var __reflect=this&&this.__reflect||function(t,e,o){t.__class__=e,o?o.push(e):o=[e],t.__types__=t.__types__?o.concat(t.__types__):o},__extends=this&&this.__extends||function(t,e){function o(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);o.prototype=e.prototype,t.prototype=new o},__awaiter=this&&this.__awaiter||function(t,e,o,n){return new(o||(o=Promise))(function(i,r){function a(t){try{l(n.next(t))}catch(e){r(e)}}function s(t){try{l(n["throw"](t))}catch(e){r(e)}}function l(t){t.done?i(t.value):new o(function(e){e(t.value)}).then(a,s)}l((n=n.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){function o(t){return function(e){return n([t,e])}}function n(o){if(i)throw new TypeError("Generator is already executing.");for(;l;)try{if(i=1,r&&(a=r[2&o[0]?"return":o[0]?"throw":"next"])&&!(a=a.call(r,o[1])).done)return a;switch(r=0,a&&(o=[0,a.value]),o[0]){case 0:case 1:a=o;break;case 4:return l.label++,{value:o[1],done:!1};case 5:l.label++,r=o[1],o=[0];continue;case 7:o=l.ops.pop(),l.trys.pop();continue;default:if(a=l.trys,!(a=a.length>0&&a[a.length-1])&&(6===o[0]||2===o[0])){l=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){l.label=o[1];break}if(6===o[0]&&l.label<a[1]){l.label=a[1],a=o;break}if(a&&l.label<a[2]){l.label=a[2],l.ops.push(o);break}a[2]&&l.ops.pop(),l.trys.pop();continue}o=e.call(t,l)}catch(n){o=[6,n],r=0}finally{i=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}var i,r,a,s,l={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:o(0),"throw":o(1),"return":o(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s},cdcommon;!function(t){var e;!function(t){var e;!function(t){var e=function(){function t(t){void 0===t&&(t=!1),this.keys=[],this.values=[],this.isCache=t}return Object.defineProperty(t.prototype,"count",{get:function(){return this.getKeysCount()},enumerable:!0,configurable:!0}),t.prototype.add=function(t,e){return this.isCache&&(this[t]=e),this.keys.push(t),this.values.push(e)},t.prototype.remove=function(t){var e=this.keys.indexOf(t,0);this.keys.splice(e,1),this.values.splice(e,1),this.isCache&&delete this[t]},t.prototype.clear=function(){for(var t=this.getKeys(),e=t.length,o=0;e>o;o++)this.remove(t[o]),o--,e--},t.prototype.getKeysCount=function(){return this.keys.length},t.prototype.setValue=function(t,e){var o=this.keys.indexOf(t,0);return-1!=o?(this.keys[o]=t,this.values[o]=e,this.isCache&&(this[t]=e),!0):!1},t.prototype.getValue=function(t){var e=this.keys.indexOf(t,0);return-1!=e?this.values[e]:null},t.prototype.containsKey=function(t){for(var e=this.keys,o=0;o<e.length;++o)if(e[o]==t)return!0;return!1},t.prototype.getKeys=function(){return this.keys},t.prototype.getValues=function(){return this.values},t}();t.Dictionary=e,__reflect(e.prototype,"cdcommon.framework.utils.Dictionary")}(e=t.utils||(t.utils={}))}(e=t.framework||(t.framework={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(t){var e;!function(t){var e=function(){function t(){}return t.TOP_LAYER=2,t.DESIGN_LAYER=1,t.BOTTOM_LAYER=-1,t}();t.LayerConstant=e,__reflect(e.prototype,"cdcommon.editor.constants.LayerConstant")}(e=t.constants||(t.constants={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(t){var e;!function(t){var e=function(){function t(){}return t.TYPE_PHOTO="photo",t.TYPE_TEXT="text",t.TYPE_BACKGROUND="background",t.TYPE_DECORATION="decoration",t.TYPE_SPECIAL="special",t.TYPE_SMART_CALENDAR="smart_calendar",t.TYPE_SMART_CONTACTS_GRID="smart_contacts_grid",t}();t.ElementConstant=e,__reflect(e.prototype,"cdcommon.editor.constants.ElementConstant")}(e=t.constants||(t.constants={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(t){var e;!function(t){var e=function(){function t(){}return t.WECHAT="wechat",t.WECHAT_APP="wechatApp",t.TAOBAO="taobao",t.WEB="web",t.APP="app",t}();t.RunPlatformConstant=e,__reflect(e.prototype,"cdcommon.framework.constants.RunPlatformConstant")}(e=t.constants||(t.constants={}))}(e=t.framework||(t.framework={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(t){var e;!function(t){var e=function(){function t(){}return t.PHOTO="PH_",t.DECORATION="DE_",t.FRAME="FR_",t.TEXT="TX_",t.BACKGROUND="BG_",t.SPECIAL="SP_",t.SMART="SM_",t.PAGE="PAGE_",t.COVER="cover",t.INPAGE_GROUP="inpage",t}();t.IDPrefixConstant=e,__reflect(e.prototype,"cdcommon.editor.constants.IDPrefixConstant")}(e=t.constants||(t.constants={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(t){var e;!function(t){var e=egret.EventDispatcher,o=function(t){function e(){var e=t.call(this)||this;return e.id="",e.x=0,e.y=0,e.width=0,e.height=0,e.rotation=0,e.alpha=100,e.locked=0,e.scale=1,e.visible=1,e}return __extends(e,t),e.prototype.toJsonObject=function(){var t={};return t.id=this.id,t.x=this.x,t.y=this.y,t.width=this.width,t.height=this.height,t.rotation=this.rotation,t.alpha=this.alpha,t.locked=this.locked,t.scale=this.scale,t.visible=this.visible,t},e.prototype.fillByObject=function(t){try{this.id=t.id,this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this.rotation=t.rotation,this.alpha=t.alpha,this.locked=t.locked,this.scale=t.scale,this.visible=t.visible}catch(e){console.log("填充对象属性时发生异常：",e.message)}},e.prototype.clone=function(){throw new Error("父级无法克隆，应由具体子类实现")},e.prototype.fillValue=function(t,e){try{this[t]=e}catch(o){console.log("填充对象属性时发生异常："+o.message)}},e}(e);t.InteractiveObjectModel=o,__reflect(o.prototype,"cdcommon.editor.models.InteractiveObjectModel",["cdcommon.framework.objecthandles.IHandleObject","egret.IEventDispatcher","Object"])}(e=t.models||(t.models={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(t){var e;!function(t){var e=function(){function t(){}return t}();t.UserModel=e,__reflect(e.prototype,"cdcommon.framework.models.UserModel")}(e=t.models||(t.models={}))}(e=t.framework||(t.framework={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(t){var e;!function(t){var e=function(){function t(){}return t}();t.TextFontPartModel=e,__reflect(e.prototype,"cdcommon.editor.models.TextFontPartModel")}(e=t.models||(t.models={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(t){var e;!function(t){var e=function(){function t(){}return t.getID=function(t){void 0===t&&(t=null);var e=this.date.getFullYear().toString()+this.date.getMonth().toString();e=e+this.date.getDate().toString()+this.date.getHours().toString(),e=e+this.date.getMilliseconds().toString()+this.date.getMinutes().toString();for(var o=0;o<this.COUNT;o++)e+=Math.floor(Math.random()*this.MAX_NUMBER).toString();return null!=t&&(e+=t),e},t.COUNT=3,t.MAX_NUMBER=1e3,t.date=new Date,t}();t.UniqueID=e,__reflect(e.prototype,"cdcommon.framework.utils.UniqueID")}(e=t.utils||(t.utils={}))}(e=t.framework||(t.framework={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(e){var o;!function(e){var o=t.framework.utils.Dictionary,n=function(){function t(){this.map=null,this.map=new o}return t.prototype.put=function(t,e){this.map.add(t,e)},t.prototype.putEntry=function(t){this.put(t.key,t.value)},t.prototype.remove=function(t){var e=this.map.getValue(t);return this.map.remove(t),e},t.prototype.containsKey=function(t){return this.map.containsKey(t)},t.prototype.containsValue=function(t){for(var e=this.map.getKeys(),o=0,n=e;o<n.length;o++){var i=n[o];if(this.map.getValue(i)==t)return!0}return!1},t.prototype.getKey=function(t){for(var e=void 0,o=this.map.getKeys(),n=0,i=o;n<i.length;n++){var r=i[n];if(this.map.getValue(r)==t){e=r;break}}return e},t.prototype.getKeys=function(){return this.map.getKeys()},t.prototype.getValue=function(t){return this.map.getValue(t)},t.prototype.getValues=function(){return this.map.getValues()},t.prototype.size=function(){return this.map.count},t.prototype.isEmpty=function(){return this.size()<=0},t.prototype.clear=function(){this.map.clear()},t.prototype.clearAllExcept=function(t){for(var e=this.map.getKeys(),o=e.length,n=0;o>n;n++)e[n]!=t&&(this.map.remove(e[n]),n--,o--)},t.prototype.getEntries=function(){for(var t=new Array,o=this.map.getKeys(),n=0,i=o;n<i.length;n++){var r=i[n];t.push(new e.HashMapEntry(r,this.map.getValue(r)))}return t},t}();e.HashMap=n,__reflect(n.prototype,"cdcommon.framework.hashmap.HashMap")}(o=e.hashmap||(e.hashmap={}))}(e=t.framework||(t.framework={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(t){var e;!function(t){var e=function(){function t(){this.id="",this.name="",this.index=0,this.thumb_url="",this.width=30,this.height=30}return Object.defineProperty(t.prototype,"kind",{get:function(){return null},set:function(t){},enumerable:!0,configurable:!0}),t}();t.MaterialItemBase=e,__reflect(e.prototype,"cdcommon.editor.models.MaterialItemBase")}(e=t.models||(t.models={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(e){var o;!function(e){var o=t.editor.models.TextFontPartModel,n=function(){function t(){}return t.getFontFaceDeclaration=function(t,e){var o="\n                    @font-face \n                    {\n                        font-family: '"+t+"';\n                        src:url('"+e+".ttf') format('truetype'),\n                            url('"+e+".woff') format('woff');\n                        font-weight: normal;\n                        font-style: normal;\n                    }\n                ";return o},t.getFontParts=function(e,n){for(var i=[],r=0;r<e.length;r++){var a=new o,s=e.charAt(r),l=this.str6763.indexOf(s);-1!=l&&(a["char"]=s,a.charIndex=r,a.fontIndex=Math.floor(l/t.SPLIT_GAP)+1,a.fontName=n+a.fontIndex,i.push(a))}return i},t.removeDuplicates=function(t){return t.filter(this._removeDuplicatesFilter)},t._removeDuplicatesFilter=function(t,e,o){return 0==e?!0:-1==o.lastIndexOf(t,e-1)},t.str6763="",t.SPLIT_GAP=500,t.fonts=[],t}();e.TextFontUtil=n,__reflect(n.prototype,"cdcommon.editor.utils.TextFontUtil")}(o=e.utils||(e.utils={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(t){var e;!function(t){var e=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._kind="font",e.font_family="",e.fontName_ch="",e.fontName_en="",e}return __extends(e,t),Object.defineProperty(e.prototype,"kind",{get:function(){return this._kind},set:function(t){this._kind=t},enumerable:!0,configurable:!0}),e}(t.MaterialItemBase);t.FontItem=e,__reflect(e.prototype,"cdcommon.editor.models.FontItem")}(e=t.models||(t.models={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(t){var e;!function(t){var e=function(){function t(){}return t}();t.TextFontUrlModel=e,__reflect(e.prototype,"cdcommon.editor.models.TextFontUrlModel")}(e=t.models||(t.models={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(t){var e;!function(t){var e=egret.Event,o=function(t){function e(e,o,n,i,r){var a=t.call(this,e,o,n,i)||this;return a.detail=r,a}return __extends(e,t),e.prototype.clone=function(){var t=new e(this.type,this.bubbles,this.cancelable,this.data);return t.detail=this.detail,t},e.CLOSE="componentClose",e}(e);t.CloseEvent=o,__reflect(o.prototype,"cdcommon.framework.events.CloseEvent")}(e=t.events||(t.events={}))}(e=t.framework||(t.framework={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(e){var o;!function(e){var o=eui.Rect,n=t.framework.hashmap.HashMap,i=function(){function t(){}return t.contains=function(e){return t.popupedDisplayCaches.containsKey(e)},t.addPopUp=function(e,n,i){void 0===n&&(n=null),void 0===i&&(i=!1),n||(n=GlobalCommon.rootContainer);var r;i&&(r=new o,r.percentWidth=r.percentHeight=100,r.touchEnabled=!0,r.fillColor=t.MODAL_COLOR,r.fillAlpha=t.MODAL_ALPHA,n.addChild(r)),n.addChild(e),t.popupedDisplayCaches.containsKey(e)||t.popupedDisplayCaches.put(e,r)},t.centerPopUp=function(t){t.parent&&(t.x=(t.parent.width-t.width)/2,t.y=(t.parent.height-t.height)/2)},t.removePopUp=function(e){if(t.contains(e)){if(e.parent){var o=t.popupedDisplayCaches.getValue(e);o&&e.parent.removeChild(o),e.parent.removeChild(e),e.filters=null}t.popupedDisplayCaches.remove(e)}},t.MODAL_COLOR=0,t.MODAL_ALPHA=.5,t.popupedDisplayCaches=new n,t}();e.PopUpManager=i,__reflect(i.prototype,"cdcommon.framework.managers.PopUpManager")}(o=e.managers||(e.managers={}))}(e=t.framework||(t.framework={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(t){var e;!function(t){var e=function(){function t(){this.urlInfos=[],this.success=!1}return t.prototype.containsFont=function(t){for(var e,o,n=0,i=this.urlInfos;n<i.length;n++)if(o=i[n],o.name==t){e=!0;break}return e},t.prototype.checkLoadComplete=function(t){for(var e,o=!0,n=0,i=this.urlInfos;n<i.length;n++)e=i[n],-1==t.indexOf(e.name)&&(o=!1);return o},t}();t.TextFontLoadModel=e,__reflect(e.prototype,"cdcommon.editor.models.TextFontLoadModel")}(e=t.models||(t.models={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(t){var e;!function(t){var e=function(){function t(){}return t.setPrecision=function(t,e){return e=Math.pow(10,e),Math.round(t*e)/e},t.isNegativeZero=function(t){return 0===t&&0>1/t},t}();t.NumberConvertionUtil=e,__reflect(e.prototype,"cdcommon.framework.utils.NumberConvertionUtil")}(e=t.utils||(t.utils={}))}(e=t.framework||(t.framework={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(t){var e;!function(t){var e=function(){function t(){}return t.AUTO_GENERATE_LAYOUT="autoGen",t.AUTO_APPLY_LAYOUT="autoApp",t.NORMAL="normal",t.ADVANCED="advanced",t.PRINTING="printing",t}();t.EditorModeConstant=e,__reflect(e.prototype,"cdcommon.editor.constants.EditorModeConstant")}(e=t.constants||(t.constants={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(t){var e;!function(t){var e=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._kind="photo",e.url="",e.source=null,e.fileRef=null,e.processedSize=0,e.ext="",e.type="",e.size=0,e.native_path="",e.folderName="",e.facesInfoJson="",e.usedCount=0,e.selectedIndex=1,e.selected=!1,e.status=0,e.uploadingPercent=0,e.uploadErrorMsg="",e}return __extends(e,t),Object.defineProperty(e.prototype,"kind",{get:function(){return this._kind},set:function(t){this._kind=t},enumerable:!0,configurable:!0}),e.prototype.fillByPhotoVO=function(t){this.id=t.ph_id,this.native_path=t.url,this.url=t.url,this.ext=t.ext,this.size=t.org_size,this.name=t.org_name},e}(t.MaterialItemBase);t.PhotoItem=e,__reflect(e.prototype,"cdcommon.editor.models.PhotoItem")}(e=t.models||(t.models={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(e){var o;!function(e){var o=t.framework.constants.RunPlatformConstant,n=function(){function t(){}return t.isAgentMode=function(){var t=UserModelController.getInstance().userModel;return t?null!=t.agentInfo:!1},t.SERVICES_URL="http://cms.meiin.com",t.API_CONFIG_URL=t.SERVICES_URL+"/ds/api_config.xml",t.runPlatform=o.TAOBAO,t.versionInfo="",t.versionNumber="",t}();e.GlobalCommon=n,__reflect(n.prototype,"cdcommon.framework.models.GlobalCommon")}(o=e.models||(e.models={}))}(e=t.framework||(t.framework={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(t){var e;!function(t){var e=egret.EventDispatcher,o=function(e){function o(){var o=null!==e&&e.apply(this,arguments)||this;return o.enabled=!0,o._currentState=t.TaskState.UNSTARTED,o}return __extends(o,e),Object.defineProperty(o.prototype,"currentState",{get:function(){return this._currentState},enumerable:!0,configurable:!0}),o.prototype.setCurrentState=function(t){this._currentState=t},o.prototype.start=function(){this.dispatchEvent(t.TaskEvent.createStartEvent(this)),this.setCurrentState(t.TaskState.RUNNING),this.performTask()},o.prototype.performTask=function(){throw new Error("abstract function call")},o.prototype.complete=function(){this._currentState==t.TaskState.RUNNING&&(this.setCurrentState(t.TaskState.COMPLETED),this.dispatchEvent(t.TaskEvent.createCompleteEvent(this)))},o.prototype.fault=function(e){void 0===e&&(e=null),this._currentState==t.TaskState.RUNNING&&(this.setCurrentState(t.TaskState.FAULT),this.dispatchEvent(t.TaskEvent.createFaultEvent(this,e)))},o}(e);t.Task=o,__reflect(o.prototype,"cdcommon.framework.task.Task",["cdcommon.framework.task.ITask","egret.IEventDispatcher"])}(e=t.task||(t.task={}))}(e=t.framework||(t.framework={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(t){var e;!function(t){var e=function(){function t(){}return t.isFace=function(e){return-1!=t.faceTypeIDs.indexOf(e)},t.isInpage=function(e){return-1!=t.inpageTypeIDs.indexOf(e)},t.isBackPage=function(e){return-1!=t.backPageTypeIDs.indexOf(e)},t.COVER=0,t.INPAGE=1,t.BACK=2,t.faceTypeIDs=[t.COVER],t.inpageTypeIDs=[t.INPAGE],t.backPageTypeIDs=[t.BACK],t}();t.PageTypeConstant=e,__reflect(e.prototype,"cdcommon.editor.constants.PageTypeConstant")}(e=t.constants||(t.constants={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(e){var o;!function(e){var o=t.editor.constants.LayerConstant,n=function(t){function e(){var e=t.call(this)||this;return e.index=0,e.layer=o.DESIGN_LAYER,e.relatedId="",e.relatedDbId="",e.relatedPageId="",e.relatedPageIndex=0,e.remark="",e.isDelete=!1,e.shadowEnable=!1,e.shadowColor="#000000",e.shadowDistance=4,e.shadowBlur=10,e.shadowAlpha=100,e.shadowAngle=45,e}return __extends(e,t),Object.defineProperty(e.prototype,"elementType",{get:function(){return"element base"},set:function(t){},enumerable:!0,configurable:!0}),e.prototype.toJsonObject=function(){var e=t.prototype.toJsonObject.call(this);return e.elementType=this.elementType,e.index=this.index,e.layer=this.layer,e.relatedId=this.relatedId,e.relatedDbId=this.relatedDbId,e.relatedPageId=this.relatedPageId,e.relatedPageIndex=this.relatedPageIndex,e.remark=this.remark,e.isDelete=this.isDelete.toString(),e.shadowEnable=this.shadowEnable,e.shadowColor=this.shadowColor,e.shadowDistance=this.shadowDistance,e.shadowBlur=this.shadowBlur,e.shadowAlpha=this.shadowAlpha,e.shadowAngle=this.shadowAngle,e},e.prototype.fillByObject=function(e){t.prototype.fillByObject.call(this,e),this.elementType=e.elementType,this.index=e.index,this.layer=e.layer,this.relatedId=e.relatedId,this.relatedDbId=e.relatedDbId,this.relatedPageId=e.relatedPageId,this.relatedPageIndex=e.relatedPageIndex,this.remark=e.remark,e.hasOwnProperty("isDelete")&&(this.isDelete="true"==e.isDelete.toString()),this.shadowEnable=e.shadowEnable,this.shadowColor=e.shadowColor,this.shadowDistance=e.shadowDistance,this.shadowBlur=e.shadowBlur,this.shadowAlpha=e.shadowAlpha,this.shadowAngle=e.shadowAngle},e}(e.InteractiveObjectModel);e.ElementModelBase=n,__reflect(n.prototype,"cdcommon.editor.models.ElementModelBase")}(o=e.models||(e.models={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(t){var e;!function(t){var e=egret.EventDispatcher,o=function(t){function e(e){var o=t.call(this)||this;return o._existedFontFamilyArr=[],o}return __extends(e,t),e.prototype.clear=function(){this._existedFontFamilyArr.splice(0)},e.prototype.savaFontDefinition=function(t){-1==this._existedFontFamilyArr.indexOf(t)&&this._existedFontFamilyArr.push(t)},e.prototype.hasFontDefinition=function(t){var e;return-1!=this._existedFontFamilyArr.indexOf(t)&&(e=!0),e},e.getInstance=function(){return this._inst||(this._inst=new e(new n)),this._inst},e}(e);t.FontInfoCachesManager=o,__reflect(o.prototype,"cdcommon.editor.managers.FontInfoCachesManager");var n=function(){function t(){}return t}();__reflect(n.prototype,"SingletonEnforcer")}(e=t.managers||(t.managers={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(e){var o;!function(e){var o=t.framework.utils.UniqueID,n=t.editor.constants.IDPrefixConstant,i=t.editor.constants.ElementConstant,r=function(){function t(){}return t.getElementModelID=function(t){var e,r=o.getID();switch(t){case i.TYPE_PHOTO:e=n.PHOTO+r;break;case i.TYPE_TEXT:e=n.TEXT+r;break;case i.TYPE_DECORATION:e=n.DECORATION+r;break;case i.TYPE_BACKGROUND:e=n.BACKGROUND+r;break;case i.TYPE_SPECIAL:e=n.SPECIAL+r;break;case i.TYPE_SMART_CONTACTS_GRID:e=n.SMART+r;break;case i.TYPE_SMART_CALENDAR:e=n.SMART+r}return e},t.getMaterialItemID=function(t){var e=o.getID();return t+e},t}();e.IDFactory=r,__reflect(r.prototype,"cdcommon.editor.factories.IDFactory")}(o=e.factories||(e.factories={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(t){var e;!function(t){var e=function(){function t(){this.id="",this.tid="",this.pid="",this.type=0,this.index=0,this.name="",this.mask_count=0,this.spread=0,this.stage_content=""}return t}();t.SWPageItem=e,__reflect(e.prototype,"cdcommon.editor.models.SWPageItem")}(e=t.models||(t.models={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(e){var o;!function(e){var o=eui.Panel,n=eui.Button,i=eui.UIEvent,r=t.framework.events.CloseEvent,a=egret.TouchEvent,s=egret.DropShadowFilter,l=t.framework.models.GlobalCommon,d=t.framework.managers.PopUpManager,c=function(t){function e(){var o=t.call(this)||this;return o.buttonFlags=e.OK,o.source=null,o._text="",o}return __extends(e,t),Object.defineProperty(e.prototype,"text",{get:function(){return this._text},set:function(t){this._text=t,this.contentComp&&(this.contentComp.text=this._text)},enumerable:!0,configurable:!0}),e.resetLabels=function(){e.yesLabel=e.LABEL_TEXT_YES,e.noLabel=e.LABEL_TEXT_NO,e.okLabel=e.LABEL_TEXT_OK,e.cancelLabel=e.LABEL_TEXT_CANCEL,e.buttonWidth=e.BUTTON_WIDTH_DEFAULT,e.buttonHeight=e.BUTTON_HEIGHT_DEFAULT},e.showConfirm=function(t,o,n,a,s,c,h,u,m,p){void 0===o&&(o=""),void 0===n&&(n=""),void 0===a&&(a=e.OK),void 0===s&&(s=null),void 0===c&&(c=null),void 0===h&&(h=null),void 0===u&&(u=!1),void 0===m&&(m=null),void 0===p&&(p=null);var f=new e;return f.source=t,f.text=o,f.title=n,m?f.skinName=m:f.skinName="app.AlertPicConfirmSkin",(a&e.OK||a&e.CANCEL||a&e.YES||a&e.NO)&&(f.buttonFlags=a),null!=c&&f.once(r.CLOSE,function(t){c.apply(h,[t.clone()]),c=null},this),p&&(f.buttonSkinClasses=p),s||(s=l.rootContainer),f.addEventListener(i.CREATION_COMPLETE,e.static_creationCompleteHandler,this),d.addPopUp(f,s,u),d.centerPopUp(f),f},e.show=function(t,o,n,a,s,c,h,u){void 0===o&&(o=""),void 0===n&&(n=""),void 0===a&&(a=null),void 0===s&&(s=null),void 0===c&&(c=null),void 0===h&&(h=!1),void 0===u&&(u=null);var m=new e;return m.source=t,m.text=o,m.title=n,u&&(m.skinName=u),null!=s&&m.once(r.CLOSE,function(t){s.apply(c,[t.clone()]),s=null},this),a||(a=l.rootContainer),m.once(i.CREATION_COMPLETE,e.static_creationCompleteHandler,this),d.addPopUp(m,a,h),d.centerPopUp(m),m},e.static_creationCompleteHandler=function(t){if(t.target instanceof e&&2==t.eventPhase){var o=t.target;if(o.buttonFlags&&o.buttonGroup){var n,i=o.buttonFlags;i&e.OK&&(n=e.okLabel,o.createButton(n,"OK")),i&e.YES&&(n=e.yesLabel,o.createButton(n,"YES")),i&e.NO&&(n=e.noLabel,o.createButton(n,"NO")),i&e.CANCEL&&(n=e.cancelLabel,o.createButton(n,"CANCEL"))}else o.okButton.width=e.buttonWidth,o.okButton.height=e.buttonHeight}},e.prototype.partAdded=function(o,n){t.prototype.partAdded.call(this,o,n),n==this.imageComp?this.imageComp.source=this.source:n==this.contentComp?this.contentComp.text=this.text:(n==this.yesButton||n==this.noButton||n==this.okButton||n==this.cancelButton)&&(n==this.yesButton?this.yesButton.label=e.yesLabel:n==this.noButton?this.noButton.label=e.noLabel:n==this.okButton?this.okButton.label=e.okLabel:n==this.cancelButton&&(this.cancelButton.label=e.cancelLabel),n.addEventListener(a.TOUCH_TAP,this.onFlagButtonClick,this))},e.prototype.partRemoved=function(e,o){t.prototype.partRemoved.call(this,e,o),o==this.imageComp?this.imageComp.source=null:o==this.contentComp?this.contentComp.text=null:(o==this.yesButton||o==this.noButton||o==this.okButton||o==this.cancelButton)&&o.removeEventListener(a.TOUCH_TAP,this.onFlagButtonClick,this)},e.prototype.onFlagButtonClick=function(t){var o=t.currentTarget;o.removeEventListener(a.TOUCH_TAP,this.onFlagButtonClick,this);var n=o.name,i=new r(r.CLOSE);"YES"==n||o==this.yesButton?i.detail=e.YES:"NO"==n||o==this.noButton?i.detail=e.NO:"OK"==n||o==this.okButton?i.detail=e.OK:("CANCEL"==n||o==this.cancelButton)&&(i.detail=e.CANCEL),this.dispatchEvent(i),d.removePopUp(this)},e.prototype.createButton=function(t,o){var i=new n;if(i.label=t,i.name=o,i.addEventListener(a.TOUCH_TAP,this.onFlagButtonClick,this),i.width=e.buttonWidth,i.height=e.buttonHeight,this.buttonSkinClasses&&this.buttonSkinClasses.length>0){var r=this.buttonSkinClasses.shift();i.skinName=r}return this.buttonGroup.addChild(i),i},e.prototype.getFilter=function(){var t=new s;return t.blurX=t.blurY=7,t.alpha=.3,[t]},e.YES=1,e.NO=2,e.OK=4,e.CANCEL=8,e.LABEL_TEXT_YES="是",e.LABEL_TEXT_NO="否",e.LABEL_TEXT_OK="确定",e.LABEL_TEXT_CANCEL="取消",e.yesLabel=e.LABEL_TEXT_YES,e.noLabel=e.LABEL_TEXT_NO,e.okLabel=e.LABEL_TEXT_OK,e.cancelLabel=e.LABEL_TEXT_CANCEL,e.BUTTON_WIDTH_DEFAULT=80,e.BUTTON_HEIGHT_DEFAULT=35,e.buttonWidth=e.BUTTON_WIDTH_DEFAULT,e.buttonHeight=e.BUTTON_HEIGHT_DEFAULT,e}(o);e.AlertPic=c,__reflect(c.prototype,"cdcommon.framework.components.AlertPic")}(o=e.components||(e.components={}))}(e=t.framework||(t.framework={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(t){var e;!function(t){var e=function(){function t(){}return Object.defineProperty(t,"Alert_COMPLETE",{get:function(){return RES.getRes("alert_complete_png")},enumerable:!0,configurable:!0}),Object.defineProperty(t,"Alert_ERROR",{get:function(){return RES.getRes("alert_error_png")},enumerable:!0,configurable:!0}),Object.defineProperty(t,"Alert_WARNING",{get:function(){return RES.getRes("alert_warning_png")},enumerable:!0,configurable:!0}),t}();t.IconCommonProvider=e,__reflect(e.prototype,"cdcommon.framework.models.IconCommonProvider")}(e=t.models||(t.models={}))}(e=t.framework||(t.framework={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(t){var e;!function(t){var e=function(){function e(){}return Object.defineProperty(e,"dateFormatter",{get:function(){return e._dateFormatter||(e._dateFormatter=new t.DateFormatter),e._dateFormatter},enumerable:!0,configurable:!0}),Object.defineProperty(e,"objDaysOfWeek",{get:function(){return e._objDaysOfWeek||(e._objDaysOfWeek={},e._objDaysOfWeek[e.SUNDAY]=0,e._objDaysOfWeek[e.MONDAY]=1,e._objDaysOfWeek[e.TUESDAY]=2,e._objDaysOfWeek[e.WEDNESDAY]=3,e._objDaysOfWeek[e.THURSDAY]=4,e._objDaysOfWeek[e.FRIDAY]=5,e._objDaysOfWeek[e.SATURDAY]=6),e._objDaysOfWeek},enumerable:!0,configurable:!0}),Object.defineProperty(e,"objMonth",{get:function(){return e._objMonth||(e._objMonth={},e._objMonth[e.JANUARY]=0,e._objMonth[e.FEBRUARY]=1,e._objMonth[e.MARCH]=2,e._objMonth[e.APRIL]=3,e._objMonth[e.MAY]=4,e._objMonth[e.JUNE]=5,e._objMonth[e.JULY]=6,e._objMonth[e.AUGUST]=7,e._objMonth[e.SEPTEMBER]=8,e._objMonth[e.OCTOBER]=9,e._objMonth[e.NOVEMBER]=10,e._objMonth[e.DECEMBER]=11),e._objMonth},enumerable:!0,configurable:!0}),e.removeInvalidDateTimeCharacters=function(t,e,o){return t.replace(new RegExp(e,"ig"),"").length>0&&(t=o),t.replace(new RegExp("TZD","i"),"tzd")},e.dateTimeFormat=function(t,o){return void 0===o&&(o="MM/DD/YYYY L:NN:SS A"),e.buildDateTime(t,o,"(Y|M|D|E|A|J|H|K|L|N|S|TZD|\\W)+",e.SHORT_DATE_MASK+" "+e.MEDIUM_TIME_MASK)},e.timeFormat=function(t,o){return void 0===o&&(o=e.SHORT_TIME_MASK),e.buildDateTime(t,o,"(A|:|J|H|K|L|N|S|TZD|\\s)+",e.SHORT_TIME_MASK)},e.dateFormat=function(t,o){return void 0===o&&(o=e.SHORT_DATE_MASK),e.buildDateTime(t,o,"(Y|M|D|E|\\W)+",e.SHORT_DATE_MASK)},e.buildDateTime=function(t,o,n,i){return e.dateFormatter.formatString=e.removeInvalidDateTimeCharacters(o,n,i),e.dateFormatter.format(t).replace(new RegExp("TZD","i"),e.buildTimeZoneDesignation(t))},e.buildTimeZoneDesignation=function(t){if(!t)return"";var e="GMT ";return t.getTimezoneOffset()/60>0&&t.getTimezoneOffset()/60<10?e+="-0"+(t.getTimezoneOffset()/60).toString():t.getTimezoneOffset()<0&&t.getTimezoneOffset()/60>-10&&(e+="0"+(-1*t.getTimezoneOffset()/60).toString()),e+="00"},e.dateAdd=function(t,o,n){var i=new Date(n.getTime());switch(t){case e.YEAR:i.setFullYear(i.getFullYear()+o);break;case e.MONTH:i.setMonth(i.getMonth()+o);break;case e.DAY_OF_MONTH:i.setDate(i.getDate()+o);break;case e.HOURS:i.setHours(i.getHours()+o);break;case e.MINUTES:i.setMinutes(i.getMinutes()+o);break;case e.SECONDS:i.setSeconds(i.getSeconds()+o);break;case e.MILLISECONDS:i.setMilliseconds(i.getMilliseconds()+o);break;case e.WEEK:i.setDate(i.getDate()+7*o)}return i},e.dayOfWeek=function(t){return t.getDay()},e.dayOfYear=function(t){return e.dateDiff(e.DAY_OF_MONTH,new Date(t.getFullYear(),e.monthAsNumber(e.JANUARY),1),t)+1},e.weekOfYear=function(t){var o;return e.dateDiff(e.DAY_OF_MONTH,new Date(t.getFullYear(),e.monthAsNumber(e.DECEMBER),29),t)>=0?(o=e.getISOWeekOne(t.getFullYear()+1),e.dateDiff(e.DAY_OF_MONTH,t,o)>0&&(o=e.getISOWeekOne(t.getFullYear()))):(o=e.getISOWeekOne(t.getFullYear()),e.dateDiff(e.DAY_OF_MONTH,t,o)>0&&(o=e.getISOWeekOne(t.getFullYear()-1))),Math.floor(e.dateDiff(e.DAY_OF_MONTH,o,t)/7+1)},e.getISOWeekOne=function(t){var o=new Date(t,e.monthAsNumber(e.JANUARY),4),n=e.dayOfWeek(o);return 0==n&&(n=7),e.dateAdd(e.DAY_OF_MONTH,1-n,o)},e.toFlexDayOfWeek=function(t){return t>0&&8>t?t-1:0},e.dayOfWeekIterationOfMonth=function(t,o,n){var i=e.dayOfWeekAsNumber(o),r=new Date(n.getFullYear(),n.getMonth(),1),a=i-e.dayOfWeek(r);0>a&&(a+=7);var s=e.dateAdd(e.DAY_OF_MONTH,a,r);return 1==t?s:((e.totalDayOfWeekInMonth(o,n)<t||t==e.LAST)&&(t=e.totalDayOfWeekInMonth(o,n)),e.dateAdd(e.WEEK,t-1,s))},e.daysInMonth=function(t){t=new Date(t.getFullYear(),t.getMonth(),1);var o=new Date(t.getFullYear(),e.dateAdd(e.MONTH,1,t).getMonth(),1);return e.dateAdd(e.DAY_OF_MONTH,-1,o).getDate()},e.totalDayOfWeekInMonth=function(t,o){var n=e.dayOfWeekIterationOfMonth(1,t,o),i=e.dateDiff(e.DAY_OF_MONTH,n,new Date(o.getFullYear(),o.getMonth(),e.daysInMonth(o)));return Math.floor(i/7)+1},e.toFlexMonth=function(t){return t>0&&13>t?t-1:0},e.isDate=function(t){return Date.parse(t)>0},e.dayOfWeekAsString=function(t){return e.dateFormat(t,"EEEE")},e.dayOfWeekAsNumber=function(t){return e.objDaysOfWeek[t]>=0?e.objDaysOfWeek[t]:-1},e.monthAsString=function(t){return e.dateFormat(t,"MMMM")},e.monthAsNumber=function(t){return e.objMonth[t]>=0?e.objMonth[t]:-1},e.weeksInMonth=function(t){var o=0,n=e.daysInMonth(t),i=7-e.dayOfWeek(new Date(t.getFullYear(),t.getMonth(),1)),r=(n-i)%7;return o+=Math.floor((n-i)/7)+1,0!=r&&(o+=1),o},e.daysInYear=function(t){return e.dateDiff(e.DAY_OF_MONTH,new Date(t.getFullYear(),e.monthAsNumber(e.JANUARY),1),e.dateAdd(e.YEAR,1,new Date(t.getFullYear(),e.monthAsNumber(e.JANUARY),1)))},e.isLeapYear=function(t){return e.daysInYear(t)>365},e.dateDiff=function(t,o,n){var i=0;switch(t){case e.MILLISECONDS:var r=60*(o.getTimezoneOffset()-n.getTimezoneOffset())*1e3;i=n.getTime()-o.getTime()+r;break;case e.SECONDS:i=Math.floor(e.dateDiff(e.MILLISECONDS,o,n)/e.SECOND_VALUE);break;case e.MINUTES:i=Math.floor(e.dateDiff(e.MILLISECONDS,o,n)/e.MINUTE_VALUE);break;case e.HOURS:i=Math.floor(e.dateDiff(e.MILLISECONDS,o,n)/e.HOUR_VALUE);break;case e.DAY_OF_MONTH:i=Math.floor(e.dateDiff(e.MILLISECONDS,o,n)/e.DAY_VALUE);break;case e.WEEK:i=Math.floor(e.dateDiff(e.MILLISECONDS,o,n)/e.WEEK_VALUE);break;case e.MONTH:e.dateDiff(e.MILLISECONDS,o,n)<0?i-=e.dateDiff(e.MONTH,n,o):(i=12*e.dateDiff(e.YEAR,o,n),n.getMonth()!=o.getMonth()?i+=n.getMonth()<=o.getMonth()?12-o.getMonth()+n.getMonth():n.getMonth()-o.getMonth():o.getFullYear()!=n.getFullYear()&&n.getUTCDate()<o.getUTCDate()&&(i+=12),(n[e.DAY_OF_MONTH]<o[e.DAY_OF_MONTH]||n[e.DAY_OF_MONTH]==o[e.DAY_OF_MONTH]&&n[e.MILLISECONDS]<o[e.MILLISECONDS])&&(i-=1));
break;case e.YEAR:i=n.getFullYear()-o.getFullYear(),0!=i&&(0>i?(n[e.MONTH]>o[e.MONTH]||n[e.MONTH]==o[e.MONTH]&&n[e.DAY_OF_MONTH]>o[e.DAY_OF_MONTH]||n[e.MONTH]==o[e.MONTH]&&n[e.DAY_OF_MONTH]==o[e.DAY_OF_MONTH]&&n[e.MILLISECONDS]>o[e.MILLISECONDS])&&(i+=1):(n[e.MONTH]<o[e.MONTH]||n[e.MONTH]==o[e.MONTH]&&n[e.DAY_OF_MONTH]<o[e.DAY_OF_MONTH]||n[e.MONTH]==o[e.MONTH]&&n[e.DAY_OF_MONTH]==o[e.DAY_OF_MONTH]&&n[e.MILLISECONDS]<o[e.MILLISECONDS])&&(i-=1))}return i},e.MONDAY="monday",e.TUESDAY="tuesday",e.WEDNESDAY="wednesday",e.THURSDAY="thursday",e.FRIDAY="friday",e.SATURDAY="saturday",e.SUNDAY="sunday",e.JANUARY="january",e.FEBRUARY="february",e.MARCH="march",e.APRIL="april",e.MAY="may",e.JUNE="june",e.JULY="july",e.AUGUST="august",e.SEPTEMBER="september",e.OCTOBER="october",e.NOVEMBER="november",e.DECEMBER="december",e.YEAR="fullYear",e.MONTH="month",e.WEEK="week",e.DAY_OF_MONTH="date",e.HOURS="hours",e.MINUTES="minutes",e.SECONDS="seconds",e.MILLISECONDS="milliseconds",e.DAY_OF_WEEK="day",e.LAST=-1,e.SHORT_DATE_MASK="MM/DD/YY",e.MEDIUM_DATE_MASK="MMM D, YYYY",e.LONG_DATE_MASK="MMMM D, YYYY",e.FULL_DATE_MASK="EEEE, MMMM D, YYYY",e.SHORT_TIME_MASK="L:NN A",e.MEDIUM_TIME_MASK="L:NN:SS A",e.LONG_TIME_MASK=e.MEDIUM_TIME_MASK+" TZD",e.SECOND_VALUE=1e3,e.MINUTE_VALUE=60*e.SECOND_VALUE,e.HOUR_VALUE=60*e.MINUTE_VALUE,e.DAY_VALUE=24*e.HOUR_VALUE,e.WEEK_VALUE=7*e.DAY_VALUE,e._objDaysOfWeek=null,e._objMonth=null,e}();t.DateUtils=e,__reflect(e.prototype,"cdcommon.framework.utils.DateUtils")}(e=t.utils||(t.utils={}))}(e=t.framework||(t.framework={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(t){var e;!function(t){var e=function(){function t(){}return t.string2Uint=function(t){var e;if(-1!=t.indexOf("#")){var o=new RegExp(/#/g);e=parseInt(t.replace(o,"0x"))}else-1!=t.indexOf("0x")&&(e=parseInt(t));return e},t.number2StringColor=function(t){var e="000000"+t.toString(16).toUpperCase();return"#"+e.substr(e.length-6)},t}();t.ColorUtil=e,__reflect(e.prototype,"cdcommon.framework.utils.ColorUtil")}(e=t.utils||(t.utils={}))}(e=t.framework||(t.framework={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(t){var e;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e.styleID=1,e.backgroundColor=0,e.exifInfo=null,e.exifGpsJD="",e.exifGpsWD="",e.exifCreateDate="",e}return __extends(e,t),e.prototype.toJsonObject=function(){var e=t.prototype.toJsonObject.call(this);return e.styleID=this.styleID,e.backgroundColor=this.backgroundColor,e.exifGpsJD=this.exifGpsJD,e.exifGpsWD=this.exifGpsWD,e.exifCreateDate=this.exifCreateDate,e},e.prototype.fillByObject=function(e){t.prototype.fillByObject.call(this,e),this.styleID=e.styleID,this.backgroundColor=e.backgroundColor,this.exifInfo=e.exifInfo,this.exifGpsJD=e.exifGpsJD,this.exifGpsWD=e.exifGpsWD,this.exifCreateDate=e.exifCreateDate},e}(t.ElementModelBase);t.SmartElementModelBase=e,__reflect(e.prototype,"cdcommon.editor.models.SmartElementModelBase")}(e=t.models||(t.models={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(e){var o;!function(e){var o=t.framework.utils.NumberConvertionUtil,n=egret.Texture,i=egret.BitmapData,r=function(){function t(){}return t.getTypeByName=function(e){var o;return e=e.toLowerCase(),o=t.mime[t.getExtByName(e)]},t.getExtByName=function(t){t=t.toLowerCase();var e=t.match(/\.([^\.]+)$/i)[1];return e},t.scaleByMaxEdgeVarCanvas=function(t,e,n,i){void 0===n&&(n="image/png"),void 0===i&&(i=.9);var r,a=t.width,s=t.height;e=Math.min(e,Math.max(t.width,t.height));var l=e,d=o.setPrecision(t.height/t.width*e,2);d>e&&(d=e,l=o.setPrecision(t.width/t.height*e,2));var c=document.createElement("canvas");t.width*=l/t.width,t.height*=d/t.height;var h=c.getContext("2d");return h.clearRect(0,0,c.width,c.height),c.width=t.width,c.height=t.height,h.drawImage(t,0,0,t.width,t.height),r=c.toDataURL(n,i),t.width=a,t.height=s,r},t.getScaleByMaxEdge=function(t,e,n){var i=1;n=Math.min(n,Math.max(t,e));var r=n,a=o.setPrecision(e/t*n,2);return a>n&&(a=n,r=o.setPrecision(t/e*n,2)),i=o.setPrecision(r/t,3)},t.getBase64ByUrl=function(t,e,o){var n=new Image,i="";n.src=t,n.crossOrigin="anonymous",n.onload=function(){n.onload=null;for(var r,a=[".jpg",".jpeg"],s=0,l=a;s<l.length;s++){var d=l[s];if(-1!=t.toLowerCase().indexOf(d)){r="image/jpeg";break}}r||(r="image/png");var c=document.createElement("canvas"),h=n.width,u=n.height;c.width=h,c.height=u;var m=c.getContext("2d");m.drawImage(n,0,0,h,u),i=c.toDataURL(r),e?e.apply(o,[i]):null,e=null}},t.getTextureByBase64=function(t){var e=new Image;e.src=t;var o=new n,r=new i(e);return o._setBitmapData(r),o},t.getOrientation=function(t,e){var o=new FileReader;o.onload=function(t){o.onload=null;var n=new DataView(o.result);if(65496!=n.getUint16(0,!1))return e(-2);for(var i=n.byteLength,r=2;i>r;){var a=n.getUint16(r,!1);if(r+=2,65505==a){if(1165519206!=n.getUint32(r+=2,!1))return e(-1);var s=18761==n.getUint16(r+=6,!1);r+=n.getUint32(r+4,s);var l=n.getUint16(r,s);r+=2;for(var d=0;l>d;d++)if(274==n.getUint16(r+12*d,s))return e(n.getUint16(r+12*d+8,s))}else{if(65280!=(65280&a))break;r+=n.getUint16(r,!1)}}return e(-1)},o.readAsArrayBuffer(t)},t.resetOrientation=function(e,o,n,i){var r=new Image;r.onload=function(){r.onload=null;var e=r.width,a=r.height,s=document.createElement("canvas"),l=s.getContext("2d"),d=t.MIDDLE_SIZE_PX,c=t.MIDDLE_SIZE_PX;switch(e/d>a/c?e>d&&(a*=d/e,e=d):a>c&&(e*=c/a,a=c),[5,6,7,8].indexOf(o)>-1?(s.width=a,s.height=e):(s.width=e,s.height=a),o){case 2:l.transform(-1,0,0,1,e,0);break;case 3:l.transform(-1,0,0,-1,e,a);break;case 4:l.transform(1,0,0,-1,0,a);break;case 5:l.transform(0,1,1,0,0,0);break;case 6:l.transform(0,1,-1,0,a,0);break;case 7:l.transform(0,-1,-1,0,a,e);break;case 8:l.transform(0,-1,1,0,0,e);break;default:l.transform(1,0,0,1,0,0)}l.drawImage(r,0,0,s.width,s.height),n.apply(i,[s.toDataURL()])},r.src=e},t.BIG_SIZE_PX=2560,t.MIDDLE_SIZE_PX=700,t.SMARLL_SIZE_PX=200,t.mime={png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg",bmp:"image/bmp",gif:"image/jpeg"},t}();e.PhotoTools=r,__reflect(r.prototype,"cdcommon.editor.utils.PhotoTools")}(o=e.utils||(e.utils={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(e){var o;!function(e){var o=t.editor.constants.ElementConstant,n=t.editor.factories.IDFactory,i=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._elementType=o.TYPE_PHOTO,e.url="",e.url_big="",e.source=null,e.badPX=0,e.phoX=0,e.phoY=0,e.phoWidth=100,e.phoHeight=100,e.phoScale=1,e.phoRotation=0,e.phoRotated=!1,e.phoSourceWidth=0,e.phoSourceHeight=0,e.borderWidth=0,e.borderColor="#000000",e.widthMM=0,e.heightMM=0,e.frameUrl="",e.frameSource=null,e.frameMaskUrl="",e.frameMaskSource=null,e.frameWidth=300,e.frameHeight=300,e.clip=0,e.faceInfos=null,e}return __extends(e,t),Object.defineProperty(e.prototype,"elementType",{get:function(){return this._elementType},set:function(t){this._elementType=t},enumerable:!0,configurable:!0}),e.prototype.fillByObject=function(e){t.prototype.fillByObject.call(this,e),this.url=e.url,this.url_big=e.url_big,this.source=e.source,this.badPX=e.badPX,this.phoX=e.phoX,this.phoY=e.phoY,this.phoWidth=e.phoWidth,this.phoHeight=e.phoHeight,this.phoSourceWidth=e.phoSourceWidth,this.phoSourceHeight=e.phoSourceHeight,this.borderWidth=e.borderWidth,this.borderColor=e.borderColor,this.widthMM=e.widthMM,this.heightMM=e.heightMM,this.phoRotation=e.phoRotation,this.phoRotated=e.phoRotated,this.frameUrl=e.frameUrl,this.frameMaskUrl=e.frameMaskUrl,this.frameWidth=e.frameWidth,this.frameHeight=e.frameHeight,this.faceInfos=e.faceInfos,this.phoScale=e.phoScale,this.clip=e.clip?e.clip:0},e.prototype.toJsonObject=function(){var e=t.prototype.toJsonObject.call(this);return e.url=encodeURIComponent(this.url),e.url_big=encodeURIComponent(this.url_big),e.badPX=this.badPX,e.phoX=this.phoX,e.phoY=this.phoY,e.phoWidth=this.phoWidth,e.phoHeight=this.phoHeight,e.phoSourceWidth=this.phoSourceWidth,e.phoSourceHeight=this.phoSourceHeight,e.borderWidth=this.borderWidth,e.borderColor=this.borderColor,e.widthMM=this.widthMM,e.heightMM=this.heightMM,e.phoRotation=this.phoRotation,e.frameUrl=this.frameUrl,e.frameMaskUrl=this.frameMaskUrl,e.frameWidth=this.frameWidth,e.frameHeight=this.frameHeight,e.phoScale=this.phoScale,e.clip=this.clip,e},e.prototype.clone=function(){var t=new e;return t.fillByObject(this),t.id=n.getElementModelID(t.elementType),t},e}(e.ElementModelBase);e.PhotoElementModel=i,__reflect(i.prototype,"cdcommon.editor.models.PhotoElementModel")}(o=e.models||(e.models={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(e){var o;!function(e){var o=t.editor.constants.IDPrefixConstant,n=t.framework.utils.UniqueID,i=eui.ArrayCollection,r=function(){function t(){this.id="",this.wpId="",this.tpId="",this.type=0,this.basicPageInfo=null,this.elementList=new i,this.pageIndex=0,this.pageName="",this.thumbSource=null,this.scale=1,this.maskCount=0,this.printCount=1,this.id=o.PAGE+n.getID()}return t.prototype.clone=function(){var e=new t;e.tpId=this.tpId,e.type=this.type,e.basicPageInfo=this.basicPageInfo,e.pageIndex=this.pageIndex,e.pageName=this.pageName,e.clipPhoto=this.clipPhoto;for(var o=new i,n=0,r=this.elementList.source;n<r.length;n++){var a=r[n],s=a.clone();s.relatedPageId=e.id,o.addItem(s)}return e.elementList=o,e},t}();e.PageModel=r,__reflect(r.prototype,"cdcommon.editor.models.PageModel")}(o=e.models||(e.models={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(e){var o;!function(e){var o=t.framework.task.Task,n=t.editor.managers.FontInfoCachesManager,i=t.editor.utils.TextFontUtil,r=function(t){function e(e){var o=t.call(this)||this;return o.fontLoadModel=null,o.pendingItems=[],o.loadingItems=[],o._currReCallTime=0,o.fontInfoCachesManager=n.getInstance(),o.fontLoadModel=e,o}return __extends(e,t),e.prototype.getModel=function(){return this.fontLoadModel},e.prototype.performTask=function(){for(var t,e=[],o=this.fontLoadModel.urlInfos.length,n=0,i=this.fontLoadModel.urlInfos;n<i.length;n++)t=i[n],this.fontInfoCachesManager.hasFontDefinition(t.name)?e.push(t.name):this.pendingItems.push(t);e.length==o?this.overThis(!0):this.doFontLoad()},e.prototype.doFontLoad=function(){if(this.pendingItems.length>0){for(var t=[],e=void 0,o=0,n=this.pendingItems;o<n.length;o++)e=n[o],t.push($.get(e.url+".ttf")),t.push($.get(e.url+".woff"));var r="",a=this,s=function(t){for(var e,o=0,n=a.pendingItems;o<n.length;o++){e=n[o],a.fontInfoCachesManager.savaFontDefinition(e.name);var s=i.getFontFaceDeclaration(e.name,e.url);r+=s+"\n"}$("style").append(r),a.overThis(!0)},l=function(){console.log("加载字体文件失败"),1==a._currReCallTime?a.overThis(!1):(a.doFontLoad(),a._currReCallTime++)};$.when(t).then(s,l)}else this.overThis(!0)},e.prototype.overThis=function(t,e){void 0===e&&(e=null),this.pendingItems.splice(0),this.loadingItems.splice(0),t?this.complete():this.fault(e)},e}(o);e.TextFontLoadTask=r,__reflect(r.prototype,"cdcommon.editor.tasks.TextFontLoadTask")}(o=e.tasks||(e.tasks={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(t){var e;!function(t){var e=function(){function t(){this.id="",this.type=0,this.index=0,this.name="",this.mask_count=0,this.thumb_url="",this.page_width=0,this.page_height=0,this.dpi=0,this.stage_content=""}return t}();t.TPageItem=e,__reflect(e.prototype,"cdcommon.editor.models.TPageItem")}(e=t.models||(t.models={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(t){var e;!function(t){var e=function(){function t(){}return t.PHOTO="photo",t.FONT="font",t.DECORATION="decoration",t.FRAME="frame",t.BACKGROUND="background",t.SPECIAL="special",t.SMART="smart",t}();t.MaterialKindConstant=e,__reflect(e.prototype,"cdcommon.editor.constants.MaterialKindConstant")}(e=t.constants||(t.constants={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(t){var e;!function(t){var e=egret.Event,o=function(t){function e(e,o){var n=t.call(this,e)||this;return n._task=o,n}return __extends(e,t),e.createStartEvent=function(t){return new e(e.TASK_START,t)},e.createCompleteEvent=function(t){return new e(e.TASK_COMPLETE,t)},e.createFaultEvent=function(t,o){void 0===o&&(o=null);var n=new e(e.TASK_FAULT,t);return n._message=o,n},e.createProgressEvent=function(t,o,n){var i=new e(e.TASK_PROGRESS,t);return i._processed=o,i._size=n,i},e.createChildStartEvent=function(t){return new e(e.CHILD_START,t)},e.createChildCompleteEvent=function(t){return new e(e.CHILD_COMPLETE,t)},e.createChildFaultEvent=function(t,o){void 0===o&&(o=null);var n=new e(e.CHILD_FAULT,t);return n._message=o,n},Object.defineProperty(e.prototype,"task",{get:function(){return this._task},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"processed",{get:function(){return this._processed},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"message",{get:function(){return this._message},enumerable:!0,configurable:!0}),e.prototype.clone=function(){var t=new e(this.type,this._task);return t._message=this._message,t._processed=this._processed,t._size=this._size,t},e.TASK_START="taskStart",e.TASK_COMPLETE="taskComplete",e.TASK_FAULT="taskFault",e.TASK_PROGRESS="taskProgress",e.CHILD_START="childStart",e.CHILD_COMPLETE="childComplete",e.CHILD_FAULT="childFault",e}(e);t.TaskEvent=o,__reflect(o.prototype,"cdcommon.framework.task.TaskEvent")}(e=t.task||(t.task={}))}(e=t.framework||(t.framework={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(e){var o;!function(e){var o=t.editor.constants.EditorModeConstant,n=t.framework.models.GlobalCommon,i=function(){function t(){}return t.isLocalPath=function(t){var e;return t&&-1==t.indexOf("http:")&&-1==t.indexOf("https:")&&(e=!0),e},t.SERVICE_FACE_RECOGNITION_URL="http://www.meiin.com/script/face.php",t.FONT_CHARSET_PATH=n.SERVICES_URL+"/ds/fontlibs/zi6763.txt",t.FONT_CONFIG_PATH=n.SERVICES_URL+"/ds/fontlibs/font_config.xml",t.FONT_LIB_PATH=n.SERVICES_URL+"/ds/fontlibs/ttfs/",t.SHOP_HOST_URL="http://wx.meiin.com",t.SUBMIT_ORDER_URL="http://wx.meiin.com/submitOrder",t.displayOnly=!1,t.editorType="",t.editorMode=o.NORMAL,t.fontList=null,t.DPI=300,t.stageOverview=null,t}();e.EditorCommon=i,__reflect(i.prototype,"cdcommon.editor.models.EditorCommon")}(o=e.models||(e.models={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(e){var o;!function(e){var o=t.editor.constants.PageTypeConstant,n=function(){function t(){this.name="",this.thickness=0,this.sizeItem=null,this.themeId=0,this.themeName="",this.thumbUrl="",this.pages=null,this.firstYear=""}return t.prototype.getPageItemByID=function(t){for(var e,o=0,n=this.pages;o<n.length;o++){var i=n[o];if(i.id==t){e=i;break}}return e},t.prototype.getFirstInPageItem=function(){for(var t,e=0,n=this.pages;e<n.length;e++){var i=n[e];if(o.isInpage(i.type)){t=i;break}}return t},t}();e.TemplateModel=n,__reflect(n.prototype,"cdcommon.editor.models.TemplateModel")}(o=e.models||(e.models={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(t){var e;!function(t){var e=egret.Event,o=function(t){function e(e,o,n,i){return t.call(this,e,o,n,i)||this}return __extends(e,t),e.prototype.clone=function(){var t=new e(this.type,this.bubbles,this.cancelable,this.data);return t.item=this.item,t},e.ADD="addUse",e.REMOVE="removeUse",e}(e);t.PhotoUsedCountEvent=o,__reflect(o.prototype,"cdcommon.editor.events.PhotoUsedCountEvent")}(e=t.events||(t.events={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(t){var e;!function(t){var e=egret.Event,o=function(t){function e(e,o,n,i){return t.call(this,e,o,n,i)||this}return __extends(e,t),e.prototype.clone=function(){var t=new e(e.COMPLETE);return t},e.COMPLETE="dataLoadComplete",e}(e);t.DataLoadedEvent=o,__reflect(o.prototype,"cdcommon.editor.events.DataLoadedEvent")}(e=t.events||(t.events={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(t){var e;!function(t){var e=function(){function t(){}return t.WAITING=0,t.UPLOADING=1,t.UPLOAD_COMPLETE=2,t.UPLOAD_FAULT=3,t.NO_STATUS=7,t}();t.PhotoStatus=e,__reflect(e.prototype,"cdcommon.editor.constants.PhotoStatus")}(e=t.constants||(t.constants={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(t){var e;!function(t){var e=function(){function e(){}return e.mm2px=function(e,o){void 0===o&&(o=300);var n;return isNaN(e)||(n=o*t.NumberConvertionUtil.setPrecision(e/25.4,3)),n},e.px2mm=function(e,o){void 0===o&&(o=300);var n;return isNaN(e)||(n=e/o*25.4),t.NumberConvertionUtil.setPrecision(n,3)},e.pt2px=function(t,e){var o;return isNaN(t)||(o=t*e/72),o},e.px2pt=function(t,e){var o;return isNaN(t)||(o=t/(e/72)),o},e}();t.UnitConvertionUtil=e,__reflect(e.prototype,"cdcommon.framework.utils.UnitConvertionUtil")}(e=t.utils||(t.utils={}))}(e=t.framework||(t.framework={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(t){var e;!function(t){var e=egret.Event,o=function(t){function e(e,o,n,i){return t.call(this,e,o,n,i)||this}return __extends(e,t),e.prototype.clone=function(){var t=new e(this.type,this.bubbles,this.cancelable,this.data);return t.photoItem=this.photoItem,t.increaseUsedCount=this.increaseUsedCount,t},e.ADD="photo_add",e.REMOVE="photo_remove",e.SELECT="photo_select",e.REUPLOAD="photo_reupload",e}(e);t.PhotoItemRenderEvent=o,__reflect(o.prototype,"cdcommon.editor.events.PhotoItemRenderEvent")}(e=t.events||(t.events={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(e){var o;!function(e){var o=eui.Component,n=t.editor.models.ElementModelBase,i=t.editor.models.EditorCommon,r=eui.PropertyEvent,a=t.editor.events.DataLoadedEvent,s=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.init=function(t){this.stageOverview||(this.stageOverview=i.stageOverview),t instanceof n&&(this.$dataModel=t,this.$dataModel.addEventListener(r.PROPERTY_CHANGE,this.onPropertyChangeHandler,this))},e.prototype.clear=function(){this.$dataModel&&this.$dataModel.removeEventListener(r.PROPERTY_CHANGE,this.onPropertyChangeHandler,this),this.$dataModel=null},e.prototype.destroy=function(){this.clear(),this.stageOverview=null},e.prototype.getFillData=function(){return null},e.prototype.getCurrentState=function(){var e=t.prototype.getCurrentState.call(this);return this.$displayState&&(e=this.$displayState),e},e.prototype.fillElement=function(){},e.prototype.finishDataLoad=function(){this.dispatchEvent(new a(a.COMPLETE))},e.prototype.onPropertyChangeHandler=function(t){this.fillElement()},Object.defineProperty(e.prototype,"selected",{get:function(){var t=!1;if(this.stageOverview){var e=this.stageOverview.getSelectedElements(),o=e.indexOf(this);t=-1!=o}return t},enumerable:!0,configurable:!0}),e}(o);e.ElementBase=s,__reflect(s.prototype,"cdcommon.editor.components.ElementBase",["cdcommon.framework.interfaces.IElement","cdcommon.framework.interfaces.IComponent","eui.UIComponent","egret.DisplayObject"])}(o=e.components||(e.components={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(e){var o;!function(e){var o=t.framework.models.IconCommonProvider,n=t.editor.models.PhotoElementModel,i=egret.Event,r=t.framework.components.AlertPic,a=function(t){function e(e){var o=t.call(this)||this;return o._undoList=[],o._redoList=[],o.undoCount=10,o}return __extends(e,t),Object.defineProperty(e.prototype,"canUndo",{get:function(){return this._undoList.length>0},set:function(t){},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"canRedo",{get:function(){return this._redoList.length>0},set:function(t){},enumerable:!0,configurable:!0}),e.prototype.init=function(t){this._stageContainer=t},e.prototype.saveCommand=function(t,o,n){if(this._stageContainer){var i;switch(t){case e.STATE_CHANGE:i=new l(this._stageContainer.stageOverview,n,o);break;case e.STATE_ADD:i=new d(this._stageContainer,n);break;case e.STATE_REMOVE:i=new c(this._stageContainer,n)}this._undoList.push(i),-1!=this.undoCount&&this._undoList.length>this.undoCount&&this._undoList.shift(),this.clearList(this._redoList),this.updateState(),console.log("追加一条可撤销与重做的执行命令",t,"撤销列表长度="+this._undoList.length,"重做列表长度="+this._redoList.length)}},e.prototype.clear=function(){this.clearList(this._undoList),this.clearList(this._redoList),this.updateState()},e.prototype.undo=function(){if(this._undoList.length>0){var t=this._undoList.pop();try{t.unExecute(),this._redoList.push(t)}catch(e){r.show(o.Alert_ERROR,"撤销处理发生错误，撤销与重做缓存列表将重置。\n"+e.message,"撤销失败"),this.clear()}}this.updateState()},e.prototype.redo=function(){if(this._redoList.length>0){var t=this._redoList.pop();try{t.execute(),this._undoList.push(t)}catch(e){r.show(o.Alert_ERROR,"重做处理发生错误，撤销与重做缓存列表将重置。\n"+e.message,"重做失败"),this.clear()}}this.updateState()},e.prototype.clearList=function(t){for(var e,o=0,n=t;o<n.length;o++)e=n[o],e.dispose();t.splice(0)},e.prototype.updateState=function(){this.dispatchEvent(new i(e.UPDATED))},e.getInstance=function(){return this._inst||(this._inst=new e(new s)),this._inst},e.STATE_ADD="add",e.STATE_REMOVE="remove",e.STATE_CHANGE="change",e.UPDATED="updated",e}(egret.EventDispatcher);e.CommandManager=a,__reflect(a.prototype,"cdcommon.editor.managers.CommandManager");var s=function(){function t(){}return t}();__reflect(s.prototype,"SingletonEnforcer");var l=function(){function t(t,e,o){this.stageOverview=t,this.elementModel=e,this.oldPropsObj=o}return t.prototype.execute=function(){for(var t in this.newPropsObj)this.elementModel[t]=this.newPropsObj[t];var o=this.getElement();o&&o.init(this.elementModel),this.elementModel instanceof n&&this.newPropsObj.hasOwnProperty("relatedId")&&(e.PhotoUsedCountController.getInstance().removeUsed(this.oldPropsObj.relatedId),e.PhotoUsedCountController.getInstance().addUsed(this.newPropsObj.relatedId))},t.prototype.unExecute=function(){var t;this.newPropsObj={};for(t in this.oldPropsObj)this.newPropsObj[t]=this.elementModel[t];for(t in this.oldPropsObj)this.elementModel[t]=this.oldPropsObj[t];var o=this.getElement();o&&o.init(this.elementModel),this.elementModel instanceof n&&this.oldPropsObj.hasOwnProperty("relatedId")&&(e.PhotoUsedCountController.getInstance().removeUsed(this.newPropsObj.relatedId),e.PhotoUsedCountController.getInstance().addUsed(this.oldPropsObj.relatedId))},t.prototype.dispose=function(){this.newPropsObj=this.oldPropsObj=null,this.stageOverview=null,this.elementModel=null},t.prototype.getElement=function(){var t;return this.stageOverview&&(t=this.stageOverview.getElementByModel(this.elementModel)),t},t}();__reflect(l.prototype,"ChangeStateCommand",["cdcommon.framework.interfaces.IStateCommand"]);var d=function(){function t(t,e){this.stageContainer=t,this.elementModel=e}return t.prototype.execute=function(){this.stageContainer.addElementItem(this.elementModel,!0)},t.prototype.unExecute=function(){this.stageContainer.removeElementItem(this.elementModel,!0)},t.prototype.dispose=function(){this.elementModel=null,this.stageContainer=null},t}();__reflect(d.prototype,"AddStateCommand",["cdcommon.framework.interfaces.IStateCommand"]);var c=function(){function t(t,e){this.stageContainer=t,this.elementModel=e}return t.prototype.execute=function(){this.stageContainer.removeElementItem(this.elementModel,!0)},t.prototype.unExecute=function(){this.stageContainer.addElementItem(this.elementModel,!0)},t.prototype.dispose=function(){this.elementModel=null,this.stageContainer=null},t}();__reflect(c.prototype,"RemoveStateCommand",["cdcommon.framework.interfaces.IStateCommand"])}(o=e.managers||(e.managers={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(e){var o;!function(e){var o=t.framework.hashmap.HashMap,n=function(){function t(t){this._hashMap=new o}return t.prototype.clear=function(){this.removeModelList()},t.prototype.addModel=function(t){this._hashMap.put(t.id,t)},t.prototype.getModel=function(t){var e;return this._hashMap.containsKey(t)&&(e=this._hashMap.getValue(t)),e},t.prototype.removeModel=function(t){this._hashMap.containsKey(t)&&this._hashMap.remove(t)},t.prototype.getModelList=function(){return this._hashMap.getValues()},t.prototype.removeModelList=function(){this._hashMap.clear()},t.prototype.sortModelList=function(e,o){var n;switch(o){case t.SORT_BY_DEFAULT_INDEX:n=this.sortModelListByIndex(e);break;case t.SORT_BY_FILE_NAME_ASC:n=this.sortModelListByName(e);break;case t.SORT_BY_HORIZONTAL:n=this.sortModelListByShape(e,t.HORIZONTAL);break;case t.SORT_BY_VERTICAL:n=this.sortModelListByShape(e,t.VERTICAL);break;case t.SORT_BY_SQUARE:n=this.sortModelListByShape(e,t.SQUARE)}return n},t.prototype.sortModelListByName=function(t){for(var e,o=[],n=[],i=0,r=t;i<r.length;i++)if(e=r[i],e.name&&-1!=e.name.indexOf(".")){var a=e.name.substring(0,e.name.indexOf("."));o.push({key:a,value:e})}else o.push({key:e.name,value:e});o=o.sort(function(t,e){return t.key-e.key});for(var s,l=0,d=o;l<d.length;l++)s=d[l],n.push(s.value);return n},t.prototype.sortModelListByIndex=function(t){return t=t.sort(function(t,e){return t.index-e.index})},t.prototype.sortModelListByShape=function(t,e){for(var o,n,i=[],r=[],a=0,s=t;a<s.length;a++)n=s[a],this.getPhotoShape(n)==e?i.push(n):r.push(n);return o=i.concat(r)},t.prototype.getPhotoShape=function(e){var o;return o=e.source.width>e.source.height?t.HORIZONTAL:e.source.width<e.source.height?t.VERTICAL:t.SQUARE},t.getInstance=function(){return this._inst||(this._inst=new t(new i)),this._inst},t.SORT_BY_DEFAULT_INDEX="defaultIndex",t.SORT_BY_FILE_NAME_ASC="fileNameASC",t.SORT_BY_HORIZONTAL="horizontalPriority",t.SORT_BY_VERTICAL="verticalPriority",t.SORT_BY_SQUARE="squarePriority",t.HORIZONTAL="horizontal",t.VERTICAL="vertical",t.SQUARE="square",t}();e.LeftPhotoItemController=n,__reflect(n.prototype,"cdcommon.editor.managers.LeftPhotoItemController");var i=function(){function t(){}return t}();__reflect(i.prototype,"SingletonEnforcer")}(o=e.managers||(e.managers={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(e){var o;!function(e){var o=t.framework.hashmap.HashMap,n=t.editor.models.SWPageItem,i=t.editor.constants.ElementConstant,r=egret.RenderTexture,a=egret.Rectangle,s=function(){function t(t){this._modelHashMap=new o}return Object.defineProperty(t.prototype,"currentModel",{get:function(){return this._currentModel},set:function(t){this._currentModel=t},enumerable:!0,configurable:!0}),t.prototype.clear=function(){this.removeAllModel(),this._currentModel=null},t.prototype.getModel=function(t){var e;return this._modelHashMap.containsKey(t)&&(e=this._modelHashMap.getValue(t)),e},t.prototype.addModel=function(t){return t.id?void this._modelHashMap.put(t.id,t):void console.log("页面：["+t.pageName+"] 的id为空，无法加入缓存列表")},t.prototype.removeModel=function(t){this._modelHashMap.remove(t)},t.prototype.removeAllModel=function(){this._modelHashMap.clear()},t.prototype.getModelList=function(){return this._modelHashMap.getValues()},t.getInstance=function(){return this._inst||(this._inst=new t(new l)),this._inst},t.prototype.createChildStagePageThumb=function(t,e,o){void 0===e&&(e=80);var n;if(t){var i,s=t.width,l=t.height;i=s>l?e/s:e/l,1>i&&(i=1),i=Math.floor(i);var d,c=new r;o&&(d=new a(o.x,o.y,Math.ceil(o.width),Math.ceil(o.height))),c.drawToTexture(t,d,i),n=c.toDataURL("image/png")}return n},t.prototype.createSaveWorkPageItemList=function(t){this._time=egret.getTimer();for(var o,r=e.ElementModelController.getInstance(),a=[],s=0,l=t;s<l.length;s++){o=l[s];var d=new n;d.id=o.wpId?o.wpId:"",d.tid=o.tpId,d.pid=o.id,d.type=o.type,d.name=o.pageName,d.index=o.pageIndex;var c=r.getModelListByPageId(o.id,i.TYPE_PHOTO).length;d.mask_count=c,d.spread=o.basicPageInfo.spread,d.stage_content=r.modelListToJsonString(o.elementList.source),a.push(d)}return a},t.prototype.extractElementListFromJsonString=function(t){this._time=egret.getTimer();var o=[],n=1;if(t){var i=JSON.parse(t);i&&i.length>0&&(o=e.ElementModelController.getInstance().jsonListToModelList(i)),n++}return o},t}();e.PageModelController=s,__reflect(s.prototype,"cdcommon.editor.managers.PageModelController");var l=function(){function t(){}return t}();__reflect(l.prototype,"SingletonEnforcer")}(o=e.managers||(e.managers={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(e){var o;!function(e){var o=t.editor.events.PhotoUsedCountEvent,n=function(t){function n(o){var n=t.call(this)||this;return n.leftPhotoItemContoller=e.LeftPhotoItemController.getInstance(),n}return __extends(n,t),Object.defineProperty(n.prototype,"photoItemList",{get:function(){return this.leftPhotoItemContoller.getModelList()},enumerable:!0,configurable:!0}),n.prototype.addUsed=function(t){if(t&&""!=t){var e=this.getPhotoItem(t);e&&e.usedCount++;var n=new o(o.ADD);n.item=e,this.dispatchEvent(n)}},n.prototype.removeUsed=function(t){if(t&&""!=t){var e=this.getPhotoItem(t);e&&e.usedCount--;var n=new o(o.REMOVE);n.item=e,this.dispatchEvent(n)}},n.prototype.removeAllUsed=function(){for(var t,e=0,n=this.photoItemList;e<n.length;e++){t=n[e],t.usedCount=0;var i=new o(o.REMOVE);i.item=t,this.dispatchEvent(i)}},n.prototype.getPhotoItem=function(t){var e;if(t)for(var o=0,n=this.photoItemList;o<n.length&&(e=n[o],e.id!=t);o++);return e},n.getInstance=function(){return this._inst||(this._inst=new n(new i)),this._inst},n}(egret.EventDispatcher);e.PhotoUsedCountController=n,__reflect(n.prototype,"cdcommon.editor.managers.PhotoUsedCountController");var i=function(){function t(){}return t}();__reflect(i.prototype,"SingletonEnforcer")}(o=e.managers||(e.managers={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(e){var o;!function(e){var o=egret.EventDispatcher,n=t.editor.tasks.TextFontLoadTask,i=t.framework.task.TaskEvent,r=function(t){function e(e){var o=t.call(this)||this;return o.pendingItems=[],o.loadingItems=[],o}return __extends(e,t),Object.defineProperty(e.prototype,"isAllWorksComplete",{get:function(){var t;return 0==this.loadingItems.length&&0==this.pendingItems.length&&(t=!0),t},enumerable:!0,configurable:!0}),e.prototype.load=function(t){this.pendingItems.push(t),this.doFontLoad()},e.prototype.clear=function(){this.pendingItems.splice(0),this.loadingItems.splice(0)},e.prototype.doFontLoad=function(){if(this.pendingItems.length>0&&this.loadingItems.length<e.MAX_LOAD_PROCESS_COUNT){var t=this.pendingItems.shift(),o=new n(t);o.addEventListener(i.TASK_COMPLETE,this.onTaskResultHandler,this),o.addEventListener(i.TASK_FAULT,this.onTaskResultHandler,this),this.loadingItems.push(t),o.start()}},e.prototype.onTaskResultHandler=function(t){var e=t.task.getModel();t.type==i.TASK_COMPLETE?(e.success=!0,e.callbackFun.apply(e.hostObj)):(e.success=!1,e.callbackFun.apply(e.hostObj,[t.message])),this.loadingItems.splice(this.loadingItems.indexOf(e),1),this.isAllWorksComplete?this.clear():this.doFontLoad()},e.getInstance=function(){return this._inst||(this._inst=new e(new a)),this._inst},e.MAX_LOAD_PROCESS_COUNT=1,e}(o);e.TextFontLoadManager=r,__reflect(r.prototype,"cdcommon.editor.managers.TextFontLoadManager");var a=function(){function t(){}return t}();__reflect(a.prototype,"SingletonEnforcer")}(o=e.managers||(e.managers={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(e){var o;!function(e){var o=t.editor.constants.ElementConstant,n=t.editor.factories.IDFactory,i=function(t){function e(){var e=t.call(this)||this;return e._elementType=o.TYPE_BACKGROUND,e.url="",e.source=null,e.backgroundColor="",e}return __extends(e,t),Object.defineProperty(e.prototype,"elementType",{get:function(){return this._elementType
},set:function(t){this._elementType=t},enumerable:!0,configurable:!0}),e.prototype.fillByObject=function(e){t.prototype.fillByObject.call(this,e),this.url=e.url,this.source=e.source,this.backgroundColor=e.backgroundColor},e.prototype.toJsonObject=function(){var e=t.prototype.toJsonObject.call(this);return e.url=this.url,e.backgroundColor=this.backgroundColor,e},e.prototype.clone=function(){var t=new e;return t.fillByObject(this),t.id=n.getElementModelID(t.elementType),t},e}(e.ElementModelBase);e.BackgroundElementModel=i,__reflect(i.prototype,"cdcommon.editor.models.BackgroundElementModel")}(o=e.models||(e.models={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(t){var e;!function(t){var e=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._kind="background",e.style_id=0,e.url="",e}return __extends(e,t),Object.defineProperty(e.prototype,"kind",{get:function(){return this._kind},set:function(t){this._kind=t},enumerable:!0,configurable:!0}),e}(t.MaterialItemBase);t.BackgroundItem=e,__reflect(e.prototype,"cdcommon.editor.models.BackgroundItem")}(e=t.models||(t.models={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(e){var o;!function(e){var o=t.editor.constants.ElementConstant,n=t.editor.factories.IDFactory,i=t.framework.utils.DateUtils,r=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._elementType=o.TYPE_SMART_CALENDAR,e.type=1,e.showDate=new Date,e.weekSymbolSize=25,e.weekSymbolColor="#000000",e.holidaySymbolColor="#FF0000",e.holidaySymbolBgColor="",e.daySymbolSize=42,e.daySymbolColor="#000000",e.chineseLabelSymbolSize=23,e.solarSymbolColor="#FF0000",e.lunarSymbolColor="#000000",e.yearSymbolSize=33,e.yearSymbolColor="#000000",e.monthSymbolSize=90,e.monthSymbolColor="#000000",e.monthSymbolSize_En=33,e.monthSymbolColor_En="#000000",e.borderColor="#FF0000",e.headerHeight=0,e}return __extends(e,t),Object.defineProperty(e.prototype,"elementType",{get:function(){return this._elementType},set:function(t){this._elementType=t},enumerable:!0,configurable:!0}),e.prototype.fillByObject=function(e){t.prototype.fillByObject.call(this,e),this.type=e.type,this.showDate=e.showDate,this.birthdayDate=e.birthdayDate,this.weekSymbolSize=e.weekSymbolSize,this.weekSymbolColor=e.weekSymbolColor,this.weekSymbolBgColor=e.weekSymbolBgColor,this.holidaySymbolColor=e.holidaySymbolColor,this.holidaySymbolBgColor=e.holidaySymbolBgColor,this.daySymbolSize=e.daySymbolSize,this.daySymbolColor=e.daySymbolColor,this.chineseLabelSymbolSize=e.chineseLabelSymbolSize,this.solarSymbolColor=e.solarSymbolColor,this.lunarSymbolColor=e.lunarSymbolColor,this.yearSymbolSize=e.yearSymbolSize,this.yearSymbolColor=e.yearSymbolColor,this.monthSymbolSize=e.monthSymbolSize,this.monthSymbolColor=e.monthSymbolColor,this.monthSymbolSize_En=e.monthSymbolSize_En,this.monthSymbolColor_En=e.monthSymbolColor_En,e.hasOwnProperty("borderVisible")&&(this.borderVisible="true"==e.borderVisible.toString()),this.borderColor=e.borderColor,this.headerHeight=e.headerHeight},e.prototype.toJsonObject=function(){var e=t.prototype.toJsonObject.call(this);return e.type=this.type,e.showDate=i.dateFormat(this.showDate,"YYYY-MM-DD"),e.birthdayDate=i.dateFormat(this.birthdayDate,"YYYY-MM-DD"),e.weekSymbolSize=this.weekSymbolSize,e.weekSymbolColor=this.weekSymbolColor,e.weekSymbolBgColor=this.weekSymbolBgColor,e.holidaySymbolColor=this.holidaySymbolColor,e.holidaySymbolBgColor=this.holidaySymbolBgColor,e.daySymbolSize=this.daySymbolSize,e.daySymbolColor=this.daySymbolColor,e.chineseLabelSymbolSize=this.chineseLabelSymbolSize,e.solarSymbolColor=this.solarSymbolColor,e.lunarSymbolColor=this.lunarSymbolColor,e.yearSymbolSize=this.yearSymbolSize,e.yearSymbolColor=this.yearSymbolColor,e.monthSymbolSize=this.monthSymbolSize,e.monthSymbolColor=this.monthSymbolColor,e.monthSymbolSize_En=this.monthSymbolSize_En,e.monthSymbolColor_En=this.monthSymbolColor_En,e.borderVisible=1==this.borderVisible?"true":"false",e.borderColor=this.borderColor,e.headerHeight=this.headerHeight,e},e.prototype.clone=function(){var t=new e;return t.fillByObject(this),t.id=n.getElementModelID(t.elementType),t},e}(e.SmartElementModelBase);e.CalendarElementModel=r,__reflect(r.prototype,"cdcommon.editor.models.CalendarElementModel")}(o=e.models||(e.models={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(e){var o;!function(e){var o=t.editor.constants.ElementConstant,n=t.editor.factories.IDFactory,i=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._elementType=o.TYPE_DECORATION,e.url="",e.source=null,e}return __extends(e,t),Object.defineProperty(e.prototype,"elementType",{get:function(){return this._elementType},set:function(t){this._elementType=t},enumerable:!0,configurable:!0}),e.prototype.fillByObject=function(e){t.prototype.fillByObject.call(this,e),this.url=e.url,this.source=e.source},e.prototype.toJsonObject=function(){var e=t.prototype.toJsonObject.call(this);return e.url=this.url,e},e.prototype.clone=function(){var t=new e;return t.fillByObject(this),t.id=n.getElementModelID(t.elementType),t},e}(e.ElementModelBase);e.DecorationElementModel=i,__reflect(i.prototype,"cdcommon.editor.models.DecorationElementModel")}(o=e.models||(e.models={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(t){var e;!function(t){var e=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._kind="decoration",e.style_id=0,e.url="",e}return __extends(e,t),Object.defineProperty(e.prototype,"kind",{get:function(){return this._kind},set:function(t){this._kind=t},enumerable:!0,configurable:!0}),e}(t.MaterialItemBase);t.DecorationItem=e,__reflect(e.prototype,"cdcommon.editor.models.DecorationItem")}(e=t.models||(t.models={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(t){var e;!function(t){var e=egret.Event,o=function(t){function e(e,o,n,i){return t.call(this,e,o,n,i)||this}return __extends(e,t),e.prototype.clone=function(){var t=new e(this.type,this.bubbles,this.cancelable,this.data);return t.elements=this.elements,t},e.FORCE_UPDATE_SELECTION="forceUpdateSelection",e.SELECTED_CHANGE="selectedChange",e}(e);t.ElementManagerEvent=o,__reflect(o.prototype,"cdcommon.editor.events.ElementManagerEvent")}(e=t.events||(t.events={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(t){var e;!function(t){var e=function(){function t(){}return Object.defineProperty(t,"INPAGE_CENTER_LINE",{get:function(){return RES.getRes("inpage_center_line_png")},enumerable:!0,configurable:!0}),Object.defineProperty(t,"EMPTY_PHOTO",{get:function(){return RES.getRes("tempimg_jpg")},enumerable:!0,configurable:!0}),t}();t.EditorImageProvider=e,__reflect(e.prototype,"cdcommon.editor.models.EditorImageProvider")}(e=t.models||(t.models={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(e){var o;!function(e){var o=t.editor.utils.PhotoTools,n=t.editor.constants.MaterialKindConstant,i=function(){function t(){}return t.covert=function(e,i,r,a){if(void 0===r&&(r=!1),void 0===a&&(a=null),i&&""!=i){if(e==n.PHOTO){if(-1!=i.toLowerCase().indexOf("http")&&-1==i.indexOf("x-oss-process=image/resize")){var s=r?o.SMARLL_SIZE_PX:o.MIDDLE_SIZE_PX;i+="?x-oss-process=image/resize,h_"+s.toString()+",w_"+s.toString()+",limit_0/auto-orient,0"}}else r&&(i=i.replace("mid/","sml/"));t.openCrossDomain&&a}return i},t.extractPath=function(t){for(var e=t.replace(/(http):\/\/([^\/]+)/i,"");0==e.indexOf("/");)e=e.substring(1);return e},t.openCrossDomain=!1,t}();e.URLConvertor=i,__reflect(i.prototype,"cdcommon.editor.utils.URLConvertor")}(o=e.utils||(e.utils={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(t){var e;!function(t){var e=function(){function t(){}return t}();t.FaceInfoModel=e,__reflect(e.prototype,"cdcommon.editor.models.FaceInfoModel")}(e=t.models||(t.models={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(t){var e;!function(t){var e=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._kind="frame",e.style_id=0,e.frame_url="",e.frame_mask_url="",e}return __extends(e,t),Object.defineProperty(e.prototype,"kind",{get:function(){return this._kind},set:function(t){this._kind=t},enumerable:!0,configurable:!0}),e}(t.MaterialItemBase);t.FrameItem=e,__reflect(e.prototype,"cdcommon.editor.models.FrameItem")}(e=t.models||(t.models={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(t){var e;!function(t){var e=eui.PropertyEvent,o=function(){function t(){}return t.update=function(t,o){t.dispatchEvent(new e(e.PROPERTY_CHANGE,!1,!1,o))},t}();t.ModelUpdater=o,__reflect(o.prototype,"cdcommon.editor.utils.ModelUpdater")}(e=t.utils||(t.utils={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(t){var e;!function(t){var e=function(){function t(){}return t.random=function(e){return e[t._randomIntegerWithinRange(0,e.length-1)]},t.randomize=function(e){for(var o=[],n=e.sort(t._sortRandom),i=-1;++i<e.length;)o.push(e[n[i]]);return o},t._sortRandom=function(e,o){return t.randomIntegerWithinRange(0,1)?1:-1},t.randomIntegerWithinRange=function(t,e){return Math.floor(Math.random()*(1+e-t)+t)},t.max=function(t){var e=Math.max.apply(null,t);return e},t.getValuesByKey=function(t,e){for(var o,n=[],i=0,r=t;i<r.length;i++)o=r[i],o.hasOwnProperty(e)&&n.push(o[e]);return n},t._randomIntegerWithinRange=function(t,e){return Math.floor(Math.random()*(1+e-t)+t)},t}();t.ArrayUtil=e,__reflect(e.prototype,"cdcommon.framework.utils.ArrayUtil")}(e=t.utils||(t.utils={}))}(e=t.framework||(t.framework={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(e){var o;!function(e){var o=t.editor.constants.ElementConstant,n=t.editor.factories.IDFactory,i=function(t){function e(){var n=null!==t&&t.apply(this,arguments)||this;return n._elementType=o.TYPE_TEXT,n.text=e.DEFAULT_TEXT,n.fontFamily="微软雅黑",n.fontName_ch="",n.fontName_en="",n.fontId="",n.color="#000000",n.bgColor="",n.size=36,n.isBold=!1,n.isItalic=!1,n.align="left",n.letterSpacing=0,n.leading=0,n}return __extends(e,t),Object.defineProperty(e.prototype,"elementType",{get:function(){return this._elementType},set:function(t){this._elementType=t},enumerable:!0,configurable:!0}),e.prototype.fillByObject=function(e){t.prototype.fillByObject.call(this,e),this.text=e.text,this.fontFamily=e.fontFamily,this.fontName_ch=e.fontName_ch,this.fontName_en=e.fontName_en,this.fontId=e.fontId,this.color=e.color,this.bgColor=e.bgColor,this.size=e.size,this.isBold="true"==e.isBold.toString(),this.isItalic="true"==e.isItalic.toString(),this.align=e.align,this.letterSpacing=e.letterSpacing,this.leading=e.leading},e.prototype.toJsonObject=function(){var e=t.prototype.toJsonObject.call(this);return e.text=encodeURIComponent(this.text),e.fontFamily=encodeURIComponent(this.fontFamily),e.fontName_ch=encodeURIComponent(this.fontName_ch),e.fontName_en=this.fontName_en,e.fontId=this.fontId,e.color=this.color,e.bgColor=this.bgColor,e.size=this.size,e.isBold=1==this.isBold?"true":"false",e.isItalic=1==this.isItalic?"true":"false",e.align=this.align,e.letterSpacing=this.letterSpacing,e.leading=this.leading,e},e.prototype.clone=function(){var t=new e;return t.fillByObject(this),t.id=n.getElementModelID(t.elementType),t},e.DEFAULT_TEXT="双击添加文字",e}(e.ElementModelBase);e.TextElementModel=i,__reflect(i.prototype,"cdcommon.editor.models.TextElementModel")}(o=e.models||(e.models={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(t){var e;!function(t){var e=function(){function t(){}return t.getScale=function(t,e,o,n){var i;return i=o>n?t/o:e/n},t.getScaledSizeByConstraint=function(e,o){var n=e[0],i=e[1],r=o[0],a=o[1],s=1,l=r,d=a,c=r/a,h=n/i;return isNaN(h)||(h>c?d=r/h:l=a*h),s=t.getScale(l,d,n,i),[l,d,s]},t}();t.ScaledConstraintUtil=e,__reflect(e.prototype,"cdcommon.framework.utils.ScaledConstraintUtil")}(e=t.utils||(t.utils={}))}(e=t.framework||(t.framework={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(t){var e;!function(t){var e=egret.Point,o=function(){function t(){}return t.getPointByCenterRotation=function(o,n,i){var r=new e,a=t.toRadians(i);return r.x=Math.cos(a)*o-Math.sin(a)*n,r.y=Math.cos(a)*n+Math.sin(a)*o,r},t.pointRotate=function(o,n,i){var r=new e,a=t.toRadians(i),s=(n.x-o.x)*Math.cos(a)+(n.y-o.y)*Math.sin(a)+o.x,l=-(n.x-o.x)*Math.sin(a)+(n.y-o.y)*Math.cos(a)+o.y;return r.x=s,r.y=l,r},t.toRadians=function(t){return t*Math.PI/180},t.toDegrees=function(t){return 180*t/Math.PI},t}();t.RotationUtil=o,__reflect(o.prototype,"cdcommon.framework.utils.RotationUtil")}(e=t.utils||(t.utils={}))}(e=t.framework||(t.framework={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(t){var e;!function(t){var e=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._kind="special",e.url="",e}return __extends(e,t),Object.defineProperty(e.prototype,"kind",{get:function(){return this._kind},set:function(t){this._kind=t},enumerable:!0,configurable:!0}),e}(t.MaterialItemBase);t.SpecialItem=e,__reflect(e.prototype,"cdcommon.editor.models.SpecialItem")}(e=t.models||(t.models={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(e){var o;!function(e){var o=t.editor.constants.ElementConstant,n=t.editor.factories.IDFactory,i=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._elementType=o.TYPE_SPECIAL,e.url="",e.source=null,e.type=1,e}return __extends(e,t),Object.defineProperty(e.prototype,"elementType",{get:function(){return this._elementType},set:function(t){this._elementType=t},enumerable:!0,configurable:!0}),e.prototype.fillByObject=function(e){t.prototype.fillByObject.call(this,e),this.url=e.url,this.source=e.source,this.type=e.type},e.prototype.toJsonObject=function(){var e=t.prototype.toJsonObject.call(this);return e.url=this.url,e.type=this.type,e},e.prototype.clone=function(){var t=new e;return t.fillByObject(this),t.id=n.getElementModelID(t.elementType),t},e}(e.ElementModelBase);e.SpecialElementModel=i,__reflect(i.prototype,"cdcommon.editor.models.SpecialElementModel")}(o=e.models||(e.models={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(t){var e;!function(t){var e=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.thumb_class=null,e.type="",e.category="",e.remark="",e}return __extends(e,t),e}(t.MaterialItemBase);t.SmartItem=e,__reflect(e.prototype,"cdcommon.editor.models.SmartItem")}(e=t.models||(t.models={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(e){var o;!function(e){var o=egret.Bitmap,n=egret.Texture,i=egret.RenderTexture,r=egret.Sprite,a=t.framework.utils.NumberConvertionUtil,s=function(){function t(){}return t.scaleByMaxEdge=function(t,e,r){if(void 0===r&&(r="base64"),!t)return null;var s,l=t.width,d=t.height;s=l>d?e/l:e/d,s=a.setPrecision(s,3);var c=new n;c.bitmapData=t;var h=new o(c);h.smoothing=!0,h.width=Math.round(h.width*s),h.height=Math.round(h.height*s);var u=new i;u.drawToTexture(h);var m;if("base64"==r.toLowerCase())m=u.toDataURL("image/jpeg");else if("bitmapdata"==r.toLowerCase())m=u.bitmapData;else if("texture"==r.toLowerCase()){var p=new n;p.bitmapData=u.bitmapData,m=p}return m},t.flipH=function(t,e){void 0===e&&(e=!0);var a=new n;a.bitmapData=t;var s=new o(a),l=s.matrix;l.a=-l.a,l.tx=t.width,s.matrix=l;var d=new r;d.addChild(s);var c=new i;return c.drawToTexture(d),e&&a.dispose(),c.bitmapData},t.flipV=function(t,e){void 0===e&&(e=!0);var a=new n;a.bitmapData=t;var s=new o(a),l=s.matrix;l.d=-l.d,l.ty=t.height,s.matrix=l;var d=new r;d.addChild(s);var c=new i;return c.drawToTexture(d),e&&a.dispose(),c.bitmapData},t.rotateLeft90=function(t,e){void 0===e&&(e=!0);var a=new n;a.bitmapData=t;var s=new o(a),l=s.matrix;l.rotate(-Math.PI/2),l.translate(0,t.width),s.matrix=l;var d=new r;d.addChild(s);var c=new i;return c.drawToTexture(d),e&&a.dispose(),c.bitmapData},t.rotateTheRatioOf90=function(t,e,a){void 0===a&&(a=!0);var s=new n;s.bitmapData=e;var l=new o(s);switch(l.anchorOffsetX=l.width/2,l.anchorOffsetY=l.height/2,l.rotation=t,Math.abs(t)){case 90:l.x=l.anchorOffsetY,l.y=l.anchorOffsetX;break;case 180:l.x=l.anchorOffsetX,l.y=l.anchorOffsetY;break;case 270:l.x=l.anchorOffsetY,l.y=l.anchorOffsetX;break;case 360:l.x=l.anchorOffsetX,l.y=l.anchorOffsetY}var d=new r;d.addChild(l);var c=new i;return c.drawToTexture(d),a&&s.dispose(),c.bitmapData},t}();e.BitmapDataUtil=s,__reflect(s.prototype,"cdcommon.framework.utils.BitmapDataUtil")}(o=e.utils||(e.utils={}))}(e=t.framework||(t.framework={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(t){var e;!function(t){var e=function(){function t(t,e,o,n,i){void 0===n&&(n=null),void 0===i&&(i=null),this.role=t,this.percentageOffset=e,this.offset=o,this.handleFactory=n,this.constraint=i}return t}();t.HandleDescription=e,__reflect(e.prototype,"cdcommon.framework.objecthandles.HandleDescription")}(e=t.objecthandles||(t.objecthandles={}))}(e=t.framework||(t.framework={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(e){var o;!function(e){var o=t.editor.models.EditorCommon,n=egret.Event,i=egret.IOErrorEvent,r=t.editor.models.SpecialElementModel,a=egret.Texture,s=t.editor.utils.URLConvertor,l=t.framework.utils.UnitConvertionUtil,d=t.framework.components.AlertPic,c=t.framework.models.IconCommonProvider,h=t.editor.constants.MaterialKindConstant,u=function(t){function e(){var e=t.call(this)||this;return e.touchEnabled=e.touchChildren=!1,e}return __extends(e,t),e.prototype.getFillData=function(){return this._dataModel},e.prototype.init=function(e){void 0===e&&(e=null),t.prototype.init.call(this,e),e instanceof r&&(this._dataModel=e,this.fillElement())},e.prototype.fillElement=function(){if(t.prototype.fillElement.call(this),this.x=this._dataModel.x,this.y=this._dataModel.y,this.rotation=this._dataModel.rotation,this.width=this._dataModel.width,this.height=this._dataModel.height,this.alpha=this._dataModel.alpha/100,this._dataModel.source){var e=new a;e.bitmapData=this._dataModel.source,this.imageComp.source=e,this.finishDataLoad()}else this._displayState="loading",this.invalidateState(),this.imageComp.source=s.covert(h.SPECIAL,this._dataModel.url,this.fromChildStage,this.imageComp)},e.prototype.clear=function(){t.prototype.clear.call(this),this.imageComp.source=null,this._dataModel=null},e.prototype.destroy=function(){t.prototype.destroy.call(this)},e.prototype.partAdded=function(e,r){t.prototype.partAdded.call(this,e,r),r==this.imageComp?(this.imageComp.addEventListener(n.COMPLETE,this.onDataLoaded,this),this.imageComp.addEventListener(i.IO_ERROR,this.onLoadIOError,this)):r==this.loadingDisplay&&(this.loadingDisplay.size=l.pt2px(20,o.DPI))},e.prototype.partRemoved=function(e,o){t.prototype.partRemoved.call(this,e,o),o==this.imageComp&&(this.imageComp.removeEventListener(n.COMPLETE,this.onDataLoaded,this),this.imageComp.removeEventListener(i.IO_ERROR,this.onLoadIOError,this))},e.prototype.getCurrentState=function(){var e=t.prototype.getCurrentState.call(this);return e=this._displayState?this._displayState:"normal"},e.prototype.onDataLoaded=function(t){this._displayState=null,this.invalidateState(),this._dataModel.source=this.imageComp.texture.bitmapData,this.finishDataLoad()},e.prototype.onLoadIOError=function(t){var e="特殊元素链接无效或加载过程遇到IO错误 remark="+this._dataModel.remark+"\nsource="+this._dataModel.url;d.show(c.Alert_ERROR,e,"加载特殊元素失败"),this.imageComp.source=null,this.imageComp.visible=!1,this.finishDataLoad()},e}(e.ElementBase);e.SpecialElement=u,__reflect(u.prototype,"cdcommon.editor.components.SpecialElement")}(o=e.components||(e.components={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(e){var o;!function(e){var o=t.framework.utils.DateUtils,n=function(){function t(){}return t.fillModelByObject=function(t,e,o){void 0===o&&(o=!0);try{for(var n in t)if(void 0!=e[n]){var i=t[n],r=typeof e[n];switch(r=r.toLowerCase(),"object"==r&&e[n]instanceof Date&&(r="date"),r){case"boolean":e[n]="true"==i||"TRUE"==i||"1"==i||1==i;break;case"date":i?e[n]=this.string2Date(i.toString()):e[n]=null;break;case"number":i?e[n]=isNaN(parseFloat(i.toString()))?0:parseFloat(i.toString()):e[n]=0;break;case"string":i?e[n]=o?decodeURIComponent(i):i:e[n]=i}}}catch(a){console.log("fillModelByObject()->"+a.message)}return e},t.model2Jsonstring=function(t,e){void 0===e&&(e=!0);var n,i,r="",a={};try{for(n in t){var s=t[n],l=typeof s;switch(l){case"boolean":i=1==t[n]?"true":"false",a[n]=i;break;case"Date":i=o.dateFormat(t[n],"YYYY-MM-DD"),a[n]=i;break;case"number":i=isNaN(t[n])?0:t[n],a[n]=i;break;case"string":i=t[n]?e?encodeURIComponent(t[n]):t[n]:"",a[n]=i}}r=JSON.stringify(a)}catch(d){console.log("model2Jsonstring()->"+d.message)}return r},t.string2Date=function(t){if(-1==t.indexOf("-"))return null;var e,o=t.split("-");return e=1==o.length?new Date(o[0]):2==o.length?new Date(o[0],o[1]-1):3==o.length?new Date(o[0],o[1]-1,o[2]):null},t}();e.ModelDataGenerator=n,__reflect(n.prototype,"cdcommon.framework.managers.ModelDataGenerator")}(o=e.managers||(e.managers={}))}(e=t.framework||(t.framework={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(e){var o;!function(e){var o=eui.ArrayCollection,n=t.editor.models.EditorCommon,i=t.editor.models.CalendarElementModel,r=t.framework.utils.UnitConvertionUtil,a=t.framework.utils.ColorUtil,s=t.framework.utils.DateUtils,l=function(t){function e(){var o=t.call(this)||this;return o._customDayNames_EN=["SUN","MON","TUE","WEB","THU","FRI","SAT"],o._customDayNames_CN=["日","一","二","三","四","五","六"],o._displayMode=e.DISPLAY_MODE_NORMAL,o.setCustomDayNames(o._customDayNames_EN),o}return __extends(e,t),Object.defineProperty(e.prototype,"displayMode",{get:function(){return this._displayMode},set:function(t){this._displayMode=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dayNames",{get:function(){return this._dayNames},set:function(t){this._dayNames=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"selectedDate",{get:function(){return this._selectedDate},set:function(t){t.getFullYear()!=this._selectedDate.getFullYear()&&t.getMonth()!=this._selectedDate.getMonth()&&t.getDate()!=this._selectedDate.getDate()&&(this._selectedDate=t,this.fillElement())},enumerable:!0,configurable:!0}),e.prototype.getFillData=function(){return this._dataModel},e.prototype.init=function(e){void 0===e&&(e=null),t.prototype.init.call(this,e),e instanceof i&&(this._dataModel=e,this._dataModel&&this.changeSkinClass())},e.prototype.clear=function(){t.prototype.clear.call(this),this._dataModel=null},e.prototype.destroy=function(){t.prototype.destroy.call(this)},e.prototype.partAdded=function(e,o){t.prototype.partAdded.call(this,e,o),o==this.loadingDisplay&&(this.loadingDisplay.size=r.pt2px(20,n.DPI))},e.prototype.partRemoved=function(e,o){t.prototype.partRemoved.call(this,e,o)},e.prototype.getCurrentState=function(){var e=t.prototype.getCurrentState.call(this);return e=this._displayState?this._displayState:"normal"},e.prototype.changeSkinClass=function(){this._dataModel.borderVisible||(this._dataModel.styleID==e.STYLE_02?this.skinName="app.CalendarElementStyle02Skin":this._dataModel.styleID==e.STYLE_03&&(this.skinName="app.CalendarElementStyle03Skin")),this.fillElement()},e.prototype.fillElement=function(){switch(t.prototype.fillElement.call(this),this.x=this._dataModel.x,this.y=this._dataModel.y,this.scaleX=this.scaleY=this._dataModel.scale,this._selectedDate=this._dataModel.showDate,this._dataModel.type){case 0:this._displayMode=e.DISPLAY_MODE_NORMAL;break;case 1:this._displayMode=e.DISPLAY_MODE_TWOROW;break;case 2:this._displayMode=e.DISPLAY_MODE_ONEROW;break;case 3:this._displayMode=e.DISPLAY_MODE_THREEROW}this.monthNumLabelDisplay&&this.setMonthNumLabel(),this.monthNameLabelDisplay&&this.setMonthNameLabel(),this.yearLabelDisplay&&this.setYearLabel(),this.initRowAndHeaderSize(),this.generateDayHeader(),this.generateDayList(),this.finishDataLoad()},e.prototype.generateDayHeader=function(){var t,n=[],i=new Date(this._dataModel.showDate.getFullYear(),this._dataModel.showDate.getMonth(),1);switch(this.displayMode){case e.DISPLAY_MODE_NORMAL:t=7;break;case e.DISPLAY_MODE_ONEROW:t=s.daysInMonth(i);break;case e.DISPLAY_MODE_TWOROW:t=21;break;case e.DISPLAY_MODE_THREEROW:t=14}for(var r,l=s.dayOfWeek(i);t>0;){var d=this.dayNames[l];r=-1!=d.toLowerCase().indexOf("sun")||-1!=d.toLowerCase().indexOf("sat");var c=this._dataModel.weekSymbolSize,h=r?a.string2Uint(this._dataModel.holidaySymbolColor):a.string2Uint(this._dataModel.weekSymbolColor),u=this.getGridColumnWidth(),m={};m.label=d,m.size=c,m.color=h,m.width=u,n.push(m),t--,l++,l>this.dayNames.length-1&&(l=0)}this.daysHeaderDataGroup.dataProvider=new o(n)},e.prototype.generateDayList=function(){for(var t=[],e=new Date(this._dataModel.showDate.getFullYear(),this._dataModel.showDate.getMonth(),1),n=s.daysInMonth(e);n>0;){var i,r,l=e.getDate().toString(),d=this._dataModel.daySymbolSize,c=this.getLunarText(e),h=c.specialDay,u=c.name,m=this._dataModel.chineseLabelSymbolSize;6==e.getDay()||0==e.getDay()?(i=a.string2Uint(this._dataModel.solarSymbolColor),r=a.string2Uint(this._dataModel.solarSymbolColor)):(i=a.string2Uint(this._dataModel.daySymbolColor),r=a.string2Uint(h?this._dataModel.solarSymbolColor:this._dataModel.lunarSymbolColor));var p={};p.dayName=l,p.daySize=d,p.dayColor=i,p.chineseName=u,p.chineseDaySize=m,p.chineseDayColor=r,t.push(p),e.setDate(e.getDate()+1),n--}this.daysListDataGroup.dataProvider=new o(t)},e.prototype.getLunarText=function(t){if(!t)return null;var e,o,n=LunarCalendar.getDayDate(t.getFullYear(),t.getMonth()+1,t.getDate());if(n)try{var i=JSON.parse(n);"1"==i.display?this.isEmptyValue(i.lunarFestival)?this.isEmptyValue(i.solarFestival)||(e=i.solarFestival,o=!0):(e=i.lunarFestival,o=!0):this.isEmptyValue(i.term)?(e=i.lunarDayName,"初一"==e&&(e=i.lunarMonthName),o=!1):(e=i.term,o=!0)}catch(r){console.log("返回的日历信息不是有效的JSON字符串！JSON = "+n)}return{specialDay:o,name:e}},e.prototype.isEmptyValue=function(t){var e;return(""==t||void 0==t)&&(e=!0),e},e.prototype.setMonthNumLabel=function(){var t=this._dataModel.showDate.getMonth()+1,e="";e=10>t?"0"+t.toString():t.toString(),this.monthNumLabelDisplay.text=e,this.monthNumLabelDisplay.textColor=a.string2Uint(this._dataModel.monthSymbolColor)},e.prototype.setMonthNameLabel=function(){this.monthNameLabelDisplay.text=s.monthAsString(this._dataModel.showDate),this.monthNameLabelDisplay.textColor=a.string2Uint(this._dataModel.monthSymbolColor_En)},e.prototype.setYearLabel=function(){this.yearLabelDisplay.text=this._dataModel.showDate.getFullYear().toString(),this.yearLabelDisplay.textColor=a.string2Uint(this._dataModel.yearSymbolColor)},e.prototype.initRowAndHeaderSize=function(){var t=this.daysListDataGroup.layout,o=this._dataModel.headerHeight;0==o&&(o=this._dataModel.headerHeight=this._dataModel.weekSymbolSize+10),this.daysHeaderDataGroup.height=o,this.displayMode==e.DISPLAY_MODE_TWOROW?t.rowHeight=this._dataModel.daySymbolSize+this._dataModel.chineseLabelSymbolSize+40:t.rowHeight=this._dataModel.daySymbolSize+this._dataModel.chineseLabelSymbolSize+20,t.columnWidth=this.getGridColumnWidth();var n;switch(this.displayMode){case e.DISPLAY_MODE_NORMAL:n=7;break;case e.DISPLAY_MODE_ONEROW:n=s.daysInMonth(this._dataModel.showDate);break;case e.DISPLAY_MODE_TWOROW:n=21;break;case e.DISPLAY_MODE_THREEROW:n=14}t.requestedColumnCount=n},e.prototype.setCustomDayNames=function(t){this.dayNames=t.concat()},e.prototype.getGridColumnWidth=function(){var t;return this._dataModel&&(t=3*this._dataModel.chineseLabelSymbolSize+10),this.displayMode==e.DISPLAY_MODE_NORMAL&&(t+=50),t},e.DISPLAY_MODE_NORMAL="normal",e.DISPLAY_MODE_THREEROW="threerow",e.DISPLAY_MODE_TWOROW="tworow",e.DISPLAY_MODE_ONEROW="onerow",e.STYLE_01=1,e.STYLE_02=2,e.STYLE_03=3,e}(e.ElementBase);e.CalendarElement=l,__reflect(l.prototype,"cdcommon.editor.components.CalendarElement")}(o=e.components||(e.components={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(e){var o;!function(e){var o=t.editor.models.EditorCommon,n=t.editor.models.TextElementModel,i=t.framework.utils.UnitConvertionUtil,r=t.framework.components.AlertPic,a=t.framework.models.IconCommonProvider,s=t.framework.utils.ColorUtil,l=t.editor.models.TextFontUrlModel,d=t.editor.models.TextFontLoadModel,c=t.editor.events.ElementManagerEvent,h=t.editor.utils.TextFontUtil,u=t.framework.utils.ArrayUtil,m=t.framework.utils.UniqueID,p=t.editor.managers.PageModelController,f=t.editor.managers.TextFontLoadManager,g=function(t){function e(){var e=t.call(this)||this;return e._editing=!1,e._prevTextContent="",e.skinName="app.TextElementSkin",e.textFontLoadManager=f.getInstance(),e}return __extends(e,t),e.prototype.getFillData=function(){return this._dataModel},Object.defineProperty(e.prototype,"editing",{get:function(){return this._editing},set:function(t){this._editing=t,t?this._displayState="editing":this._displayState=null,this.invalidateState()},enumerable:!0,configurable:!0}),e.prototype.init=function(e){void 0===e&&(e=null),t.prototype.init.call(this,e),e instanceof n&&(this._dataModel=e,this.fillElement())},e.prototype.fillElement=function(){t.prototype.fillElement.call(this),this.editingRect&&(this.editingRect.visible=!this.fromChildStage),this.x=this._dataModel.x,this.y=this._dataModel.y,this.rotation=this._dataModel.rotation,this.width=this._dataModel.width,this.height=this._dataModel.height,this.loadingTextComp&&(this.loadingTextComp.size=i.pt2px(this._dataModel.size,o.DPI)),this._prevTextContent!=this._dataModel.text?(this.loadTextFontDeclaration(),this._prevTextContent=this._dataModel.text):this.updateTextComp(!0)},e.prototype.clear=function(){t.prototype.clear.call(this),this._dataModel=null},e.prototype.destroy=function(){t.prototype.destroy.call(this)},e.prototype.partAdded=function(e,o){t.prototype.partAdded.call(this,e,o)},e.prototype.partRemoved=function(e,o){t.prototype.partRemoved.call(this,e,o)},e.prototype.getCurrentState=function(){var e=t.prototype.getCurrentState.call(this);return e=this._displayState?this._displayState:"normal"},e.prototype.onPropertyChangeHandler=function(e){if("fontName_ch"!=e.property&&"fontName_en"!=e.property)if("fontFamily"==e.property)this._prevTextContent=null,this.fillElement();else if("color"==e.property||"size"==e.property||"align"==e.property||"letterSpacing"==e.property||"leading"==e.property){if(this.updateTextComp(!0),"size"==e.property&&!this.fromChildStage){console.log("强制更新选择框");var o=new c(c.FORCE_UPDATE_SELECTION,!0);o.elements=[this],this.dispatchEvent(o)}}else t.prototype.onPropertyChangeHandler.call(this,e)},e.prototype.loadTextFontDeclaration=function(){this._fontPartArr=h.getFontParts(this._dataModel.text,this._dataModel.fontFamily);var t=u.getValuesByKey(this._fontPartArr,"fontIndex");t=h.removeDuplicates(t),this.fontLoadModel=new d,this.fontLoadModel.id=m.getID();for(var e=0;e<t.length;e++){var n=this._dataModel.fontFamily+t[e],i=o.FONT_LIB_PATH+this._dataModel.fontFamily+"/"+n,r=new l;r.name=n,r.url=i,this.fontLoadModel.urlInfos.push(r)}if(this.fontLoadModel.urlInfos.length>0){var a,s=p.getInstance().getModel(this._dataModel.relatedPageId);s&&(a=s.pageName,this.fontLoadModel.pageName=a),this.fontLoadModel.callbackFun=this.textFontLoadCallBack,this.fontLoadModel.hostObj=this,this.fontLoadModel.text=this._dataModel.text,this._displayState="loading",this.invalidateState(),this.textFontLoadManager.load(this.fontLoadModel)
}else this.updateTextComp(!0)},e.prototype.textFontLoadCallBack=function(){if(this.fontLoadModel.callbackFun=null,this.fontLoadModel.success){this.updateTextComp();var t=new c(c.FORCE_UPDATE_SELECTION,!0);t.elements=[this],this.dispatchEvent(t)}else{var e="加载字体资源失败："+this.fontLoadModel.faultInfo+"\n请尝试重新编辑文本";r.show(a.Alert_ERROR,e,"字体加载失败")}},e.prototype.updateTextComp=function(t){if(void 0===t&&(t=!1),"loading"==this._displayState&&(this._displayState=null,this.invalidateState()),this.textComp.size=i.pt2px(this._dataModel.size,o.DPI),this.textComp.italic=this._dataModel.isItalic,this.textComp.textAlign=this._dataModel.align,this.textComp.bold=this._dataModel.isBold,this.textComp.textColor=s.string2Uint(this._dataModel.color),this.textComp.lineSpacing=this._dataModel.leading,this.textComp.wordWrap=!0,!t){for(var e=[],n=0;n<this._fontPartArr.length;n++){var r=this._fontPartArr[n],a=new v;a.text=r["char"],a.style=new _,a.style.fontFamily=r.fontName,e.push(a)}console.log("updateTextComp(",t,")",this._dataModel.text),console.log("========================================="),this.textComp.textFlow=e,this.textComp.textHeight>this.height&&(this._dataModel.height=this.height=this.textComp.textHeight+10)}this.finishDataLoad()},e.LOADING_STR="正在加载...",e}(e.ElementBase);e.TextElement=g,__reflect(g.prototype,"cdcommon.editor.components.TextElement");var v=function(){function t(){}return t}();__reflect(v.prototype,"TextFlowElement",["egret.ITextElement"]);var _=function(){function t(){}return t}();__reflect(_.prototype,"TextStyle",["egret.ITextStyle"])}(o=e.components||(e.components={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(t){var e;!function(t){var e=egret.Rectangle,o=egret.EventDispatcher,n=function(t){function o(){var e=t.call(this)||this;return e.x=0,e.y=0,e.width=0,e.height=0,e.rotation=0,e.locked=0,e}return __extends(o,t),o.prototype.clone=function(){var t=new o;return t.x=this.x,t.y=this.y,t.width=this.width,t.height=this.height,t.rotation=this.rotation,t},o.prototype.copyFrom=function(t){this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this.rotation=t.rotation},o.prototype.getRectangle=function(){return new e(this.x,this.y,this.width,this.height)},o.prototype.toString=function(){return"[DragGeometry "+this.x+","+this.y+"+"+this.width+"x"+this.height+"]"},o}(o);t.DragGeometry=n,__reflect(n.prototype,"cdcommon.framework.objecthandles.DragGeometry",["cdcommon.framework.objecthandles.IHandleObject","egret.IEventDispatcher","Object"])}(e=t.objecthandles||(t.objecthandles={}))}(e=t.framework||(t.framework={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(t){var e;!function(t){var e=egret.Sprite,o=egret.TouchEvent,n=function(t){function e(){var e=t.call(this)||this;return e.isOver=!1,e.touchEnabled=!0,e.addEventListener(o.TOUCH_BEGIN,e.onMouseEventHandle,e),e.addEventListener(o.TOUCH_END,e.onMouseEventHandle,e),e.addEventListener(o.TOUCH_RELEASE_OUTSIDE,e.onMouseEventHandle,e),e}return __extends(e,t),Object.defineProperty(e.prototype,"handleDescriptor",{get:function(){return this._descriptor},set:function(t){this._descriptor=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"targetModel",{get:function(){return this._targetModel},set:function(t){this._targetModel=t},enumerable:!0,configurable:!0}),e.prototype.onMouseEventHandle=function(t){this.isOver=t.type==o.TOUCH_BEGIN,this.redraw()},e.prototype.destory=function(){this.removeEventListener(o.TOUCH_BEGIN,this.onMouseEventHandle,this),this.removeEventListener(o.TOUCH_END,this.onMouseEventHandle,this),this.removeEventListener(o.TOUCH_RELEASE_OUTSIDE,this.onMouseEventHandle,this)},e.prototype.redraw=function(){this.graphics.clear(),this.isOver?(this.graphics.lineStyle(e.borderWidth,e.handleBorderColorOver),this.graphics.beginFill(e.handleColorOver,1)):(this.graphics.lineStyle(e.borderWidth,e.handleBorderColor),this.graphics.beginFill(e.handleColor,1)),this.graphics.drawRect(-e.handleSize/2,-e.handleSize/2,e.handleSize,e.handleSize),this.graphics.endFill()},e.handleSize=10,e.handleColor=16777215,e.handleColorOver=16664606,e.borderWidth=1,e.handleBorderColor=16664606,e.handleBorderColorOver=16664606,e}(e);t.SpriteHandle=n,__reflect(n.prototype,"cdcommon.framework.objecthandles.SpriteHandle",["cdcommon.framework.objecthandles.IHandle","egret.IEventDispatcher"])}(e=t.objecthandles||(t.objecthandles={}))}(e=t.framework||(t.framework={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(t){var e;!function(t){var e=egret.Event,o=function(t){function e(e,o,n,i){return t.call(this,e,o,n,i)||this}return __extends(e,t),e.COMPLETE="serviceComplete",e.FAULT="serviceFault",e}(e);t.InterfaceEvent=o,__reflect(o.prototype,"cdcommon.framework.events.InterfaceEvent")}(e=t.events||(t.events={}))}(e=t.framework||(t.framework={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(e){var o;!function(e){var o=t.editor.models.EditorCommon,n=egret.Event,i=egret.IOErrorEvent,r=t.editor.models.BackgroundElementModel,a=egret.Texture,s=t.editor.utils.URLConvertor,l=t.framework.utils.UnitConvertionUtil,d=t.framework.components.AlertPic,c=t.framework.models.IconCommonProvider,h=t.editor.constants.MaterialKindConstant,u=eui.Group,m=function(t){function e(){var e=t.call(this)||this;return e.touchEnabled=e.touchChildren=!1,e}return __extends(e,t),e.prototype.getFillData=function(){return this._dataModel},e.prototype.init=function(e){void 0===e&&(e=null),t.prototype.init.call(this,e),e instanceof r&&(this._dataModel=e,this.fillElement())},e.prototype.fillElement=function(){if(t.prototype.fillElement.call(this),this.alpha=this._dataModel.alpha/100,this.imageComp)if(""==this._dataModel.url)this.finishDataLoad();else if(this._dataModel.source){var e=new a;e.bitmapData=this._dataModel.source,this.imageComp.source=e,this.scaleToFit(this._dataModel.source),this.finishDataLoad()}else this._displayState="loading",this.invalidateState(),this.imageComp.source=s.covert(h.BACKGROUND,this._dataModel.url,this.fromChildStage,this.imageComp)},e.prototype.clear=function(){t.prototype.clear.call(this),this.imageComp.source=null,this._dataModel=null},e.prototype.destroy=function(){t.prototype.destroy.call(this)},e.prototype.partAdded=function(e,r){t.prototype.partAdded.call(this,e,r),r==this.imageComp?(this.imageComp.addEventListener(n.COMPLETE,this.onDataLoaded,this),this.imageComp.addEventListener(i.IO_ERROR,this.onLoadIOError,this)):r==this.loadingDisplay&&(this.loadingDisplay.size=l.pt2px(20,o.DPI))},e.prototype.partRemoved=function(e,o){t.prototype.partRemoved.call(this,e,o),o==this.imageComp&&(this.imageComp.removeEventListener(n.COMPLETE,this.onDataLoaded,this),this.imageComp.removeEventListener(i.IO_ERROR,this.onLoadIOError,this))},e.prototype.getCurrentState=function(){var e=t.prototype.getCurrentState.call(this);return e=this._displayState?this._displayState:"normal"},e.prototype.onPropertyChangeHandler=function(t){},e.prototype.onDataLoaded=function(t){this._displayState=null,this.invalidateState(),this._dataModel.source=this.imageComp.texture.bitmapData,this.scaleToFit(this.imageComp.texture.bitmapData),this.finishDataLoad()},e.prototype.scaleToFit=function(t){if(t){(this.width<this.parent.width||this.height<this.parent.height)&&this.parent instanceof u&&this.parent.validateNow();var e,o,n=t.width,i=t.height;n/i>=this.width/this.height?(n=n*this.height/i,i=this.height):(i=i*this.width/n,n=this.width),e=(this.width-n)/2,o=(this.height-i)/2,this.percentWidth=0/0,this.percentHeight=0/0,this.width=this._dataModel.width=n,this.height=this._dataModel.height=i,this.x=this._dataModel.x=e,this.y=this._dataModel.y=o}},e.prototype.onLoadIOError=function(t){var e="背景元素链接无效或加载过程遇到IO错误！ remark="+this._dataModel.remark+"\nsource="+this._dataModel.url;d.show(c.Alert_ERROR,e,"加载背景元素失败"),this.imageComp.source=null,this.imageComp.visible=!1,this.finishDataLoad()},e}(e.ElementBase);e.BackgroundElement=m,__reflect(m.prototype,"cdcommon.editor.components.BackgroundElement")}(o=e.components||(e.components={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(t){var e;!function(t){var e=function(){function t(){this.id="",this.top_layer_width=0,this.top_layer_height=0,this.design_layer_width=0,this.design_layer_height=0,this.design_layer_left=0,this.design_layer_top=0,this.tip_left=0,this.tip_right=0,this.tip_top=0,this.tip_bottom=0,this.bleed_left=0,this.bleed_right=0,this.bleed_top=0,this.bleed_bottom=0,this.spread=0,this.compound=0,this.editable=0,this.displayable=0,this.front_and_back=0}return t}();t.PageItem=e,__reflect(e.prototype,"cdcommon.editor.models.PageItem")}(e=t.models||(t.models={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(e){var o;!function(e){var o=t.editor.models.EditorCommon,n=egret.Event,i=egret.IOErrorEvent,r=t.editor.models.DecorationElementModel,a=egret.Texture,s=t.editor.utils.URLConvertor,l=t.framework.utils.UnitConvertionUtil,d=t.framework.components.AlertPic,c=t.framework.models.IconCommonProvider,h=t.editor.constants.MaterialKindConstant,u=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.getFillData=function(){return this._dataModel},e.prototype.init=function(e){void 0===e&&(e=null),t.prototype.init.call(this,e),e instanceof r&&(this._dataModel=e,this.fillElement())},e.prototype.fillElement=function(){if(t.prototype.fillElement.call(this),this.x=this._dataModel.x,this.y=this._dataModel.y,this.rotation=this._dataModel.rotation,this.width=this._dataModel.width,this.height=this._dataModel.height,this.alpha=this._dataModel.alpha/100,this._dataModel.source){var e=new a;e.bitmapData=this._dataModel.source,this.imageComp.source=e,this.finishDataLoad()}else this._displayState="loading",this.invalidateState(),this.imageComp.source=s.covert(h.DECORATION,this._dataModel.url,this.fromChildStage,this.imageComp)},e.prototype.clear=function(){t.prototype.clear.call(this),this.imageComp.source=null,this._dataModel=null},e.prototype.destroy=function(){t.prototype.destroy.call(this)},e.prototype.partAdded=function(e,r){t.prototype.partAdded.call(this,e,r),r==this.imageComp?(this.imageComp.addEventListener(n.COMPLETE,this.onDataLoaded,this),this.imageComp.addEventListener(i.IO_ERROR,this.onLoadIOError,this)):r==this.loadingDisplay&&(this.loadingDisplay.size=l.pt2px(20,o.DPI))},e.prototype.partRemoved=function(e,o){t.prototype.partRemoved.call(this,e,o),o==this.imageComp&&(this.imageComp.removeEventListener(n.COMPLETE,this.onDataLoaded,this),this.imageComp.removeEventListener(i.IO_ERROR,this.onLoadIOError,this))},e.prototype.getCurrentState=function(){var e=t.prototype.getCurrentState.call(this);return e=this._displayState?this._displayState:"normal"},e.prototype.onDataLoaded=function(t){this._displayState=null,this.invalidateState(),this._dataModel.source=this.imageComp.texture.bitmapData,this.finishDataLoad()},e.prototype.onLoadIOError=function(t){var e="装饰元素链接无效或加载过程遇到IO错误 remark="+this._dataModel.remark+"\nsource="+this._dataModel.url;d.show(c.Alert_ERROR,e,"加载装饰元素失败"),this.imageComp.source=null,this.imageComp.visible=!1,this.finishDataLoad()},e}(e.ElementBase);e.DecorationElement=u,__reflect(u.prototype,"cdcommon.editor.components.DecorationElement")}(o=e.components||(e.components={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(t){var e;!function(t){var e=function(){function t(){}return t}();t.ResultBaseDTO=e,__reflect(e.prototype,"cdcommon.framework.dtos.ResultBaseDTO")}(e=t.dtos||(t.dtos={}))}(e=t.framework||(t.framework={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(t){var e;!function(t){var e=function(){function t(){}return t.isResize=function(e){return t.isResizeDown(e)||t.isResizeLeft(e)||t.isResizeRight(e)||t.isResizeUp(e)},t.isResizeUp=function(e){return(e&t.RESIZE_UP)==t.RESIZE_UP},t.isResizeDown=function(e){return(e&t.RESIZE_DOWN)==t.RESIZE_DOWN},t.isResizeLeft=function(e){return(e&t.RESIZE_LEFT)==t.RESIZE_LEFT},t.isResizeRight=function(e){return(e&t.RESIZE_RIGHT)==t.RESIZE_RIGHT},t.isRotate=function(e){return(e&t.ROTATE)==t.ROTATE},t.isMove=function(e){return(e&t.MOVE)==t.MOVE},t.NO_ROLE=0,t.RESIZE_UP=1,t.RESIZE_DOWN=2,t.RESIZE_LEFT=4,t.RESIZE_RIGHT=8,t.ROTATE=16,t.MOVE=32,t.ROTATE_LINE=71,t.MOVE_LINE=81,t.BORDER_LINE=91,t}();t.HandleRoles=e,__reflect(e.prototype,"cdcommon.framework.objecthandles.HandleRoles")}(e=t.objecthandles||(t.objecthandles={}))}(e=t.framework||(t.framework={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(e){var o;!function(e){var o=t.editor.models.EditorCommon,n=egret.Event,i=egret.IOErrorEvent,r=t.editor.models.PhotoElementModel,a=egret.Texture,s=t.editor.utils.URLConvertor,l=t.framework.utils.UnitConvertionUtil,d=t.framework.components.AlertPic,c=t.framework.models.IconCommonProvider,h=egret.Sprite,u=t.editor.managers.PhotoUsedCountController,m=t.editor.models.PhotoItem,p=t.editor.managers.CommandManager,f=egret.Point,g=t.editor.models.EditorImageProvider,v=t.editor.managers.PageModelController,_=t.framework.models.GlobalCommon,y=egret.TouchEvent,E=t.framework.utils.ColorUtil,C=t.editor.events.PhotoItemRenderEvent,M=egret.Rectangle,I=t.framework.utils.ScaledConstraintUtil,T=t.framework.utils.NumberConvertionUtil,w=t.framework.utils.RotationUtil,O=t.editor.constants.MaterialKindConstant,P=t.framework.utils.BitmapDataUtil,L=egret.ImageLoader,S=t.editor.constants.PhotoStatus,b=t.editor.managers.LeftPhotoItemController,k=t.editor.utils.ModelUpdater,R=function(e){function R(){var t=e.call(this)||this;return t.hasFrame=!1,t.hasMaskRect=!1,t.realPxTip="",t._pendingLoadPhotoCount=0,t._pendingLoadFrameCount=0,t._pendingLoadMaskCount=0,t._win=_.rootContainer,t}return __extends(R,e),R.prototype.getFillData=function(){return this._dataModel},Object.defineProperty(R.prototype,"editing",{get:function(){return"editing"==this._displayState},set:function(t){t?this.filled&&!this.editing&&(this._displayState="editing",this.invalidateState(),this.imageComp.addEventListener(y.TOUCH_BEGIN,this.onImageMouseDown,this),this.createMask()):this.filled&&(this._displayState="filledPhoto",this.invalidateState(),this.imageComp.removeEventListener(y.TOUCH_BEGIN,this.onImageMouseDown,this),this.createMask())},enumerable:!0,configurable:!0}),Object.defineProperty(R.prototype,"filled",{get:function(){var t=!1;return this._dataModel&&this._dataModel.url&&""!=this._dataModel.url&&(t=!0),t},enumerable:!0,configurable:!0}),R.prototype.setSelectedState=function(t){this.selected&&this.filled&&!this.editing},R.prototype.clearPhoto=function(){this.filled&&(u.getInstance().removeUsed(this._dataModel.relatedId),this._dataModel.relatedId=null,this._dataModel.phoX=0,this._dataModel.phoY=0,this._dataModel.phoWidth=this._dataModel.width,this._dataModel.phoHeight=this._dataModel.height,this._dataModel.source=null,this._dataModel.url="",this._dataModel.phoRotation=0,this._dataModel.phoScale=1,this._dataModel.phoRotated=!1,this.fillElement())},R.prototype.importPhoto=function(t,e,o,n){void 0===n&&(n=!1);if(!t.source)return void this.loadPhotoSourceForImport(t,n);if(this.filled&&u.getInstance().removeUsed(this._dataModel.relatedId),this._dataModel.phoRotation=0,this._dataModel.phoScale=1,this._dataModel.phoRotated=!1,!n){var i={};i.relatedId=this._dataModel.relatedId,i.phoX=this._dataModel.phoX,i.phoY=this._dataModel.phoY,i.phoWidth=this._dataModel.phoWidth,i.phoHeight=this._dataModel.phoHeight,i.source=this._dataModel.source,i.url=this._dataModel.url,p.getInstance().saveCommand(p.STATE_CHANGE,i,this._dataModel)}this._dataModel.relatedId=t.id,u.getInstance().addUsed(this._dataModel.relatedId);var r,a,s,l;if(e/o>=this._dataModel.width/this._dataModel.height?(r=e*this._dataModel.height/o,a=this._dataModel.height):(a=o*this._dataModel.width/e,r=this._dataModel.width),this._dataModel.phoWidth=r,this._dataModel.phoHeight=a,this._dataModel.source=t.source,this._dataModel.url=t.url,this._dataModel.faceInfos=t.faceInfos,this._dataModel.faceInfos&&this._dataModel.faceInfos.length>0){var d=this.getPhotoBestPositionByFaceRecognition();s=d.x,l=d.y}else s=(this._dataModel.width-r)/2,l=(this._dataModel.height-a)/2;this._dataModel.phoX=s,this._dataModel.phoY=l,k.update(this._dataModel,"photoImported")},R.prototype.loadPhotoSourceForImport=function(t,e){if(void 0===e&&(e=!1),!t.url)return void d.show(c.Alert_ERROR,"无法填充照片，照片链接为空！","填充照片失败");var o=this,r=new L;r.once(n.COMPLETE,function(n){t.source=r.data,o.importPhoto(t,t.source.width,t.source.height,e)},this),r.once(i.IO_ERROR,function(t){d.show(c.Alert_ERROR,"无法填充照片，加载照片失败","填充照片失败")},this);var a=s.covert(O.PHOTO,t.url);r.load(a)},R.prototype.importFrame=function(t){if(this._dataModel.frameUrl!=t.frame_url&&this._dataModel.frameMaskUrl!=t.frame_mask_url){this.hasFrame=this.hasMaskRect=!0;var e=t.width,o=t.height;if(e=e*this._dataModel.height/o,o=this._dataModel.height,this._dataModel.frameSource&&(this._dataModel.frameSource=null),this._dataModel.frameMaskSource&&(this._dataModel.frameMaskSource=null),this._dataModel.frameUrl=t.frame_url,this._dataModel.frameMaskUrl=t.frame_mask_url,this._dataModel.width=e,this._dataModel.height=o,this.filled){var n,i,r,a;this._dataModel.phoWidth/this._dataModel.phoHeight>=this._dataModel.width/this._dataModel.height?(n=this._dataModel.phoWidth*this._dataModel.height/this._dataModel.phoHeight,i=this._dataModel.height):(i=this._dataModel.phoHeight*this._dataModel.width/this._dataModel.phoWidth,n=this._dataModel.width),r=(this._dataModel.width-n)/2,a=(this._dataModel.height-i)/2,this._dataModel.phoX=r,this._dataModel.phoY=a,this._dataModel.phoWidth=n,this._dataModel.phoHeight=i}else this._dataModel.phoWidth=this._dataModel.width,this._dataModel.phoHeight=this._dataModel.height;k.update(this._dataModel,"frameImported")}},R.prototype.init=function(t){void 0===t&&(t=null),e.prototype.init.call(this,t),t instanceof r&&(this._dataModel=t,this.fillElement())},R.prototype.clear=function(){e.prototype.clear.call(this),this.imageComp.source=null,this.frameImageComp&&(this.frameImageComp.source=null),this.frameMaskImageComp&&(this.frameMaskImageComp.source=null),this._dataModel=null},R.prototype.destroy=function(){e.prototype.destroy.call(this)},R.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.maskComp=new h,this.maskComp.touchEnabled=this.maskComp.touchChildren=!1,this.contentGroup.addChild(this.maskComp)},R.prototype.partAdded=function(t,r){e.prototype.partAdded.call(this,t,r),r==this.imageComp?(this.imageComp.addEventListener(n.COMPLETE,this.onDataLoaded,this),this.imageComp.addEventListener(i.IO_ERROR,this.onLoadIOError,this),this.imageComp.addEventListener(y.TOUCH_BEGIN,this.onImageMouseDown,this),this.imageComp.source=g.EMPTY_PHOTO):r==this.loadingDisplay?this.loadingDisplay.size=l.pt2px(20,o.DPI):r==this.frameImageComp?(this.frameImageComp.addEventListener(n.COMPLETE,this.onFrameImageLoaded,this),this.frameMaskImageComp.addEventListener(i.IO_ERROR,this.onFrameImageLoadIOError,this)):r==this.frameMaskImageComp?(this.frameMaskImageComp.addEventListener(n.COMPLETE,this.onMaskImageLoaded,this),this.frameMaskImageComp.addEventListener(i.IO_ERROR,this.onMaskImageLoadIOError,this)):r==this.emptyBitmapIcon||r==this.scaleFlagLabel},R.prototype.partRemoved=function(t,o){e.prototype.partRemoved.call(this,t,o),o==this.imageComp?(this.imageComp.removeEventListener(n.COMPLETE,this.onDataLoaded,this),this.imageComp.removeEventListener(i.IO_ERROR,this.onLoadIOError,this),this.imageComp.removeEventListener(y.TOUCH_BEGIN,this.onImageMouseDown,this)):o==this.frameImageComp?(this.frameImageComp.removeEventListener(n.COMPLETE,this.onFrameImageLoaded,this),this.frameMaskImageComp.removeEventListener(i.IO_ERROR,this.onFrameImageLoadIOError,this)):o==this.frameMaskImageComp&&(this.frameMaskImageComp.removeEventListener(n.COMPLETE,this.onMaskImageLoaded,this),this.frameMaskImageComp.removeEventListener(i.IO_ERROR,this.onMaskImageLoadIOError,this))},R.prototype.getCurrentState=function(){var t=e.prototype.getCurrentState.call(this);return t=this._displayState?this._displayState:"normal"},R.prototype.fillElement=function(){if(e.prototype.fillElement.call(this),this.x=this._dataModel.x,this.y=this._dataModel.y,this.width=this._dataModel.width,this.height=this._dataModel.height,this.rotation=this._dataModel.rotation,this.visible=1==this._dataModel.visible,this._dataModel.frameUrl&&""!=this._dataModel.frameUrl&&(this.hasFrame=!0),this._dataModel.frameMaskUrl&&""!=this._dataModel.frameMaskUrl&&(this.hasMaskRect=!0),this.hasFrame?this.removeBorder():this._dataModel.borderWidth>0?this.drawBorder():this.removeBorder(),this.imageComp.alpha=this._dataModel.alpha/100,this.imageComp.width=this._dataModel.phoWidth,this.imageComp.height=this._dataModel.phoHeight,this.imageComp.x=this._dataModel.phoX,this.imageComp.y=this._dataModel.phoY,this.createMask(),t.editor.managers.QuickImportPhotosController.getInstance().isEmptyPhotoModel(this._dataModel))this.imageComp.source=g.EMPTY_PHOTO,this._displayState&&(this._displayState=null,this.invalidateState()),this.finishDataLoad();else{if(this._dataModel.source){var n=new a;n.bitmapData=this._dataModel.source,this.imageComp.source=n}else if(0==this._pendingLoadPhotoCount){var i=s.covert(O.PHOTO,this._dataModel.url);this.imageComp.source!=i&&(this._pendingLoadPhotoCount++,this.imageComp.source=decodeURIComponent(i))}this.editing||"filledPhoto"==this._displayState||(this._displayState="filledPhoto",this.invalidateState())}if(this.frameImageComp&&this.hasFrame){if(this._dataModel.frameUrl&&""!=this._dataModel.frameUrl)if(this._dataModel.frameSource){var r=new a;r.bitmapData=this._dataModel.frameSource,this.frameImageComp.source=r}else if(0==this._pendingLoadFrameCount){var d=s.covert(O.FRAME,this._dataModel.frameUrl);this.frameImageComp.source!=d&&(this._pendingLoadFrameCount++,this.frameImageComp.source=d)}this.frameImageComp.width=this._dataModel.width,this.frameImageComp.height=this._dataModel.height}this.realPxTip="最佳像素："+Math.round(this._dataModel.width).toString()+"x"+Math.round(this._dataModel.height).toString();var c=v.getInstance().getModel(this._dataModel.relatedPageId);c&&(this._dataModel.widthMM=l.px2mm(this._dataModel.width,o.DPI),this._dataModel.heightMM=l.px2mm(this._dataModel.height,o.DPI)),this.finishDataLoad()},R.prototype.onPropertyChangeHandler=function(t){this.fillElement()},R.prototype.finishDataLoad=function(){0==this._pendingLoadPhotoCount&&0==this._pendingLoadFrameCount&&0==this._pendingLoadMaskCount&&(e.prototype.finishDataLoad.call(this),this._dataModel.phoRotation>0&&this.fromChildStage&&this.rotatePhoto(this._dataModel.phoRotation))},R.prototype.drawBorder=function(){this.borderRect&&(this.borderRect.strokeColor=E.string2Uint(this._dataModel.borderColor),this.borderRect.strokeWeight=l.pt2px(this._dataModel.borderWidth,o.DPI),this.borderRect.fillAlpha=0,this.borderRect.visible=!0)},R.prototype.removeBorder=function(){this.borderRect&&(this.borderRect.strokeWeight=0,this.borderRect.visible=!1,this._dataModel.borderWidth=0)},R.prototype.createMask=function(){if(this.editing||!this.hasMaskRect){var t,e;this.frameMaskImageComp&&(this.frameMaskImageComp.cacheAsBitmap=!1),this.editing?(this.maskComp.getChildByName("parentMask")?t=this.maskComp.getChildByName("parentMask"):(t=new h,t.name="parentMask",this.maskComp.addChild(t)),t.getChildByName("childMask")?e=t.getChildByName("childMask"):(e=new h,e.name="childMask",t.addChild(e)),t.cacheAsBitmap=!0,e.cacheAsBitmap=!0,this.maskComp.cacheAsBitmap=!0,this.imageComp.cacheAsBitmap=!0,t.graphics.clear(),t.graphics.beginFill(0,.4),t.graphics.drawRect(this._dataModel.phoX,this._dataModel.phoY,this._dataModel.phoWidth,this._dataModel.phoHeight),t.graphics.endFill(),e.graphics.clear(),e.graphics.beginFill(0,1),e.graphics.drawRect(0,0,this._dataModel.width,this._dataModel.height),e.graphics.endFill(),this.maskComp.graphics.clear(),this.maskComp.graphics.beginFill(0,1),this.maskComp.graphics.drawRect(0,0,this._dataModel.width,this._dataModel.height),this.maskComp.graphics.endFill()):(this.maskComp.cacheAsBitmap=!1,this.imageComp.cacheAsBitmap=!1,this.maskComp.numChildren&&this.maskComp.removeChildren(),this.maskComp.graphics.clear(),this.maskComp.graphics.beginFill(0,1),this.maskComp.graphics.drawRect(0,0,this._dataModel.width,this._dataModel.height),this.maskComp.graphics.endFill()),this.imageComp.mask=this.maskComp}else if(this.frameMaskImageComp&&this.hasMaskRect&&this._dataModel.frameMaskUrl&&""!=this._dataModel.frameMaskUrl){if(this._dataModel.frameMaskSource){var o=new a;o.bitmapData=this._dataModel.frameMaskSource,this.frameMaskImageComp.source=o,this.setFrameMask()}else{var n=s.covert(O.FRAME,this._dataModel.frameMaskUrl);this.frameMaskImageComp.source!=n&&(this._pendingLoadMaskCount=1,this.frameMaskImageComp.source=n)}this.frameMaskImageComp.width=this._dataModel.width,this.frameMaskImageComp.height=this._dataModel.height}},R.prototype.onDataLoaded=function(e){if(this._pendingLoadPhotoCount=0,this.loadingDisplay&&(this.loadingDisplay.visible=!1),this._dataModel.source=this.imageComp.texture.bitmapData,!t.editor.managers.QuickImportPhotosController.getInstance().isEmptyPhotoModel(this._dataModel)){var o=b.getInstance().getModel(this._dataModel.relatedId);o||(o=new m,o.id=this._dataModel.relatedId),o.source=this._dataModel.source,o.url=this._dataModel.url,o.thumb_url=s.covert(O.PHOTO,this._dataModel.url,!0),o.status=S.UPLOAD_COMPLETE;var n=new C(C.ADD,!0);n.photoItem=o,n.increaseUsedCount=!0,this.dispatchEvent(n)}this.finishDataLoad()},R.prototype.onFrameImageLoaded=function(t){this._pendingLoadFrameCount=0,this._dataModel.frameSource=this.frameImageComp.texture.bitmapData,this.finishDataLoad()},R.prototype.onMaskImageLoaded=function(t){this._pendingLoadMaskCount=0,this._dataModel.frameMaskSource=this.frameMaskImageComp.texture.bitmapData,egret.callLater(this.setFrameMask,this),this.finishDataLoad()},R.prototype.setFrameMask=function(){this.maskComp.cacheAsBitmap=!1,this.imageComp.cacheAsBitmap=!1,this.maskComp.numChildren&&this.maskComp.removeChildren(),this.maskComp.graphics.clear(),this.imageComp.mask=this.frameMaskImageComp},R.prototype.onLoadIOError=function(t){this._pendingLoadPhotoCount=0;var e="照片链接无效或加载过程遇到IO错误 remark="+this._dataModel.remark+"\nsource="+this._dataModel.url;e+="\n该相框已自动被重置",d.show(c.Alert_ERROR,e,"加载照片失败"),this.clearPhoto(),this.finishDataLoad()},R.prototype.onFrameImageLoadIOError=function(t){this._pendingLoadFrameCount=0;"画框图片链接无效或加载过程遇到IO错误! \n"+this._dataModel.frameUrl;this.finishDataLoad()},R.prototype.onMaskImageLoadIOError=function(t){this._pendingLoadMaskCount=0;"遮罩图片链接无效或加载过程遇到IO错误! \n"+this._dataModel.frameMaskUrl;this.finishDataLoad()},R.prototype.onImageMouseDown=function(t){this.editing&&(this.imageComp.addEventListener(y.TOUCH_MOVE,this.onImageMouseMove,this),this.imageComp.addEventListener(y.TOUCH_END,this.onImageMouseUp,this),this.storeX=this.imageComp.x,this.storeY=this.imageComp.y,this.XTouch=t.stageX,this.YTouch=t.stageY)},R.prototype.onImageMouseMove=function(t){var e=this.storeX+(t.stageX-this.XTouch),o=this.storeY+(t.stageY-this.YTouch);e>0&&(e=0),o>0&&(o=0);var n=this._dataModel.phoWidth-this.width;n=n>0?-n:0,n>e&&(e=n);var i=this._dataModel.phoHeight-this.height;i=i>0?-i:0,i>o&&(o=i),this.imageComp.x=e,this.imageComp.y=o,this._dataModel.phoX=this.imageComp.x,this._dataModel.phoY=this.imageComp.y,this.createMask()},R.prototype.onImageMouseUp=function(t){this.imageComp.removeEventListener(y.TOUCH_MOVE,this.onImageMouseMove,this),this.imageComp.removeEventListener(y.TOUCH_END,this.onImageMouseUp,this)},R.prototype.getPhotoBestPositionByFaceRecognition=function(){for(var t,e,o,n,i,r,a,s=[],l=new M,d=new f,c=0,h=this._dataModel.faceInfos;c<h.length;c++)t=h[c],e=I.getScale(this._dataModel.phoWidth,this._dataModel.phoHeight,t.phoWidth,t.phoHeight),s.push(t);s=s.sort(function(t,e){return t.faceX-e.faceX}),r=s[0],a=s[s.length-1],s=s.sort(function(t,e){return t.faceY-e.faceY}),n=s[0],i=s[s.length-1],l.x=r.faceX,l.y=n.faceY,l.width=a.faceX+a.faceWidth-r.faceX,l.height=i.faceY+a.faceHeight-n.faceY;var u,m=1200,p=0,g=this._dataModel.rotation;0>g&&(g=360-Math.abs(g));var v=Math.cos(w.toRadians(g)),_=Math.sin(w.toRadians(g));if(Math.floor(this._dataModel.width)==Math.floor(this._dataModel.phoWidth)){var y=this._dataModel.height*T.setPrecision(1/3,2);o=new f,o.x=0,o.y=y-(l.y+l.height/2)*e;var E;d=new f;do{p++,u=!1,o.y<0?d.y=this._dataModel.y-Math.abs(o.y):d.y=this._dataModel.y+Math.abs(o.y);var C,O=d.y>this._dataModel.y,P=d.y+this._dataModel.phoHeight<this._dataModel.y+this._dataModel.height,L=d.y+(n.faceY+l.height)*e>this._dataModel.y+this._dataModel.height,S=d.y+n.faceY*e<this._dataModel.y;(S||L)&&(C=!0,console.log("【人脸矩形溢出相框，居中处理】")),O?o.y-=2:P?o.y+=2:C&&!E?(y=this._dataModel.height/2,o.y=y-(l.y+l.height/2)*e,d.x=this._dataModel.x,d.y=this._dataModel.y-o.y,E=!0):u=!0,p>m&&(u=!0,console.log("【人脸识别坐标计算出现死循环！】","竖形照片, Ph_id = ",this._dataModel.id))}while(!u);g>1?(d.x=this._dataModel.x+Math.abs(o.y)*_,d.y=this._dataModel.y-Math.abs(o.y)*v):d.x=this._dataModel.x}else{var b=this._dataModel.width/2;o=new f,o.y=0,o.x=b-(l.x+l.width/2)*e;do{p++,u=!1,o.x<0?d.x=this._dataModel.x-Math.abs(o.x):d.x=this._dataModel.x+Math.abs(o.x);var k=d.x>this._dataModel.x,R=d.x+this._dataModel.phoWidth<this._dataModel.x+this._dataModel.width;k?o.x-=2:R?o.x+=2:u=!0,p>m&&(u=!0,console.log("【人脸识别坐标计算出现死循环！】","横形照片, Ph_id = ",this._dataModel.id))}while(!u);g>1?(d.x=this._dataModel.x-Math.abs(o.x)*v,d.y=this._dataModel.y-Math.abs(o.x)*_):d.y=this._dataModel.y}return o},R.prototype.rotatePhoto=function(t,e){if(void 0===e&&(e=!1),this.filled&&(this._dataModel.phoRotation!=t||!this._dataModel.phoRotated||e)){var o,n=this._dataModel.phoRotated;if(e){o=P.rotateTheRatioOf90(t,this._dataModel.source,n);var i,r,a,s,l=o.width,d=o.height;l/d>=this._dataModel.width/this._dataModel.height?(i=l*this._dataModel.height/d,r=this._dataModel.height):(r=d*this._dataModel.width/l,i=this._dataModel.width),a=(this._dataModel.width-i)/2,s=(this._dataModel.height-r)/2,this._dataModel.phoX=a,this._dataModel.phoY=s,this._dataModel.phoWidth=i,this._dataModel.phoHeight=r,this._dataModel.phoScale=1,console.log("旋转后的旋转度：",this._dataModel.phoRotation)}else switch(t){case 90:o=P.rotateTheRatioOf90(90,this._dataModel.source,n);break;case 180:o=P.rotateTheRatioOf90(180,this._dataModel.source,n);break;case 270:o=P.rotateTheRatioOf90(-90,this._dataModel.source,n);break;default:o=this._dataModel.source}this._dataModel.phoRotated=!0,console.log(this.fromChildStage?"子舞台":"主舞台","[rotatePhoto]",t,o.width,o.height),this._dataModel.source=o,k.update(this._dataModel,"phoRotated")}},R}(e.ElementBase);e.PhotoElement=R,__reflect(R.prototype,"cdcommon.editor.components.PhotoElement")}(o=e.components||(e.components={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(e){var o;!function(e){var o=t.editor.constants.ElementConstant,n=t.editor.models.PhotoElementModel,i=t.editor.models.TextElementModel,r=t.editor.models.DecorationElementModel,a=t.editor.models.BackgroundElementModel,s=t.editor.models.SpecialElementModel,l=t.editor.models.CalendarElementModel,d=t.editor.constants.MaterialKindConstant,c=t.editor.models.PhotoItem,h=t.editor.models.FontItem,u=t.editor.models.DecorationItem,m=t.editor.models.FrameItem,p=t.editor.models.BackgroundItem,f=t.editor.models.SpecialItem,g=function(){function t(){}return t.createElementModel=function(t){var d;switch(t){case o.TYPE_PHOTO:d=new n;break;case o.TYPE_TEXT:d=new i;break;case o.TYPE_DECORATION:d=new r;break;case o.TYPE_BACKGROUND:d=new a;break;case o.TYPE_SPECIAL:d=new s;break;case o.TYPE_SMART_CONTACTS_GRID:break;case o.TYPE_SMART_CALENDAR:d=new l}return d.id=e.IDFactory.getElementModelID(t),d},t.createElementModelByMaterialModel=function(e){var n;switch(e.kind){case d.PHOTO:n=t.createElementModel(o.TYPE_PHOTO),n.url=e.url,n.source=e.source;
break;case d.FONT:n=t.createElementModel(o.TYPE_TEXT),n.fontFamily=e.font_family,n.fontName_ch=e.fontName_ch,n.fontName_en=e.fontName_en;break;case d.DECORATION:n=t.createElementModel(o.TYPE_DECORATION),n.url=e.url;break;case d.FRAME:n=t.createElementModel(o.TYPE_PHOTO),n.frameUrl=e.frame_url,n.frameMaskUrl=e.frame_mask_url;break;case d.BACKGROUND:n=t.createElementModel(o.TYPE_BACKGROUND),n.url=e.url;break;case d.SPECIAL:n=t.createElementModel(o.TYPE_SPECIAL),n.url=e.url;break;case d.SMART:n=t.createElementModel(e.type)}return n},t.createMaterialModel=function(t){var o;switch(t){case d.PHOTO:o=new c;break;case d.FONT:o=new h;break;case d.DECORATION:o=new u;break;case d.FRAME:o=new m;break;case d.BACKGROUND:o=new p;break;case d.SPECIAL:o=new f}return o.id=e.IDFactory.getMaterialItemID(t),o},t}();e.ModelFactory=g,__reflect(g.prototype,"cdcommon.editor.factories.ModelFactory")}(o=e.factories||(e.factories={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(t){var e;!function(t){var e=function(){function t(){this.textCount=0,this.photoCount=0,this.decorationCount=0,this.specialCount=0,this.backgroundCount=0,this.smartCount=0,this.allLoadedCount=0,this.allCount=0,this.loadedTextCount=0,this.loadedPhotoCount=0,this.loadedDecorationCount=0,this.loadedSpecialCount=0,this.loadedBackgroundCount=0,this.loadedSmartCount=0}return t.prototype.fillByObject=function(t){this.textCount=t.textCount,this.photoCount=t.photoCount,this.decorationCount=t.decorationCount,this.specialCount=t.specialCount,this.backgroundCount=t.backgroundCount,this.smartCount=t.smartCount,this.allLoadedCount=t.allLoadedCount,this.allCount=t.allCount,this.loadedTextCount=t.loadedTextCount,this.loadedPhotoCount=t.loadedPhotoCount,this.loadedDecorationCount=t.loadedDecorationCount,this.loadedSpecialCount=t.loadedSpecialCount,this.loadedBackgroundCount=t.loadedBackgroundCount,this.loadedSmartCount=t.loadedSmartCount},t.prototype.clone=function(){var e=new t;return e.textCount=this.textCount,e.photoCount=this.photoCount,e.decorationCount=this.decorationCount,e.specialCount=this.specialCount,e.backgroundCount=this.backgroundCount,e.smartCount=this.smartCount,e.allLoadedCount=this.allLoadedCount,e.allCount=this.allCount,e.loadedTextCount=this.loadedTextCount,e.loadedPhotoCount=this.loadedPhotoCount,e.loadedDecorationCount=this.loadedDecorationCount,e.loadedSpecialCount=this.loadedSpecialCount,e.loadedBackgroundCount=this.loadedBackgroundCount,e.loadedSmartCount=this.loadedSmartCount,e},t}();t.CountLoadModel=e,__reflect(e.prototype,"cdcommon.editor.models.CountLoadModel")}(e=t.models||(t.models={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(t){var e;!function(t){var e=function(){function t(){this.kind="",this.name="",this.url=""}return t}();t.APIConfigItem=e,__reflect(e.prototype,"cdcommon.framework.models.APIConfigItem")}(e=t.models||(t.models={}))}(e=t.framework||(t.framework={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(t){var e;!function(t){var e=egret.Event,o=function(t){function e(e,o,n,i){return t.call(this,e,o,n,i)||this}return __extends(e,t),e.prototype.clone=function(){var t=new e(this.type,this.bubbles,this.cancelable,this.data);return t.pageModel=this.pageModel,t.scaleValue=this.scaleValue,t},e.SCALE_CHANGE="stageScaleChange",e.INIT_FRAMEWORK_COMPLETE="initFrameworkComplete",e.ELEMENT_CREATION_COMPLETE="elementCreationComplete",e.CHANGE_PREVIEW_MODE="changePreviewMode",e}(e);t.StageEvent=o,__reflect(o.prototype,"cdcommon.editor.events.StageEvent")}(e=t.events||(t.events={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(t){var e;!function(t){var e=egret.Event,o=function(t){function e(e,o,n,i){return t.call(this,e,o,n,i)||this}return __extends(e,t),e.prototype.clone=function(){var t=new e(this.type,this.bubbles,this.cancelable,this.data);return t.elements=this.elements,t},e.SHOW="showController",e.HIDE="hideController",e.FOCUS_IN="barFocusIn",e.FOCUS_OUT="barFocusOut",e.APPLY="apply",e.LOCK_SHAKE="lockShake",e}(e);t.ElementControllerEvent=o,__reflect(o.prototype,"cdcommon.editor.events.ElementControllerEvent")}(e=t.events||(t.events={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(e){var o;!function(e){var o;!function(o){var n=egret.Sprite,i=t.framework.utils.Dictionary,r=function(){function t(t,o){this.decorators=[],this.subDrawLayers=new i,this.drawLayer=o,this.objectHandles=t,this.objectHandles.selectionManager.addEventListener(e.SelectionEvent.ADDED_TO_SELECTION,this.onSelectionChanged,this),this.objectHandles.selectionManager.addEventListener(e.SelectionEvent.REMOVED_FROM_SELECTION,this.onSelectionChanged,this),this.objectHandles.selectionManager.addEventListener(e.SelectionEvent.SELECTION_CLEARED,this.onSelectionChanged,this),this.objectHandles.selectionManager.addEventListener(e.SelectionEvent.SELECTED,this.onSelectionChanged,this),this.objectHandles.addEventListener(e.ObjectChangedEvent.OBJECT_MOVING,this.onPositionChanged,this),this.objectHandles.addEventListener(e.ObjectChangedEvent.OBJECT_RESIZING,this.onPositionChanged,this),this.objectHandles.addEventListener(e.ObjectChangedEvent.OBJECT_ROTATING,this.onPositionChanged,this),this.objectHandles.addEventListener(e.ObjectChangedEvent.OBJECT_CLICK_OFF,this.onSelectionChanged,this)}return t.prototype.destroy=function(){this.objectHandles&&(this.objectHandles.selectionManager.removeEventListener(e.SelectionEvent.ADDED_TO_SELECTION,this.onSelectionChanged,this),this.objectHandles.selectionManager.removeEventListener(e.SelectionEvent.REMOVED_FROM_SELECTION,this.onSelectionChanged,this),this.objectHandles.selectionManager.removeEventListener(e.SelectionEvent.SELECTION_CLEARED,this.onSelectionChanged,this),this.objectHandles.selectionManager.removeEventListener(e.SelectionEvent.SELECTED,this.onSelectionChanged,this),this.objectHandles.removeEventListener(e.ObjectChangedEvent.OBJECT_MOVING,this.onPositionChanged,this),this.objectHandles.removeEventListener(e.ObjectChangedEvent.OBJECT_RESIZING,this.onPositionChanged,this),this.objectHandles.removeEventListener(e.ObjectChangedEvent.OBJECT_ROTATING,this.onPositionChanged,this),this.objectHandles.removeEventListener(e.ObjectChangedEvent.OBJECT_CLICK_OFF,this.onSelectionChanged,this),this.objectHandles=null);for(var t,o=0,n=this.decorators;o<n.length;o++)t=n[o],t.cleanup(this.subDrawLayers.getValue(t)),this.subDrawLayers.remove(t);this.decorators.splice(0),this.drawLayer=null},t.prototype.addDecorator=function(t){var e=new n;this.drawLayer.addChild(e),this.decorators.push(t),this.subDrawLayers.add(t,e)},t.prototype.updateNow=function(){for(var t,e=0,o=this.decorators;e<o.length;e++)t=o[e],t.updateSelected(this.objectHandles.modelList,this.objectHandles.selectionManager.currentlySelected,this.subDrawLayers.getValue(t)),t.updatePosition(this.objectHandles.modelList,this.objectHandles.selectionManager.currentlySelected,this.objectHandles.modelList,this.subDrawLayers.getValue(t))},t.prototype.onSelectionChanged=function(t){for(var e,o=0,n=this.decorators;o<n.length;o++)e=n[o],e.updateSelected(this.objectHandles.modelList,this.objectHandles.selectionManager.currentlySelected,this.subDrawLayers.getValue(e))},t.prototype.onPositionChanged=function(t){for(var e,o=0,n=this.decorators;o<n.length;o++)e=n[o],e.updatePosition(this.objectHandles.modelList,this.objectHandles.selectionManager.currentlySelected,t.relatedObjects,this.subDrawLayers.getValue(e))},t}();o.DecoratorManager=r,__reflect(r.prototype,"cdcommon.framework.objecthandles.decorators.DecoratorManager")}(o=e.decorators||(e.decorators={}))}(o=e.objecthandles||(e.objecthandles={}))}(e=t.framework||(t.framework={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(t){var e;!function(t){var e=egret.Event,o=function(t){function e(e,o,n,i){return t.call(this,e,o,n,i)||this}return __extends(e,t),e.prototype.clone=function(){var t=new e(this.type,this.bubbles,this.cancelable,this.data);return t.loadCountVO=this.loadCountVO,t},e.EXTRACT_READY="extractReady",e.LOAD_READY="loadReady",e.COUNT_CHANGE="loadCountChange",e}(e);t.ElementLoadEvent=o,__reflect(o.prototype,"cdcommon.editor.events.ElementLoadEvent")}(e=t.events||(t.events={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(e){var o;!function(e){var o=egret.Event,n=egret.EventDispatcher,i=egret.URLLoader,r=egret.IOErrorEvent,a=t.framework.events.InterfaceEvent,s=function(t){function e(e){var o=t.call(this,e)||this;return o.reCallTime=2,o.reCallDelay=500,o.loader=new i,o._currReCallTime=0,o}return __extends(e,t),e.prototype.call=function(t){this.callParam=t,this.addLoaderListeners()},e.prototype.addLoaderListeners=function(){this.loader.addEventListener(o.COMPLETE,this.onResultHandler,this),this.loader.addEventListener(r.IO_ERROR,this.onFaultHandler,this)},e.prototype.removeLoaderListeners=function(){this.loader.removeEventListener(o.COMPLETE,this.onResultHandler,this),this.loader.removeEventListener(r.IO_ERROR,this.onFaultHandler,this)},e.prototype.onResultHandler=function(t){throw Error("must override")},e.prototype.onFaultHandler=function(t){throw Error("must override")},e.prototype.callback=function(t,e){var o,n=this;if(t==a.FAULT&&this.reCallTime>0?this._currReCallTime==this.reCallTime?o=!0:egret.setTimeout(function(){n.call(n.callParam),n._currReCallTime++},this,this.reCallDelay):o=!0,o){this.removeLoaderListeners();var i=new a(t,!1,!1,e);this.dispatchEvent(i)}},e}(n);e.InterfaceBase=s,__reflect(s.prototype,"cdcommon.framework.services.InterfaceBase")}(o=e.services||(e.services={}))}(e=t.framework||(t.framework={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(t){var e;!function(t){var e=function(){function t(t){void 0===t&&(t=null),this.properties=null,this.generator=t}return t.prototype.newInstance=function(){var t=new this.generator;if(null!=this.properties)for(var e in this.properties)t[e]=this.properties[e];return t},t}();t.ClassFactory=e,__reflect(e.prototype,"cdcommon.framework.objecthandles.ClassFactory",["cdcommon.framework.objecthandles.IFactory"])}(e=t.objecthandles||(t.objecthandles={}))}(e=t.framework||(t.framework={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(e){var o;!function(e){var o=egret.Sprite,n=egret.Bitmap,i=egret.TouchEvent,r=t.framework.objecthandles.HandleRoles,a=function(t){function e(){var e=t.call(this)||this;return e.isOver=!1,e.bitmap=new n,e.addChild(e.bitmap),e.touchEnabled=!0,e.addEventListener(i.TOUCH_BEGIN,e.onMouseEventHandle,e),e.addEventListener(i.TOUCH_END,e.onMouseEventHandle,e),e.addEventListener(i.TOUCH_RELEASE_OUTSIDE,e.onMouseEventHandle,e),e}return __extends(e,t),Object.defineProperty(e.prototype,"handleDescriptor",{get:function(){return this._descriptor},set:function(t){this._descriptor=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"targetModel",{get:function(){return this._targetModel},set:function(t){this._targetModel=t},enumerable:!0,configurable:!0}),e.prototype.onMouseEventHandle=function(t){this.isOver=t.type==i.TOUCH_BEGIN,this.redraw()},e.prototype.destory=function(){this.removeEventListener(i.TOUCH_BEGIN,this.onMouseEventHandle,this),this.removeEventListener(i.TOUCH_END,this.onMouseEventHandle,this),this.removeEventListener(i.TOUCH_RELEASE_OUTSIDE,this.onMouseEventHandle,this)},e.prototype.redraw=function(){this.handleDescriptor.role==r.MOVE?(this.bitmap.texture=RES.getRes("btn_resize_png"),this.bitmap.cacheAsBitmap=!0,this.bitmap.width=this.bitmap.height=e.bitmapSize,this.bitmap.x=-e.bitmapSize/2,this.bitmap.y=-e.bitmapSize/2):this.handleDescriptor.role==r.ROTATE?(this.bitmap.texture=RES.getRes("btn_rotate_png"),this.bitmap.cacheAsBitmap=!0,this.bitmap.width=this.bitmap.height=e.bitmapSize,this.bitmap.x=-e.bitmapSize/2,this.bitmap.y=-e.bitmapSize/2):(this.graphics.clear(),this.isOver?(this.graphics.lineStyle(e.borderWidth,e.handleBorderColorOver),this.graphics.beginFill(e.handleColorOver,1)):(this.graphics.lineStyle(e.borderWidth,e.handleBorderColor),this.graphics.beginFill(e.handleColor,1)),this.graphics.drawRect(-e.handleSize/2,-e.handleSize/2,e.handleSize,e.handleSize),this.graphics.endFill())},e.handleSize=10,e.bitmapSize=10,e.outerlineLength=20,e.handleColor=16777215,e.handleColorOver=16664606,e.borderWidth=1,e.handleBorderColor=16664606,e.handleBorderColorOver=16664606,e}(o);e.BitmapHandle=a,__reflect(a.prototype,"cdcommon.editor.objecthandles.BitmapHandle",["cdcommon.framework.objecthandles.IHandle","egret.IEventDispatcher"])}(o=e.objecthandles||(e.objecthandles={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(e){var o;!function(e){var o=egret.Sprite,n=t.editor.models.ElementModelBase,i=egret.EventDispatcher,r=eui.PropertyEvent,a=function(t){function o(){var e=t.call(this)||this;return e.isOver=!1,e}return __extends(o,t),Object.defineProperty(o.prototype,"handleDescriptor",{get:function(){return this._descriptor},set:function(t){this._descriptor=t},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"targetModel",{get:function(){return this._targetModel},set:function(t){this._targetModel=t,t instanceof i&&t.addEventListener(r.PROPERTY_CHANGE,this.onPropertyChange,this)},enumerable:!0,configurable:!0}),o.prototype.destory=function(){this.graphics.clear(),this.targetModel.removeEventListener(r.PROPERTY_CHANGE,this.onPropertyChange,this)},o.prototype.redraw=function(){var t;this.targetModel instanceof n&&(t=this.targetModel,this.graphics.clear(),this.graphics.lineStyle(e.BitmapHandle.borderWidth,e.BitmapHandle.handleBorderColor),this.graphics.moveTo(0,0),this.graphics.lineTo(t.width,0),this.graphics.lineTo(t.width,t.height),this.graphics.lineTo(0,t.height),this.graphics.lineTo(0,0))},o.prototype.onPropertyChange=function(){this.redraw()},o}(o);e.BorderLineHandle=a,__reflect(a.prototype,"cdcommon.editor.objecthandles.BorderLineHandle",["cdcommon.framework.objecthandles.IHandle","egret.IEventDispatcher"])}(o=e.objecthandles||(e.objecthandles={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(e){var o;!function(e){var o=egret.Sprite,n=t.framework.objecthandles.HandleRoles,i=t.framework.utils.UnitConvertionUtil,r=function(t){function o(){var e=t.call(this)||this;return e.isOver=!1,e}return __extends(o,t),Object.defineProperty(o.prototype,"handleDescriptor",{get:function(){return this._descriptor},set:function(t){this._descriptor=t},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"targetModel",{get:function(){return this._targetModel},set:function(t){this._targetModel=t},enumerable:!0,configurable:!0}),o.prototype.destory=function(){this.graphics.clear()},o.prototype.redraw=function(){this.graphics.clear(),this.graphics.lineStyle(e.BitmapHandle.borderWidth,e.BitmapHandle.handleBorderColor),this.graphics.moveTo(0,0),this.handleDescriptor.role==n.MOVE_LINE?this.graphics.lineTo(0,i.pt2px(e.BitmapHandle.outerlineLength,EditorCommon.DPI)):this.handleDescriptor.role==n.ROTATE_LINE&&this.graphics.lineTo(i.pt2px(e.BitmapHandle.outerlineLength,EditorCommon.DPI),0)},o}(o);e.VLineHandle=r,__reflect(r.prototype,"cdcommon.editor.objecthandles.VLineHandle",["cdcommon.framework.objecthandles.IHandle","egret.IEventDispatcher"])}(o=e.objecthandles||(e.objecthandles={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(t){var e;!function(t){var e;!function(t){var e=function(){function t(t,e,o,n){void 0===e&&(e=30),void 0===o&&(o=5e3),void 0===n&&(n=4e3),this.offset=e,this.lineWidth=o,this.lineHeight=n,this.objecthandles=t}return t.prototype.updateSelected=function(t,e,o){o.graphics.clear(),this._existedHLine=this._existedVLine=!1},t.prototype.updatePosition=function(t,e,o,n){if(1==e.length){var i=e[0];n.graphics.clear(),n.graphics.lineStyle(1,65280,1),this._existedHLine=this._existedVLine=!1;for(var r,a=0,s=t;a<s.length;a++)r=s[a],r!=i&&(Math.abs(i.x-r.x)<this.offset&&this.drawVerticalLine(r.x,n,i,r.x),Math.abs(i.y-r.y)<this.offset&&this.drawHorizontalLine(r.y,n,i,r.y),Math.abs(i.x+i.width-(r.x+r.width))<this.offset&&this.drawVerticalLine(r.x+r.width,n,i,r.x+r.width-i.width),Math.abs(i.y+i.height-(r.y+r.height))<this.offset&&this.drawHorizontalLine(r.y+r.height,n,i,r.y+r.height-i.height),Math.abs(i.x-(r.width+r.x))<this.offset&&this.drawVerticalLine(i.x,n,i,r.width+r.x),Math.abs(i.y-(r.y+r.height))<this.offset&&this.drawHorizontalLine(i.y,n,i,r.y+r.height),Math.abs(i.x+i.width-r.x)<this.offset&&this.drawVerticalLine(i.x+i.width,n,i,r.x-i.width),Math.abs(i.y+i.height-r.y)<this.offset&&this.drawHorizontalLine(i.y+i.height,n,i,r.y-i.height))}},t.prototype.drawVerticalLine=function(t,e,o,n){void 0===o&&(o=null),void 0===n&&(n=0),e.graphics.moveTo(t,0),e.graphics.lineTo(t,this.lineHeight),this._existedVLine=!0},t.prototype.drawHorizontalLine=function(t,e,o,n){void 0===o&&(o=null),void 0===n&&(n=0),e.graphics.moveTo(0,t),e.graphics.lineTo(this.lineWidth,t),this._existedHLine=!0},t.prototype.cleanup=function(t){t.graphics.clear(),this._existedHLine=this._existedVLine=!1},t}();t.AlignmentDecorator=e,__reflect(e.prototype,"cdcommon.framework.objecthandles.decorators.AlignmentDecorator",["cdcommon.framework.objecthandles.decorators.IDecorator"])}(e=t.decorators||(t.decorators={}))}(e=t.objecthandles||(t.objecthandles={}))}(e=t.framework||(t.framework={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(t){var e;!function(t){var e;!function(t){var e=function(){function t(){}return t.prototype.applyConstraint=function(t,e,o){t&&e&&(isNaN(this.maxWidth)||t.width+e.width>this.maxWidth&&(e.width=this.maxWidth-t.width),isNaN(this.maxHeight)||t.height+e.height>this.maxHeight&&(e.height=this.maxHeight-t.height),isNaN(this.minWidth)||t.width+e.width<this.minWidth&&(e.width=this.minWidth-t.width),isNaN(this.minHeight)||t.height+e.height<this.minHeight&&(e.height=this.minHeight-t.height))},t}();t.SizeConstraint=e,__reflect(e.prototype,"cdcommon.framework.objecthandles.constraints.SizeConstraint",["cdcommon.framework.objecthandles.IConstraint"])}(e=t.constraints||(t.constraints={}))}(e=t.objecthandles||(t.objecthandles={}))}(e=t.framework||(t.framework={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(t){var e;!function(t){var e;!function(t){var e=function(){function t(){}return t.prototype.applyConstraint=function(t,e,o){t&&e&&(isNaN(this.maxX)||t.x+e.x>this.maxX&&(e.x=this.maxX-t.x),isNaN(this.maxY)||t.y+e.y>this.maxY&&(e.y=this.maxY-t.y),isNaN(this.minX)||t.x+e.x<this.minX&&(e.x=this.minX-t.x),isNaN(this.minY)||t.y+e.y<this.minY&&(e.y=this.minY-t.y))},t}();t.MovementConstraint=e,__reflect(e.prototype,"cdcommon.framework.objecthandles.constraints.MovementConstraint",["cdcommon.framework.objecthandles.IConstraint"])}(e=t.constraints||(t.constraints={}))}(e=t.objecthandles||(t.objecthandles={}))}(e=t.framework||(t.framework={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(e){var o;!function(e){var o;!function(e){var o=egret.Point,n=t.framework.objecthandles.HandleRoles,i=function(){function t(){this.origin=new o(0,0)}return t.prototype.applyConstraint=function(t,e,i){if(n.isResize(i)){var r,a=t.width/t.height,s=new o(e.width,e.width/a),l=new o(e.height*a,e.height),d=new o(e.width,e.height),c=o.distance(s,d),h=o.distance(l,d);r=n.isResizeDown(i)||n.isResizeUp(i)?(n.isResizeLeft(i)||n.isResizeRight(i))&&h>c?s:l:s,e.width=r.x,e.height=r.y}},t}();e.MaintainProportionConstraint=i,__reflect(i.prototype,"cdcommon.framework.objecthandles.constraints.MaintainProportionConstraint",["cdcommon.framework.objecthandles.IConstraint"])}(o=e.constraints||(e.constraints={}))}(o=e.objecthandles||(e.objecthandles={}))}(e=t.framework||(t.framework={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(t){var e;!function(t){var e=egret.Event,o=function(t){function e(e,o,n,i){return t.call(this,e,o,n,i)||this}return __extends(e,t),e.prototype.clone=function(){var t=new e(this.type,this.bubbles,this.cancelable,this.data);return t.elementModel=this.elementModel,t},e.ADD_TO_STAGE="addElementToStage",e.REMOVE_FROM_STAGE="removeElementFromStage",e.DATA_CHANGED="elementDataChanged",e.UP_INDEX="upIndex",e.DOWN_INDEX="downIndex",e.MAX_INDEX="maxIndex",e.MIN_INDEX="minIndex",e}(e);t.ElementEvent=o,__reflect(o.prototype,"cdcommon.editor.events.ElementEvent")}(e=t.events||(t.events={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(e){var o;!function(e){var o=t.editor.models.PhotoElementModel,n=t.editor.models.TextElementModel,i=t.editor.models.DecorationElementModel,r=t.editor.models.BackgroundElementModel,a=t.editor.models.SpecialElementModel,s=t.editor.models.CalendarElementModel,l=t.editor.components.BackgroundElement,d=t.editor.components.TextElement,c=t.editor.components.PhotoElement,h=t.editor.components.DecorationElement,u=t.editor.components.SpecialElement,m=t.editor.components.CalendarElement,p=function(){function t(){}return t.create=function(t){var e;return t instanceof n?e=new d:t instanceof a?e=new u:t instanceof o?e=new c:t instanceof i?e=new h:t instanceof r?e=new l:t instanceof s&&(e=new m),e},t}();e.ElementFactory=p,__reflect(p.prototype,"cdcommon.editor.factories.ElementFactory")}(o=e.factories||(e.factories={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(e){var o;!function(e){var o=t.framework.hashmap.HashMap,n=t.framework.utils.UnitConvertionUtil,i=t.editor.constants.LayerConstant,r=t.editor.models.BackgroundElementModel,a=t.editor.constants.ElementConstant,s=t.editor.models.PhotoElementModel,l=t.editor.factories.ModelFactory,d=t.framework.managers.ModelDataGenerator,c=t.editor.factories.IDFactory,h=function(){function t(t){this._photoHashMap=new o,this._decorationHashMap=new o,this._textHashMap=new o,this._backgroundHashMap=new o,this._specialHashMap=new o,this._smartHashMap=new o,this._repeatCount=0}return t.scaleModelList=function(e,o){if(1!=o)for(var n,i=0,r=e;i<r.length;i++)n=r[i],t.scaleModel(n,o)},t.reviseThicknessModelList=function(t,e,o){for(var r,a=n.mm2px(e,EditorCommon.DPI),s=n.mm2px(10,EditorCommon.DPI),l=a-s,d=0,c=t;d<c.length;d++){r=c[d];var h=r.layer==i.DESIGN_LAYER?o.design_layer_width:o.top_layer_width,u=n.mm2px(h,EditorCommon.DPI)/2,m=u+s,p=u+a;r.x>=m&&(r.x+=l,console.log("elementType",r.elementType),console.log("元素书脊 偏移量：",l)),r.x>u&&r.x<p&&(r.x=p)}},t.scaleModel=function(t,e){if(!(1==e||t instanceof r))switch(t.x*=e,t.y*=e,t.width*=e,t.height*=e,t.shadowDistance*=e,t.shadowBlur*=e,t.elementType){case a.TYPE_PHOTO:var o=t;o.phoX*=e,o.phoY*=e,o.phoWidth*=e,o.phoHeight*=e;var n=o.borderWidth*e;o.borderWidth=Math.round(n);break;case a.TYPE_TEXT:var i=t,s=i.size*e;i.size=Math.round(s);break;case a.TYPE_DECORATION:break;case a.TYPE_SPECIAL:}},t.prototype.clear=function(){this.removeAllModel()},t.prototype.addModel=function(t,e){var o=this.getHashMap(e);o.containsKey(t.id)?t instanceof s&&(this._repeatCount++,console.log("[重复ID]","ph_Id = ",t.id,"page index=",t.relatedPageIndex),console.log("[总共重复个数]",this._repeatCount)):o.put(t.id,t)},t.prototype.getModel=function(t,e){var o,n=this.getHashMap(e);return n.containsKey(t)&&(o=n.getValue(t)),o},t.prototype.removeModel=function(t,e){var o=this.getHashMap(e);o.containsKey(t)&&o.remove(t)},t.prototype.removeAllModel=function(){this._photoHashMap.clear(),this._decorationHashMap.clear(),this._textHashMap.clear(),this._backgroundHashMap.clear(),this._specialHashMap.clear(),this._smartHashMap.clear()},t.prototype.removeModelListByType=function(t){var e=this.getHashMap(t);e.clear()},t.prototype.removeModelListByPageId=function(t,e){void 0===e&&(e=null);var o;if(e){var n=this.getHashMap(e);o=n.getValues();for(var i=0,r=o;i<r.length;i++){var a=r[i];a.relatedPageId==t&&n.remove(a.id)}}else this.removeModelListByPageIdHandler(t,this._photoHashMap),this.removeModelListByPageIdHandler(t,this._textHashMap),this.removeModelListByPageIdHandler(t,this._decorationHashMap),this.removeModelListByPageIdHandler(t,this._backgroundHashMap),this.removeModelListByPageIdHandler(t,this._specialHashMap),this.removeModelListByPageIdHandler(t,this._smartHashMap)},t.prototype.getModelListByType=function(t){var e,o=this.getHashMap(t);return e=o.getValues()},t.prototype.getModelListByPageId=function(t,e){void 0===e&&(e=null);var o=[];if(e)for(var n=this.getHashMap(e),i=n.getValues(),r=0,a=i;r<a.length;r++){var s=a[r];s.relatedPageId==t&&o.push(s)}else{var l=this.getModelListByPageIdHandler(t,this._photoHashMap),d=this.getModelListByPageIdHandler(t,this._textHashMap),c=this.getModelListByPageIdHandler(t,this._decorationHashMap),h=this.getModelListByPageIdHandler(t,this._backgroundHashMap),u=this.getModelListByPageIdHandler(t,this._specialHashMap),m=this.getModelListByPageIdHandler(t,this._smartHashMap);o=l.concat(d,c,h,u,m)}return o},t.prototype.modelListToJsonString=function(t){var e="";if(t.length>0){for(var o,n=0,i=t;n<i.length;n++){o=i[n];var r=JSON.stringify(o.toJsonObject());e+=r+","}e="["+e.substr(0,e.lastIndexOf(","))+"]"}else e="[]";return e},t.prototype.jsonListToModelList=function(t){for(var e=[],o=0,n=t;o<n.length;o++){var i=n[o],r=l.createElementModel(i.elementType);r=d.fillModelByObject(i,r),r.id=c.getElementModelID(r.elementType),e.push(r)}return e},t.prototype.getHashMap=function(t){var e;switch(t){case a.TYPE_PHOTO:e=this._photoHashMap;break;case a.TYPE_DECORATION:e=this._decorationHashMap;break;case a.TYPE_TEXT:e=this._textHashMap;break;case a.TYPE_BACKGROUND:e=this._backgroundHashMap;break;case a.TYPE_SPECIAL:e=this._specialHashMap;break;case a.TYPE_SMART_CONTACTS_GRID:e=this._smartHashMap;break;case a.TYPE_SMART_CALENDAR:e=this._smartHashMap}return e},t.prototype.getModelListByPageIdHandler=function(t,e){for(var o,n=[],i=e.getValues(),r=0,a=i;r<a.length;r++)o=a[r],o.relatedPageId==t&&n.push(o);return n},t.prototype.removeModelListByPageIdHandler=function(t,e){for(var o,n=e.getValues(),i=0,r=n;i<r.length;i++)o=r[i],o.relatedPageId==t&&e.remove(o.id)},t.getInstance=function(){return this._inst||(this._inst=new t(new u)),this._inst},t}();e.ElementModelController=h,__reflect(h.prototype,"cdcommon.editor.managers.ElementModelController");var u=function(){function t(){}return t}();__reflect(u.prototype,"SingletonEnforcer")}(o=e.managers||(e.managers={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(t){var e;!function(t){var e=function(){function t(){}return t.STRETCH="stretch",t.WIDTH_ONLY="widthOnly",t.HEIGHT_ONLY="heightOnly",t}();t.ScaleMode=e,__reflect(e.prototype,"cdcommon.editor.constants.ScaleMode")}(e=t.constants||(t.constants={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(t){var e;!function(t){var e=function(){function t(){}return t.json2ResultDTO=function(t,e){return e.success="true"==t.success,e.results=t.result,e.err_code=t.err_code,e.err_msg=t.err_msg,e},t}();t.APIUtils=e,__reflect(e.prototype,"cdcommon.framework.utils.APIUtils")}(e=t.utils||(t.utils={}))}(e=t.framework||(t.framework={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(t){var e;!function(t){var e=egret.Event,o=function(t){function e(e,o,n,i){void 0===n&&(n=!1),void 0===i&&(i=!1);var r=t.call(this,o,n,i)||this;return r.relatedObjects=e,r}return __extends(e,t),e.OBJECT_MOVE_START="objectMoveStart",e.OBJECT_RESIZE_START="objectResizeStart",e.OBJECT_ROTATE_START="objectRotateStart",e.OBJECT_MOVED="objectMoved",e.OBJECT_RESIZED="objectResized",e.OBJECT_ROTATED="objectRotated",e.OBJECT_MOVING="objectMoving",e.OBJECT_RESIZING="objectResizing",e.OBJECT_ROTATING="objectRotating",e.OBJECT_CLICK_OFF="objectClickOff",e}(e);t.ObjectChangedEvent=o,__reflect(o.prototype,"cdcommon.framework.objecthandles.ObjectChangedEvent")}(e=t.objecthandles||(t.objecthandles={}))}(e=t.framework||(t.framework={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(t){var e;!function(t){var e=function(){function t(){}return t.GET_SERVER_TIME="get-server-time",t.GET_LOCATION_LIST="get-location-list",t.GET_GOODS="get-goods",t.GET_GOODS_LIST="get-goods-list",t.GET_GOODS_TYPE_LIST="get-goods-type-list",t.GET_GOODS_SIZE_LIST="get-goods-size-list",t.GET_TEMPLATE_THEME_LIST="get-template-theme-list",t.GET_TEMPLATE_LIST="get-template-list",t.GET_TEMPLATE="get-template",t.GET_TEMPLATE_PAGE_DATA="get-template-page-data",t.SAVE_TEMPLATE_DATA="save-template-data",t.SAVE_TEMPLATE_THUMB="save-template-thumb",t.GET_WORK_ID="get-work-id",t.GET_WORK="get-work",t.SAVE_WORK_DATA="save-work-data",t.SAVE_WORK_THUMB="save-work-thumb",t.UPDATE_WORK_UPLOAD_STATUS="update-work-upload-status",t.GET_LAYOUT_LIST="get-layout-list",t.GET_LAYOUT_DATA="get-layout-data",t.GET_LAYOUT_KIND_LIST="get-layout-kind-list",t.SAVE_LAYOUT_DATA="save-layout-data",t.GET_MATERIAL_STYLE_LIST="get-material-style-list",t.GET_MATERIAL_LIST="get-material-list",t.SAVE_PHOTO="save-photo",t.GET_PHOTO_LIST="get-photo-list",t.GET_PHOTO="get-photo",t.GET_UPLOAD_SIGN="get-upload-sign",t.GET_SUPPLIER_INFO="get-supplier-info",t.SUPPLIER_LOGIN="supplier-login",t.GET_AGENT_INFO="get-agent-info",t.GET_ADMIN_INFO="get-admin-info",t}();t.APIConstant=e,__reflect(e.prototype,"cdcommon.framework.constants.APIConstant")}(e=t.constants||(t.constants={}))}(e=t.framework||(t.framework={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(t){var e;!function(t){var e=function(){function t(){}return t}();t.ParamBaseDTO=e,__reflect(e.prototype,"cdcommon.framework.dtos.ParamBaseDTO")}(e=t.dtos||(t.dtos={}))}(e=t.framework||(t.framework={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(t){var e;!function(t){var e=function(){function t(){}return t.addItem=function(t){this.API_LIST[t.name]=t},t.getItem=function(t){var e=this.API_LIST[t];return e},t.API_LIST={},t}();t.APIConfig=e,__reflect(e.prototype,"cdcommon.framework.managers.APIConfig")}(e=t.managers||(t.managers={}))}(e=t.framework||(t.framework={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(t){var e;!function(t){var e=function(){function t(){}return t.TOP_LAYAER=2,t.DESIGN_LAYAER=1,t.BOTTOM_LAYAER=-1,t}();t.ElementLayerConstant=e,__reflect(e.prototype,"cdcommon.editor.constants.ElementLayerConstant")}(e=t.constants||(t.constants={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(t){var e;!function(t){var e=egret.Event,o=function(t){function e(e,o,n){void 0===o&&(o=!1),void 0===n&&(n=!1);var i=t.call(this,e,o,n)||this;return i.targets=[],i}return __extends(e,t),e.REMOVED_FROM_SELECTION="removedFromSelection",e.SELECTION_CLEARED="selectionCleared",e.ADDED_TO_SELECTION="addedToSelection",e.SELECTED="selected",e}(e);t.SelectionEvent=o,__reflect(o.prototype,"cdcommon.framework.objecthandles.SelectionEvent")}(e=t.objecthandles||(t.objecthandles={}))}(e=t.framework||(t.framework={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(e){var o;!function(e){var o=egret.Point,n=egret.EventDispatcher,i=egret.TouchEvent,r=egret.Matrix,a=eui.PropertyEvent,s=t.framework.utils.Dictionary,l=t.editor.utils.ModelUpdater,d=function(t){function n(i,a,l,d){void 0===a&&(a=null),void 0===l&&(l=null),void 0===d&&(d=null);var c=t.call(this)||this;return c.defaultHandles=[],c.enableMultiSelect=!0,c.modelList=[],c.currentDragRole=0,c.zero=new o(0,0),c.handles=new s,c.models=new s,c.constraints=new s,c.originalModelGeometry=new s,c.visuals=new s,c.handleDefinitions=new s,c.handleCache=[],c.temp=new o(0,0),c.tempMatrix=new r,c.isDragging=!1,c.defaultConstraints=[],c.multiSelectConstraints=[],c.isMoved=!1,c.isResized=!1,c.isRotated=!1,c.selectionMatrix=new r,c.objectMatrix=new r,c.relativeGeometry=new o,c.translation=new e.DragGeometry,c.multiSelectModel=new e.DragGeometry,c._multiSelectHandles=[],c.tempGeometry=new e.DragGeometry,c.container=i,a?c.selectionManager=a:c.selectionManager=new e.ObjectHandlesSelectionManager,l?c.handleFactory=l:c.handleFactory=new e.ClassFactory(n.defaultHandleClass),c.selectionManager.addEventListener(e.SelectionEvent.ADDED_TO_SELECTION,c.onSelectionAdded,c),c.selectionManager.addEventListener(e.SelectionEvent.REMOVED_FROM_SELECTION,c.onSelectionRemoved,c),c.selectionManager.addEventListener(e.SelectionEvent.SELECTION_CLEARED,c.onSelectionCleared,c),c.multiSelectHandles.push(new e.HandleDescription(e.HandleRoles.RESIZE_UP+e.HandleRoles.RESIZE_LEFT,c.zero,c.zero)),c.multiSelectHandles.push(new e.HandleDescription(e.HandleRoles.RESIZE_UP,new o(50,0),c.zero)),c.multiSelectHandles.push(new e.HandleDescription(e.HandleRoles.RESIZE_UP+e.HandleRoles.RESIZE_RIGHT,new o(100,0),c.zero)),c.multiSelectHandles.push(new e.HandleDescription(e.HandleRoles.RESIZE_RIGHT,new o(100,50),c.zero)),c.multiSelectHandles.push(new e.HandleDescription(e.HandleRoles.RESIZE_DOWN+e.HandleRoles.RESIZE_RIGHT,new o(100,100),c.zero)),c.multiSelectHandles.push(new e.HandleDescription(e.HandleRoles.RESIZE_DOWN,new o(50,100),c.zero)),c.multiSelectHandles.push(new e.HandleDescription(e.HandleRoles.RESIZE_DOWN+e.HandleRoles.RESIZE_LEFT,new o(0,100),c.zero)),c.multiSelectHandles.push(new e.HandleDescription(e.HandleRoles.RESIZE_LEFT,new o(0,50),c.zero)),c.multiSelectHandles.push(new e.HandleDescription(e.HandleRoles.ROTATE,new o(100,50),new o(20,0))),c.defaultHandles.push(new e.HandleDescription(e.HandleRoles.RESIZE_UP+e.HandleRoles.RESIZE_LEFT,c.zero,c.zero)),c.defaultHandles.push(new e.HandleDescription(e.HandleRoles.RESIZE_UP,new o(50,0),c.zero)),c.defaultHandles.push(new e.HandleDescription(e.HandleRoles.RESIZE_UP+e.HandleRoles.RESIZE_RIGHT,new o(100,0),c.zero)),c.defaultHandles.push(new e.HandleDescription(e.HandleRoles.RESIZE_RIGHT,new o(100,50),c.zero)),c.defaultHandles.push(new e.HandleDescription(e.HandleRoles.RESIZE_DOWN+e.HandleRoles.RESIZE_RIGHT,new o(100,100),c.zero)),c.defaultHandles.push(new e.HandleDescription(e.HandleRoles.RESIZE_DOWN,new o(50,100),c.zero)),c.defaultHandles.push(new e.HandleDescription(e.HandleRoles.RESIZE_DOWN+e.HandleRoles.RESIZE_LEFT,new o(0,100),c.zero)),c.defaultHandles.push(new e.HandleDescription(e.HandleRoles.RESIZE_LEFT,new o(0,50),c.zero)),c.defaultHandles.push(new e.HandleDescription(e.HandleRoles.ROTATE,new o(100,50),new o(20,0))),null==d?c._childManager=new e.ChildManager:c._childManager=d,c.registerComponent(c.multiSelectModel,null,c.multiSelectHandles),c
}return __extends(n,t),n.toRadians=function(t){return t*Math.PI/180},n.toDegrees=function(t){return 180*t/Math.PI},n.prototype.destory=function(){this.selectionManager.clearSelection();for(var t=this.container.numChildren,e=0;e<this.container.numChildren;e++){var o=this.container.getChildAt(e);if(this.isIHandle(o)){var n=o;n.destory(),this.container.removeChild(n),e--,t--}}this.handles.clear(),this.models.clear(),this.visuals.clear(),this.constraints.clear(),this.originalModelGeometry.clear(),this.handleDefinitions.clear(),this.handleCache.splice(0)},Object.defineProperty(n.prototype,"multiSelectHandles",{get:function(){return this._multiSelectHandles},set:function(t){var e=this.modelList.indexOf(this.multiSelectModel);-1!=e&&this.modelList.splice(e,1),this.multiSelectModel.removeEventListener(a.PROPERTY_CHANGE,this.onModelChange,this),this._multiSelectHandles=t,this.registerComponent(this.multiSelectModel,null,this._multiSelectHandles)},enumerable:!0,configurable:!0}),n.prototype.registerComponent=function(t,o,n,r){void 0===n&&(n=null),void 0===r&&(r=null),this.modelList.push(t),o&&(o.addEventListener(i.TOUCH_BEGIN,this.onComponentMouseDown,this,!1,0),o.addEventListener(e.SelectionEvent.SELECTED,this.handleSelection,this),this.models.add(o,t)),t.addEventListener(a.PROPERTY_CHANGE,this.onModelChange,this),this.visuals.add(t,o),n&&this.handleDefinitions.add(t,n),r&&this.constraints.add(t,r)},n.prototype.unregisterComponent=function(t){t.removeEventListener(i.TOUCH_BEGIN,this.onComponentMouseDown,this),t.removeEventListener(e.SelectionEvent.SELECTED,this.handleSelection,this);var o=this.findModel(t);o&&o.removeEventListener(a.PROPERTY_CHANGE,this.onModelChange,this),this.modelList.splice(this.modelList.indexOf(o),1),this.visuals.containsKey(o)&&this.visuals.remove(o),this.models.containsKey(t)&&this.models.remove(t),-1!=this.selectionManager.currentlySelected.indexOf(o)&&this.selectionManager.clearSelection()},n.prototype.unregisterModel=function(t){var e=this.visuals.getValue(t);this.unregisterComponent(e)},n.prototype.setConstraints=function(t,e){void 0===e&&(e=null),this.constraints.containsKey(t)?this.constraints.setValue(t,e):this.constraints.add(t,e)},n.prototype.getConstraints=function(t){return this.constraints.getValue(t)},n.prototype.addDefaultConstraint=function(t){this.defaultConstraints.push(t)},n.prototype.addMultiSelectConstraint=function(t){this.multiSelectConstraints.push(t)},n.prototype.getDisplayForModel=function(t){return this.visuals.getValue(t)},n.prototype.redrawHandle=function(t){var e=this.handles.getValue(t);if(e)for(var o,n=0,i=e;n<i.length;n++)o=i[n],o.redraw()},n.prototype.getRotatedRectPoint=function(t,e,n){void 0===n&&(n=null);var i=n?n.x:0,a=n?n.y:0,s=new r(1,0,0,1,e.x-i,e.y-a);return s.rotate(t),new o(s.tx+i,s.ty+a)},n.prototype.hasMovementHandle=function(t){for(var o,n=this.getHandleDefinitions(t),i=0,r=n;i<r.length;i++)if(o=r[i],e.HandleRoles.isMove(o.role))return!0;return!1},n.prototype.onModelChange=function(t){switch(t.property){case"x":case"y":case"width":case"height":case"rotation":this.updateHandlePositions(t.target);break;case"locked":this.redrawHandle(t.target)}},n.prototype.onSelectionAdded=function(t){this.setupHandles()},n.prototype.onSelectionRemoved=function(t){this.setupHandles()},n.prototype.onSelectionCleared=function(t){this.setupHandles(),this.lastSelectedModel=null},n.prototype.onComponentMouseDown=function(t){this.handleSelection(t),this.container.stage.addEventListener(i.TOUCH_MOVE,this.onContainerMouseMove,this),this.container.stage.addEventListener(i.TOUCH_END,this.onContainerMouseUp,this);try{}catch(o){console.log("onComponentMouseDown() Error: ",o.message)}var n=this.findModel(t.target);this.hasMovementHandle(n)||(this.currentDragRole=e.HandleRoles.MOVE,this.currentHandleConstraint=null,this.handleBeginDrag(t),this.dispatchEvent(new e.ObjectChangedEvent(this.selectionManager.currentlySelected,e.ObjectChangedEvent.OBJECT_MOVE_START)))},n.prototype.onContainerMouseUp=function(t){this.isMoved?this.dispatchEvent(new e.ObjectChangedEvent(this.selectionManager.currentlySelected,e.ObjectChangedEvent.OBJECT_MOVED,!0)):this.isResized?this.dispatchEvent(new e.ObjectChangedEvent(this.selectionManager.currentlySelected,e.ObjectChangedEvent.OBJECT_RESIZED,!0)):this.isRotated&&this.dispatchEvent(new e.ObjectChangedEvent(this.selectionManager.currentlySelected,e.ObjectChangedEvent.OBJECT_ROTATED,!0)),this.dispatchEvent(new e.ObjectChangedEvent(this.selectionManager.currentlySelected,e.ObjectChangedEvent.OBJECT_CLICK_OFF,!0)),this.isMoved=!1,this.isResized=!1,this.isRotated=!1,this.container.stage.removeEventListener(i.TOUCH_MOVE,this.onContainerMouseMove,this),this.container.stage.removeEventListener(i.TOUCH_END,this.onContainerMouseUp,this),this.selectionManager.currentlySelected.length>1&&(this.multiSelectModel.copyFrom(this.selectionManager.getGeometry()),this.updateHandlePositions(this.multiSelectModel)),this.isDragging=!1},n.prototype.onContainerMouseMove=function(t){var o=!1;if(this.selectionManager.currentlySelected.length>0)for(var n,i=0,r=this.selectionManager.currentlySelected;i<r.length;i++)n=r[i],n.hasOwnProperty("locked")&&n.locked&&(o=!0);this.isDragging&&!o&&(this.translation.height=0,this.translation.width=0,this.translation.x=0,this.translation.y=0,this.translation.rotation=0,e.HandleRoles.isMove(this.currentDragRole)&&(this.isMoved=!0,this.applyMovement(t,this.translation),this.applyConstraints(this.translation,this.currentDragRole)),e.HandleRoles.isResizeLeft(this.currentDragRole)&&(this.isResized=!0,this.applyResizeLeft(t,this.translation)),e.HandleRoles.isResizeUp(this.currentDragRole)&&(this.isResized=!0,this.applyResizeUp(t,this.translation)),e.HandleRoles.isResizeRight(this.currentDragRole)&&(this.isResized=!0,this.applyResizeRight(t,this.translation)),e.HandleRoles.isResizeDown(this.currentDragRole)&&(this.isResized=!0,this.applyResizeDown(t,this.translation)),e.HandleRoles.isRotate(this.currentDragRole)&&(this.isRotated=!0,this.applyRotate(t,this.translation)),this.applyConstraints(this.translation,this.currentDragRole),this.applyAnchorPoint(this.originalGeometry,this.translation,this.currentDragRole),this.applyTranslation(this.translation),t.updateAfterEvent(),this.isMoved?this.dispatchMoving():this.isResized?this.dispatchResizing():this.isRotated&&this.dispatchRotating())},n.prototype.dispatchRotating=function(){this.willTrigger(e.ObjectChangedEvent.OBJECT_ROTATING)&&this.dispatchEvent(new e.ObjectChangedEvent(this.selectionManager.currentlySelected,e.ObjectChangedEvent.OBJECT_ROTATING,!0))},n.prototype.dispatchResizing=function(){this.willTrigger(e.ObjectChangedEvent.OBJECT_RESIZING)&&this.dispatchEvent(new e.ObjectChangedEvent(this.selectionManager.currentlySelected,e.ObjectChangedEvent.OBJECT_RESIZING,!0))},n.prototype.dispatchMoving=function(){this.willTrigger(e.ObjectChangedEvent.OBJECT_MOVING)&&this.dispatchEvent(new e.ObjectChangedEvent(this.selectionManager.currentlySelected,e.ObjectChangedEvent.OBJECT_MOVING,!0))},n.prototype.applyAnchorPoint=function(t,i,r){if(e.HandleRoles.isRotate(r)){var a=new o(t.width/2,t.height/2);this.tempMatrix.identity(),this.tempMatrix.rotate(n.toRadians(t.rotation)),this.temp=this.tempMatrix.transformPoint(a.x,a.y),this.tempMatrix.identity(),this.tempMatrix.rotate(n.toRadians(t.rotation+i.rotation)),a=this.tempMatrix.transformPoint(a.x,a.y),i.x=this.temp.x-a.x,i.y=this.temp.y-a.y}if(e.HandleRoles.isResize(r)){var s=this.getAnchorProportion(r);this.tempMatrix.identity(),this.tempMatrix.rotate(n.toRadians(t.rotation)),this.temp.x=s.x*(i.width+this.originalGeometry.width)-s.x*this.originalGeometry.width,this.temp.y=s.y*(i.height+this.originalGeometry.height)-s.y*this.originalGeometry.height,this.temp=this.tempMatrix.transformPoint(this.temp.x,this.temp.y),i.x+=this.temp.x,i.y+=this.temp.y}},n.prototype.getAnchorProportion=function(t){var n=new o;return e.HandleRoles.isResizeUp(t)?e.HandleRoles.isResizeLeft(t)?(n.x=-1,n.y=-1):e.HandleRoles.isResizeRight(t)?(n.x=0,n.y=-1):(n.x=-.5,n.y=-1):e.HandleRoles.isResizeDown(t)?e.HandleRoles.isResizeLeft(t)?(n.x=-1,n.y=0):e.HandleRoles.isResizeRight(t)?(n.x=0,n.y=0):(n.x=-.5,n.y=0):e.HandleRoles.isResizeLeft(t)?(n.x=-1,n.y=-.5):(n.x=0,n.y=-.5),n},n.prototype.applyTranslationForSingleObject=function(t,e,o){t.hasOwnProperty("x")&&(t.x=e.x+o.x),t.hasOwnProperty("y")&&(t.y=e.y+o.y),t.hasOwnProperty("width")&&(t.width=e.width+o.width),t.hasOwnProperty("height")&&(t.height=e.height+o.height),t.hasOwnProperty("rotation")&&(t.rotation=e.rotation+o.rotation),l.update(t,"sizeInfos"),this.updateHandlePositions(t)},n.prototype.applyTranslation=function(t){if(1==this.selectionManager.currentlySelected.length)this.applyTranslationForSingleObject(this.selectionManager.currentlySelected[0],t,this.originalGeometry);else if(this.selectionManager.currentlySelected.length>1){this.applyTranslationForSingleObject(this.multiSelectModel,t,this.originalGeometry);for(var e,o=0,n=this.selectionManager.currentlySelected;o<n.length;o++){e=n[o];var i=this.calculateTranslationFromMultiTranslation(t,e),r=this.originalModelGeometry.getValue(e);this.applySingleObjectConstraints(e,r,i,this.currentDragRole),this.applyTranslationForSingleObject(e,i,this.originalModelGeometry.getValue(e))}}},n.prototype.copyToTempGeometry=function(t){this.tempGeometry.height=t.height,this.tempGeometry.width=t.width,this.tempGeometry.x=t.x,this.tempGeometry.y=t.y,t.hasOwnProperty("rotation")&&(this.tempGeometry.rotation=t.rotation),t.hasOwnProperty("locked")&&(this.tempGeometry.locked=t.locked)},n.prototype.calculateTranslationFromMultiTranslation=function(t,i){var r=new e.DragGeometry;this.selectionMatrix.identity(),this.selectionMatrix.rotate(n.toRadians(t.rotation)),this.selectionMatrix.scale((this.originalGeometry.width+t.width)/this.originalGeometry.width,(this.originalGeometry.height+t.height)/this.originalGeometry.height),this.selectionMatrix.translate(t.x+this.originalGeometry.x,t.y+this.originalGeometry.y),this.relativeGeometry.x=this.originalModelGeometry.getValue(i).x-this.originalGeometry.x,this.relativeGeometry.y=this.originalModelGeometry.getValue(i).y-this.originalGeometry.y,this.objectMatrix.identity(),this.objectMatrix.rotate(n.toRadians(t.rotation+this.originalModelGeometry.getValue(i).rotation)),this.objectMatrix.translate(this.relativeGeometry.x,this.relativeGeometry.y);var a=this.objectMatrix.transformPoint(this.zero.x,this.zero.y),s=this.objectMatrix.transformPoint(this.originalModelGeometry.getValue(i).width,0),l=this.objectMatrix.transformPoint(0,this.originalModelGeometry.getValue(i).height);a=this.selectionMatrix.transformPoint(a.x,a.y),s=this.selectionMatrix.transformPoint(s.x,s.y),l=this.selectionMatrix.transformPoint(l.x,l.y);var d=o.distance(a,s),c=o.distance(a,l);r.x=a.x-this.originalModelGeometry.getValue(i).x,r.y=a.y-this.originalModelGeometry.getValue(i).y,r.width=d-this.originalModelGeometry.getValue(i).width,r.height=c-this.originalModelGeometry.getValue(i).height;var h=n.toDegrees(Math.atan2(s.y-a.y,s.x-a.x));return r.rotation=h-this.originalModelGeometry.getValue(i).rotation-t.rotation,r},n.prototype.applyConstraints=function(t,e){var o;if(null!=this.currentHandleConstraint&&this.currentHandleConstraint.newInstance().applyConstraint(this.originalGeometry,t,e),this.selectionManager.currentlySelected.length>1)for(var n=0,i=this.multiSelectConstraints;n<i.length;n++)o=i[n],o.applyConstraint(this.originalGeometry,t,e);else this.applySingleObjectConstraints(this.selectionManager.currentlySelected[0],this.originalGeometry,t,e)},n.prototype.applySingleObjectConstraints=function(t,e,o,n){for(var i,r=0,a=this.defaultConstraints;r<a.length;r++)i=a[r],i.applyConstraint(e,o,n);var s=this.constraints.getValue(t);if(s)for(var l=0,d=s;l<d.length;l++)i=d[l],i.applyConstraint(e,o,n)},n.prototype.applyRotate=function(t,e){var o=n.toRadians(this.originalGeometry.rotation)-n.toRadians(this.mouseDownRotation)+this.getAngleInRadians(t.stageX,t.stageY);this.tempMatrix.identity(),this.tempMatrix.rotate(n.toRadians(this.originalGeometry.rotation));var i=this.tempMatrix.transformPoint(this.originalGeometry.width/2,this.originalGeometry.height/2),a=new r;a.translate(-i.x,-i.y),a.rotate(o),a.translate(i.x,i.y);a.transformPoint(this.zero.x,this.zero.y);e.rotation=n.toDegrees(o)},n.prototype.getAngleInRadians=function(t,e){this.tempMatrix.identity();var o=this.container.globalToLocal(t,e);this.tempMatrix.rotate(n.toRadians(this.originalGeometry.rotation));var i=this.tempMatrix.transformPoint(this.originalGeometry.width/2,this.originalGeometry.height/2);if(i.offset(this.originalGeometry.x,this.originalGeometry.y),this.isIViewport(this.container)&&this.container.scrollH&&this.container.scrollV){var r=this.container;return Math.atan2(o.y+r.scrollV-i.y,o.x+r.scrollH-i.x)}return Math.atan2(o.y-i.y,o.x-i.x)},n.prototype.applyMovement=function(t,e){this.temp.x=t.stageX,this.temp.y=t.stageY;var n=this.container.globalToLocal(this.temp.x,this.temp.y),i=new o(n.x-this.containerMouseDownPoint.x,n.y-this.containerMouseDownPoint.y);e.x=i.x,e.y=i.y},n.prototype.applyResizeRight=function(t,e){var o=this.container.globalToLocal(this.mouseDownPoint.x,this.mouseDownPoint.y),i=this.container.globalToLocal(t.stageX,t.stageY);this.tempMatrix.identity(),this.tempMatrix.rotate(n.toRadians(this.originalGeometry.rotation));var r=this.tempMatrix.clone();r.invert();var a=r.transformPoint(o.x,o.y),s=r.transformPoint(i.x,i.y),l=s.x-a.x;e.width+=l},n.prototype.applyResizeDown=function(t,e){var o=this.container.globalToLocal(this.mouseDownPoint.x,this.mouseDownPoint.y),i=this.container.globalToLocal(t.stageX,t.stageY);this.tempMatrix.identity(),this.tempMatrix.rotate(n.toRadians(this.originalGeometry.rotation));var r=this.tempMatrix.clone();r.invert();var a=r.transformPoint(o.x,o.y),s=r.transformPoint(i.x,i.y),l=s.y-a.y;e.height+=l},n.prototype.applyResizeLeft=function(t,e){var o=this.container.globalToLocal(this.mouseDownPoint.x,this.mouseDownPoint.y),i=this.container.globalToLocal(t.stageX,t.stageY);this.tempMatrix.identity(),this.tempMatrix.rotate(n.toRadians(this.originalGeometry.rotation));var r=this.tempMatrix.clone();r.invert();var a=r.transformPoint(o.x,o.y),s=r.transformPoint(i.x,i.y),l=a.x-s.x;e.width+=l},n.prototype.applyResizeUp=function(t,e){var o=this.container.globalToLocal(this.mouseDownPoint.x,this.mouseDownPoint.y),i=this.container.globalToLocal(t.stageX,t.stageY);this.tempMatrix.identity(),this.tempMatrix.rotate(n.toRadians(this.originalGeometry.rotation));var r=this.tempMatrix.clone();r.invert();var a=r.transformPoint(o.x,o.y),s=r.transformPoint(i.x,i.y),l=a.y-s.y;e.height+=l},n.prototype.findModel=function(t){for(var e=this.models.getValue(t);null==e&&null!=t.parent;)t=t.parent,e=this.models.getValue(t);return e},n.prototype.handleSelection=function(t){var e=this.findModel(t.currentTarget);e&&(this.selectionManager.isSelected(e)||this.selectionManager.setSelected(e))},n.prototype.handleBeginDrag=function(t){this.isDragging=!0,this.mouseDownPoint=new o(t.stageX,t.stageY),this.containerMouseDownPoint=this.container.globalToLocal(this.mouseDownPoint.x,this.mouseDownPoint.y),this.originalGeometry=this.selectionManager.getGeometry(),this.originalModelGeometry=new s;for(var e,i=0,r=this.selectionManager.currentlySelected;i<r.length;i++)e=r[i],this.originalModelGeometry.add(e,this.selectionManager.getGeometryForObject(e));this.mouseDownRotation=this.originalGeometry.rotation+n.toDegrees(this.getAngleInRadians(t.stageX,t.stageY))},n.prototype.getCurrentSelection=function(){for(var t,e=[],o=0,n=this.selectionManager.currentlySelected;o<n.length;o++)t=n[o],this.visuals.containsKey(t)&&e.push(t);return e},n.prototype.setupHandles=function(){var t=this.getCurrentSelection();if(0==t.length)this.removeHandles(this.lastSelectedModel),this.removeHandles(this.multiSelectModel);else if(1==t.length)this.createHandlesFor(t[0]),this.updateHandlePositions(t[0]),this.removeHandles(this.multiSelectModel),this.removeHandles(this.lastSelectedModel),this.lastSelectedModel=t[0];else{this.removeHandles(this.lastSelectedModel);var e=this.selectionManager.getGeometry();e&&(this.multiSelectModel.copyFrom(e),this.createHandlesFor(this.multiSelectModel),this.updateHandlePositions(this.multiSelectModel),this.lastSelectedModel=this.multiSelectModel)}},n.prototype.createHandlesFor=function(t){for(var e,o=this.getHandleDefinitions(t),n=0,i=o;n<i.length;n++)e=i[n],this.createHandle(t,e)},n.prototype.getHandleDefinitions=function(t){var e;return e=this.handleDefinitions.getValue(t),e||(e=this.defaultHandles),e},n.prototype.createHandle=function(t,e){var o=this.handles.getValue(t);o||(o=[],this.handles.add(t,o));var n;n=null!=e.handleFactory?e.handleFactory.newInstance():this.handleFactory.newInstance(),n.targetModel=t,n.handleDescriptor=e,this.connectHandleEvents(n,e),o.push(n),this.addToContainer(n),n.redraw()},n.prototype.getContainerScrollAmount=function(){var t=new o(0,0);if(this.isIViewport(this.container)&&this.container.scrollH&&this.container.scrollV){var e=this.container;e.scrollH<0?t.x=0:e.scrollH>e.contentWidth?t.y=e.contentWidth:t.x=e.scrollH,e.scrollV<0?t.y=0:e.scrollV>e.contentHeight?t.y=e.contentHeight:t.y=e.scrollV}return t},n.prototype.updateHandlePositions=function(t){var e=this.handles.getValue(t),o=this.getContainerScrollAmount();if(e)for(var i,r=0,a=e;r<a.length;r++)if(i=a[r],t.hasOwnProperty("rotation")){this.tempMatrix.identity(),this.tempMatrix.translate(t.width*i.handleDescriptor.percentageOffset.x/100+i.handleDescriptor.offset.x,t.height*i.handleDescriptor.percentageOffset.y/100+i.handleDescriptor.offset.y),this.tempMatrix.rotate(n.toRadians(t.rotation)),this.tempMatrix.translate(t.x,t.y);var s=this.tempMatrix.transformPoint(this.zero.x,this.zero.y);i.rotation=t.rotation,i.x=s.x-o.x,i.y=s.y-o.y}else i.x=t.x+t.width*i.handleDescriptor.percentageOffset.x/100+i.handleDescriptor.offset.x-o.x,i.y=t.y+t.height*i.handleDescriptor.percentageOffset.y/100+i.handleDescriptor.offset.y-o.y},n.prototype.connectHandleEvents=function(t,e){t.addEventListener(i.TOUCH_BEGIN,this.onHandleDown,this)},n.prototype.onHandleDown=function(t){var o=t.target;o&&(o.handleDescriptor.role==e.HandleRoles.NO_ROLE?this.dispatchEvent(new e.HandleClickedEvent(t.target)):(this.container.stage.addEventListener(i.TOUCH_MOVE,this.onContainerMouseMove,this),this.container.stage.addEventListener(i.TOUCH_END,this.onContainerMouseUp,this),this.currentDragRole=o.handleDescriptor.role,this.currentHandleConstraint=o.handleDescriptor.constraint,this.handleBeginDrag(t),e.HandleRoles.isMove(this.currentDragRole)&&this.dispatchEvent(new e.ObjectChangedEvent(this.selectionManager.currentlySelected,e.ObjectChangedEvent.OBJECT_MOVE_START)),e.HandleRoles.isResize(this.currentDragRole)&&this.dispatchEvent(new e.ObjectChangedEvent(this.selectionManager.currentlySelected,e.ObjectChangedEvent.OBJECT_RESIZE_START)),e.HandleRoles.isRotate(this.currentDragRole)&&this.dispatchEvent(new e.ObjectChangedEvent(this.selectionManager.currentlySelected,e.ObjectChangedEvent.OBJECT_ROTATE_START))))},n.prototype.addToContainer=function(t){this._childManager.addChild(this.container,t)},n.prototype.removeFromContainer=function(t){this._childManager.removeChild(this.container,t)},n.prototype.removeHandles=function(t){if(t){var e=this.handles.getValue(t);if(e){for(var o,n=0,i=e;n<i.length;n++)o=i[n],this.handleCache.length<=10?(o.visible=!1,this.handleCache.push(o)):(this.removeFromContainer(o),o.destory());this.handles.containsKey(t)&&this.handles.remove(t)}}},n.prototype.isIViewport=function(t){return void 0!=t.scrollH&&void 0!=t.scrollV},n.prototype.isIHandle=function(t){return void 0!=t.handleDescriptor&&void 0!=t.targetModel},n.defaultHandleClass=e.SpriteHandle,n}(n);e.ObjectHandles=d,__reflect(d.prototype,"cdcommon.framework.objecthandles.ObjectHandles")}(o=e.objecthandles||(e.objecthandles={}))}(e=t.framework||(t.framework={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(e){var o;!function(e){var o=t.framework.dtos.ResultBaseDTO,n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(o);e.SavePhotoResultDTO=n,__reflect(n.prototype,"cdcommon.editor.dtos.SavePhotoResultDTO")}(o=e.dtos||(e.dtos={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(t){var e;!function(t){var e=function(){function t(){}return t.encode=function(t){var e=new egret.ByteArray;return e.writeUTFBytes(t),this.encodeByteArray(e)},t.encodeByteArray=function(t){var e,o="",n=new Array(4);for(t.position=0;t.bytesAvailable>0;){e=new Array;for(var i=0;3>i&&t.bytesAvailable>0;i++)e[i]=t.readUnsignedByte();n[0]=(252&e[0])>>2,n[1]=(3&e[0])<<4|e[1]>>4,n[2]=(15&e[1])<<2|e[2]>>6,n[3]=63&e[2];for(var r=e.length;3>r;r++)n[r+1]=64;for(var a=0;a<n.length;a++)o+=this.BASE64_CHARS.charAt(n[a])}return o},t.decode=function(t){var e=this.decodeToByteArray(t);return e.readUTFBytes(e.length)},t.decodeToByteArray=function(t){for(var e=new egret.ByteArray,o=new Array(4),n=new Array(3),i=0;i<t.length;i+=4){for(var r=0;4>r&&i+r<t.length;r++)o[r]=this.BASE64_CHARS.indexOf(t.charAt(i+r));n[0]=(o[0]<<2)+((48&o[1])>>4),n[1]=((15&o[1])<<4)+((60&o[2])>>2),n[2]=((3&o[2])<<6)+o[3];for(var a=0;a<n.length&&64!=o[a+1];a++)e.writeByte(n[a])}return e.position=0,e},t.BASE64_CHARS="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",t.version="1.0.0",t}();t.Base64Utils=e,__reflect(e.prototype,"cdcommon.framework.utils.Base64Utils")}(e=t.utils||(t.utils={}))}(e=t.framework||(t.framework={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(e){var o;!function(e){var o=t.framework.dtos.ParamBaseDTO,n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(o);e.SavePhotoParamDTO=n,__reflect(n.prototype,"cdcommon.editor.dtos.SavePhotoParamDTO")}(o=e.dtos||(e.dtos={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(t){var e;!function(t){var e=function(){function t(){this.ph_id="",this.uid=0,this.sp_id=0,this.org_name="",this.org_width=0,this.org_height=0,this.org_size=0,this.ext="",this.url="",this.add_time=0}return t}();t.PhotoVO=e,__reflect(e.prototype,"cdcommon.editor.models.PhotoVO")}(e=t.models||(t.models={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(e){var o;!function(e){var o=egret.URLRequest,n=egret.URLRequestMethod,i=t.framework.events.InterfaceEvent,r=t.framework.services.InterfaceBase,a=t.editor.models.EditorCommon,s=t.editor.models.PhotoItem,l=t.editor.utils.URLConvertor,d=t.editor.constants.MaterialKindConstant,c=function(t){function e(e){return t.call(this,e)||this}return __extends(e,t),e.prototype.call=function(e){if(t.prototype.call.call(this,e),e instanceof s){var i=e,r=l.covert(d.PHOTO,i.url);this.request=new o(a.SERVICE_FACE_RECOGNITION_URL+"?url="+r),this.request.method=n.POST,this.loader.load(this.request)}},e.prototype.onResultHandler=function(t){var e=t.target;this.callParam.facesInfoJson=e.data,this.callback(i.COMPLETE,this.callParam)},e.prototype.onFaultHandler=function(t){this.callback(i.FAULT,"接口IO错误！")},e}(r);e.GetPhotoRecognitionInterface=c,__reflect(c.prototype,"cdcommon.editor.services.GetPhotoRecognitionInterface")}(o=e.services||(e.services={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(t){var e;!function(t){var e=function(){function e(){this.templateModeType=0,this.workId="",this.workName="",this.workExtraInfo=new t.WorkExtraInfo,this.goodsId="",this.productId="",this.templateId="",this.agentId="",this.uid="",this.pageCount=0,this.thickness=0/0,this.sizeItem=null,this.createTime=new Date,this.subSystem="",this.status=1,this.goodsInfo=new t.GoodsModel,this.templateInfo=new t.TemplateModel,this.pageList=null,this.pages=null}return e.prototype.getPageItemById=function(t){for(var e,o=0,n=this.pages;o<n.length;o++){var i=n[o];if(i.id==t){e=i;break}}return e},e}();t.WorkModel=e,__reflect(e.prototype,"cdcommon.editor.models.WorkModel")}(e=t.models||(t.models={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(e){var o;!function(e){var o=eui.Component,n=t.editor.constants.ScaleMode,i=t.editor.models.PageModel,r=t.editor.models.CountLoadModel,a=t.framework.hashmap.HashMap,s=t.editor.models.ElementModelBase,l=t.editor.constants.LayerConstant,d=t.editor.constants.PageTypeConstant,c=t.framework.utils.UnitConvertionUtil,h=t.framework.utils.ScaledConstraintUtil,u=t.editor.events.StageEvent,m=t.editor.events.ElementLoadEvent,p=t.framework.utils.ArrayUtil,f=t.editor.models.SpecialElementModel,g=t.editor.constants.ElementConstant,v=t.editor.events.DataLoadedEvent,_=eui.Image,y=egret.BitmapFillMode,E=t.editor.models.EditorImageProvider,C=t.editor.constants.ElementLayerConstant,M=eui.UIEvent,I=t.framework.utils.NumberConvertionUtil,T=egret.Event,w=t.editor.events.ElementManagerEvent,O=t.editor.events.ElementEvent,P=t.editor.managers.ElementModelController,L=t.framework.models.IconCommonProvider,S=t.editor.models.BackgroundElementModel,b=t.editor.factories.ElementFactory,k=egret.Point,R=t.editor.managers.CommandManager,D=t.framework.objecthandles.ObjectHandles,A=t.framework.objecthandles.SelectionEvent,x=t.framework.objecthandles.ObjectChangedEvent,U=t.framework.objecthandles.constraints.MaintainProportionConstraint,H=t.framework.objecthandles.constraints.SizeConstraint,N=t.framework.objecthandles.decorators.DecoratorManager,B=t.framework.objecthandles.decorators.AlignmentDecorator,F=egret.TouchEvent,G=t.editor.models.PhotoElementModel,j=t.editor.models.TextElementModel,V=t.framework.objecthandles.HandleDescription,W=t.framework.objecthandles.HandleRoles,Y=t.editor.objecthandles.BitmapHandle,z=t.editor.objecthandles.VLineHandle,K=t.editor.objecthandles.BorderLineHandle,X=t.framework.objecthandles.ClassFactory,Z=t.editor.events.ElementControllerEvent,J=t.framework.objecthandles.constraints.MovementConstraint,q=t.editor.constants.EditorModeConstant,$=t.framework.components.AlertPic,Q=t.editor.utils.ModelUpdater,te=function(t){function o(){var e=t.call(this)||this;return e.scaleMode=n.STRETCH,e.openTransform=!1,e.keepSelected=!1,e.isChildStage=!1,e.elementsLoadCountVO=new r,e.pageModel=null,e.elementDataModelMapping=new a,e.oldSizeOfResizeStartModelMapping=new a,e.commandManager=R.getInstance(),e._scale=1,e.$displayState=null,e._defaultWidth=0/0,e._defaultHeight=0/0,e._orgWidth=0/0,e._orgHeight=0/0,e._paddingToCreateElementCount=0,e._selectedLayer=l.DESIGN_LAYER,e._alwaysTopElementCount=0,e}return __extends(o,t),Object.defineProperty(o.prototype,"scale",{get:function(){return this._scale},set:function(t){t!=this._scale&&this.setStageScale(t)},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"defaultWidth",{get:function(){return this._defaultWidth},set:function(t){this._defaultWidth=t},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"defaultHeight",{get:function(){return this._defaultHeight},set:function(t){this._defaultHeight=t},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"selectedLayer",{get:function(){return this._selectedLayer},set:function(t){this._selectedLayer!=t&&(this._selectedLayer=t,this.setSelectedLayer())},enumerable:!0,configurable:!0}),o.prototype.getOrignalSize=function(){return[this._orgWidth,this._orgHeight]},o.prototype.getModel=function(){return this.pageModel},o.prototype.changeStageContent=function(t){t&&(this.clearStageContent(),this.pageModel.elementList=t,this.createStageContent())},o.prototype.clearStageContent=function(t){if(void 0===t&&(t=!1),t){var e=P.getInstance();e.removeModelListByPageId(this.pageModel.id)}this.removeStageContent()},o.prototype.getElementByModel=function(t){var e;return this.elementDataModelMapping.containsValue(t)&&(e=this.elementDataModelMapping.getKey(t)),e},o.prototype.lockElements=function(t,e){if(t&&t.length>0)for(var o,n=0,i=t;n<i.length;n++)o=i[n],o.locked=e?1:0},o.prototype.getEnableChangeIndex=function(t){var e,o,n,i,r={},a=this.elementDataModelMapping.getKey(t);if(a){var s=(this.getLayerContainer(t.layer),this.getElementCount()),l=this.getAlwaysTopIndexElementCount()>0?s-this.getAlwaysTopIndexElementCount()-1:s-1;t instanceof f?(t.index<s-1&&(e=!0),t.index>l+1&&(o=!0),n=i=!1):(t.index<l&&(e=n=!0),t.index>0&&(o=i=!0)),r.canUpIndex=e,r.canDownIndex=o,r.canMaxIndex=n,r.canMinIndex=i}return r},o.prototype.setElementIndexUpOrDown=function(t,e){try{if(!this.getLayerContainer(this.selectedLayer))return;var o=this.elementDataModelMapping.getKey(t);if(o){var n,i,r=this.getLayerContainer(t.layer);e?(n=t.index+1,i=!0):(n=t.index-1,i=!0),i&&(r.setChildIndex(o,n),this.updateElementIndexForModel())}}catch(a){$.show(L.Alert_ERROR,(e?"上移":"下移")+"调整元素层级时发生错误！\n(MSG="+a.message+")")}},o.prototype.setElementIndexMaxOrMin=function(t,e){try{if(!this.getLayerContainer(this.selectedLayer))return;var o=this.elementDataModelMapping.getKey(t);if(!(t instanceof f)){var n,i,r=this.getLayerContainer(t.layer),a=this.getElementCount(),s=this.getAlwaysTopIndexElementCount()>0?a-this.getAlwaysTopIndexElementCount()-1:a-1;e?(n=s,i=!0):(n=0,i=!0),i&&(r.setChildIndex(o,n),this.updateElementIndexForModel())}}catch(l){$.show(L.Alert_ERROR,(e?"置顶":"置底")+"元素层级时发生错误！\n(MSG="+l.message+")")}},o.prototype.addElementToStage=function(t,e){void 0===e&&(e=!1);try{if(!this.getLayerContainer(this.selectedLayer))return;e||(t.layer=this.selectedLayer),t.relatedPageId=this.pageModel.id,t.relatedPageIndex=this.pageModel.pageIndex;var o;if(o=b.create(t),o.addEventListener(M.CREATION_COMPLETE,this.onElementCreated,this),this.addDataLoadEvent(o),this.elementDataModelMapping.put(o,t),t instanceof S){var n;if(this.backgroundGroup.numElements>0)for(var i=0;i<this.backgroundGroup.numElements;i++){var r=this.backgroundGroup.getChildAt(i);if(this.isIElement(r)){if(n=r.getFillData(),!this.isChildStage){var a=this.pageModel.elementList.getItemIndex(n);this.pageModel.elementList.removeItemAt(a)}this.removeElementFromStage(n);break}}o.percentWidth=o.percentHeight=100,this.backgroundGroup.addChild(o)}else{var s=this.getLayerContainer(t.layer),l=this.getElementCount();if(e)t instanceof f&&this._alwaysTopElementCount++,s.addChild(o);else if(t instanceof f)s.addChild(o);else{var d=l-this.getAlwaysTopIndexElementCount();s.addChildAt(o,d)}}e||this.updateElementCountInfo(t.elementType,!0)}catch(c){$.show(L.Alert_ERROR,"添加元素时发生错误！\n(MSG="+c.message+")","系统错误")}},o.prototype.removeElementFromStage=function(t){try{if(!this.getLayerContainer(this.selectedLayer))return;if(t){var e=this.elementDataModelMapping.getKey(t);if(this.elementDataModelMapping.remove(e),e)if(e.destroy(),t instanceof S)this.backgroundGroup.removeChild(e);else{t instanceof f&&this._alwaysTopElementCount--;var o=this.getLayerContainer(t.layer);o.removeChild(e);var n=this.getLayerTransformManager(t.layer);n&&n.selectionManager.removeFromSelected(t)}this.updateElementIndexForModel(),this.updateElementCountInfo(t.elementType,!1)}}catch(i){$.show(L.Alert_ERROR,"删除元素时发生错误！\n(MSG="+i.message+")","系统错误")}},o.prototype.removeElementByTypes=function(t){for(var e,o=this.pageModel.elementList.source,n=0,i=o;n<i.length;n++)e=i[n],-1!=t.indexOf(e.elementType)&&(console.log("[REMOVE type]",e.elementType,e.id),this.removeElementFromStage(e))},o.prototype.addToTransformManager=function(t){var e=t.getFillData(),o=this.getLayerTransformManager(e.layer);if(o){var n=[];if(EditorCommon.editorMode==q.ADVANCED){n.push(new V(W.BORDER_LINE,new k(0,0),new k(0,0),new X(K))),n.push(new V(W.ROTATE_LINE,new k(100,50),new k(0,0),new X(z))),n.push(new V(W.MOVE_LINE,new k(50,100),new k(0,0),new X(z))),n.push(new V(W.RESIZE_UP+W.RESIZE_LEFT,new k(0,0),new k(0,0))),n.push(new V(W.RESIZE_UP+W.RESIZE_RIGHT,new k(100,0),new k(0,0))),n.push(new V(W.RESIZE_DOWN+W.RESIZE_LEFT,new k(0,100),new k(0,0))),n.push(new V(W.RESIZE_DOWN+W.RESIZE_RIGHT,new k(100,100),new k(0,0))),n.push(new V(W.RESIZE_UP,new k(50,0),new k(0,0))),n.push(new V(W.RESIZE_DOWN,new k(50,100),new k(0,0))),n.push(new V(W.RESIZE_LEFT,new k(0,50),new k(0,0))),n.push(new V(W.RESIZE_RIGHT,new k(100,50),new k(0,0))),n.push(new V(W.ROTATE,new k(100,50),new k(c.pt2px(Y.outerlineLength,EditorCommon.DPI),0))),n.push(new V(W.MOVE,new k(50,100),new k(0,c.pt2px(Y.outerlineLength,EditorCommon.DPI))));
var i=new J,r=new H;r.minWidth=100,r.minHeight=100,o.registerComponent(e,t,n,[r,i])}else{if(e.locked=1,e.elementType!=g.TYPE_PHOTO&&e.elementType!=g.TYPE_TEXT)return;n.push(new V(W.BORDER_LINE,new k(0,0),new k(0,0),new X(K))),n.push(new V(W.RESIZE_UP+W.RESIZE_LEFT,new k(0,0),new k(0,0))),n.push(new V(W.RESIZE_UP+W.RESIZE_RIGHT,new k(100,0),new k(0,0))),n.push(new V(W.RESIZE_DOWN+W.RESIZE_LEFT,new k(0,100),new k(0,0))),n.push(new V(W.RESIZE_DOWN+W.RESIZE_RIGHT,new k(100,100),new k(0,0))),o.registerComponent(e,t,n,[r,i])}console.log("[添加新的元素组件到变形器]",e.elementType,e.id)}},o.prototype.getSelectedElements=function(){var t,e=[],o=this.getLayerTransformManager(this.selectedLayer);if(o)for(var n,i=0,r=o.selectionManager.currentlySelected;i<r.length;i++)n=r[i],n instanceof s&&(t=this.elementDataModelMapping.getKey(n),e.push(t));return e},o.prototype.setSelectedElements=function(t){var e=this.getLayerTransformManager(this.selectedLayer);if(e)for(var o,n=0,i=t;n<i.length;n++){o=i[n];var r=this.elementDataModelMapping.getValue(o);e.selectionManager.addToSelected(r)}},o.prototype.deSelectAllElements=function(){var t=this.getLayerTransformManager(this.selectedLayer);t&&t.selectionManager.clearSelection()},o.prototype.init=function(t){void 0===t&&(t=null),t instanceof i&&(this.pageModel=t,this.pageModel&&(this.initializeFramework(),this.createStageContent()))},o.prototype.clear=function(){this.removeStageContent(),this.clearAndResetStageFramework()},o.prototype.destroy=function(){this.clear()},o.prototype.partAdded=function(e,o){t.prototype.partAdded.call(this,e,o),o==this.topLayerContainer?this.topLayerContainer.scrollEnabled=!0:o==this.bottomLayerContainer?this.bottomLayerContainer.scrollEnabled=!0:o==this.designLayerContainer?this.designLayerContainer.scrollEnabled=!0:o==this.backgroundGroup?this.backgroundGroup.scrollEnabled=!0:o==this.pageBorderRect&&(this.pageBorderRect.strokeWeight=c.pt2px(1,EditorCommon.DPI))},o.prototype.partRemoved=function(e,o){t.prototype.partRemoved.call(this,e,o)},o.prototype.getCurrentState=function(){var e=t.prototype.getCurrentState.call(this);return this.$displayState&&(e=this.$displayState),e},o.prototype.initTransformManager=function(t,e){Y.handleSize=c.pt2px(30,EditorCommon.DPI),Y.bitmapSize=c.pt2px(65,EditorCommon.DPI),Y.outerlineLength=c.pt2px(20,EditorCommon.DPI),Y.borderWidth=c.pt2px(4,EditorCommon.DPI),t.enableMultiSelect=!1,t.selectionManager.addEventListener(A.ADDED_TO_SELECTION,this.onItemsSelectionChanged,this),t.selectionManager.addEventListener(A.REMOVED_FROM_SELECTION,this.onItemsSelectionChanged,this),t.selectionManager.addEventListener(A.SELECTION_CLEARED,this.onItemsSelectionChanged,this),t.selectionManager.addEventListener(A.SELECTED,this.onItemsSelectionChanged,this),t.addEventListener(x.OBJECT_MOVE_START,this.onItemsPositionChangeStart,this),t.addEventListener(x.OBJECT_RESIZE_START,this.onItemsPositionChangeStart,this),t.addEventListener(x.OBJECT_ROTATE_START,this.onItemsPositionChangeStart,this),t.addEventListener(x.OBJECT_MOVING,this.onItemsPositionChanging,this),t.addEventListener(x.OBJECT_RESIZING,this.onItemsPositionChanging,this),t.addEventListener(x.OBJECT_ROTATING,this.onItemsPositionChanging,this),t.addEventListener(x.OBJECT_MOVED,this.onItemsPositionChangeEnd,this),t.addEventListener(x.OBJECT_RESIZED,this.onItemsPositionChangeEnd,this),t.addEventListener(x.OBJECT_ROTATED,this.onItemsPositionChangeEnd,this),t.addEventListener(x.OBJECT_CLICK_OFF,this.onItemsClickOff,this),this.stage.addEventListener(F.TOUCH_END,this.onStageMouseUp,this,!1,999)},o.prototype.onStageMouseUp=function(t){if(!this.keepSelected&&!this.isIHandle(t.target)){for(var e,o,n=this.getLayerTransformManager(l.DESIGN_LAYER),i=n.selectionManager.currentlySelected,r=0,a=i;r<a.length;r++){var s=a[r];if(e=this.elementDataModelMapping.getKey(s),e&&!e.hitTestPoint(t.stageX,t.stageY,!0)){o=!0;break}}o&&n.selectionManager.clearSelection()}},o.prototype.destoryTransformManager=function(t){t&&(t.selectionManager.removeEventListener(A.ADDED_TO_SELECTION,this.onItemsSelectionChanged,this),t.selectionManager.removeEventListener(A.REMOVED_FROM_SELECTION,this.onItemsSelectionChanged,this),t.selectionManager.removeEventListener(A.SELECTION_CLEARED,this.onItemsSelectionChanged,this),t.selectionManager.removeEventListener(A.SELECTED,this.onItemsSelectionChanged,this),t.removeEventListener(x.OBJECT_MOVE_START,this.onItemsPositionChangeStart,this),t.removeEventListener(x.OBJECT_RESIZE_START,this.onItemsPositionChangeStart,this),t.removeEventListener(x.OBJECT_ROTATE_START,this.onItemsPositionChangeStart,this),t.removeEventListener(x.OBJECT_MOVING,this.onItemsPositionChanging,this),t.removeEventListener(x.OBJECT_RESIZING,this.onItemsPositionChanging,this),t.removeEventListener(x.OBJECT_ROTATING,this.onItemsPositionChanging,this),t.removeEventListener(x.OBJECT_MOVED,this.onItemsPositionChangeEnd,this),t.removeEventListener(x.OBJECT_RESIZED,this.onItemsPositionChangeEnd,this),t.removeEventListener(x.OBJECT_ROTATED,this.onItemsPositionChangeEnd,this),t.removeEventListener(x.OBJECT_CLICK_OFF,this.onItemsClickOff,this),t.destory(),t=null,this.stage.removeEventListener(F.TOUCH_END,this.onStageMouseUp,this))},o.prototype.containsConstraint=function(t,e){for(var o,n=0,i=t;n<i.length;n++){var r=i[n];if(r instanceof e){o=!0;break}}return o},o.prototype.onItemsSelectionChanged=function(t){var e,o,n,i,r=!1;switch(t.type){case A.ADDED_TO_SELECTION:r=!0;break;case A.REMOVED_FROM_SELECTION:r=!1;break;case A.SELECTION_CLEARED:r=!1;break;case A.SELECTED:r=!0}if(r)for(var a=0,s=t.targets;a<s.length;a++)e=s[a],o=this.elementDataModelMapping.getKey(e),n=this.getLayerTransformManager(e.layer),i=n.getConstraints(e),i||(i=[]),e instanceof j?o.editing=!0:e instanceof G?(o.setSelectedState(!0),this.containsConstraint(i,U)||(i.push(new U),n.setConstraints(e,i))):this.containsConstraint(i,U)||(i.push(new U),n.setConstraints(e,i));else for(var l=0,d=t.targets;l<d.length;l++)e=d[l],o=this.elementDataModelMapping.getKey(e),o&&(e instanceof j?o.editing=!1:e instanceof G&&o.setSelectedState(!1));this.dispatchSelectedElementsChangeEvent()},o.prototype.onItemsPositionChangeStart=function(t){console.log("-------------------onItemsPositionChangeStart");var e,o,n,i,r=t.relatedObjects;switch(t.type){case x.OBJECT_MOVE_START:for(var a=0,s=r;a<s.length;a++){e=s[a];var l={};l.x=e.x,l.y=e.y,this.commandManager.saveCommand(R.STATE_CHANGE,l,e)}break;case x.OBJECT_RESIZE_START:for(var d=[W.RESIZE_UP+W.RESIZE_LEFT,W.RESIZE_UP+W.RESIZE_RIGHT,W.RESIZE_DOWN+W.RESIZE_LEFT,W.RESIZE_DOWN+W.RESIZE_RIGHT],c=([W.RESIZE_UP,W.RESIZE_LEFT,W.RESIZE_RIGHT,W.RESIZE_DOWN],0),h=r;c<h.length;c++){e=h[c];var l={};if(e instanceof G&&(l.phoX=e.phoX,l.phoY=e.phoY,l.phoWidth=e.phoWidth,l.phoHeight=e.phoHeight),l.x=e.x,l.y=e.y,l.width=e.width,l.height=e.height,this.commandManager.saveCommand(R.STATE_CHANGE,l,e),e instanceof G){this.oldSizeOfResizeStartModelMapping.containsKey(e)?(this.oldSizeOfResizeStartModelMapping.remove(e),this.oldSizeOfResizeStartModelMapping.put(e,[e.width,e.height])):this.oldSizeOfResizeStartModelMapping.put(e,[e.width,e.height]),n=this.getLayerTransformManager(e.layer),i=n.getConstraints(e),o=this.elementDataModelMapping.getKey(e);var u;if(u=o.hasFrame?!0:-1!=d.indexOf(n.currentDragRole)?!0:!1)this.containsConstraint(i,U)||(i.push(new U),n.setConstraints(e,i));else for(var m=0,p=i;m<p.length;m++){var f=p[m];if(f instanceof U){i.splice(i.indexOf(f),1);break}}}}break;case x.OBJECT_ROTATE_START:for(var g=0,v=r;g<v.length;g++){e=v[g];var l={};l.x=e.x,l.y=e.y,l.rotation=e.rotation,this.commandManager.saveCommand(R.STATE_CHANGE,l,e)}}},o.prototype.onItemsPositionChanging=function(t){var e,o,n,i,r=t.relatedObjects;switch(t.type){case x.OBJECT_MOVING:break;case x.OBJECT_RESIZING:for(var a=0,s=r;a<s.length;a++)if(e=s[a],e instanceof G){var l=[W.RESIZE_UP+W.RESIZE_LEFT,W.RESIZE_UP+W.RESIZE_RIGHT,W.RESIZE_DOWN+W.RESIZE_LEFT,W.RESIZE_DOWN+W.RESIZE_RIGHT];n=this.getLayerTransformManager(e.layer),i=n.getConstraints(e),o=this.elementDataModelMapping.getKey(e);var d=e,c=o,h=this.oldSizeOfResizeStartModelMapping.getValue(e),u=I.setPrecision(d.width/h[0],3);h.splice(0),h.push(e.width,e.height);c.getFillData();if(c.filled)if(c.hasFrame)d.phoX*=u,d.phoY*=u,d.phoWidth*=u,d.phoHeight*=u;else{var m=n.currentDragRole;m==W.RESIZE_LEFT?d.width>d.width?d.phoX<0?d.phoX+=d.width-d.width:d.phoX=0:d.phoX-=d.width-d.width:m==W.RESIZE_RIGHT?d.phoX<0?d.phoWidth-Math.abs(d.phoX)<d.width&&(d.phoX+=d.width-(d.phoWidth-Math.abs(d.phoX))):d.phoX=0:m==W.RESIZE_UP?d.height<d.height?d.phoY-=d.height-d.height:d.phoY<0?d.phoY+=d.height-d.height:d.phoY=0:m==W.RESIZE_DOWN?d.phoY<0?d.phoHeight-Math.abs(d.phoY)<d.height&&(d.phoY+=d.height-(d.phoHeight-Math.abs(d.phoY))):d.phoY=0:-1!=l.indexOf(m)&&(d.phoX*=u,d.phoY*=u,d.phoWidth*=u,d.phoHeight*=u)}else d.phoX=0,d.phoY=0,d.phoWidth=d.width,d.phoHeight=d.height;Q.update(d,"phoX")}break;case x.OBJECT_ROTATING:}for(var p=0,f=r;p<f.length;p++)e=f[p],this.dispatchElementDataChangedEvent(e)},o.prototype.onItemsPositionChangeEnd=function(t){var e,o=t.relatedObjects;switch(t.type){case x.OBJECT_MOVED:break;case x.OBJECT_RESIZED:for(var n=0,i=o;n<i.length;n++)e=i[n],this.oldSizeOfResizeStartModelMapping.containsKey(e)&&this.oldSizeOfResizeStartModelMapping.remove(e);break;case x.OBJECT_ROTATED:}},o.prototype.onItemsClickOff=function(t){for(var e,o=t.relatedObjects,n=this,i=0,r=o;i<r.length;i++)if(e=r[i],e&&e.locked){console.log("lock item released!");var a=new Z(Z.LOCK_SHAKE,!0);n.dispatchEvent(a);break}},o.prototype.initializeFramework=function(){var t,e,o=this.pageModel.basicPageInfo,i=EditorCommon.DPI,r=0,a=1==o.spread,s=d.isFace(this.pageModel.type),m=d.isInpage(this.pageModel.type);c.mm2px(1,i);s&&a&&(r=WorkModelController.getInstance().workModel.thickness);var p=c.mm2px(r,i),f=c.mm2px(o.top_layer_width,i),g=c.mm2px(o.top_layer_height,i),v=c.mm2px(o.design_layer_width,i),_=c.mm2px(o.design_layer_height,i),y=c.mm2px(o.design_layer_left,i),E=c.mm2px(o.design_layer_top,i),C=c.mm2px(o.tip_left,i),M=c.mm2px(o.tip_right,i),I=c.mm2px(o.tip_top,i),T=c.mm2px(o.tip_bottom,i);t=c.mm2px(o.bleed_left+o.bleed_right,i),e=c.mm2px(o.bleed_top+o.bleed_bottom,i),this._defaultWidth=this.width,this._defaultHeight=this.height,this.topLayerContainer?(this._orgWidth=f+t+p,this._orgHeight=g+e,this.topLayerContainer.width=this._orgWidth,this.topLayerContainer.height=this._orgHeight,this.designLayerContainer.width=v+t+p,this.designLayerContainer.height=_+e,this.designLayerContainer.x=y,this.designLayerContainer.y=E,this.stageGroup.width=v+p,this.stageGroup.height=_):(this._orgWidth=v+t+p,this._orgHeight=_+e,this.designLayerContainer.width=this._orgWidth,this.designLayerContainer.height=this._orgHeight,this.designLayerContainer.x=0,this.designLayerContainer.y=0,this.stageGroup.width=v+p,this.stageGroup.height=_),this.bottomLayerContainer&&(this.bottomLayerContainer.width=this.topLayerContainer.width,this.bottomLayerContainer.height=this.topLayerContainer.height),this.backgroundGroup.width=this.designLayerContainer.width,this.backgroundGroup.height=this.designLayerContainer.height,this.setSelectedLayer(),this.isChildStage||this.drawBleedLines(C,M,I,T),this.tipLayerContainer&&(this.tipLayerContainer.left=this.tipLayerContainer.right=1,this.tipLayerContainer.top=this.tipLayerContainer.bottom=1,a&&(s?this.drawFaceThickness(p):m&&this.drawInpageSplitLine()));var w,O,P;if(this.scaleMode==n.STRETCH){var L=[this._orgWidth,this._orgHeight],S=h.getScaledSizeByConstraint(L,[this.width,this.height]);O=S[0],P=S[1],w=S[2]}else this.scaleMode==n.WIDTH_ONLY?(P=this.height,O=this._orgWidth*P/this._orgHeight,w=h.getScale(O,P,this._orgWidth,this._orgHeight)):this.scaleMode==n.HEIGHT_ONLY&&(O=this.width,P=this._orgHeight*O/this._orgWidth,w=h.getScale(O,P,this._orgWidth,this._orgHeight));this.width=this._orgWidth,this.height=this._orgHeight,this.setStageScale(w),this.openTransform&&this.stageGroup&&(this.transformHandlesLayerContainer&&(this.transformHandlesLayerContainer.parent.x=y,this.transformHandlesLayerContainer.parent.y=E,this.transformHandlesLayerContainer.parent.width=this.designLayerContainer.width,this.transformHandlesLayerContainer.parent.height=this.designLayerContainer.height,this.transformHandlesLayerContainer.width=this.stageGroup.width,this.transformHandlesLayerContainer.height=this.stageGroup.height,this.transformHandlesLayerContainer.horizontalCenter=this.transformHandlesLayerContainer.verticalCenter=0),this._designLayerTFManager=new D(this.transformHandlesLayerContainer,null,new X(Y)),this.initTransformManager(this._designLayerTFManager,l.DESIGN_LAYER),this.drawingSprite_Design&&(this.drawingSprite_Design.x=this.stageGroup.x,this.drawingSprite_Design.y=this.stageGroup.y,this.drawingSprite_Design.width=this.stageGroup.width,this.drawingSprite_Design.height=this.stageGroup.height,this._designLayerAlignLinesManager=new N(this._designLayerTFManager,this.drawingSprite_Design),this._designLayerAlignLinesManager.addDecorator(new B(this._designLayerTFManager,c.pt2px(5,EditorCommon.DPI),this.drawingSprite_Design.width+50,this.drawingSprite_Design.height+50))));var b=new u(u.INIT_FRAMEWORK_COMPLETE);b.pageModel=this.pageModel,this.dispatchEvent(b)},o.prototype.createStageContent=function(){var t,e;this.pageModel.elementList&&this.pageModel.elementList.length>0&&(this.extractElementCountInfo(this.pageModel.elementList),0==this.elementsLoadCountVO.allCount?(e=new u(u.ELEMENT_CREATION_COMPLETE),e.pageModel=this.pageModel,this.dispatchEvent(e),t=new m(m.LOAD_READY),t.loadCountVO=this.elementsLoadCountVO.clone(),this.dispatchEvent(t)):this.createElements(this.sortByElementIndex(this.pageModel.elementList)))},o.prototype.removeStageContent=function(){this.topLayerContainer&&(this.destroyChildrenElement(this.topLayerContainer),this.topLayerContainer.removeChildren()),this.stageGroup&&(this.destroyChildrenElement(this.stageGroup),this.stageGroup.removeChildren()),this.backgroundGroup&&(this.destroyChildrenElement(this.backgroundGroup),this.backgroundGroup.removeChildren()),this.bottomLayerContainer&&(this.destroyChildrenElement(this.bottomLayerContainer),this.bottomLayerContainer.removeChildren()),this.elementDataModelMapping.clear(),this._alwaysTopElementCount=0,this._paddingToCreateElementCount=0},o.prototype.clearAndResetStageFramework=function(){this._designLayerAlignLinesManager&&(this.drawingSprite_Design.removeChildren(),this._designLayerAlignLinesManager.destroy(),this._designLayerAlignLinesManager=null),this._designLayerTFManager&&this.destoryTransformManager(this._designLayerTFManager),this.topLayerContainer&&(this.topLayerContainer.width=this.topLayerContainer.height=0/0),this.tipLayerContainer&&this.tipLayerContainer.removeChildren(),this.stageGroup.width=this.stageGroup.height=0/0,isNaN(this._defaultWidth)||(this.width=this._defaultWidth),isNaN(this._defaultHeight)||(this.height=this._defaultHeight),this._orgWidth=this._orgHeight=0/0,this.setStageScale(1)},o.prototype.sortByElementIndex=function(t){for(var e,o,n=t.source.concat(),i=[],r=0,a=n;r<a.length;r++)e=a[r],e instanceof f?o=!0:i.push(e.index);if(o)for(var s=p.max(i),l=0,d=0,c=n;d<c.length;d++)e=c[d],e instanceof f&&e.index<s&&(l++,e.index=s+l);return n=n.sort(function(t,e){return t.index-e.index})},o.prototype.extractElementCountInfo=function(t){var e;this.elementsLoadCountVO=new r;for(var o=0,n=t.source;o<n.length;o++)if(e=n[o],this.getLayerContainer(e.layer))switch(e.elementType){case g.TYPE_PHOTO:this.elementsLoadCountVO.photoCount++,this.elementsLoadCountVO.allCount++;break;case g.TYPE_TEXT:this.elementsLoadCountVO.textCount++,this.elementsLoadCountVO.allCount++;break;case g.TYPE_DECORATION:this.elementsLoadCountVO.decorationCount++,this.elementsLoadCountVO.allCount++;break;case g.TYPE_SPECIAL:this.elementsLoadCountVO.specialCount++,this.elementsLoadCountVO.allCount++;break;case g.TYPE_BACKGROUND:this.elementsLoadCountVO.backgroundCount++,this.elementsLoadCountVO.allCount++;break;case g.TYPE_SMART_CALENDAR:this.elementsLoadCountVO.smartCount++,this.elementsLoadCountVO.allCount++}if(this.elementsLoadCountVO.allCount>0){var i=new m(m.EXTRACT_READY);i.loadCountVO=this.elementsLoadCountVO.clone(),this.dispatchEvent(i)}this.dispatchPageElementsInfoChangedEvent()},o.prototype.addDataLoadEvent=function(t){t.addEventListener(v.COMPLETE,this.onElementDataLoaded,this)},o.prototype.onElementDataLoaded=function(t){var e=t.target;e.removeEventListener(v.COMPLETE,this.onElementDataLoaded,this);var o=e.getFillData().elementType;switch(o){case g.TYPE_PHOTO:this.elementsLoadCountVO.loadedPhotoCount++,this.elementsLoadCountVO.allLoadedCount++;break;case g.TYPE_TEXT:this.elementsLoadCountVO.loadedTextCount++,this.elementsLoadCountVO.allLoadedCount++;break;case g.TYPE_DECORATION:this.elementsLoadCountVO.loadedDecorationCount++,this.elementsLoadCountVO.allLoadedCount++;break;case g.TYPE_SPECIAL:this.elementsLoadCountVO.loadedSpecialCount++,this.elementsLoadCountVO.allLoadedCount++;break;case g.TYPE_BACKGROUND:this.elementsLoadCountVO.loadedBackgroundCount++,this.elementsLoadCountVO.allLoadedCount++;break;case g.TYPE_SMART_CONTACTS_GRID:case g.TYPE_SMART_CALENDAR:this.elementsLoadCountVO.loadedSmartCount++,this.elementsLoadCountVO.allLoadedCount++}if(this.elementsLoadCountVO.allLoadedCount==this.elementsLoadCountVO.allCount){var n=new m(m.LOAD_READY);n.loadCountVO=this.elementsLoadCountVO.clone(),this.dispatchEvent(n)}this.dispatchPageElementsInfoChangedEvent()},o.prototype.createElements=function(t){for(var e,o=(t.length,0),n=t;o<n.length;o++)e=n[o],this.getLayerContainer(e.layer)&&this._paddingToCreateElementCount++;for(var i=0,r=t;i<r.length;i++)e=r[i],this.getLayerContainer(e.layer)&&this.addElementToStage(e,!0)},o.prototype.drawBleedLines=function(t,e,o,n){this.bleedTipRect&&(this.bleedTipRect.left=t,this.bleedTipRect.right=e,this.bleedTipRect.top=o,this.bleedTipRect.bottom=n,this.bleedTipRect.alpha=1,this.bleedTipRect.fillAlpha=0,this.bleedTipRect.strokeColor=16711680,this.bleedTipRect.strokeWeight=Math.round(c.pt2px(1,EditorCommon.DPI)))},o.prototype.drawFaceThickness=function(t){if(this.tipLayerContainer){this.tipLayerContainer.removeChildren();var o=new e.FaceThickness;o.thicknessWidth=t,o.lineWeight=Math.round(c.pt2px(2,EditorCommon.DPI)),o.height=this.stageGroup.height,o.horizontalCenter=0,this.tipLayerContainer.addChild(o)}},o.prototype.drawInpageSplitLine=function(){if(this.tipLayerContainer){this.tipLayerContainer.removeChildren();var t=new _;t.source=E.INPAGE_CENTER_LINE,t.fillMode=y.REPEAT,t.width=400,t.percentHeight=100,t.horizontalCenter=0,this.tipLayerContainer.addChild(t)}},o.prototype.getLayerContainer=function(t){var e;return e=t==C.TOP_LAYAER?this.topLayerContainer:t==C.DESIGN_LAYAER?this.stageGroup:this.bottomLayerContainer},o.prototype.getLayerTransformManager=function(t){var e;return e=t==C.TOP_LAYAER?this._designLayerTFManager:t==C.DESIGN_LAYAER?this._designLayerTFManager:this._designLayerTFManager},o.prototype.onElementCreated=function(t){if(this._paddingToCreateElementCount--,0==this._paddingToCreateElementCount){var o=new u(u.ELEMENT_CREATION_COMPLETE);o.pageModel=this.pageModel,this.dispatchEvent(o)}var n=t.target;n.removeEventListener(M.CREATION_COMPLETE,this.onElementCreated,this),n instanceof e.ElementBase&&(n.fromChildStage=this.isChildStage),this.initElement(n),this.openTransform&&(n.getFillData()instanceof S||this.addToTransformManager(n)),this.updateElementIndexForModel()},o.prototype.initElement=function(t){var e=this.elementDataModelMapping.getValue(t);t.init(e)},o.prototype.setStageScale=function(t){this._scale=I.setPrecision(t,6),this.scaleX=this._scale,this.scaleY=this._scale,this.dispatchEvent(new T("scaleChange"))},o.prototype.setSelectedLayer=function(){switch(this.selectedLayer){case l.TOP_LAYER:this.topLayerContainer&&(this.topLayerContainer.touchEnabled=this.topLayerContainer.touchEnabled=!0),this.bottomLayerContainer&&(this.bottomLayerContainer.touchEnabled=this.bottomLayerContainer.touchEnabled=!1),this.stageGroup.touchEnabled=this.stageGroup.touchEnabled=!1;break;case l.DESIGN_LAYER:this.topLayerContainer&&(this.topLayerContainer.touchEnabled=this.topLayerContainer.touchEnabled=!1),this.bottomLayerContainer&&(this.bottomLayerContainer.touchEnabled=this.bottomLayerContainer.touchEnabled=!1),this.stageGroup.touchEnabled=this.stageGroup.touchEnabled=!0;break;case l.BOTTOM_LAYER:this.topLayerContainer&&(this.topLayerContainer.touchEnabled=this.topLayerContainer.touchEnabled=!1),this.bottomLayerContainer&&(this.bottomLayerContainer.touchEnabled=this.bottomLayerContainer.touchEnabled=!0),this.stageGroup.touchEnabled=this.stageGroup.touchEnabled=!1}},o.prototype.destroyChildrenElement=function(t){var e,o=0,n=t.numChildren;for(o;n>o;o++){var i=t.getChildAt(o);this.isIElement(i)&&(e=i,e.destroy())}},o.prototype.getElementCount=function(){for(var t=this.getLayerContainer(this.selectedLayer),e=t.numChildren,o=0,n=0;e>n;n++){var i=t.getChildAt(n);this.isIElement(i)&&o++}return o},o.prototype.getAlwaysTopIndexElementCount=function(){return this.selectedLayer!=l.DESIGN_LAYER&&(this._alwaysTopElementCount=0),this._alwaysTopElementCount},o.prototype.updateElementIndexForModel=function(){if(!this.isChildStage)for(var t,e,o=this.getLayerContainer(this.selectedLayer),n=o.numChildren,i=0;n>i;i++){var r=o.getChildAt(i);this.isIElement(r)&&(t=r,e=t.getFillData(),e&&(e.index=i))}},o.prototype.dispatchSelectedElementsChangeEvent=function(){var t=new w(w.SELECTED_CHANGE);t.elements=this.getSelectedElements(),this.dispatchEvent(t)},o.prototype.dispatchElementDataChangedEvent=function(t){var e=new O(O.DATA_CHANGED);e.elementModel=t,this.dispatchEvent(e)},o.prototype.updateElementCountInfo=function(t,e){switch(t){case g.TYPE_PHOTO:e?(this.elementsLoadCountVO.photoCount++,this.elementsLoadCountVO.allCount++):(this.elementsLoadCountVO.photoCount--,this.elementsLoadCountVO.loadedPhotoCount--,this.elementsLoadCountVO.allCount--,this.elementsLoadCountVO.allLoadedCount--);break;case g.TYPE_TEXT:e?(this.elementsLoadCountVO.textCount++,this.elementsLoadCountVO.allCount++):(this.elementsLoadCountVO.textCount--,this.elementsLoadCountVO.loadedTextCount--,this.elementsLoadCountVO.allCount--,this.elementsLoadCountVO.allLoadedCount--);break;case g.TYPE_DECORATION:e?(this.elementsLoadCountVO.decorationCount++,this.elementsLoadCountVO.allCount++):(this.elementsLoadCountVO.decorationCount--,this.elementsLoadCountVO.loadedDecorationCount--,this.elementsLoadCountVO.allCount--,this.elementsLoadCountVO.allLoadedCount--);break;case g.TYPE_SPECIAL:e?(this.elementsLoadCountVO.specialCount++,this.elementsLoadCountVO.allCount++):(this.elementsLoadCountVO.specialCount--,this.elementsLoadCountVO.loadedSpecialCount--,this.elementsLoadCountVO.allCount--,this.elementsLoadCountVO.allLoadedCount--);break;case g.TYPE_BACKGROUND:e?(this.elementsLoadCountVO.backgroundCount++,this.elementsLoadCountVO.allCount++):(this.elementsLoadCountVO.backgroundCount--,this.elementsLoadCountVO.loadedBackgroundCount--,this.elementsLoadCountVO.allCount--,this.elementsLoadCountVO.allLoadedCount--);break;case g.TYPE_SMART_CONTACTS_GRID:case g.TYPE_SMART_CALENDAR:e?(this.elementsLoadCountVO.smartCount++,this.elementsLoadCountVO.allCount++):(this.elementsLoadCountVO.smartCount--,this.elementsLoadCountVO.loadedSmartCount--,this.elementsLoadCountVO.allCount--,this.elementsLoadCountVO.allLoadedCount--)}this.dispatchPageElementsInfoChangedEvent()},o.prototype.dispatchPageElementsInfoChangedEvent=function(){var t=new m(m.COUNT_CHANGE,!0);t.loadCountVO=this.elementsLoadCountVO.clone(),this.dispatchEvent(t)},o.prototype.isIElement=function(t){return void 0!=t.getFillData},o.prototype.isIHandle=function(t){return void 0!=t.handleDescriptor&&void 0!=t.targetModel},o}(o);e.StageOverviewBase=te,__reflect(te.prototype,"cdcommon.editor.components.StageOverviewBase",["cdcommon.framework.interfaces.IComponent","eui.UIComponent","egret.DisplayObject"])}(o=e.components||(e.components={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(e){var o;!function(e){var o=t.framework.task.Task,n=egret.ImageLoader,i=egret.Event,r=egret.IOErrorEvent,a=egret.BitmapData,s=t.editor.utils.PhotoTools,l=t.framework.utils.BitmapDataUtil,d=function(t){function e(e){var o=t.call(this)||this;return o.photoItem=null,o.imageLoader=null,o._time=0,o.photoItem=e,o}return __extends(e,t),e.prototype.performTask=function(){this.photoItem.fileRef?this.loadFileDataByFileRef():this.loadFileDataByUrl()},e.prototype.addLoaderListeners=function(){this.imageLoader&&(this.imageLoader.addEventListener(i.COMPLETE,this.onFileDataLoaded,this),this.imageLoader.addEventListener(r.IO_ERROR,this.onFileDataLoadedError,this))},e.prototype.removeLoaderListeners=function(){this.imageLoader&&(this.imageLoader.removeEventListener(i.COMPLETE,this.onFileDataLoaded,this),this.imageLoader.removeEventListener(r.IO_ERROR,this.onFileDataLoadedError,this))},e.prototype.loadFileDataByFileRef=function(){var t=this.photoItem.fileRef,e=s.getTypeByName(this.photoItem.name),o=this;this._time=egret.getTimer(),EXIF.getData(t,function(n){void 0===n&&(n=!0),n||console.log("无法读取到EXIF信息：",o.photoItem.name);var i=EXIF.getTag(this,"Orientation"),r=document.createElement("canvas"),a=r.getContext("2d"),l=new Image;l.onload=function(){l.onload=null;var t=s.getScaleByMaxEdge(l.width,l.height,s.MIDDLE_SIZE_PX);l.width*=t,l.height*=t,r.width=l.width,r.height=l.height,a.save();var n=r.width,d=r.style.width,c=r.height,h=r.style.height;if(i)switch([5,6,7,8].indexOf(i)>-1&&(r.width=c,r.style.width=h,r.height=n,r.style.height=d),i){case 2:a.translate(n,0),a.scale(-1,1);break;case 3:a.translate(n,c),a.rotate(Math.PI);break;case 4:a.translate(0,c),a.scale(1,-1);break;case 5:a.rotate(.5*Math.PI),a.scale(1,-1);break;case 6:a.rotate(.5*Math.PI),a.translate(0,-c);break;case 7:a.rotate(.5*Math.PI),a.translate(n,-c),a.scale(-1,1);break;case 8:a.rotate(-.5*Math.PI),a.translate(-n,0)}a.drawImage(l,0,0,n,c),a.restore();var u=r.toDataURL(e);o.onFileDataReaded(u)},l.src=o.createObjectURL(t)})},e.prototype.onFileDataReaded=function(t){var e=this,o=new Image;this._time=egret.getTimer(),o.onload=function(){o.onload=null;var t=new a(o);e.photoItem.source=t,e.photoItem.thumb_url=s.scaleByMaxEdgeVarCanvas(o,s.SMARLL_SIZE_PX,s.getTypeByName(e.photoItem.name)),e.overThis(!0)},o.src=t},e.prototype.onFileDataLoaded=function(t){var e=t.target;this.photoItem.source=e.data,this.photoItem.thumb_url=l.scaleByMaxEdge(this.photoItem.source,s.SMARLL_SIZE_PX,"base64"),this.overThis(!0)},e.prototype.onFileDataLoadedError=function(t){var e="加载时遇到IOError错误。\n图片名称："+this.photoItem.name;this.overThis(!1,e)},e.prototype.loadFileDataByUrl=function(){this.imageLoader=new n,this.addLoaderListeners(),this.imageLoader.load(this.photoItem.url)},e.prototype.createObjectURL=function(t){return void 0!=window.URL?window.URL.createObjectURL(t):window.webkitURL.createObjectURL(t)},e.prototype.overThis=function(t,e){void 0===e&&(e=null),this.removeLoaderListeners(),t?this.complete():this.fault(e)},e}(o);e.PhotoDataLoadTask=d,__reflect(d.prototype,"cdcommon.editor.tasks.PhotoDataLoadTask")}(o=e.tasks||(e.tasks={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(e){var o;!function(e){var o=t.editor.models.WorkModel,n=function(){function t(t){this._workModel=new o}return Object.defineProperty(t.prototype,"workModel",{get:function(){return this._workModel},set:function(t){this._workModel=t},enumerable:!0,configurable:!0}),t.getInstance=function(){return this._inst||(this._inst=new t(new i)),this._inst},t}();e.WorkModelController=n,__reflect(n.prototype,"cdcommon.editor.managers.WorkModelController");var i=function(){function t(){}return t}();__reflect(i.prototype,"SingletonEnforcer")}(o=e.managers||(e.managers={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(e){var o;!function(e){var o=t.framework.dtos.ParamBaseDTO,n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(o);e.GetLocationListParamDTO=n,__reflect(n.prototype,"cdcommon.framework.dtos.GetLocationListParamDTO")}(o=e.dtos||(e.dtos={}))}(e=t.framework||(t.framework={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(e){var o;!function(e){var o=eui.Component,n=t.framework.utils.ColorUtil,i=function(t){function e(){var e=t.call(this)||this;return e._text="",e._backgroundColor="#FE481E",e._backgroundAlpha=1,e}return __extends(e,t),Object.defineProperty(e.prototype,"text",{get:function(){return this._text},set:function(t){this._text=t,this.labelDisplay&&(this.labelDisplay.text=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"backgroundColor",{get:function(){return this._backgroundColor},set:function(t){this._backgroundColor=t,this.ellipseRect&&(this.ellipseRect.fillColor=n.string2Uint(t))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"backgroundAlpha",{get:function(){return this._backgroundAlpha},set:function(t){this._backgroundAlpha=t,this.ellipseRect&&(this.ellipseRect.fillAlpha=t)},enumerable:!0,configurable:!0}),e.prototype.partAdded=function(e,o){t.prototype.partAdded.call(this,e,o),o==this.labelDisplay?this.labelDisplay.text=this._text:o==this.ellipseRect&&(this.ellipseRect.ellipseWidth=this.ellipseRect.ellipseHeight=this.width,this.ellipseRect.fillColor=n.string2Uint(this._backgroundColor),this.ellipseRect.fillAlpha=this._backgroundAlpha)},e.prototype.partRemoved=function(e,o){t.prototype.partRemoved.call(this,e,o)},e}(o);e.CircleLabel=i,__reflect(i.prototype,"cdcommon.framework.components.CircleLabel")}(o=e.components||(e.components={}))}(e=t.framework||(t.framework={}))}(cdcommon||(cdcommon={}));var managers;!function(t){var e=egret.EventDispatcher,o=cdcommon.editor.services.GetPhotoRecognitionInterface,n=egret.Event,i=cdcommon.editor.models.FaceInfoModel,r=egret.Rectangle,a=egret.Sprite,s=function(t){function e(e){return t.call(this)||this}return __extends(e,t),e.getInstance=function(){return this._inst||(this._inst=new e(new l)),this._inst},e.prototype.getFaceRecognitionInfo=function(t){var e=new o;e.once(InterfaceEvent.COMPLETE,this.onGetPhotoRecognitionHandler,this),e.once(InterfaceEvent.FAULT,this.onGetPhotoRecognitionHandler,this),e.call(t)},e.prototype.onGetPhotoRecognitionHandler=function(t){var o;if(t.type==InterfaceEvent.COMPLETE)o=t.data,o&&(this.updateRelatedPhotoElementModelsFaceInfo(o),this.dispatch(e.GET_FACEINFO_COMPLETE,o));else{var n=t.data;this.dispatch(e.GET_FACEINFO_FAULT,n),console.log("获取图片识别信息失败: "+n)}},e.prototype.updateRelatedPhotoElementModelsFaceInfo=function(t){var e,o=0,n=0;try{var a=JSON.parse(t.facesInfoJson);if("OK"==a.errormsg&&(o=a.image_width,n=a.image_height,a.face instanceof Array&&a.face.length>0)){e=[];for(var s,l=0,d=a.face;l<d.length;l++){var c=d[l],h=new r;h.width=c.width,h.height=.2*c.height,s=new i,s.phoWidth=o,s.phoHeight=n,s.faceX=c.x,s.faceY=c.y-h.height,s.faceWidth=c.width,s.faceHeight=c.height+h.height,e.push(s)}}}catch(u){e=null}t.faceInfos=e},e.prototype.drawFaceRects=function(t,e){for(var o,n=new a,i=0,r=e;i<r.length;i++)o=r[i],n.graphics.lineStyle(2,16711680),n.graphics.beginFill(0,.2),n.graphics.drawRect(o.faceX,o.faceY,o.faceWidth,o.faceHeight),n.graphics.endFill();var s=new egret.RenderTexture;return s.bitmapData=t,s.drawToTexture(n),s.bitmapData},e.prototype.dispatch=function(t,e){var o=new n(t,!1,!1,e);this.dispatchEvent(o)},e.GET_FACEINFO_COMPLETE="getFaceInfoComplete",e.GET_FACEINFO_FAULT="getFaceInfoFault",e}(e);t.FaceRecognitionManager=s,__reflect(s.prototype,"managers.FaceRecognitionManager");var l=function(){function t(){}return t}();__reflect(l.prototype,"SingletonEnforcer")}(managers||(managers={}));var cdcommon;!function(t){var e;!function(e){var o;!function(e){var o=t.framework.dtos.ResultBaseDTO,n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(o);e.GetLocationListResultDTO=n,__reflect(n.prototype,"cdcommon.framework.dtos.GetLocationListResultDTO")
}(o=e.dtos||(e.dtos={}))}(e=t.framework||(t.framework={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(e){var o;!function(e){var o=egret.URLRequest,n=egret.URLRequestMethod,i=t.framework.constants.APIConstant,r=t.framework.managers.APIConfig,a=t.framework.events.InterfaceEvent,s=t.framework.services.InterfaceBase,l=t.framework.utils.APIUtils,d=egret.URLVariables,c=t.editor.dtos.SavePhotoParamDTO,h=t.editor.dtos.SavePhotoResultDTO,u=function(t){function e(e){return t.call(this,e)||this}return __extends(e,t),e.prototype.call=function(e){if(t.prototype.call.call(this,e),e instanceof c){var a=e;this.request=new o(r.getItem(i.SAVE_PHOTO).url),this.request.method=n.POST;var s=new d;s.variables={},s.variables.ph_id=a.ph_id,s.variables.uid=a.uid,s.variables.sp_id=a.sp_id,s.variables.wid=a.wid,s.variables.org_name=a.org_name,s.variables.org_width=a.org_width,s.variables.org_height=a.org_height,s.variables.org_size=a.org_size,s.variables.ext=a.ext,s.variables.url=a.url,this.request.data=s,this.loader.load(this.request)}},e.prototype.onResultHandler=function(t){try{var e=JSON.parse(this.loader.data),o=l.json2ResultDTO(e,new h);o.success?this.callback(a.COMPLETE,this.callParam):this.callback(a.FAULT,"名称为："+this.callParam.org_name+" 的图片在保存过程发生错误\n(ERROR_CODE="+o.err_code+"MSG="+o.err_msg+")")}catch(n){this.callback(a.FAULT,"解析返回结果出错："+n.message)}},e.prototype.onFaultHandler=function(t){this.callback(a.FAULT,"接口IO错误！")},e}(s);e.SavePhotoInterface=u,__reflect(u.prototype,"cdcommon.editor.services.SavePhotoInterface")}(o=e.services||(e.services={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(t){var e;!function(t){var e=function(){function t(){this.id="",this.pid=""}return t}();t.WCPageIdItem=e,__reflect(e.prototype,"cdcommon.editor.models.WCPageIdItem")}(e=t.models||(t.models={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(t){var e;!function(t){var e=function(){function t(){}return t.getID=function(){var t=(new Date).getTime(),e=Math.round(1e6*Math.random());return t.toString()+e.toString()},t.osspath1=function(){null==t.serverTime&&(t.serverTime=new Date);var e=this.formatDate(t.serverTime);return e=e.replace("/","/d"),e="/y"+e},t.formatDate=function(t){var e=t.getFullYear().toString(),o=(t.getMonth()+1).toString(),n=t.getDate().toString();return parseInt(o)<10&&(o="0"+o),parseInt(n)<10&&(n="0"+n),e+"/"+o+n},t.osspath2=function(t){var e="";return""==t||null==t?e="":t.length<11?e=t+"/":(e+=t.slice(0,10),e=e+"/"+t.slice(10),"/"!=e.charAt(e.length-1)&&(e+="/")),"/"+e},t.serverTime=new Date,t.osspath0="m01",t}();t.TimeID=e,__reflect(e.prototype,"cdcommon.framework.utils.TimeID")}(e=t.utils||(t.utils={}))}(e=t.framework||(t.framework={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(e){var o;!function(e){var o=t.framework.utils.Base64Utils,n=function(){function t(){}return Object.defineProperty(t,"HOST",{get:function(){return"http://"+this.OSS_BUCKECT_NAME+"."+this.OSS_ENDPOINT},enumerable:!0,configurable:!0}),Object.defineProperty(t,"BASE64_POLICY",{get:function(){var t='{"expiration":"2115-01-27T10:56:19Z","conditions":[["content-length-range", 0, 504857600]]}';return o.encode(t)},enumerable:!0,configurable:!0}),t.OSS_REGION="",t.OSS_ENDPOINT="",t.OSS_BUCKECT_NAME="",t.ACCESS_KEY_ID="",t.ACCESS_KEY_SECRET="",t.ACCESS_SIGN="",t}();e.OssVar=n,__reflect(n.prototype,"cdcommon.framework.oss.OssVar")}(o=e.oss||(e.oss={}))}(e=t.framework||(t.framework={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(t){var e;!function(t){var e=function(){function t(){this.id=0,this.name="",this.remark="",this.type_id="",this.dpi=0,this.spread=0,this.cover_info=null,this.inpage_info=null,this.back_info=null}return t}();t.SizeItem=e,__reflect(e.prototype,"cdcommon.editor.models.SizeItem")}(e=t.models||(t.models={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var utils;!function(t){var e=egret.Event,o=function(){function t(t){this.$scrolleres=[]}return t.prototype.init=function(t){this.$stage=t},t.prototype.bind=function(t){this.$stage&&!egret.Capabilities.isMobile&&mouse&&t&&t.viewport&&!this.$scrolleres[t.hashCode]&&(t.verticalScrollBar.autoVisibility=!1,t.addEventListener(mouse.MouseEvent.MOUSE_OVER,this.onScrollerMouse,this),t.addEventListener(mouse.MouseEvent.MOUSE_OUT,this.onScrollerMouse,this),t.addEventListener(e.CHANGE,this.onScrollerChange,this),this.$scrolleres[t.hashCode]=this.createMouseWheel(t))},t.prototype.unbind=function(t){this.$stage&&!egret.Capabilities.isMobile&&mouse&&t&&this.$scrolleres[t.hashCode]&&(t.removeEventListener(mouse.MouseEvent.MOUSE_OVER,this.onScrollerMouse,this),t.removeEventListener(mouse.MouseEvent.MOUSE_OUT,this.onScrollerMouse,this),t.removeEventListener(e.CHANGE,this.onScrollerChange,this),this.$stage.removeEventListener(mouse.MouseEvent.MOUSE_WHEEL,this.$scrolleres[t.hashCode],null),t.viewport&&egret.Tween.removeTweens(t.viewport),delete this.$scrolleres[t.hashCode])},t.prototype.onScrollerChange=function(t){var e=t.target;e&&(e.verticalScrollBar.visible=!0)},t.prototype.onScrollerMouse=function(t){var e=t.currentTarget;if(e&&this.$scrolleres[e.hashCode]){var o=this.$scrolleres[e.hashCode];switch(t.type){case mouse.MouseEvent.MOUSE_OVER:this.$stage.addEventListener(mouse.MouseEvent.MOUSE_WHEEL,o,null);break;case mouse.MouseEvent.MOUSE_OUT:if(this.contains(e,t.target))return;this.$stage.removeEventListener(mouse.MouseEvent.MOUSE_WHEEL,o,null)}}},t.prototype.contains=function(t,e){if(t==e)return!1;if(!e||!e.parent)return!1;for(;e.parent!=this.$stage;){if(e.parent==t)return!0;e=e.parent}return!1},t.prototype.createMouseWheel=function(t){return function(e){if(t.viewport&&!(t.viewport.contentHeight<=t.height)){egret.Tween.removeTweens(t.viewport);var o=t.viewport.scrollV-e.data;0>o?o=0:o>t.viewport.contentHeight-t.viewport.height&&(o=t.viewport.contentHeight-t.viewport.height),t.viewport.scrollV=o}}},t.getInstance=function(){return this._inst||(this._inst=new t(new n)),this._inst},t}();t.MouseScroller=o,__reflect(o.prototype,"utils.MouseScroller");var n=function(){function t(){}return t}();__reflect(n.prototype,"SingletonEnforcer")}(utils||(utils={}));var cdcommon;!function(t){var e;!function(e){var o;!function(e){var o=egret.URLRequest,n=egret.URLRequestMethod,i=egret.URLVariables,r=t.framework.constants.APIConstant,a=t.framework.managers.APIConfig,s=t.framework.events.InterfaceEvent,l=t.framework.services.InterfaceBase,d=t.framework.utils.APIUtils,c=t.framework.dtos.GetLocationListParamDTO,h=t.framework.dtos.GetLocationListResultDTO,u=function(t){function e(e){return t.call(this,e)||this}return __extends(e,t),e.prototype.call=function(e){if(t.prototype.call.call(this,e),e instanceof c){var s=e;this.request=new o(a.getItem(r.GET_LOCATION_LIST).url),this.request.method=n.POST;var l=new i;l.variables={},l.variables.id=s.id,l.variables.getType=s.getType,this.request.data=l,this.loader.load(this.request)}},e.prototype.onResultHandler=function(t){try{var e=JSON.parse(this.loader.data),o=d.json2ResultDTO(e,new h);if(o.success){var n=o.results[0];o.list=n.list,this.callback(s.COMPLETE,o)}else this.callback(s.FAULT,"获取省市区信息发生错误！\n(ERROR_CODE="+o.err_code+"MSG="+o.err_msg+")")}catch(i){this.callback(s.FAULT,"解析返回结果出错："+i.message)}},e.prototype.onFaultHandler=function(t){this.callback(s.FAULT,"接口IO错误！")},e}(l);e.GetLocationListInterface=u,__reflect(u.prototype,"cdcommon.framework.services.GetLocationListInterface")}(o=e.services||(e.services={}))}(e=t.framework||(t.framework={}))}(cdcommon||(cdcommon={}));var utils;!function(t){var e=egret.EventDispatcher,o=cdcommon.framework.models.IconCommonProvider,n=cdcommon.framework.components.AlertPic,i=egret.Event,r=cdcommon.editor.constants.PhotoStatus,a=cdcommon.editor.utils.PhotoTools,s=cdcommon.editor.factories.ModelFactory,l=cdcommon.editor.constants.MaterialKindConstant,d=function(t){function e(e){return t.call(this)||this}return __extends(e,t),e.prototype.browse=function(t){void 0===t&&(t=0),this._addedTotalCount=t;var i=this,d=document.getElementById("uploadImg");d.onchange=function(){var t,c=d.files;if(c.length>0)if(c.length>e.ONCE_MAX_UPLOAD_COUNT)n.show(o.Alert_WARNING,"每次导入的照片数量不能超过"+e.ONCE_MAX_UPLOAD_COUNT.toString()+"张，请分批多次导入。","照片导入提示");else if(c.length+i._addedTotalCount>e.TOTAL_MAX_UPLOAD_COUNT)n.show(o.Alert_WARNING,"总导入的照片数量不能超过"+e.TOTAL_MAX_UPLOAD_COUNT.toString()+"张。","照片导入提示");else{for(var h=[],u=0,m=c;u<m.length;u++){t=m[u];var p=s.createMaterialModel(l.PHOTO);p.name=t.name,p.fileRef=t,p.type=t.type,p.ext=a.getExtByName(t.name),p.size=t.size,p.status=r.WAITING,h.push(p)}i.dispatch(e.ADD,h)}else i.dispatch(e.CANCEL,h)},d.click()},e.prototype.dispatch=function(t,e){var o=new i(t,!1,!1,e);this.dispatchEvent(o)},e.getInstance=function(){return this._inst||(this._inst=new e(new c)),this._inst},e.ADD="browserAdd",e.CANCEL="browserCancel",e.MIN_UPLOAD_COUNT=1,e.TOTAL_MAX_UPLOAD_COUNT=200,e.ONCE_MAX_UPLOAD_COUNT=100,e}(e);t.PhotoBrowser=d,__reflect(d.prototype,"utils.PhotoBrowser");var c=function(){function t(){}return t}();__reflect(c.prototype,"SingletonEnforcer")}(utils||(utils={}));var cdcommon;!function(t){var e;!function(e){var o;!function(e){var o=egret.EventDispatcher,n=t.editor.tasks.PhotoDataLoadTask,i=t.framework.task.TaskEvent,r=egret.Event,a=function(t){function e(){var e=t.call(this)||this;return e.loadedPhotoCount=0,e.totalPhotoCount=0,e.pendingToLoadFileItems=[],e.currentLoadingCount=0,e}return __extends(e,t),e.prototype.load=function(t){this.totalPhotoCount+=t.length;for(var e,o=0,n=t;o<n.length;o++)e=n[o],-1==this.pendingToLoadFileItems.indexOf(e)&&this.pendingToLoadFileItems.push(e);for(var i=0,r=this.pendingToLoadFileItems;i<r.length;i++){r[i];this.doFileLoad()}},e.prototype.clear=function(){},e.prototype.stop=function(){this.pendingToLoadFileItems.splice(0),this.allTasksComplateHandler()},e.prototype.isAllWorksComplete=function(){var t;return 0==this.currentLoadingCount&&0==this.pendingToLoadFileItems.length&&(t=!0),t},e.prototype.PhotoDataLoadMananger=function(){},e.prototype.doFileLoad=function(){if(this.pendingToLoadFileItems.length>0&&this.currentLoadingCount<e.MAX_LOAD_PROCESS_COUNT){var t=this.pendingToLoadFileItems.shift(),o=new n(t);o.addEventListener(i.TASK_COMPLETE,this.childCompleteHandler,this),o.addEventListener(i.TASK_FAULT,this.childFaultHandler,this),this.currentLoadingCount++,o.start()}},e.prototype.childCompleteHandler=function(t){var o=t.task;o.removeEventListener(i.TASK_COMPLETE,this.childCompleteHandler,this),o.removeEventListener(i.TASK_FAULT,this.childFaultHandler,this),this.loadedPhotoCount++,this.dispatch(e.PROGRESS,o.photoItem),this.currentLoadingCount--,this.isAllWorksComplete()?this.allTasksComplateHandler():this.doFileLoad()},e.prototype.childFaultHandler=function(t){var o=t.task;o.removeEventListener(i.TASK_COMPLETE,this.childCompleteHandler,this),o.removeEventListener(i.TASK_FAULT,this.childFaultHandler,this),this.dispatch(e.ERROR,[o.photoItem,t.message]),this.currentLoadingCount--,this.isAllWorksComplete()?this.allTasksComplateHandler():this.doFileLoad()},e.prototype.allTasksComplateHandler=function(){this.loadedPhotoCount=0,this.totalPhotoCount=0,this.dispatch(e.COMPLETE,null)},e.prototype.dispatch=function(t,e){var o=new r(t,!1,!1,e);this.dispatchEvent(o)},e.ERROR="error",e.PROGRESS="progress",e.COMPLETE="complete",e.MAX_LOAD_PROCESS_COUNT=1,e}(o);e.PhotoDataLoadMananger=a,__reflect(a.prototype,"cdcommon.editor.managers.PhotoDataLoadMananger")}(o=e.managers||(e.managers={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(e){var o;!function(e){var o=t.framework.dtos.ResultBaseDTO,n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(o);e.SaveWorkThumbResultDTO=n,__reflect(n.prototype,"cdcommon.editor.dtos.SaveWorkThumbResultDTO")}(o=e.dtos||(e.dtos={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(t){var e;!function(t){var e=eui.Component,o=egret.Shape,n=eui.ItemTapEvent,i=egret.TouchEvent,r=egret.Event,a=egret.Tween,s=function(t){function e(){var e=t.call(this)||this;return e._menuHeight=150,e._effectDuration=100,e.isShow=!1,e.labelFunction=function(t){return t},e}return __extends(e,t),Object.defineProperty(e.prototype,"dataProvider",{get:function(){return this._dataProvider},set:function(t){t!=this.dataProvider&&(this._dataProvider=t,this.applyDataProviderChanged())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"selectedItem",{get:function(){return this._selectedItem},set:function(t){this._selectedItem=t,this.applySelectedItemChanged("item")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"selectedIndex",{get:function(){return this._selectedIndex},set:function(t){this._selectedIndex=t,this.applySelectedItemChanged("index")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"labelFunction",{get:function(){return this._labelFunction},set:function(t){this._labelFunction=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"menuHeight",{get:function(){return this._menuHeight},set:function(t){this._menuHeight=t,this.scroller&&this.drawScrollerMask()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"effectDuration",{get:function(){return this._effectDuration},set:function(t){this._effectDuration=t},enumerable:!0,configurable:!0}),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.scroller&&this.drawScrollerMask(),this.selectedItem?this.applySelectedItemChanged("item"):this.applySelectedItemChanged("index")},e.prototype.drawScrollerMask=function(){this.scroller.height=this.menuHeight,this.spMask=new o,this.spMask.graphics.beginFill(0),this.spMask.graphics.drawRect(0,0,this.width,this.menuHeight),this.spMask.graphics.endFill(),this.addChild(this.spMask),this.scroller.mask=this.spMask,this.spMask.y=this.mainButton.height,this.posScrollerClose=this.scroller.y=-this.scroller.height},e.prototype.partAdded=function(e,o){t.prototype.partAdded.call(this,e,o),o==this.mainButton?this.mainButton.addEventListener(i.TOUCH_TAP,this.showOrHideMenu,this):o==this.list?(this.list.dataProvider=this.dataProvider,this.list.addEventListener(n.ITEM_TAP,this.onListItemClick,this)):o==this.scroller},e.prototype.partRemoved=function(e,o){t.prototype.partRemoved.call(this,e,o),o==this.mainButton?this.mainButton.removeEventListener(i.TOUCH_TAP,this.showOrHideMenu,this):o==this.list&&(this.list.dataProvider=null,this.list.removeEventListener(n.ITEM_TAP,this.onListItemClick,this))},e.prototype.showOrHideMenu=function(){this.isShow?(this.effectDuration>0?a.get(this.scroller).to({y:this.posScrollerClose},this.effectDuration):this.scroller.y=this.posScrollerClose,this.isShow=!1):(this.effectDuration>0?a.get(this.scroller).to({y:this.mainButton.height},this.effectDuration):this.scroller.y=this.mainButton.height,this.isShow=!0)},e.prototype.applyDataProviderChanged=function(){this.list&&(this.list.dataProvider=this.dataProvider),this.dataProvider.length>0?(this._selectedIndex=0,this._selectedItem=this.dataProvider.getItemAt(0)):(this._selectedIndex=-1,this._selectedItem=null),this.updateMainSelectedLabel()},e.prototype.applySelectedItemChanged=function(t){this.list&&("item"==t?(this.list.selectedItem=this.selectedItem,this._selectedIndex=this.list.selectedIndex):(this.list.selectedIndex=this.selectedIndex,this._selectedItem=this.list.selectedItem),this.updateMainSelectedLabel())},e.prototype.updateMainSelectedLabel=function(){this.mainButton&&(this.selectedItem?this.mainButton.label=this.labelFunction(this.selectedItem):this.mainButton.label="")},e.prototype.onListItemClick=function(t){this._selectedItem=this.list.selectedItem,this._selectedIndex=this.list.selectedIndex,this.updateMainSelectedLabel(),this.isShow?(egret.Tween.get(this.scroller).to({y:this.posScrollerClose},300),this.isShow=!1):(egret.Tween.get(this.scroller).to({y:this.mainButton.height},300),this.isShow=!0),this.dispatchEvent(new r(r.CHANGE))},e}(e);t.DropDownList=s,__reflect(s.prototype,"cdcommon.framework.components.DropDownList")}(e=t.components||(t.components={}))}(e=t.framework||(t.framework={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(e){var o;!function(e){var o=t.framework.dtos.ResultBaseDTO,n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(o);e.GetTemplateResultDTO=n,__reflect(n.prototype,"cdcommon.editor.dtos.GetTemplateResultDTO")}(o=e.dtos||(e.dtos={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var managers;!function(t){var e=egret.EventDispatcher,o=cdcommon.framework.utils.TimeID,n=cdcommon.editor.managers.WorkModelController,i=cdcommon.framework.oss.OssVar,r=cdcommon.editor.utils.PhotoTools,a=egret.Event,s=cdcommon.editor.constants.PhotoStatus,l=cdcommon.editor.managers.ElementModelController,d=cdcommon.editor.constants.ElementConstant,c=cdcommon.editor.dtos.SavePhotoParamDTO,h=cdcommon.editor.services.SavePhotoInterface,u=function(t){function e(e){var o=t.call(this)||this;return o.savePath="",o._totalCount=0,o._uploadedCount=0,o._errorCount=0,o._currUploadingPercent=0,o._currentPhotoList=[],o}return __extends(e,t),Object.defineProperty(e.prototype,"totalCount",{get:function(){return this._totalCount},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"uploadedCount",{get:function(){return this._uploadedCount},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"errorCount",{get:function(){return this._errorCount},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"uploadPercent",{get:function(){return this._uploadedCount/this._totalCount},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isUploading",{get:function(){var t=!1;return this.uploader&&this.uploader.state==plupload.STARTED&&(t=!0),t},enumerable:!0,configurable:!0}),e.prototype.addPhotoItems=function(t){if(0!=t.length){this._currentPhotoList=t.concat();for(var e=0,o=this._currentPhotoList;e<o.length;e++){var n=o[e];this.addPhotoItem(n)}}},e.prototype.addPhotoItem=function(t){t&&(this._currentPhotoList.push(t),this.uploader.addFile(t.fileRef,t.id+"."+t.ext),this.isUploading||this.uploader.start(),this._totalCount++,this.dispatch(e.START))},e.prototype.removePhotoItem=function(t){var o=this.getPhotoItemById(t);this.uploader.removeFile(o.fileRef),o.status==s.UPLOAD_FAULT&&this._errorCount--,this._totalCount--,this.dispatch(e.UPDATE)},e.prototype.reUpload=function(t){var o=this.getPhotoItemById(t);o.status==s.UPLOAD_FAULT&&this._errorCount--,this.uploader.removeFile(o.fileRef),this.addPhotoItem(o),this.dispatch(e.UPDATE)},e.prototype.init=function(){this.initOSSUploader()},e.prototype.clear=function(){},e.prototype.destroy=function(){},e.prototype.initOSSUploader=function(){this.uploader=new plupload.Uploader({runtimes:"html5,html4",browse_button:document.getElementById("pluploadFile"),max_retries:1,url:"http://oss.aliyuncs.com",resize:{width:r.BIG_SIZE_PX,height:r.BIG_SIZE_PX,quality:85,preserve_headers:!1},filters:{mime_types:[{title:"Image files",extensions:"jpg,png,jpeg,bmp"}],max_file_size:"15mb",prevent_duplicates:!1}}),this.uploader.bind("PostInit",this.uploader_postInit,this),this.uploader.bind("FilesAdded",this.uploader_filesAdd,this),this.uploader.bind("BeforeUpload",this.uploader_beforeUpload,this),this.uploader.bind("UploadProgress",this.uploader_uploadProgress,this),this.uploader.bind("FileUploaded",this.uploader_fileUploaded,this),this.uploader.bind("Error",this.uploader_uploadError,this),this.uploader.bind("UploadComplete",this.uploader_allUploadComplete,this),this.uploader.disableBrowse(!0),this.uploader.init()},e.prototype.uploader_postInit=function(t){this.uploader=t;var e=n.getInstance().workModel;this.savePath=o.osspath0+o.osspath1()+o.osspath2(e.workId)},e.prototype.uploader_filesAdd=function(t,e){for(var o=0,n=e;o<n.length;o++){var i=n[o];console.log("已添加待上传文件：",i.name)}},e.prototype.uploader_beforeUpload=function(t,e){var o=this.getPhotoItemById(e.name);o.status=s.UPLOADING,o.processedSize=e.size;var n={key:this.savePath+e.name,policy:i.BASE64_POLICY,OSSAccessKeyId:i.ACCESS_KEY_ID,success_action_status:"200",signature:i.ACCESS_SIGN};t.setOption({url:i.HOST,multipart_params:n})},e.prototype.uploader_uploadProgress=function(t,o){var n=this.getPhotoItemById(o.name);n.uploadingPercent=o.percent,this.dispatch(e.UPDATE,n)},e.prototype.uploader_fileUploaded=function(t,o,n){var r=this,a=this.getPhotoItemById(o.name);if(200==n.status){var l="http://"+i.OSS_BUCKECT_NAME+"."+i.OSS_ENDPOINT+"/"+this.savePath+a.id+"."+a.ext,d=function(){r._uploadedCount+r._errorCount==r._totalCount&&r.dispatch(e.FINISHED,null)};this.checkDamage(l).then(function(){a.url=l,a.status=s.UPLOAD_COMPLETE,r.updateRelatedPhotoElementModelsUrl(a),r.savePhotoInfo(a),r._uploadedCount++,console.log("upload to oss success！回调内容：",n.response,a.url),r.dispatch(e.UPDATE,a),d()})["catch"](function(t){a.status=s.UPLOAD_FAULT,a.uploadErrorMsg="数据损坏，请重新上传",r._errorCount++,console.log("上传后照片检测到损坏",l),r.dispatch(e.UPDATE,a),d()})}else a.status=s.UPLOAD_FAULT,a.uploadErrorMsg=n.response,this._errorCount++,console.log("上传失败，原因是:",n.response),this.dispatch(e.UPDATE,a)},e.prototype.checkDamage=function(t){return __awaiter(this,void 0,void 0,function(){var e=this;return __generator(this,function(o){return[2,new Promise(function(o,n){t+="?x-oss-process=image/average-hue";var i=new URLLoader,r=new URLRequest(t);r.method=URLRequestMethod.GET,i.once(a.COMPLETE,function(t){var e=JSON.parse(i.data);e.RGB&&"0x000000"==e.RGB.toString()?n("照片数据已损坏，请重新上传"):o(),console.log("check pho",i.data)},e),i.once(IOErrorEvent.IO_ERROR,function(t){o()},e),i.load(r)})]})})},e.prototype.uploader_uploadError=function(t,o){var n=this.getPhotoItemById(o.file.name);n.status=s.UPLOAD_FAULT,-600==o.code?(n.uploadErrorMsg="文件大小超过上限值",console.log("选择的文件太大了,可以根据应用情况，在upload.js 设置一下上传的最大大小")):-601==o.code?(n.uploadErrorMsg="文件类型不支持",console.log("选择的文件后缀不对,可以根据应用情况，在upload.js进行设置可允许的上传文件类型")):-602==o.code?(n.uploadErrorMsg="文件已经上传过一遍了",console.log("这个文件已经上传过一遍了")):(n.uploadErrorMsg="上传出错："+o.response,console.log("Error xml:\n:ERROR CODE:",o.code,"\n",o.response)),this._errorCount++,this.dispatch(e.UPDATE,n)},e.prototype.uploader_allUploadComplete=function(t,o){console.log("所有上传任务已经完成"),this.dispatch(e.FINISHED,null)},e.prototype.updateRelatedPhotoElementModelsUrl=function(t){for(var e,o=l.getInstance().getModelListByType(d.TYPE_PHOTO),n=0,i=o;n<i.length;n++)e=i[n],e.relatedId==t.id&&(e.url=t.url)},e.prototype.savePhotoInfo=function(t){console.log("supplierInfo",UserModelController.getInstance().userModel.supplierInfo);var e=new c;e.wid=n.getInstance().workModel.workId,e.ph_id=t.id,e.uid=0,e.sp_id=UserModelController.getInstance().userModel.supplierInfo.spId,e.org_name=t.name,e.org_width=t.width,e.org_height=t.height,e.org_size=t.size,e.ext=t.ext,e.url=t.url;var o=new h;o.once(InterfaceEvent.COMPLETE,this.onPhotoSaveResultHandler,this),o.once(InterfaceEvent.FAULT,this.onPhotoSaveResultHandler,this),o.call(e)},e.prototype.onPhotoSaveResultHandler=function(t){t.type==InterfaceEvent.COMPLETE||t.type==InterfaceEvent.FAULT&&console.log(t.data)},e.prototype.getPhotoItemById=function(t){for(var e,o,n=0,i=this._currentPhotoList;n<i.length;n++)if(o=i[n],-1!=t.indexOf(o.id)){e=o;break}return e},e.prototype.dispatch=function(t,e){var o=new a(t,!1,!1,e);this.dispatchEvent(o)},e.getInstance=function(){return this._inst||(this._inst=new e(new m)),this._inst},e.START="start",e.UPDATE="update",e.FINISHED="finished",e}(e);t.PhotoUploadManager=u,__reflect(u.prototype,"managers.PhotoUploadManager");var m=function(){function t(){}return t}();__reflect(m.prototype,"SingletonEnforcer")}(managers||(managers={}));var components;!function(t){var e=eui.Group,o=eui.Rect,n=cdcommon.editor.components.PhotoElement,i=cdcommon.framework.utils.UnitConvertionUtil,r=cdcommon.framework.utils.ScaledConstraintUtil,a=cdcommon.editor.factories.ModelFactory,s=cdcommon.editor.constants.ElementConstant,l=cdcommon.editor.managers.LeftPhotoItemController,d=cdcommon.editor.events.DataLoadedEvent,c=cdcommon.editor.managers.ElementModelController,h=function(t){function h(){var e=t.call(this)||this;return e.scaledValue=1,e.isChildStage=!1,e.pageModel=null,e._defaultWidth=0,e._defaultHeight=0,e._orgWidth=0,e._orgHeight=0,e._clip=!1,e}return __extends(h,t),Object.defineProperty(h.prototype,"clip",{get:function(){return this._clip},set:function(t){t!=this._clip&&(this._clip=t,this.handleClipChange())},enumerable:!0,configurable:!0}),h.prototype.getPhotoModel=function(){return this.orgPhotoModel},h.prototype.getModel=function(){return this.pageModel},h.prototype.getPhotoElement=function(){return this.phoElementComp},h.prototype.rotatePhoto=function(t){void 0===t&&(t="right");var e,o=this.orgPhotoModel.phoRotation;this.orgPhotoModel.phoRotated=!1,"right"==t?(e=0==o?270:o-90,this.orgPhotoModel.phoRotation=e,this.phoElementComp.rotatePhoto(-90,!0)):(e=360==o?90:270==o?0:o+90,this.orgPhotoModel.phoRotation=e,this.phoElementComp.rotatePhoto(90,!0))},h.prototype.updateToRealData=function(){return this._isRealData?void console.log("已经是实际值",this.orgPhotoModel.phoWidth,this.orgPhotoModel.phoHeight):(this.pageModel.clipPhoto=this.clip,this.orgPhotoModel.width=this.orgPhotoModel.width/this.scaledValue,this.orgPhotoModel.height=this.orgPhotoModel.height/this.scaledValue,this.orgPhotoModel.x=this.orgPhotoModel.x/this.scaledValue,this.orgPhotoModel.y=this.orgPhotoModel.y/this.scaledValue,this.orgPhotoModel.phoX=this.orgPhotoModel.phoX/this.scaledValue,this.orgPhotoModel.phoY=this.orgPhotoModel.phoY/this.scaledValue,this.orgPhotoModel.phoWidth=this.orgPhotoModel.phoWidth/this.scaledValue,this.orgPhotoModel.phoHeight=this.orgPhotoModel.phoHeight/this.scaledValue,this.orgPhotoModel.clip=this.clip?1:0,this._isRealData=!0,void console.log("[updateToRealData]",this.pageModel.pageName,this.orgPhotoModel.phoWidth,this.orgPhotoModel.phoHeight))},h.prototype.init=function(t,e){this.pageModel=t,this._clip=t.clipPhoto,this.initStageGroup(),this.initPhotoElement(e)},h.prototype.clear=function(){this.phoElementComp.clear(),this.pageModel=null,this.orgPhotoModel=null,this.scaledValue=1,this._defaultWidth=0,this._defaultHeight=0,this._orgWidth=0,this._orgHeight=0,this.isChildStage=!1},h.prototype.destroy=function(){this.clear(),this.phoElementComp.destroy(),this.removeChildren()},h.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.stageGroup=new e,this.stageGroup.horizontalCenter=0,this.stageGroup.verticalCenter=0,this.phoElementComp=new n,this.phoElementComp.fromChildStage=this.isChildStage;var i=new o;i.touchEnabled=i.touchChildren=!1,i.fillColor=16777215,this.isChildStage?(i.left=i.right=i.top=i.bottom=-1.5,i.strokeColor=4473924,i.strokeWeight=this.isChildStage?1.2:0):i.left=i.right=i.top=i.bottom=0,this.stageGroup.addChild(i),this.stageGroup.addChild(this.phoElementComp),this.addChild(this.stageGroup)},h.prototype.validateForcedly=function(){var t=this.parent;void 0!=t.validateNow&&t.validateNow()},h.prototype.initStageGroup=function(){var t,e,o=this.pageModel.basicPageInfo,n=EditorCommon.DPI;i.mm2px(o.tip_left,n),i.mm2px(o.tip_right,n),i.mm2px(o.tip_top,n),i.mm2px(o.tip_bottom,n);t=i.mm2px(o.bleed_left+o.bleed_right,n),e=i.mm2px(o.bleed_top+o.bleed_bottom,n);var a=i.mm2px(o.design_layer_width,n),s=i.mm2px(o.design_layer_height,n);this._defaultWidth=this.width,this._defaultHeight=this.height;var l=r.getScaledSizeByConstraint([a,s],[this.width,this.height]);this.stageGroup.width=l[0],this.stageGroup.height=l[1],this.scaledValue=l[2],this._isRealData=!1,console.log(this.pageModel.pageName,"缩放值：",this.scaledValue)},h.prototype.handleClipChange=function(){var t=l.getInstance().getModel(this.orgPhotoModel.relatedId);this.initPhotoElement(t)},h.prototype.initPhotoElement=function(t){var e=this;if(this.pageModel&&this.phoElementComp){if(t&&t.thumb_url){this.orgPhotoModel||(this.orgPhotoModel=a.createElementModel(s.TYPE_PHOTO),this.orgPhotoModel.relatedId=t.id,this.pageModel.elementList.addItem(this.orgPhotoModel));var o=t.source?t.source.width:t.width,n=t.source?t.source.height:t.height,l=this.stageGroup.width>this.stageGroup.height,h=o>n,u=l!=h,m=u?n:o,p=u?o:n,f=(i.mm2px(1,EditorCommon.DPI)*this.scaledValue,this.stageGroup.width),g=this.stageGroup.height;if(this.clip)this.orgPhotoModel.width=f,this.orgPhotoModel.height=g,this.orgPhotoModel.phoWidth=this.orgPhotoModel.width,this.orgPhotoModel.phoHeight=this.orgPhotoModel.height,this.orgPhotoModel.phoX=this.orgPhotoModel.phoY=0,this.orgPhotoModel.x=0,this.orgPhotoModel.y=0;else{var v=r.getScaledSizeByConstraint([m,p],[f,g]);this.orgPhotoModel.width=this.orgPhotoModel.phoWidth=v[0],this.orgPhotoModel.height=this.orgPhotoModel.phoHeight=v[1],this.orgPhotoModel.phoWidth=this.orgPhotoModel.width,this.orgPhotoModel.phoHeight=this.orgPhotoModel.height,this.orgPhotoModel.phoX=this.orgPhotoModel.phoY=0,this.orgPhotoModel.x=(f-this.orgPhotoModel.width)/2,this.orgPhotoModel.y=(g-this.orgPhotoModel.height)/2}console.log("重置编辑：",this.pageModel.pageName,this.orgPhotoModel.phoWidth,this.orgPhotoModel.phoHeight);var _=function(i){return __awaiter(e,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return this.phoElementComp.removeEventListener(d.COMPLETE,_,this),[4,this.phoElementComp.importPhoto(t,o,n,!0)];case 1:return e.sent(),u&&(this.orgPhotoModel.phoRotation=90,this.phoElementComp.rotatePhoto(90,!0)),console.log("图片组件初始化完毕",this.pageModel.pageName),[2]}})})};this.phoElementComp.addEventListener(d.COMPLETE,_,this),this.phoElementComp.init(this.orgPhotoModel),this._isRealData=!1}else this.phoElementComp.fromChildStage=!0,this.orgPhotoModel=this.pageModel.elementList.getItemAt(0),console.log("二次编辑：",this.pageModel.pageName,this.orgPhotoModel.phoWidth,this.orgPhotoModel.phoHeight),this.orgPhotoModel.width*=this.scaledValue,this.orgPhotoModel.height*=this.scaledValue,this.orgPhotoModel.phoX*=this.scaledValue,this.orgPhotoModel.phoY*=this.scaledValue,this.orgPhotoModel.phoWidth*=this.scaledValue,this.orgPhotoModel.phoHeight*=this.scaledValue,this.orgPhotoModel.x*=this.scaledValue,this.orgPhotoModel.y*=this.scaledValue,this.orgPhotoModel.rotation=0,this.orgPhotoModel.frameUrl="",this.orgPhotoModel.frameMaskUrl="",this.orgPhotoModel.borderWidth=0,this.phoElementComp.init(this.orgPhotoModel);this.isChildStage&&c.getInstance().addModel(this.orgPhotoModel,this.orgPhotoModel.elementType)}},h}(e);t.PrintStageOverview=h,__reflect(h.prototype,"components.PrintStageOverview")}(components||(components={}));var cdcommon;!function(t){var e;!function(e){var o;!function(e){var o=t.framework.dtos.ResultBaseDTO,n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(o);e.GetUploadSignResultDTO=n,__reflect(n.prototype,"cdcommon.editor.dtos.GetUploadSignResultDTO")}(o=e.dtos||(e.dtos={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(e){var o;!function(e){var o=t.framework.dtos.ParamBaseDTO,n=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.mask_empty_count=0,e.bad_px_count=0,e.is_mobile=0,e}return __extends(e,t),e}(o);e.SaveWorkDataParamDTO=n,__reflect(n.prototype,"cdcommon.editor.dtos.SaveWorkDataParamDTO")}(o=e.dtos||(e.dtos={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(e){var o;!function(e){var o=t.framework.dtos.ParamBaseDTO,n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(o);e.SaveWorkThumbParamDTO=n,__reflect(n.prototype,"cdcommon.editor.dtos.SaveWorkThumbParamDTO")}(o=e.dtos||(e.dtos={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(e){var o;!function(e){var o=t.editor.models.SizeItem,n=t.framework.managers.ModelDataGenerator,i=t.editor.models.PageItem,r=t.editor.constants.PageTypeConstant,a=t.framework.utils.UnitConvertionUtil,s=t.framework.utils.ScaledConstraintUtil,l=function(){function t(){}return t.jsonObj2SizeItem=function(t){var e=new o;
return e.id=t.id,e.name=t.name,e.remark=t.remark,e.type_id=t.type_id,e.spread=parseInt(t.spread),e.dpi=parseInt(t.dpi),t.cover_info&&(e.cover_info=n.fillModelByObject(t.cover_info,new i)),t.inpage_info&&(e.inpage_info=n.fillModelByObject(t.inpage_info,new i)),t.back_info&&(e.back_info=n.fillModelByObject(t.back_info,new i)),e},t.getScaleBySize=function(t,e,o,n,i){if(0==e||0==o||0==n)return 1;var l,d,c,h,u;r.isFace(i)?(l=a.mm2px(t.cover_info.top_layer_width,t.dpi),d=a.mm2px(t.cover_info.top_layer_height,t.dpi)):(l=a.mm2px(t.inpage_info.top_layer_width,t.dpi),d=a.mm2px(t.inpage_info.top_layer_height,t.dpi)),c=a.mm2px(e,n),h=a.mm2px(o,n);var m=s.getScaledSizeByConstraint([c,h],[l,d]);return u=m[2]},t}();e.SizeItemUtil=l,__reflect(l.prototype,"cdcommon.editor.utils.SizeItemUtil")}(o=e.utils||(e.utils={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var components;!function(t){var e=eui.ItemRenderer,o=egret.TouchEvent,n=egret.Event,i=cdcommon.editor.models.PhotoItem,r=cdcommon.editor.constants.PhotoStatus,a=cdcommon.editor.events.PhotoItemRenderEvent,s=cdcommon.framework.models.IconCommonProvider,l=cdcommon.framework.models.GlobalCommon,d=cdcommon.framework.utils.ScaledConstraintUtil,c=function(t){function e(){var e=t.call(this)||this;return e.STATE_WAITING="waiting",e.STATE_UPLOADING="uploading",e.STATE_ERROR="error",e}return __extends(e,t),e.prototype.dataChanged=function(){if(t.prototype.dataChanged.call(this),this.data instanceof i){this._dataModel=this.data,this.applyUploadStatus(),this.imageComp&&(this.imageComp.source=this._dataModel.thumb_url,this.imageComp.visible=!0,this.imageComp.texture&&this.scaleToFit(this.imageComp.texture.textureWidth,this.imageComp.texture.textureHeight)),this._dataModel.selected&&this._dataModel.status!=r.UPLOAD_COMPLETE&&(this._dataModel.selected=!1);var e=this._dataModel.usedCount;this.usedCountDisplay&&(this.usedCountDisplay.visible=this.usedCountDisplay.includeInLayout=e>0,this.usedCountDisplay.text=this._dataModel.usedCount.toString()),this.usedFlagImage&&(this.usedFlagImage.visible=this.usedFlagImage.includeInLayout=e>0),this.borderRect&&(this.borderRect.strokeColor=this._dataModel.selected?16732521:14606046,this.borderRect.strokeWeight=this._dataModel.selected?2:1,this.borderRect.fillAlpha=this._dataModel.selected?.1:0,this.borderRect.fillColor=16732521)}},e.prototype.applyUploadStatus=function(){var t,e=this._dataModel.status;e==r.WAITING?(this._displayState=this.STATE_WAITING,this.imageComp.touchEnabled=!1,t="等待上传"):e==r.UPLOADING?(this._displayState=this.STATE_UPLOADING,this.imageComp.touchEnabled=!1,t="正在上传"+this._dataModel.uploadingPercent+"%"):e==r.UPLOAD_COMPLETE?(this.imageComp.touchEnabled=!0,this._displayState=null,t="上传完毕"):e==r.UPLOAD_FAULT&&(this._displayState=this.STATE_ERROR,this.imageComp.touchEnabled=!1,t="上传失败"),this.stateLabel&&(this.stateLabel.text=t),this.invalidateState()},e.prototype.partAdded=function(e,i){t.prototype.partAdded.call(this,e,i),i==this.imageComp?(this.imageComp.addEventListener(n.COMPLETE,this.onImageDataLoaded,this),this.imageComp.addEventListener(o.TOUCH_TAP,this.onClickHandler,this),this.imageComp.mask=this.imageMask):i==this.deleteButton?this.deleteButton.addEventListener(o.TOUCH_TAP,this.onDeleteHandler,this):i==this.reUploadButton&&this.reUploadButton.addEventListener(o.TOUCH_TAP,this.onReloadHandler,this)},e.prototype.partRemoved=function(e,i){t.prototype.partRemoved.call(this,e,i),i==this.imageComp?(this.imageComp.removeEventListener(n.COMPLETE,this.onImageDataLoaded,this),this.imageComp.removeEventListener(o.TOUCH_TAP,this.onClickHandler,this)):i==this.deleteButton?this.deleteButton.removeEventListener(o.TOUCH_TAP,this.onDeleteHandler,this):i==this.reUploadButton&&this.reUploadButton.removeEventListener(o.TOUCH_TAP,this.onReloadHandler,this)},e.prototype.scaleToFit=function(t,e){var o,n,i=d.getScaledSizeByConstraint([t,e],[this.width,this.height]);t=i[0],e=i[1],o=(this.width-t)/2,n=(this.height-e)/2,this.imageComp.width=t,this.imageComp.height=e,this.imageComp.x=o,this.imageComp.y=n},e.prototype.onImageDataLoaded=function(t){this.scaleToFit(this.imageComp.texture.textureWidth,this.imageComp.texture.textureHeight)},e.prototype.getCurrentState=function(){var e=t.prototype.getCurrentState.call(this);return e=this._displayState?this._displayState:"normal"},e.prototype.onClickHandler=function(t){var e=new a(a.SELECT,!0);e.photoItem=this._dataModel,this.dispatchEvent(e)},e.prototype.onDeleteHandler=function(t){var e;AlertPic.yesLabel="确定",AlertPic.cancelLabel="取消",e=this._dataModel.usedCount>0?AlertPic.showConfirm(s.Alert_WARNING,"该图片已被使用，删除后设计区上对应的照片也会被删除，确定要删除该图片?","提示",AlertPic.YES|AlertPic.CANCEL,l.rootContainer,this.alertDeleteConfirmHandler,this,!0,null,["app.OKButtonSkin","app.CancelButtonSkin"]):AlertPic.showConfirm(s.Alert_WARNING,"确定要删除该图片?","提示",AlertPic.YES|AlertPic.CANCEL,l.rootContainer,this.alertDeleteConfirmHandler,this,!0,null,["app.OKButtonSkin","app.CancelButtonSkin"])},e.prototype.alertDeleteConfirmHandler=function(t){if(t.detail==AlertPic.YES){var e=new a(a.REMOVE,!0);e.photoItem=this._dataModel,this.dispatchEvent(e)}AlertPic.resetLabels()},e.prototype.onReloadHandler=function(){if(this._displayState==this.STATE_ERROR){this._dataModel.status=r.WAITING,this._dataModel.uploadingPercent=0;var t=new a(a.REUPLOAD,!0);t.photoItem=this._dataModel,this.dispatchEvent(t)}},e}(e);t.PhotoItemRenderer=c,__reflect(c.prototype,"components.PhotoItemRenderer")}(components||(components={}));var cdcommon;!function(t){var e;!function(e){var o;!function(e){var o=t.framework.dtos.ResultBaseDTO,n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(o);e.SaveWorkDataResultDTO=n,__reflect(n.prototype,"cdcommon.editor.dtos.SaveWorkDataResultDTO")}(o=e.dtos||(e.dtos={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(e){var o;!function(e){var o=t.editor.models.PhotoItem,n=t.editor.models.PhotoElementModel,i=t.editor.constants.ElementConstant,r=t.editor.components.PhotoElement,a=t.framework.utils.ArrayUtil,s=t.editor.utils.ModelUpdater,l=function(){function t(t){this.leftPhotoItemController=e.LeftPhotoItemController.getInstance()}return t.prototype.init=function(t){this.pageContainerList=t},t.prototype.clear=function(){this.pageContainerList=null},t.prototype.importPhotos=function(o,n,i,r,s){if(void 0===i&&(i=!1),void 0===r&&(r=null),void 0===s&&(s=null),n==t.IMPORT_TYPE_SHAPE)this.importPhotosByPhotoShape(o,i,r,s);else{switch(r||(r=this.getLeftPhotoItemList(o)),s||(s=this.getStageAllPhotoElementList(o)),n){case t.IMPORT_TYPE_DEFAULT_INDEX:for(var l=[];r.length>0;)l.push(r.pop());r=l;break;case t.IMPORT_TYPE_NAME:r=this.leftPhotoItemController.sortModelList(r,e.LeftPhotoItemController.SORT_BY_FILE_NAME_ASC);break;case t.IMPORT_TYPE_RANDOM:r=a.randomize(r)}this.importPhotosHandler(s,r,o)}},t.prototype.importPhotosByAutoLayout=function(){this.importPhotosByPhotoShape(!0,!0)},t.prototype.importPhotosByTemplateChange=function(t){this.importPhotosByPhotoShape(!0,!0,t)},t.prototype.getLeftPhotoItemList=function(t){for(var e,o=this.leftPhotoItemController.getModelList(),n=[],i=0,r=o;i<r.length;i++)e=r[i],t?0==e.usedCount&&n.push(e):n.push(e);return n},t.prototype.clearPhotoElementModel=function(t){t.relatedId&&e.PhotoUsedCountController.getInstance().removeUsed(t.relatedId),t.relatedId=null,t.phoX=0,t.phoY=0,t.phoWidth=t.width,t.phoHeight=t.height,t.source=null,t.url="",t.phoRotation=0,t.phoScale=1,t.phoRotated=!1,s.update(t,"photoCleared")},t.prototype.isEmptyPhotoModel=function(t){var e;return t.url&&""!=t.url||(e=!0),e},t.prototype.getStageAllPhotoModelList=function(){for(var t,o=[],n=e.PageModelController.getInstance().getModelList(),r=0,a=n;r<a.length;r++){t=a[r];var s=e.ElementModelController.getInstance().getModelListByPageId(t.id,i.TYPE_PHOTO);s&&s.length>0&&(o=o.concat(s))}return o},t.prototype.getStageAllPhotoElementList=function(t){var e=[];if(this.pageContainerList)for(var o,n,i=0,a=this.pageContainerList;i<a.length;i++){o=a[i],n=o.childStage.stageGroup;for(var s,l=0;l<n.numChildren;l++){var d=n.getChildAt(l);d instanceof r&&(s=d,t?s.filled||e.push(s):e.push(s))}}return e},t.prototype.importPhotosByPhotoShape=function(e,o,n,i){void 0===o&&(o=!1),void 0===n&&(n=null),void 0===i&&(i=null);var n,i,r,a,s,l=[],d=[],c=[],h=[],u=[],m=[];n||(n=this.getLeftPhotoItemList(e)),i||(i=this.getStageAllPhotoElementList(e));for(var p=0,f=n;p<f.length;p++)r=f[p],s=this.getPhotoShape(r),s==t.HORIZONTAL?l.push(r):s==t.VERTICAL?d.push(r):c.push(r);for(var g=0,v=i;g<v.length;g++)a=v[g],s=this.getPhotoShape(a.getFillData()),s==t.HORIZONTAL?h.push(a):s==t.VERTICAL?u.push(a):m.push(a);var _=[];if(_=_.concat(this.importPhotosHandler(h,l,e)),_=_.concat(this.importPhotosHandler(u,d,e)),_=_.concat(this.importPhotosHandler(m,c,e)),o&&_.length>0){for(var y=[],E=0,C=i;E<C.length;E++)a=C[E],a.filled||y.push(a);this.importPhotosHandler(y,_,e)}},t.prototype.getPhotoShape=function(e){var i;if(e instanceof n)i=e.width>e.height?t.HORIZONTAL:e.width<e.height?t.VERTICAL:t.SQUARE;else if(e instanceof o){var r=e;i=r.source.width>r.source.height?t.HORIZONTAL:r.source.width<r.source.height?t.VERTICAL:t.SQUARE}return i},t.prototype.importPhotosHandler=function(t,e,o){if(e.length>0&&t.length>0)for(var n,i,r=0,a=0,s=0,l=t;s<l.length;s++)if(i=l[s],n=i.getFillData(),e.length>0){var d=e.shift();i.importPhoto(d,d.source.width,d.source.height,!0),r++}else o||(i.clearPhoto(),a++);return e.concat()},t.getInstance=function(){return this._inst||(this._inst=new t(new d)),this._inst},t.IMPORT_TYPE_DEFAULT_INDEX="defaultIndex",t.IMPORT_TYPE_NAME="name",t.IMPORT_TYPE_SHAPE="shape",t.IMPORT_TYPE_RANDOM="random",t.HORIZONTAL="horizontal",t.VERTICAL="vertical",t.SQUARE="square",t}();e.QuickImportPhotosController=l,__reflect(l.prototype,"cdcommon.editor.managers.QuickImportPhotosController");var d=function(){function t(){}return t}();__reflect(d.prototype,"SingletonEnforcer")}(o=e.managers||(e.managers={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(e){var o;!function(e){var o=t.framework.dtos.ParamBaseDTO,n=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.page_count=-1,e}return __extends(e,t),e}(o);e.GetTemplateParamDTO=n,__reflect(n.prototype,"cdcommon.editor.dtos.GetTemplateParamDTO")}(o=e.dtos||(e.dtos={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(e){var o;!function(e){var o=t.framework.dtos.ParamBaseDTO,n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(o);e.GetUploadSignParamDTO=n,__reflect(n.prototype,"cdcommon.editor.dtos.GetUploadSignParamDTO")}(o=e.dtos||(e.dtos={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(e){var o;!function(e){var o=eui.Component,n=eui.UIEvent,i=t.framework.models.GlobalCommon,r=egret.Tween,a=egret.Ease,s=egret.Event,l=function(t){function e(){var e=t.call(this)||this;return e.delay=3e3,e._timeoutID=0,e.visible=!1,e.once(n.CREATION_COMPLETE,e.handleCreationComplete,e),e}return __extends(e,t),e.show=function(t,o,n,r){void 0===t&&(t=""),void 0===o&&(o=2e3),void 0===n&&(n=null),void 0===r&&(r=null),n||(n=i.rootContainer);var a=new e;return e.alert=a,r&&(a.skinName=r),a.msg=t,a.delay=o,a.horizontalCenter=a.verticalCenter=0,n.addChild(a),a},e.hide=function(){return e.alert.remove(),e.alert},e.prototype.remove=function(){this._timeoutID>0&&(egret.clearTimeout(this._timeoutID),this._timeoutID=0,this.playEffect(!1))},e.prototype.handleCreationComplete=function(t){this.textComp.text=this.msg,this.alpha=e.EFFECT_START_ALPHA,this.scaleX=this.scaleY=e.EFFECT_START_SCALE,this.playEffect(!0),this.visible=!0,this._timeoutID=egret.setTimeout(this.playEffect,this,this.delay,!1)},e.prototype.removePopup=function(){this.parent&&this.parent.removeChild(this),this.dispatchEvent(new s("removed"))},e.prototype.playEffect=function(t){var o=this;t?this.scaleX=this.scaleY=this.alpha=1:r.get(this,{loop:!1}).to({scaleX:e.EFFECT_START_SCALE,scaleY:e.EFFECT_START_SCALE,alpha:e.EFFECT_START_ALPHA},e.EFFECT_DURATION,a.sineInOut).call(function(){o.removePopup()})},e.prototype.partAdded=function(e,o){t.prototype.partAdded.call(this,e,o),o==this.backgroundRect},e.prototype.partRemoved=function(e,o){t.prototype.partRemoved.call(this,e,o),o==this.backgroundRect},e.TIP_BLUR_X=7,e.TIP_BLUR_Y=7,e.EFFECT_START_SCALE=1,e.EFFECT_START_ALPHA=.7,e.EFFECT_DURATION=500,e}(o);e.AlertTip=l,__reflect(l.prototype,"cdcommon.framework.components.AlertTip")}(o=e.components||(e.components={}))}(e=t.framework||(t.framework={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(t){var e;!function(t){var e=function(){function e(){}return Object.defineProperty(e.prototype,"formatString",{get:function(){return this._formatString},set:function(t){this._formatString=t},enumerable:!0,configurable:!0}),e.setValue=function(t,e){var o="",n=t.toString().length;if(e>n)for(var i=e-n,r=0;i>r;r++)o+="0";return o+=t.toString()},e.extractTokenDate=function(t,o){var n,i,r="",a=parseFloat(o.end)-parseFloat(o.begin);switch(o.token){case"Y":var s=t.getFullYear().toString();return 3>a?s.substr(2):a>4?e.setValue(Number(s),a):s;case"M":var l=t.getMonth();return 3>a?(l++,r+=e.setValue(l,a)):3==a?e.monthNamesShort[l]:e.monthNamesLong[l];case"D":return n=t.getDate(),r+=e.setValue(n,a);case"E":return n=t.getDay(),3>a?r+=e.setValue(n,a):3==a?e.dayNamesShort[n]:e.dayNamesLong[n];case"A":return i=t.getHours(),12>i?e.timeOfDay[0]:e.timeOfDay[1];case"H":return i=t.getHours(),0==i&&(i=24),r+=e.setValue(i,a);case"J":return i=t.getHours(),r+=e.setValue(i,a);case"K":return i=t.getHours(),i>=12&&(i-=12),r+=e.setValue(i,a);case"L":return i=t.getHours(),0==i?i=12:i>12&&(i-=12),r+=e.setValue(i,a);case"N":var d=t.getMinutes();return r+=e.setValue(d,a);case"S":var c=t.getSeconds();return r+=e.setValue(c,a);case"Q":var h=t.getMilliseconds();return r+=e.setValue(h,a)}return r},e.parseDateString=function(t){if(!t||""==t)return null;var o=-1,n=-1,i=-1,r=-1,a=-1,s=-1,l="",d=0,c=0,h=t.length,u=/(GMT|UTC)((\+|-)\d\d\d\d )?/gi;for(t=t.replace(u,"");h>c;)if(l=t.charAt(c),c++,!(" ">=l||","==l))if("/"!=l&&":"!=l&&"+"!=l&&"-"!=l){if(l>="a"&&"z">=l||l>="A"&&"Z">=l){for(var m=l;h>c&&(l=t.charAt(c),l>="a"&&"z">=l||l>="A"&&"Z">=l);)m+=l,c++;for(var p=e.defaultStringKey.length,f=0;p>f;f++){var g=e.defaultStringKey[f];if(g.toLowerCase()==m.toLowerCase()||g.toLowerCase().substr(0,3)==m.toLowerCase()){if(13==f){if(r>12||1>r)break;12>r&&(r+=12)}else if(12==f){if(r>12||1>r)break;12==r&&(r=0)}else if(12>f){if(!(0>n))break;n=f}break}}d=0}else if(l>="0"&&"9">=l){for(var v=l;"0"<=(l=t.charAt(c))&&"9">=l&&h>c;)v+=l,c++;var _=parseFloat(v);if(_>=70){if(-1!=o)break;if(!(" ">=l||","==l||"."==l||"/"==l||"-"==l||c>=h))break;o=_}else if("/"==l||"-"==l||"."==l)if(0>n)n=_-1;else{if(!(0>i))break;i=_}else if(":"==l)if(0>r)r=_;else{if(!(0>a))break;a=_}else if(r>=0&&0>a)a=_;else if(a>=0&&0>s)s=_;else if(0>i)i=_;else{if(!(0>o&&n>=0&&i>=0))break;o=2e3+_}d=0}}else d=l;if(0>o||0>n||n>11||1>i||i>31)return null;0>s&&(s=0),0>a&&(a=0),0>r&&(r=0);var y=new Date(o,n,i,r,a,s);return i!=y.getDate()||n!=y.getMonth()?null:y},e.prototype.format=function(o){if(!o||"string"==typeof o&&""==o)return"";if("string"==typeof o){if(o=e.parseDateString(o),!o)return""}else if(!(o instanceof Date))return"";for(var n,i=0,r="",a=this.formatString.length,s=0;a>s;s++)if(n=this.formatString.charAt(s),-1!=e.VALID_PATTERN_CHARS.indexOf(n)&&","!=n)if(i++,-1==r.indexOf(n))r+=n;else if(n!=this.formatString.charAt(Math.max(s-1,0)))return"";if(1>i)return"";var l=new t.StringFormatter(this.formatString,e.VALID_PATTERN_CHARS,e.extractTokenDate);return l.formatValue(o)},e.defaultStringKey=["January","February","March","April","May","June","July","August","September","October","November","December","AM","PM"],e.dayNamesShort=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],e.dayNamesLong=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],e.monthNamesShort=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],e.monthNamesLong=["January","February","March","April","May","June","July","August","September","October","November","December"],e.timeOfDay=["AM","PM"],e.VALID_PATTERN_CHARS="Y,M,D,A,E,H,J,K,L,N,S,Q",e}();t.DateFormatter=e,__reflect(e.prototype,"cdcommon.framework.utils.DateFormatter")}(e=t.utils||(t.utils={}))}(e=t.framework||(t.framework={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(e){var o;!function(e){var o=egret.URLRequest,n=egret.URLRequestMethod,i=egret.URLVariables,r=t.framework.constants.APIConstant,a=t.framework.managers.APIConfig,s=t.framework.events.InterfaceEvent,l=t.framework.services.InterfaceBase,d=t.framework.utils.APIUtils,c=t.editor.dtos.GetTemplateParamDTO,h=t.editor.dtos.GetTemplateResultDTO,u=t.framework.managers.ModelDataGenerator,m=t.editor.utils.SizeItemUtil,p=t.editor.models.TPageItem,f=function(t){function e(e){return t.call(this,e)||this}return __extends(e,t),e.prototype.call=function(e){if(t.prototype.call.call(this,e),e instanceof c){var s=e;this.request=new o(a.getItem(r.GET_TEMPLATE).url),this.request.method=n.POST;var l=new i;l.variables={},l.variables.tid=s.tid,l.variables.product_id=s.product_id,l.variables.page_count=s.page_count,this.request.data=l,this.loader.load(this.request)}},e.prototype.onResultHandler=function(t){try{var e=JSON.parse(this.loader.data),o=d.json2ResultDTO(e,new h);if(o.success){var n=o.results[0];o.name=n.name,o.thickness=parseInt(n.thickness),o.size_item=m.jsonObj2SizeItem(n.size_item),o.theme_id=n.theme_id,o.theme_name=n.theme_name,o.thumb_url=n.thumb_url,o.pages=this.getPageList(n.pages),o.first_year=n.first_year,this.callback(s.COMPLETE,o)}else this.callback(s.FAULT,"获取模版信息发生错误\n(ERROR_CODE="+o.err_code+"MSG="+o.err_msg+")")}catch(i){this.callback(s.FAULT,"解析返回结果出错："+i.message)}},e.prototype.onFaultHandler=function(t){this.callback(s.FAULT,"接口IO错误！")},e.prototype.getPageList=function(t){for(var e=[],o=0,n=t;o<n.length;o++){var i=n[o],r=u.fillModelByObject(i,new p,!1);e.push(r)}return e},e}(l);e.GetTemplateInterface=f,__reflect(f.prototype,"cdcommon.editor.services.GetTemplateInterface")}(o=e.services||(e.services={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(e){var o;!function(e){var o=egret.URLRequest,n=egret.URLRequestMethod,i=t.framework.constants.APIConstant,r=t.framework.managers.APIConfig,a=t.framework.events.InterfaceEvent,s=t.framework.services.InterfaceBase,l=t.framework.utils.APIUtils,d=t.editor.dtos.GetUploadSignResultDTO,c=egret.URLVariables,h=function(t){function e(e){return t.call(this,e)||this}return __extends(e,t),e.prototype.call=function(e){t.prototype.call.call(this,e),this.request=new o(r.getItem(i.GET_UPLOAD_SIGN).url),this.request.method=n.POST;var a=e,s=new c;s.variables={},s.variables.str=a.str,this.request.data=s,this.loader.load(this.request)},e.prototype.onResultHandler=function(t){try{var e=JSON.parse(this.loader.data),o=l.json2ResultDTO(e,new d);if(o.success){var n=o.results[0];o.sign=n.sign,this.callback(a.COMPLETE,o)}else this.callback(a.FAULT,"获取上传签名过程发生错误\n(ERROR_CODE="+o.err_code+"MSG="+o.err_msg+")")}catch(i){this.callback(a.FAULT,"解析返回结果出错："+i.message)}},e.prototype.onFaultHandler=function(t){this.callback(a.FAULT,"接口IO错误！")},e}(s);e.GetUploadSignInterface=h,__reflect(h.prototype,"cdcommon.editor.services.GetUploadSignInterface")}(o=e.services||(e.services={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(t){var e;!function(t){var e=function(){function t(){}return t.WEI_SHANG=1,t.TMALL=2,t.TAOBAO=3,t.JD=4,t.OFFINE_SHOP=5,t.EXTERNAL_SHOP=9,t}();t.AgentShopTypeConstant=e,__reflect(e.prototype,"cdcommon.framework.constants.AgentShopTypeConstant")}(e=t.constants||(t.constants={}))}(e=t.framework||(t.framework={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(t){var e;!function(t){var e=function(){function t(){}return t.trim=function(e){if(null==e)return"";for(var o=0;t.isWhitespace(e.charAt(o));)++o;for(var n=e.length-1;t.isWhitespace(e.charAt(n));)--n;return n>=o?e.slice(o,n+1):""},t.isWhitespace=function(t){switch(t){case" ":case"	":case"\r":case"\n":case"\f":return!0;default:return!1}},t}();t.StringUtil=e,__reflect(e.prototype,"cdcommon.framework.utils.StringUtil")}(e=t.utils||(t.utils={}))}(e=t.framework||(t.framework={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(e){var o;!function(e){var o=t.framework.dtos.ResultBaseDTO,n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(o);e.GetWorkIDResultDTO=n,__reflect(n.prototype,"cdcommon.editor.dtos.GetWorkIDResultDTO")}(o=e.dtos||(e.dtos={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(t){var e;!function(t){var e=function(){function t(){this.user_name="",this.order_id="",this.tel_num="",this.remark="",this.full_name="",this.address_detail="",this.location_id_str="",this.buy_quantity=1}return t}();t.WorkExtraInfo=e,__reflect(e.prototype,"cdcommon.editor.models.WorkExtraInfo")}(e=t.models||(t.models={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(t){var e;!function(t){var e=function(){function t(){this.agent_id="",this.group_id="",this.true_name="",this.shop_name="",this.shop_url="",this.shop_type_id=0,this.mobile="",this.qq="",this.email="",this.status=0}return t}();t.AgentInfo=e,__reflect(e.prototype,"cdcommon.framework.models.AgentInfo")}(e=t.models||(t.models={}))}(e=t.framework||(t.framework={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(e){var o;!function(e){var o=egret.URLRequest,n=egret.URLRequestMethod,i=t.framework.constants.APIConstant,r=t.framework.managers.APIConfig,a=t.framework.events.InterfaceEvent,s=t.framework.services.InterfaceBase,l=t.framework.utils.APIUtils,d=egret.URLVariables,c=t.editor.dtos.SaveWorkDataParamDTO,h=t.editor.dtos.SaveWorkDataResultDTO,u=t.editor.models.WCPageIdItem,m=t.framework.managers.ModelDataGenerator,p=function(t){function e(e){return t.call(this,e)||this}return __extends(e,t),e.prototype.call=function(e){if(t.prototype.call.call(this,e),e instanceof c){var a=e;this.request=new o(r.getItem(i.SAVE_WORK_DATA).url),this.request.method=n.POST;var s=new d;s.variables={},s.variables.wid=a.wid,s.variables.uid=a.uid,s.variables.agent_id=a.agent_id,s.variables.sp_id=UserModelController.getInstance().userModel.supplierInfo.spId,s.variables.tsid=a.tsid,s.variables.pid=a.pid,s.variables.work_name=a.work_name,s.variables.work_extra_info=a.work_extra_info,s.variables.mask_empty_count=a.mask_empty_count,s.variables.bad_px_count=a.bad_px_count,s.variables.is_mobile=a.is_mobile,s.variables.mask_total_count=a.mask_total_count,s.variables.pages=a.pages,s.variables.is_submit=a.is_submit,s.variables.sys_version=a.sys_version,s.variables.sub_system=a.sub_system,this.request.data=s,this.loader.load(this.request)}},e.prototype.onResultHandler=function(t){try{var e=JSON.parse(this.loader.data),o=l.json2ResultDTO(e,new h);if(o.success){var n=o.results[0];o.page_ids=this.getPageIdItemList(n.page_ids),this.callback(a.COMPLETE,o)}else this.callback(a.FAULT,"保存作品数据过程发生错误！\n(ERROR_CODE="+o.err_code+"MSG="+o.err_msg+")")}catch(i){this.callback(a.FAULT,"解析返回结果出错："+i.message)}},e.prototype.onFaultHandler=function(t){this.callback(a.FAULT,"接口IO错误！")},e.prototype.getPageIdItemList=function(t){for(var e=[],o=0,n=t;o<n.length;o++){var i=n[o],r=m.fillModelByObject(i,new u);e.push(r)}return e},e}(s);e.SaveWorkDataInterface=p,__reflect(p.prototype,"cdcommon.editor.services.SaveWorkDataInterface")}(o=e.services||(e.services={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(e){var o;!function(e){var o=egret.URLRequest,n=egret.URLRequestMethod,i=t.framework.constants.APIConstant,r=t.framework.managers.APIConfig,a=t.framework.events.InterfaceEvent,s=t.framework.services.InterfaceBase,l=t.framework.utils.APIUtils,d=egret.URLVariables,c=t.editor.dtos.SaveWorkThumbParamDTO,h=t.editor.dtos.SaveWorkThumbResultDTO,u=function(t){function e(e){return t.call(this,e)||this}return __extends(e,t),e.prototype.call=function(e){if(t.prototype.call.call(this,e),e instanceof c){var a=e;this.request=new o(r.getItem(i.SAVE_WORK_THUMB).url),this.request.method=n.POST;var s=new d;s.variables={},s.variables.id=a.id,s.variables.thumb=a.base64Str,this.request.data=s,this.loader.load(this.request)}},e.prototype.onResultHandler=function(t){try{var e=JSON.parse(this.loader.data),o=l.json2ResultDTO(e,new h);o.success?this.callback(a.COMPLETE,o):this.callback(a.FAULT,"保存作品预览图过程发生错误！\n(ERROR_CODE="+o.err_code+"MSG="+o.err_msg+")")}catch(n){this.callback(a.FAULT,"解析返回结果出错："+n.message)}},e.prototype.onFaultHandler=function(t){this.callback(a.FAULT,"接口IO错误！")},e}(s);e.SaveWorkThumbInterface=u,__reflect(u.prototype,"cdcommon.editor.services.SaveWorkThumbInterface")}(o=e.services||(e.services={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var components;!function(t){var e=eui.Component,o=cdcommon.framework.components.AlertPic,n=cdcommon.framework.models.IconCommonProvider,i=egret.Event,r=eui.ArrayCollection,a=cdcommon.framework.services.GetLocationListInterface,s=cdcommon.framework.dtos.GetLocationListParamDTO,l=cdcommon.framework.events.InterfaceEvent,d=function(t){function e(){var e=t.call(this)||this;return e.selectedProviceId=null,e.selectedCityId=null,e.selectedDistrId=null,e}return __extends(e,t),e.prototype.isAllSelected=function(){var t;return this.provinceCB.selectedItem.id&&this.cityCB.selectedItem.id&&this.districtCB.selectedItem.id?t=!0:this.provinceCB.selectedItem.id&&null==this.districtCB.selectedItem.id&&1==this.districtCB.dataProvider.length&&(t=!0),t},e.prototype.getSelectedItems=function(){var t=[];return this.provinceCB.selectedItem.id&&t.push(this.locationVO2Object(this.provinceCB.selectedItem)),this.cityCB.selectedItem.id&&t.push(this.locationVO2Object(this.cityCB.selectedItem)),this.districtCB.selectedItem.id&&t.push(this.locationVO2Object(this.districtCB.selectedItem)),t},e.prototype.init=function(t){if(void 0===t&&(t=null),t&&""!=t)try{var e=JSON.parse(t.toString());if(e instanceof Array){var i=e[0],r=e[1],a=void 0;3==e.length&&(a=e[2]),i&&(this.selectedProviceId=this.object2LocationVO(i).id),r&&(this.selectedCityId=this.object2LocationVO(r).id),a&&(this.selectedDistrId=this.object2LocationVO(a).id),this.getProvinceList(),this.getCityList(this.selectedProviceId),this.getDistrictList(this.selectedCityId)}}catch(s){o.show(n.Alert_ERROR,"解析地址信息出错，Error="+s.message,"系统错误")}else this.getProvinceList()},e.prototype.clear=function(){this.selectedProviceId=this.selectedCityId=this.selectedDistrId=null},e.prototype.destroy=function(){this.clear()},e.prototype.partAdded=function(e,o){t.prototype.partAdded.call(this,e,o),o==this.provinceCB?(this.provinceCB.labelFunction=function(t){return t.name},this.provinceCB.dataProvider=this.getDefaultDataProvider(1),this.provinceCB.addEventListener(i.CHANGE,this.onProvinceSelectChange,this)):o==this.cityCB?(this.cityCB.labelFunction=function(t){return t.name},this.cityCB.dataProvider=this.getDefaultDataProvider(2),this.cityCB.addEventListener(i.CHANGE,this.onCitySelectChange,this)):o==this.districtCB&&(this.districtCB.labelFunction=function(t){return t.name},this.districtCB.dataProvider=this.getDefaultDataProvider(3))},e.prototype.partRemoved=function(e,o){t.prototype.partRemoved.call(this,e,o),o==this.provinceCB?(this.provinceCB.labelFunction=null,this.provinceCB.removeEventListener(i.CHANGE,this.onProvinceSelectChange,this)):o==this.cityCB?(this.cityCB.labelFunction=null,this.cityCB.removeEventListener(i.CHANGE,this.onCitySelectChange,this)):o==this.districtCB&&(this.districtCB.labelFunction=null)},e.prototype.onProvinceSelectChange=function(t){var e=this.provinceCB.selectedItem.id;if(e){var o=this.provinceCB.dataProvider;null==o.getItemAt(0).id&&o.removeItemAt(0),this.getCityList(e)}},e.prototype.onCitySelectChange=function(t){var e=this.cityCB.selectedItem.id;e&&this.getDistrictList(e)},e.prototype.getProvinceList=function(){console.log("getProvinceList");var t=new a;t.once(l.COMPLETE,this.onGetProviceResultHandler,this),t.once(l.FAULT,this.onGetProviceResultHandler,this);var e=new s;e.id="",e.getType=1,t.call(e)},e.prototype.getCityList=function(t){var e=new a;e.once(l.COMPLETE,this.onGetCityResultHandler,this),e.once(l.FAULT,this.onGetCityResultHandler,this);var o=new s;o.id=t,o.getType=2,e.call(o)},e.prototype.getDistrictList=function(t){var e=new a;e.once(l.COMPLETE,this.onGetDistrictResultHandler,this),e.once(l.FAULT,this.onGetDistrictResultHandler,this);var o=new s;o.id=t,o.getType=3,e.call(o)},e.prototype.onGetProviceResultHandler=function(t){if(this.provinceCB)if(t.type==l.COMPLETE){var e=t.data;if(console.log("获取省份信息成功！"),e.list&&e.list.length>0){for(var i=this.provinceCB.dataProvider,r=0,a=0,s=e.list;a<s.length;a++){var d=s[a],c=this.object2LocationVO(d);i.addItem(c),this.selectedProviceId&&c.id==this.selectedProviceId&&(r=i.getItemIndex(c))}this.provinceCB.selectedIndex=r}}else o.show(n.Alert_ERROR,"获取省份信息失败！请尝试更换省份选项。Error: "+t.data,"信息获取失败")},e.prototype.onGetCityResultHandler=function(t){if(t.type==l.COMPLETE){var e=t.data;if(console.log("获取城市信息成功！"),e.list&&e.list.length>0){for(var i=new r,a=0,s=0,d=e.list;s<d.length;s++){var c=d[s],h=this.object2LocationVO(c);i.addItem(h),this.selectedCityId&&h.id==this.selectedCityId&&(a=i.getItemIndex(h))}this.cityCB.dataProvider=i,this.cityCB.selectedIndex=a,this.onCitySelectChange(null)}}else o.show(n.Alert_ERROR,"获取城市信息失败！请尝试关闭窗口重新保存。Error: "+t.data,"信息获取失败")},e.prototype.onGetDistrictResultHandler=function(t){if(t.type==l.COMPLETE){var e=t.data;if(console.log("获取区域信息成功！"),e.list&&e.list.length>0){for(var i=new r,a=0,s=0,d=e.list;s<d.length;s++){var c=d[s],h=this.object2LocationVO(c);i.addItem(h),this.selectedDistrId&&h.id==this.selectedDistrId&&(a=i.getItemIndex(h))}this.districtCB.dataProvider=i,this.districtCB.selectedIndex=a}}else o.show(n.Alert_ERROR,"获取区域信息失败！请尝试关闭窗口重新保存。Error: "+t.data,"信息获取失败")},e.prototype.getDefaultDataProvider=function(t){var e=new r,o=new LocationVO;return 1==t?o.name="选择省份":2==t?o.name="选择城市":o.name="选择区域",e.addItem(o),e},e.prototype.object2LocationVO=function(t){var e=new LocationVO;return e.id=t.id,e.name=t.name,e},e.prototype.locationVO2Object=function(t){var e={};return e.id=t.id,e.name=t.name,e},e}(e);t.LocationSelectionBar=d,__reflect(d.prototype,"components.LocationSelectionBar",["cdcommon.framework.interfaces.IComponent","eui.UIComponent","egret.DisplayObject"])}(components||(components={}));var LocationVO=function(){function t(){}return t}();__reflect(LocationVO.prototype,"LocationVO");var cdcommon;!function(t){var e;!function(t){var e;!function(t){var e=function(){function t(){this.spId="",this.spName="",this.logoUrl="",this.siteUrl="",this.contactName="",this.phoneNum="",this.telNum="",this.qq="",this.email="",this.styleId=""}return t}();t.SupplierInfo=e,__reflect(e.prototype,"cdcommon.framework.models.SupplierInfo")}(e=t.models||(t.models={}))}(e=t.framework||(t.framework={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(t){var e;!function(t){var e=function(){function t(){this.id="",this.tid="",this.type=0,this.index=0,this.name="",this.mask_count=0,this.stage_content=""}return t}();t.WPageItem=e,__reflect(e.prototype,"cdcommon.editor.models.WPageItem")}(e=t.models||(t.models={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(t){var e;!function(t){var e=eui.Component,o=function(t){function e(){return t.call(this)||this}return __extends(e,t),Object.defineProperty(e.prototype,"sceneName",{get:function(){return null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pm",{get:function(){return null
},enumerable:!0,configurable:!0}),e.prototype.validateForcedly=function(){var t=this.parent;void 0!=t.validateNow&&t.validateNow()},e.prototype.init=function(t){},e.prototype.clear=function(){},e.prototype.destroy=function(){this.clear()},e}(e);t.SceneBase=o,__reflect(o.prototype,"cdcommon.framework.views.SceneBase",["cdcommon.framework.interfaces.IComponent","eui.UIComponent","egret.DisplayObject"])}(e=t.views||(t.views={}))}(e=t.framework||(t.framework={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(t){var e;!function(t){var e=function(){function t(){this.name="",this.typeId="",this.productId="",this.productItem=null,this.productItemList=null,this.sizeItem=null,this.thumbUrl="",this.minImageCount=0,this.maxImageCount=0,this.pageCount=0,this.maxPageCount=0,this.addPageSpan=0,this.allowPageAdjustment=!1}return t}();t.GoodsModel=e,__reflect(e.prototype,"cdcommon.editor.models.GoodsModel")}(e=t.models||(t.models={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var views;!function(t){var e=eui.Component,o=egret.TouchEvent,n=egret.Event,i=components.PrintStageOverview,r=cdcommon.framework.managers.PopUpManager,a=cdcommon.framework.models.IconCommonProvider,s=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.getModel=function(){return this.pageModel},e.prototype.updatePageInfo=function(t){console.log("updatePageInfo",this.pageModel),this.pageInfoDisplay&&(this.pageInfoDisplay.text=this.pageModel.pageIndex+1+"/"+t)},e.prototype.init=function(t,e,o,n){if(this.validateForcedly(),this.pageModel=t,this.callbackFun=o,this.hostObj=n,this.clipRadioButtonGroup.selectedValue=t.clipPhoto?1:0,this.childStage.init(t),t.clipPhoto){var i=this.childStage.getPhotoElement();i.editing=!0}this.updatePageInfo(e),this.updateRotationEnabled()},e.prototype.clear=function(){this.childStage.clear(),this.callbackFun=null,this.hostObj=null},e.prototype.destroy=function(){this.clear()},e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.stageGroup&&(this.childStage=new i,this.childStage.percentWidth=100,this.childStage.percentHeight=100,this.childStage.isChildStage=!1,this.stageGroup.addChild(this.childStage))},e.prototype.partAdded=function(e,i){t.prototype.partAdded.call(this,e,i),i==this.closeButton?this.closeButton.addEventListener(o.TOUCH_TAP,this.onCloseButtonClick,this):i==this.submitButton?this.submitButton.addEventListener(o.TOUCH_TAP,this.onSubmitButtonClick,this):i==this.phoLeftRotateButton?this.phoLeftRotateButton.addEventListener(o.TOUCH_TAP,this.onPhotoRotateHandler,this):i==this.phoRightRotateButton?this.phoRightRotateButton.addEventListener(o.TOUCH_TAP,this.onPhotoRotateHandler,this):i==this.clipRadioButtonGroup?this.clipRadioButtonGroup.addEventListener(n.CHANGE,this.onClipSelectionChange,this):i==this.nextPageButton?this.nextPageButton.addEventListener(o.TOUCH_TAP,this.onPageChangeHandler,this):i==this.previousPageButton?this.previousPageButton.addEventListener(o.TOUCH_TAP,this.onPageChangeHandler,this):i==this.deleteButton&&this.deleteButton.addEventListener(o.TOUCH_TAP,this.onDeleteHandler,this)},e.prototype.partRemoved=function(e,i){t.prototype.partRemoved.call(this,e,i),i==this.closeButton?this.closeButton.removeEventListener(o.TOUCH_TAP,this.onCloseButtonClick,this):i==this.submitButton?this.submitButton.removeEventListener(o.TOUCH_TAP,this.onSubmitButtonClick,this):i==this.phoLeftRotateButton?this.phoLeftRotateButton.removeEventListener(o.TOUCH_TAP,this.onPhotoRotateHandler,this):i==this.phoRightRotateButton?this.phoRightRotateButton.removeEventListener(o.TOUCH_TAP,this.onPhotoRotateHandler,this):i==this.clipRadioButtonGroup?this.clipRadioButtonGroup.removeEventListener(n.CHANGE,this.onClipSelectionChange,this):i==this.nextPageButton?this.nextPageButton.removeEventListener(o.TOUCH_TAP,this.onPageChangeHandler,this):i==this.previousPageButton?this.previousPageButton.removeEventListener(o.TOUCH_TAP,this.onPageChangeHandler,this):i==this.deleteButton&&this.deleteButton.removeEventListener(o.TOUCH_TAP,this.onDeleteHandler,this)},e.prototype.onSubmitButtonClick=function(t){this.closeView()},e.prototype.onCloseButtonClick=function(t){this.closeView()},e.prototype.onPhotoRotateHandler=function(t){var e=t.target==this.phoLeftRotateButton?"left":"right";this.childStage.rotatePhoto(e)},e.prototype.onClipSelectionChange=function(t){1==this.clipRadioButtonGroup.selectedValue?this.childStage.clip=!0:this.childStage.clip=!1,this.updateRotationEnabled();var e=this.childStage.getPhotoElement();e.editing=this.childStage.clip},e.prototype.onPageChangeHandler=function(t){var o;o=new n(t.target==this.nextPageButton?e.EVENT_NEXT_PAGE:e.EVENT_PREVIOUS_PAGE),this.dispatchEvent(o)},e.prototype.onDeleteHandler=function(t){var o=this;AlertPic.yesLabel="确定",AlertPic.cancelLabel="取消";var i=function(t){if(t.detail==AlertPic.YES){var i=new n(e.EVENT_DELETE_PAGE,!0);i.data=o.pageModel,o.dispatchEvent(i)}AlertPic.resetLabels()};AlertPic.showConfirm(a.Alert_WARNING,"确定要删除该照片?","提示",AlertPic.YES|AlertPic.CANCEL,GlobalCommon.rootContainer,i,this,!0,null,["app.OKButtonSkin","skins.ButtonSkin"])},e.prototype.closeView=function(){this.childStage.updateToRealData(),this.callbackFun&&this.callbackFun.apply(this.hostObj,[this.pageModel]),this.clear(),r.removePopUp(this)},e.prototype.validateForcedly=function(){var t=this.parent;void 0!=t.validateNow&&t.validateNow()},e.prototype.centerStageOverview=function(){var t=this.childStage.stageGroup.width,e=this.childStage.stageGroup.height,o=(this.stageGroup.width-t)/2,n=(this.stageGroup.height-e)/2;this.childStage.x=o,this.childStage.y=n},e.prototype.updateRotationEnabled=function(){this.phoLeftRotateButton&&(this.phoLeftRotateButton.enabled=this.childStage.clip),this.phoRightRotateButton&&(this.phoRightRotateButton.enabled=this.childStage.clip)},e.EVENT_NEXT_PAGE="nextPage",e.EVENT_PREVIOUS_PAGE="previousPage",e.EVENT_DELETE_PAGE="deletePage",e}(e);t.PageEditorView=s,__reflect(s.prototype,"views.PageEditorView")}(views||(views={}));var cdcommon;!function(t){var e;!function(t){var e;!function(t){var e=function(){function t(){this.id=0,this.name="",this.infos=null}return t}();t.ProductItem=e,__reflect(e.prototype,"cdcommon.editor.models.ProductItem")}(e=t.models||(t.models={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var views;!function(t){var e=eui.Component,o=eui.Button,n=egret.TouchEvent,i=eui.ArrayCollection,r=egret.Event,a=cdcommon.editor.managers.PhotoUsedCountController,s=cdcommon.editor.managers.PhotoDataLoadMananger,l=utils.PhotoBrowser,d=cdcommon.editor.managers.LeftPhotoItemController,c=managers.PhotoUploadManager,h=cdcommon.editor.events.PhotoUsedCountEvent,u=cdcommon.editor.events.PhotoItemRenderEvent,m=cdcommon.editor.managers.ElementModelController,p=cdcommon.editor.managers.QuickImportPhotosController,f=cdcommon.editor.constants.ElementConstant,g=cdcommon.framework.components.AlertTip,v=components.PhotoItemRenderer,_=utils.MouseScroller,y=cdcommon.framework.models.IconCommonProvider,E=function(e){function E(){var t=e.call(this)||this;return t.photoItemList=new i,t.selectedPhotoItemArr=[],t.photoBrowser=l.getInstance(),t.photoBrowser.addEventListener(l.ADD,t.onPhotoBrowserResult,t),t.photoDataLoadManager=new s,t.photoDataLoadManager.addEventListener(s.COMPLETE,t.onPhotoDataLoadResult,t),t.photoDataLoadManager.addEventListener(s.PROGRESS,t.onPhotoDataLoadResult,t),t.photoDataLoadManager.addEventListener(s.ERROR,t.onPhotoDataLoadResult,t),t.photoUploadManager=c.getInstance(),t.photoUploadManager.addEventListener(c.START,t.onPhotoUploadResult,t),t.photoUploadManager.addEventListener(c.UPDATE,t.onPhotoUploadResult,t),t.photoUploadManager.addEventListener(c.FINISHED,t.onPhotoUploadResult,t),t.photoUploadManager.init(),t.countController=a.getInstance(),t.countController.addEventListener(h.ADD,t.onPhotoUsedCountChange,t),t.countController.addEventListener(h.REMOVE,t.onPhotoUsedCountChange,t),t}return __extends(E,e),E.prototype.getPhotoList=function(){return this.photoItemList},E.prototype.containsItem=function(t){for(var e,o,n=0,i=this.photoItemList.source;n<i.length;n++)if(o=i[n],o.id==t){e=!0;break}return e},E.prototype.addPhotoItem=function(t){"list"!=this._displayState&&(this._displayState="list",this.invalidateState()),this.photoItemList.addItem(t),d.getInstance().addModel(t),t.index=this.photoItemList.getItemIndex(t),this.updatePhotoInfoDisplay(),this.selectAllCheckBox.selected=!1},E.prototype.removePhotoItem=function(e,o){this.photoUploadManager.removePhotoItem(e.id);for(var n,i,a=e,s=m.getInstance().getModelListByType(f.TYPE_PHOTO),l=0,c=s;l<c.length;l++)i=c[l],n=i,n&&n.relatedId==a.id&&p.getInstance().clearPhotoElementModel(n);d.getInstance().removeModel(a.id),a.source&&(a.source=null),a.thumb_url&&(a.thumb_url=null),a.processedbytes&&(a.processedbytes.clear(),a.processedbytes=null),a.fileRef&&(a.fileRef=null);var h=this.photoItemList.getItemIndex(a);this.photoItemList.removeItemAt(h);var u=this.selectedPhotoItemArr.indexOf(a);-1!=u&&this.selectedPhotoItemArr.splice(u,1),this.updatePhotoInfoDisplay(),this.selectAllCheckBox.selected=!1,o&&g.show("删除成功！",1e3);var v=new r(t.PhotoManagerPanel.EVENT_CHILD_REMOVED,!0);v.data=a,this.dispatchEvent(v)},E.prototype.init=function(t){this.listScroller&&!this.mouseScroller&&(this.mouseScroller=_.getInstance(),this.mouseScroller.init(this.stage),this.mouseScroller.bind(this.listScroller)),this.updateItemRenderers(),egret.callLater(this.fillContent,this)},E.prototype.clear=function(){this.clearSelection()},E.prototype.destroy=function(){this.clear(),this.listScroller&&this.mouseScroller.unbind(this.listScroller),this.photoBrowser.removeEventListener(l.ADD,this.onPhotoBrowserResult,this),this.photoDataLoadManager.removeEventListener(s.COMPLETE,this.onPhotoDataLoadResult,this),this.photoDataLoadManager.removeEventListener(s.PROGRESS,this.onPhotoDataLoadResult,this),this.photoDataLoadManager.removeEventListener(s.ERROR,this.onPhotoDataLoadResult,this),this.photoUploadManager.removeEventListener(c.START,this.onPhotoUploadResult,this),this.photoUploadManager.removeEventListener(c.UPDATE,this.onPhotoUploadResult,this),this.photoUploadManager.removeEventListener(c.FINISHED,this.onPhotoUploadResult,this),this.countController.removeEventListener(h.ADD,this.onPhotoUsedCountChange,this),this.countController.removeEventListener(h.REMOVE,this.onPhotoUsedCountChange,this)},E.prototype.partAdded=function(t,i){e.prototype.partAdded.call(this,t,i),i instanceof o&&mouse.setButtonMode(i,!0),i==this.addPhotosButton?this.addPhotosButton.addEventListener(n.TOUCH_TAP,this.onAddPhotosButtonClick,this):i==this.appendPhotosButton?this.appendPhotosButton.addEventListener(n.TOUCH_TAP,this.onAddPhotosButtonClick,this):i==this.importPhotosButton?this.importPhotosButton.addEventListener(n.TOUCH_TAP,this.importPhotosButtonClick,this):i==this.dataGroup?(this.dataGroup.dataProvider=this.photoItemList,this.dataGroup.itemRenderer=v,this.dataGroup.addEventListener(u.SELECT,this.onPhotoItemSelectHandler,this),this.dataGroup.addEventListener(u.REUPLOAD,this.onPhotoItemReUploadHandler,this),this.dataGroup.addEventListener(u.REMOVE,this.onPhotoItemRemoveHandler,this)):i==this.addPhotosTipDisplay?this.addPhotosTipDisplay.text="添加提醒：单张照片超过10M以上，容易引起上传失败，最大请勿超过15M。":i==this.selectedInfoDisplay?this.updateSelectedInfoDisplay():i==this.selectAllCheckBox?this.selectAllCheckBox.addEventListener(n.TOUCH_TAP,this.onSelectAllToggleChanged,this):i==this.deletePhotosButton&&this.deletePhotosButton.addEventListener(n.TOUCH_TAP,this.onDeletePhotosButtonClick,this)},E.prototype.partRemoved=function(t,o){e.prototype.partRemoved.call(this,t,o),o==this.addPhotosButton?this.addPhotosButton.removeEventListener(n.TOUCH_TAP,this.onAddPhotosButtonClick,this):o==this.appendPhotosButton?this.appendPhotosButton.removeEventListener(n.TOUCH_TAP,this.onAddPhotosButtonClick,this):o==this.importPhotosButton?this.importPhotosButton.removeEventListener(n.TOUCH_TAP,this.importPhotosButtonClick,this):o==this.dataGroup?(this.dataGroup.dataProvider=null,this.dataGroup.removeEventListener(u.SELECT,this.onPhotoItemSelectHandler,this),this.dataGroup.removeEventListener(u.REUPLOAD,this.onPhotoItemReUploadHandler,this),this.dataGroup.removeEventListener(u.REMOVE,this.onPhotoItemRemoveHandler,this)):o==this.selectAllCheckBox?this.selectAllCheckBox.removeEventListener(n.TOUCH_TAP,this.onSelectAllToggleChanged,this):o==this.deletePhotosButton&&this.deletePhotosButton.removeEventListener(n.TOUCH_TAP,this.onDeletePhotosButtonClick,this)},E.prototype.getCurrentState=function(){var t=e.prototype.getCurrentState.call(this);return t=this._displayState?this._displayState:"normal"},E.prototype.fillContent=function(){},E.prototype.onAddPhotosButtonClick=function(t){l.getInstance().browse(this.photoItemList.length)},E.prototype.onPhotoBrowserResult=function(t){if(t.type==l.ADD){var e=t.data;this.photoDataLoadManager.load(e)}},E.prototype.onPhotoDataLoadResult=function(t){var e;if(t.type==s.COMPLETE)console.log("on all photo data loaded!"),this.displayProcessingInfo(!1," ");else if(t.type==s.PROGRESS){"list"!=this._displayState&&(this._displayState="list",this.invalidateState()),e=t.data;var o=Math.round(this.photoDataLoadManager.loadedPhotoCount/this.photoDataLoadManager.totalPhotoCount*100)+"%",n=[{text:"正在加载照片："+o+" | "},{text:"总数："},{text:""+this.photoDataLoadManager.totalPhotoCount,style:{bold:!0}},{text:" 张、"},{text:"已加载："},{text:""+this.photoDataLoadManager.loadedPhotoCount,style:{bold:!0,textColor:10220443}},{text:" 张"}];this.displayProcessingInfo(!0,n),this.addPhotoItem(e),this.photoUploadManager.addPhotoItem(e)}else{e=t.data[0];var i=t.data[1];AlertPic.show("图片加载失败，原因：\n"+i,"图片加载异常")}},E.prototype.onPhotoUploadResult=function(t){if(t.type==c.START);else if(t.type==c.UPDATE){var e=t.data;e&&this.photoItemList.itemUpdated(e)}else t.type==c.FINISHED},E.prototype.displayProcessingInfo=function(t,e){this.processingDisplayGroup&&this.processingDisplayGroup.visible!=t&&(this.processingDisplayGroup.visible=this.processingDisplayGroup.includeInLayout=t),e instanceof Array?this.photoProcessingDisplay.textFlow=e:this.photoProcessingDisplay.text=e},E.prototype.onPhotoItemSelectHandler=function(t){if(this.keepUpMultiSelect()){t.photoItem.selected=!t.photoItem.selected,this.photoItemList.itemUpdated(t.photoItem);var e=this.selectedPhotoItemArr.indexOf(t.photoItem);t.photoItem.selected&&-1==e?this.selectedPhotoItemArr.push(t.photoItem):t.photoItem.selected||-1==e||this.selectedPhotoItemArr.splice(e,1),this.selectedPhotoItemArr.length==this.photoItemList.length?this.selectAllCheckBox.selected=!0:(this.selectedPhotoItemArr.length<this.photoItemList.length||0==this.selectedPhotoItemArr.length)&&(this.selectAllCheckBox.selected=!1)}else g.show("当前添加的照片数量已达到上限！（最多添加 "+l.TOTAL_MAX_UPLOAD_COUNT+"张照片）",1e3);this.updateSelectedInfoDisplay()},E.prototype.onPhotoItemReUploadHandler=function(t){this.photoUploadManager.reUpload(t.photoItem.id)},E.prototype.onPhotoItemRemoveHandler=function(t,e){this.removePhotoItem(t.photoItem,!0)},E.prototype.onPhotoUsedCountChange=function(t){this.photoItemList.itemUpdated(t.item),this.updatePhotoInfoDisplay()},E.prototype.onSelectAllToggleChanged=function(t){var e;if(this.selectAllCheckBox.selected){this.selectedPhotoItemArr.splice(0);for(var o=0,n=this.photoItemList.source;o<n.length;o++){if(e=n[o],!this.keepUpMultiSelect()){g.show("当前添加的照片数量已达到上限！（最多添加 "+l.TOTAL_MAX_UPLOAD_COUNT+"张照片）",1e3),this.selectAllCheckBox.selected=!1;break}e.selected=!0,this.photoItemList.itemUpdated(e),this.selectedPhotoItemArr.push(e)}}else this.clearSelection();this.updateSelectedInfoDisplay()},E.prototype.keepUpMultiSelect=function(){var t;return this.selectedPhotoItemArr.length<l.TOTAL_MAX_UPLOAD_COUNT&&(t=!0),t},E.prototype.updatePhotoInfoDisplay=function(){for(var t,e=0,o=0,n=this.photoItemList.source;o<n.length;o++)t=n[o],t.usedCount>0&&e++;if(this.photoInfoDisplay){var i=this.photoItemList.length;this.photoInfoDisplay.textFlow=[{text:"总共：",style:{size:12}},{text:""+i,style:{bold:!0}},{text:"张、"},{text:"已用："},{text:""+e,style:{bold:!0,textColor:39168}},{text:"张"}]}},E.prototype.updateSelectedInfoDisplay=function(){this.selectedInfoDisplay&&(this.selectedInfoDisplay.text="已选中："+this.selectedPhotoItemArr.length+"张")},E.prototype.updatePhotoItemsIndex=function(){for(var t,e=0,o=this.photoItemList.source;e<o.length;e++)t=o[e],t.index=this.photoItemList.getItemIndex(t)},E.prototype.updateItemRenderers=function(){for(var t,e=0,o=this.photoItemList.source;e<o.length;e++)t=o[e],this.photoItemList.itemUpdated(t)},E.prototype.clearSelection=function(){for(var t,e=0,o=this.selectedPhotoItemArr;e<o.length;e++)t=o[e],t.selected=!1,this.photoItemList.itemUpdated(t);this.selectedPhotoItemArr.splice(0),this.selectAllCheckBox.selected=!1},E.prototype.importPhotosButtonClick=function(e){if(0==this.selectedPhotoItemArr.length)return void g.show("请至少选择一张照片后再操作！",1500);var o=new r(t.PhotoManagerPanel.EVENT_CHILD_EXPORT,!0);o.data=this.selectedPhotoItemArr.concat(),this.dispatchEvent(o),this.closePanel()},E.prototype.onDeletePhotosButtonClick=function(t){if(0==this.selectedPhotoItemArr.length)return void g.show("请至少选择一张照片后再操作！",1500);for(var e,o,n=0,i=this.selectedPhotoItemArr;n<i.length;n++)if(e=i[n],e.usedCount>0){o=!0;break}var r,a=this,s=function(t){if(t.detail==AlertPic.YES)for(var o=0,n=this.selectedPhotoItemArr;o<n.length;o++)e=n[o],a.removePhotoItem(e,!1);AlertPic.resetLabels()};AlertPic.yesLabel="确定",AlertPic.cancelLabel="取消",r=o?AlertPic.showConfirm(y.Alert_WARNING,"部分照片已被使用，删除后冲印区上对应的照片也会被删除，确定要删除该照片?","提示",AlertPic.YES|AlertPic.CANCEL,GlobalCommon.rootContainer,s,this,!0,null,["app.OKButtonSkin","app.CancelButtonSkin"]):AlertPic.showConfirm(y.Alert_WARNING,"确定要删除选中的所有照片?","提示",AlertPic.YES|AlertPic.CANCEL,GlobalCommon.rootContainer,s,this,!0,null,["app.OKButtonSkin","app.CancelButtonSkin"])},E.prototype.closePanel=function(){var e=new r(t.PhotoManagerPanel.EVENT_CHILD_CLOSE,!0);this.dispatchEvent(e)},E}(e);t.UploadPhotoView=E,__reflect(E.prototype,"views.UploadPhotoView",["cdcommon.framework.interfaces.IComponent","eui.UIComponent","egret.DisplayObject"])}(views||(views={}));var components;!function(t){var e=eui.Component,o=eui.Button,n=egret.TouchEvent,i=egret.Event,r=t.PrintStageOverview,a=function(t){function e(){var e=t.call(this)||this;return e._clip=!1,e._printCount=1,e}return __extends(e,t),Object.defineProperty(e.prototype,"displayOnly",{set:function(t){this._displayOnly=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"clip",{get:function(){return this._clip},set:function(t){if(t!=this._clip){this._clip=t,this.childStage&&(this.childStage.clip=t);var e=this.getModel();e&&(e.clipPhoto=t),this.updateCutTypeDisplay()}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"printCount",{get:function(){return this._printCount},set:function(t){this._printCount=t;var e=this.getModel();e&&(e.printCount=t),this.updatePrintCountDisplay()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"selectionMode",{get:function(){return this._selectionMode},set:function(t){this._selectionMode=t,this._displayState=t?"selectionMode":null,this.invalidateState()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"selected",{get:function(){return this.selectCheckBox?this.selectCheckBox.selected:!1},set:function(t){this.selectCheckBox.selected=t,this._displayState=t?"selected":"selectionMode",this.invalidateState()},enumerable:!0,configurable:!0}),e.prototype.getModel=function(t){return t&&this.childStage.updateToRealData(),this.childStage.getModel()},e.prototype.showLoader=function(){},e.prototype.hideLoader=function(){},e.prototype.init=function(t,e){this.validateNow(),this._clip=t.clipPhoto,this.childStage.init(t,e),this.printCount=t.printCount,this.updateCutTypeDisplay()},e.prototype.clear=function(){},e.prototype.destroy=function(){this.childStage.destroy(),this.hideLoader(),this.stageGroup.removeEventListener(n.TOUCH_TAP,this.onChildStageClick,this),mouse.setButtonMode(this.stageGroup,!1)},e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.stageGroup&&(this.stageGroup.addEventListener(n.TOUCH_TAP,this.onChildStageClick,this),mouse.setButtonMode(this.stageGroup,!0),this.childStage=new r,this.childStage.percentWidth=100,this.childStage.percentHeight=100,this.childStage.touchEnabled=this.childStage.touchChildren=!1,this.childStage.isChildStage=!0,this.stageGroup.addChild(this.childStage))},e.prototype.partAdded=function(e,i){t.prototype.partAdded.call(this,e,i),i instanceof o&&mouse.setButtonMode(i,!0),i==this.deleteButton?this.deleteButton.addEventListener(n.TOUCH_TAP,this.onDeleteButtonClick,this):i==this.increaseCountButton?(this.increaseCountButton.visible=this.increaseCountButton.includeInLayout=!this._displayOnly,this.increaseCountButton.addEventListener(n.TOUCH_TAP,this.onPrintCountChangeButtonsHandler,this)):i==this.decreaseCountButton&&(this.decreaseCountButton.visible=this.decreaseCountButton.includeInLayout=!this._displayOnly,this.decreaseCountButton.addEventListener(n.TOUCH_TAP,this.onPrintCountChangeButtonsHandler,this))},e.prototype.partRemoved=function(e,i){t.prototype.partRemoved.call(this,e,i),i instanceof o&&mouse.setButtonMode(i,!1),i==this.deleteButton?this.deleteButton.removeEventListener(n.TOUCH_TAP,this.onDeleteButtonClick,this):i==this.increaseCountButton?this.increaseCountButton.removeEventListener(n.TOUCH_TAP,this.onPrintCountChangeButtonsHandler,this):i==this.decreaseCountButton&&this.decreaseCountButton.removeEventListener(n.TOUCH_TAP,this.onPrintCountChangeButtonsHandler,this)},e.prototype.getCurrentState=function(){var t;return t=this._displayState?this._displayState:"normal"},e.prototype.onDeleteButtonClick=function(t){},e.prototype.onChildStageClick=function(t){this.selectionMode&&(this.selectCheckBox.selected=!this.selectCheckBox.selected,this._displayState=this.selectCheckBox.selected?"selected":"selectionMode",this.invalidateState());var o=new i(e.EVENT_STAGE_CLICK);o.data=this,this.dispatchEvent(o)},e.prototype.onPrintCountChangeButtonsHandler=function(t){t.target==this.increaseCountButton?this._printCount++:this._printCount>1&&this._printCount--;var e=this.getModel();e.printCount=this.printCount,this.updatePrintCountDisplay()},e.prototype.updatePrintCountDisplay=function(){this.printCountInput&&(this.printCountInput.text=this._printCount.toString()),this.dispatchEvent(new i(e.EVENT_PRINT_COUNT_CHANGE,!1,!1,this._printCount))},e.prototype.updateCutTypeDisplay=function(){if(this.cutTypeDisplay){var t=this.clip?"裁剪":"留白",e=[{text:"裁切处理："},{text:""+t,style:{bold:!0,textColor:16711680}}];this.cutTypeDisplay.textFlow=e}},e.EVENT_STAGE_CLICK="stageClick",e.EVENT_PRINT_COUNT_CHANGE="printCountChange",e}(e);t.PageItemContainer=a,__reflect(a.prototype,"components.PageItemContainer")}(components||(components={}));var cdcommon;!function(t){var e;!function(e){var o;!function(e){var o=t.framework.dtos.ResultBaseDTO,n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(o);e.GetGoodsResultDTO=n,__reflect(n.prototype,"cdcommon.editor.dtos.GetGoodsResultDTO")}(o=e.dtos||(e.dtos={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var views;!function(t){var e=eui.Panel,o=egret.TouchEvent,n=cdcommon.framework.managers.PopUpManager,i=cdcommon.framework.constants.AgentShopTypeConstant,r=cdcommon.editor.models.WorkExtraInfo,a=cdcommon.framework.utils.StringUtil,s=cdcommon.framework.components.AlertTip,l=function(t){function e(){return t.call(this)||this}return __extends(e,t),Object.defineProperty(e.prototype,"fromTaoBao",{get:function(){var t,e=UserModelController.getInstance().userModel;return e.agentInfo&&(t=e.agentInfo.shop_type_id==i.TAOBAO||e.agentInfo.shop_type_id==i.TMALL),t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fromWeiShang",{get:function(){var t,e=UserModelController.getInstance().userModel;return e.agentInfo&&(t=e.agentInfo.shop_type_id==i.WEI_SHANG||e.agentInfo.shop_type_id==i.OFFINE_SHOP),t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fromJD",{get:function(){var t,e=UserModelController.getInstance().userModel;return e.agentInfo&&(t=e.agentInfo.shop_type_id==i.JD),t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fromExShop",{get:function(){var t,e=UserModelController.getInstance().userModel;return e.agentInfo&&(t=e.agentInfo.shop_type_id==i.EXTERNAL_SHOP),t},enumerable:!0,configurable:!0}),e.prototype.close=function(){this.clear(),n.removePopUp(this)},e.prototype.init=function(t,e,o,n){this.callbackFun=o,this.workModel=t,this.isSubmit=e,this.hostObj=n,this.title=e?"提交作品确认":"保存作品确认",this.invalidateState(),egret.setTimeout(this.fillForm,this,1e3)},e.prototype.clear=function(){this.callbackFun=null,this.workModel=null,this.isSubmit=!1,this.hostObj=null},e.prototype.destroy=function(){this.clear()},e.prototype.createChildren=function(){t.prototype.createChildren.call(this)},e.prototype.partAdded=function(e,n){t.prototype.partAdded.call(this,e,n),n==this.closeButton?this.closeButton.addEventListener(o.TOUCH_TAP,this.onCloseButtonClick,this):n==this.cancelButton?this.cancelButton.addEventListener(o.TOUCH_TAP,this.onCloseButtonClick,this):n==this.confirmButton?this.confirmButton.addEventListener(o.TOUCH_TAP,this.onConfirmButtonClick,this):n==this.locationSelectionBar&&this.locationSelectionBar.init()},e.prototype.partRemoved=function(e,n){t.prototype.partRemoved.call(this,e,n),n==this.closeButton?this.closeButton.removeEventListener(o.TOUCH_TAP,this.onCloseButtonClick,this):n==this.cancelButton?this.cancelButton.removeEventListener(o.TOUCH_TAP,this.onCloseButtonClick,this):n==this.confirmButton&&this.confirmButton.removeEventListener(o.TOUCH_TAP,this.onConfirmButtonClick,this)},e.prototype.getCurrentState=function(){var t;return t=this.fromTaoBao?"fromTaobao":this.fromJD?"fromJD":this.fromWeiShang?"fromWeiShang":this.fromExShop?"fromExShop":"normal"},e.prototype.fillForm=function(){n.centerPopUp(this),this.visible=!0,this.workNameInput.text=this.workModel.workName,this.workModel.workExtraInfo&&(this.orderNumInput&&this.orderNumInput.parent&&(this.orderNumInput.text=this.workModel.workExtraInfo.order_id),this.userNameInput&&this.userNameInput.parent&&(this.userNameInput.text=this.workModel.workExtraInfo.user_name),this.telNumInput&&this.telNumInput.parent&&(this.telNumInput.text=this.workModel.workExtraInfo.tel_num),this.fullNameInput&&this.fullNameInput.parent&&(this.fullNameInput.text=this.workModel.workExtraInfo.full_name),this.remarkInput&&this.remarkInput.parent&&(this.remarkInput.text=this.workModel.workExtraInfo.remark),this.locationSelectionBar&&this.locationSelectionBar.parent&&this.locationSelectionBar.init(this.workModel.workExtraInfo.location_id_str),this.addressDetailInput&&this.addressDetailInput.parent&&(this.addressDetailInput.text=this.workModel.workExtraInfo.address_detail),this.buyQuantityInput&&this.buyQuantityInput.parent&&(this.buyQuantityInput.text=this.workModel.workExtraInfo.buy_quantity.toString())),this.tipDisplay&&(this.tipDisplay.text="请确认作品无误后再提交！\n如制作中出现“感叹号”、“超出红线剪裁位置”、“空图片”等系统提示问题，请按提示修改完善后提交。")},e.prototype.onConfirmButtonClick=function(t){if(this.orderNumInput&&this.orderNumInput.parent){if(this.isSubmit&&""==a.trim(this.orderNumInput.text))return void s.show(this.fromJD?"请输入京东订单编号。":"请输入淘宝订单编号。");if(""!=a.trim(this.orderNumInput.text)&&a.trim(this.orderNumInput.text).length<10)return void s.show(this.fromJD?"请输入正确的京东订单编号。":"请输入正确的淘宝订单编号。")}if(this.workNameInput&&this.workNameInput.parent){if(""==a.trim(this.workNameInput.text))return void s.show("作品名称不能为空！");if(""!=a.trim(this.workNameInput.text)){var e=/^[\w \-\=\@ \u4e00-\u9fa5]+$/gi;if(!e.test(this.workNameInput.text))return void s.show("作品名称不能输入特殊符号，请检查您的作品名称。")}}if(this.userNameInput&&this.userNameInput.parent&&(this.fromTaoBao||this.fromJD)&&""==a.trim(this.userNameInput.text))return void s.show(this.fromTaoBao?"请输入旺旺昵称。":"请输入会员名称。");if(this.fullNameInput&&this.fullNameInput.parent&&this.isSubmit&&""==a.trim(this.fullNameInput.text))return void s.show("请输入收货人姓名。");if(this.telNumInput&&this.telNumInput.parent){if(this.isSubmit&&""==a.trim(this.telNumInput.text))return void s.show("请输入手机号码。");if(""!=a.trim(this.telNumInput.text)){var o=/^1[3|4|5|7|8]\d{9}$/;if(!o.test(this.telNumInput.text))return void s.show("请输入正确的手机号码。")}}if(this.addressDetailInput&&this.addressDetailInput.parent&&this.isSubmit){if(this.locationSelectionBar&&!this.locationSelectionBar.isAllSelected())return void s.show("请选择完整的省市区信息。");if(""==a.trim(this.addressDetailInput.text))return void s.show("请输入收货的详细地址。")}if(this.buyQuantityInput&&this.buyQuantityInput.parent&&this.isSubmit&&(""==a.trim(this.buyQuantityInput.text)||0==parseInt(a.trim(this.buyQuantityInput.text))))return void s.show("购买数量至少为1份。");if(this.workModel.workExtraInfo||(this.workModel.workExtraInfo=new r),this.workModel.workName=this.workNameInput?a.trim(this.workNameInput.text):"",this.workModel.workExtraInfo.order_id=this.orderNumInput?a.trim(this.orderNumInput.text):"",this.workModel.workExtraInfo.user_name=this.userNameInput?a.trim(this.userNameInput.text):"",this.workModel.workExtraInfo.tel_num=this.telNumInput?a.trim(this.telNumInput.text):"",this.workModel.workExtraInfo.remark=this.remarkInput?a.trim(this.remarkInput.text):"",this.workModel.workExtraInfo.full_name=this.fullNameInput?a.trim(this.fullNameInput.text):"",this.workModel.workExtraInfo.address_detail=this.addressDetailInput?a.trim(this.addressDetailInput.text):"",this.workModel.workExtraInfo.buy_quantity=this.buyQuantityInput?parseInt(this.buyQuantityInput.text):0,this.locationSelectionBar&&this.locationSelectionBar.parent){var n=JSON.stringify(this.locationSelectionBar.getSelectedItems());this.workModel.workExtraInfo.location_id_str=n}else this.workModel.workExtraInfo.location_id_str="";this.callbackFun.apply(this.hostObj,[!0]),this.close()},e.prototype.onCloseButtonClick=function(t){this.callbackFun.apply(this.hostObj,[!1]),this.close()},e}(e);t.SaveWorksConfirmPopup=l,__reflect(l.prototype,"views.SaveWorksConfirmPopup")}(views||(views={}));var cdcommon;!function(t){var e;!function(t){var e;!function(t){var e=function(){function t(){this.id="",this.name=""}return t}();t.TemplateThemeItem=e,__reflect(e.prototype,"cdcommon.editor.models.TemplateThemeItem")}(e=t.models||(t.models={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(t){var e;!function(t){var e=function(){function t(){this.id="",this.index=0,this.name="",this.theme_id="",this.theme_name="",this.thumb_url="",this.min_image_count=0,this.pageList=null}return t}();t.TemplateItem=e,__reflect(e.prototype,"cdcommon.editor.models.TemplateItem")}(e=t.models||(t.models={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(t){var e;!function(t){var e=function(){function t(){this.id=0,this.name="",this.value="",this.thumb_url=""}return t}();t.ProductChildItem=e,__reflect(e.prototype,"cdcommon.editor.models.ProductChildItem")}(e=t.models||(t.models={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(t){var e;!function(t){var e=function(){function t(){this.id=0,this.name=""}return t}();t.MaterialStyleItem=e,__reflect(e.prototype,"cdcommon.editor.models.MaterialStyleItem")}(e=t.models||(t.models={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(t){var e;!function(t){var e=function(){function t(){this.id=0,this.kind_id=0,this.index=0,this.name="",this.mask_count=0,this.thumb_url="",this.page_width=0,this.page_height=0,this.dpi=0,this.stage_content=""}return t}();t.LayoutItem=e,__reflect(e.prototype,"cdcommon.editor.models.LayoutItem")}(e=t.models||(t.models={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(e){var o;!function(e){var o=t.framework.dtos.ResultBaseDTO,n=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;
return e.thumb_url="",e.work_name="",e.template_id="",e.template_name="",e.goods_id="",e.product_id="",e.theme_id=0,e.theme_name="",e.uid="",e.sp_id="",e.agent_id="",e.thickness=0,e.size_item=null,e.inpage_count=0,e.status=0,e.sub_system="",e.pages=null,e.work_extra_info=null,e.wid="",e}return __extends(e,t),e}(o);e.GetWorkResultDTO=n,__reflect(n.prototype,"cdcommon.editor.dtos.GetWorkResultDTO")}(o=e.dtos||(e.dtos={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(e){var o;!function(e){var o=t.framework.dtos.ParamBaseDTO,n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(o);e.GetWorkParamDTO=n,__reflect(n.prototype,"cdcommon.editor.dtos.GetWorkParamDTO")}(o=e.dtos||(e.dtos={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(e){var o;!function(e){var o=t.framework.dtos.ResultBaseDTO,n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(o);e.GetSupplierInfoResultDTO=n,__reflect(n.prototype,"cdcommon.editor.dtos.GetSupplierInfoResultDTO")}(o=e.dtos||(e.dtos={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(e){var o;!function(e){var o=t.framework.dtos.ParamBaseDTO,n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(o);e.GetSupplierInfoParamDTO=n,__reflect(n.prototype,"cdcommon.editor.dtos.GetSupplierInfoParamDTO")}(o=e.dtos||(e.dtos={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(t){var e;!function(t){var e=egret.Event,o=function(t){function e(e,o,n,i,r){var a=t.call(this,e,o,n,i)||this;return a.scene=r,a}return __extends(e,t),e.CHANGE_COMPLETE="sceneChangeComplete",e.CLOSE_COMPLETE="sceneCloseComplete",e}(e);t.ScenesEvent=o,__reflect(o.prototype,"cdcommon.framework.events.ScenesEvent")}(e=t.events||(t.events={}))}(e=t.framework||(t.framework={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(e){var o;!function(e){var o=t.framework.dtos.ParamBaseDTO,n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(o);e.GetGoodsParamDTO=n,__reflect(n.prototype,"cdcommon.editor.dtos.GetGoodsParamDTO")}(o=e.dtos||(e.dtos={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(e){var o;!function(e){var o=t.framework.dtos.ResultBaseDTO,n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(o);e.GetAgentInfoResultDTO=n,__reflect(n.prototype,"cdcommon.editor.dtos.GetAgentInfoResultDTO")}(o=e.dtos||(e.dtos={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(e){var o;!function(e){var o=t.framework.dtos.ParamBaseDTO,n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(o);e.GetAgentInfoParamDTO=n,__reflect(n.prototype,"cdcommon.editor.dtos.GetAgentInfoParamDTO")}(o=e.dtos||(e.dtos={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(t){var e;!function(t){var e=function(){function t(){}return t.AGENT="agent",t.OFFICAL="offical",t.DESKTOP="desktop",t.HTML5="html5",t.PROGRAM="program",t.SHOP="shop",t}();t.SubSystemConstant=e,__reflect(e.prototype,"cdcommon.editor.constants.SubSystemConstant")}(e=t.constants||(t.constants={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var presentations;!function(t){var e=egret.EventDispatcher,o=egret.Event,n=eui.ArrayCollection,i=cdcommon.editor.models.GoodsModel,r=cdcommon.editor.models.PageModel,a=cdcommon.editor.managers.PageModelController,s=cdcommon.editor.constants.PageTypeConstant,l=cdcommon.framework.models.IconCommonProvider,d=cdcommon.framework.utils.DateUtils,c=cdcommon.editor.dtos.GetTemplateParamDTO,h=cdcommon.editor.services.GetTemplateInterface,u=cdcommon.editor.models.TemplateModel,m=cdcommon.editor.services.SaveWorkDataInterface,p=cdcommon.editor.services.SaveWorkThumbInterface,f=cdcommon.editor.models.PhotoElementModel,g=cdcommon.framework.hashmap.HashMap,v=cdcommon.editor.models.PhotoItem,_=cdcommon.editor.utils.URLConvertor,y=cdcommon.editor.constants.MaterialKindConstant,E=cdcommon.editor.managers.QuickImportPhotosController,C=cdcommon.editor.constants.PhotoStatus,M=utils.PhotoBrowser,I=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.createPageTemplateModel=function(){var t,e=this.workModel.templateInfo.pages;if(e.length>0){var o=this.workModel.sizeItem;t=e[0];var n=new r;n.tpId=t.id,n.type=t.type;var i=a.getInstance().getModelList().length;return n.pageIndex=i,n.basicPageInfo=o.inpage_info,n.pageName=(n.pageIndex+1).toString(),n}return AlertPic.show(l.Alert_ERROR,"抱歉，该模版不存在任何子页信息导致无法制作，请与管理员联系！","模版信息不存在"),null},e.prototype.generateWorksPageModelList=function(){var t,e,o=this.workModel.sizeItem,i=this.workModel.pages,l=[],d=0;i=i.sort(function(t,e){return t.index-e.index});for(var c=new g,h=0,u=i;h<u.length;h++){t=u[h];for(var m,p,v=a.getInstance().extractElementListFromJsonString(t.stage_content),_=0,y=v;_<y.length;_++)if(m=y[_],m instanceof f){p=m;break}(p||!E.getInstance().isEmptyPhotoModel(p))&&(c.containsKey(p.relatedId)?(e=c.getValue(p.relatedId),e.printCount++):(e=new r,e.wpId=t.id,e.tpId=t.tid,e.type=t.type,e.pageName=t.name,e.pageIndex=d,s.isFace(t.type)?e.basicPageInfo=o.cover_info:e.basicPageInfo=o.inpage_info,e.elementList=new n(v),e.clipPhoto=1==p.clip?!0:!1,l.push(e),d++,c.put(p.relatedId,e)))}return l},e.prototype.getWorksRelatedPhotoItems=function(){for(var t,e,o,n,i=[],r=0,a=this.workModel.pageList;r<a.length;r++){t=a[r];for(var s=0,l=t.elementList.source;s<l.length;s++)if(n=l[s],n instanceof f){if(o=n,E.getInstance().isEmptyPhotoModel(o))continue;e=new v,e.id=o.relatedId,e.url=o.url,e.thumb_url=_.covert(y.PHOTO,e.url,!0),e.status=C.UPLOAD_COMPLETE,i.push(e)}}return i},e.prototype.clear=function(){this.view=null,this.workModel=null,this.callBack=null},e.prototype.getWorksIDCall=function(){var t=this,e=this;return new Promise(function(o,n){var i=function(t){if(t.type==InterfaceEvent.COMPLETE){var i=t.data;e.workModel.workId=i.wid;var r=GoodsTypeConstant.getNameByType(this.workModel.goodsInfo.typeId);e.workModel.workName=d.dateFormat(new Date,"YYYY-MM-DD")+"-"+r+"-"+this.workModel.workId,console.log("作品ID：",i.wid),o()}else AlertPic.show(l.Alert_ERROR,t.data,"作品ID获取失败"),n()},r=new GetWorkIDInterface;r.once(InterfaceEvent.COMPLETE,i,t),r.once(InterfaceEvent.FAULT,i,t),r.call()})},e.prototype.getAgentInfoCall=function(t){var e=this;return new Promise(function(o,n){var i=function(t){if(t.type==InterfaceEvent.COMPLETE){var e=t.data,i=UserModelController.getInstance().userModel;i.agentInfo=e.info,o()}else AlertPic.show(l.Alert_ERROR,"分销商信息失败，请尝试刷新页面或重新进入系统。\n"+t.data,"分销商信息获取失败"),n()},r=new GetAgentInfoInterface;r.once(InterfaceEvent.COMPLETE,i,e),r.once(InterfaceEvent.FAULT,i,e),t||(t=new GetAgentInfoParamDTO,t.agent_id=e.workModel.agentId),r.call(t)})},e.prototype.getGoodsInfoCall=function(t){var e=this,o=this;return new Promise(function(n,r){var a=function(t){if(t.type==InterfaceEvent.COMPLETE){var e=t.data,a=new i;a.name=e.name,a.productId=o.workModel.productId,a.productItem=e.product_item,a.productItemList=e.product_item_list,a.typeId=e.type_id,a.sizeItem=e.size_item,a.thumbUrl=e.thumb_url,a.minImageCount=e.min_image_count,a.maxImageCount=e.max_image_count,a.pageCount=e.page_count,a.maxPageCount=e.max_page_count,a.addPageSpan=e.add_page_span,a.allowPageAdjustment=1==e.allow_page_adjustment,o.workModel.goodsInfo=a,0==this.workModel.pageCount?(M.MIN_UPLOAD_COUNT=a.minImageCount,M.TOTAL_MAX_UPLOAD_COUNT=0==a.maxImageCount?9999:a.maxImageCount):(a.allowPageAdjustment=!1,M.MIN_UPLOAD_COUNT=this.workModel.pageCount,M.TOTAL_MAX_UPLOAD_COUNT=this.workModel.pageCount),o.view.updateUploadTip(),a.allowPageAdjustment?0==o.workModel.pageCount&&(o.workModel.pageCount=a.pageCount):o.workModel.pageCount=a.pageCount,n()}else AlertPic.show(l.Alert_ERROR,t.data,"商品信息获取失败"),r()},s=new GetGoodsInterface;s.once(InterfaceEvent.COMPLETE,a,e),s.once(InterfaceEvent.FAULT,a,e),t||(t=new GetGoodsParamDTO,t.goods_id=e.workModel.goodsId,t.product_id=e.workModel.productId),s.call(t)})},e.prototype.getTemplateCall=function(t){var e=this,o=this;return new Promise(function(n,i){var r=function(t){if(t.type==InterfaceEvent.COMPLETE){var e=t.data,r=new u;r.name=e.name,r.thickness=e.thickness,r.sizeItem=e.size_item,r.themeId=e.theme_id,r.themeName=e.theme_name,r.thumbUrl=e.thumb_url,r.pages=e.pages,r.firstYear=e.first_year,o.workModel.templateInfo=r,isNaN(o.workModel.thickness)&&(o.workModel.thickness=r.thickness),EditorCommon.editorType==EditorTypeConstant.OPEN&&(o.workModel.sizeItem=o.workModel.goodsInfo.sizeItem,EditorCommon.DPI=o.workModel.sizeItem.dpi),n()}else AlertPic.show(l.Alert_ERROR,t.data,"模版信息获取失败"),i()},a=new h;a.once(InterfaceEvent.COMPLETE,r,e),a.once(InterfaceEvent.FAULT,r,e),t||(t=new c,t.tid=e.workModel.templateId,t.product_id=e.workModel.productId),a.call(t)})},e.prototype.getWorkInfoCall=function(t){var e=this,o=this;return new Promise(function(n,i){var r=function(t){if(t.type==InterfaceEvent.COMPLETE){var e=t.data,r=o.workModel;r.status=e.status,r.templateId=e.template_id,r.workName=e.work_name,r.thickness=e.thickness,r.sizeItem=e.size_item,r.goodsId=e.goods_id,r.productId=e.product_id,r.uid=e.uid,r.agentId=e.agent_id,r.subSystem=e.sub_system,r.pages=e.pages,r.workExtraInfo=e.work_extra_info,n()}else AlertPic.show(l.Alert_ERROR,t.data,"作品数据获取失败"),i()},a=new GetWorkInterface;a.once(InterfaceEvent.COMPLETE,r,e),a.once(InterfaceEvent.FAULT,r,e),t||(t=new GetWorkParamDTO,t.wid=e.workModel.workId),a.call(t)})},e.prototype.saveWorksDataCall=function(t){var e=this,o=this;return new Promise(function(n,i){var r=function(t){if(t.type==InterfaceEvent.COMPLETE){var e=t.data,r=e.page_ids;if(r)for(var a,s,d=0,c=r;d<c.length;d++){a=c[d];for(var h=0,u=o.workModel.pageList;h<u.length;h++)s=u[h],s.id==a.pid&&(s.wpId=a.id)}n()}else AlertPic.show(l.Alert_ERROR,t.data,"保存或提交作品失败"),o.view.hideLoader(),o.view.resetFlags(),i()},a=new m;a.once(InterfaceEvent.COMPLETE,r,e),a.once(InterfaceEvent.FAULT,r,e),a.call(t)})},e.prototype.saveWorksThumbCall=function(t){var e=this,o=this;return new Promise(function(n,i){var r=function(t){t.type==InterfaceEvent.COMPLETE?n():(AlertPic.show(l.Alert_ERROR,t.data,"保存作品封面缩略图失败"),o.view.hideLoader(),o.view.resetFlags(),i())},a=new p;a.once(InterfaceEvent.COMPLETE,r,e),a.once(InterfaceEvent.FAULT,r,e),a.call(t)})},e.prototype.callBack=function(t,e){this.dispatchEvent(new o(t,!1,!1,e))},e}(e);t.PrinterOverviewPM=I,__reflect(I.prototype,"presentations.PrinterOverviewPM",["cdcommon.framework.interfaces.IComponentPM"])}(presentations||(presentations={}));var uploads;!function(t){var e=cdcommon.framework.oss.OssVar,o=cdcommon.editor.services.GetUploadSignInterface,n=cdcommon.editor.dtos.GetUploadSignParamDTO,i=cdcommon.framework.models.IconCommonProvider,r=function(){function r(){}return r.init=function(){var o=new Array,i=new t.OSSBucket;i.region="oss-cn-zhangjiakou",i.endpoint="oss-cn-zhangjiakou.aliyuncs.com",i.bucketname="yd-p4",i.accesskeyid="LTAIZMbzAsFbSFsr",i.domain="http://img1.haoin.com.cn",o.push(i),r.bucket=o[0],e.OSS_REGION=r.bucket.region,e.OSS_ENDPOINT=r.bucket.endpoint,e.OSS_BUCKECT_NAME=r.bucket.bucketname,e.ACCESS_KEY_ID=r.bucket.accesskeyid;var a=new n;a.str=e.BASE64_POLICY,this.getUploadSignCall(a)},r.getUploadSignCall=function(t){var e=new o;e.once(InterfaceEvent.COMPLETE,this.onGetUploadSignResult,this),e.once(InterfaceEvent.FAULT,this.onGetUploadSignResult,this),e.call(t)},r.onGetUploadSignResult=function(t){if(t.type==InterfaceEvent.COMPLETE){var o=t.data;e.ACCESS_SIGN=o.sign}else AlertPic.show(i.Alert_ERROR,t.data,"上传签名获取失败")},r}();t.OSSUploadConfig=r,__reflect(r.prototype,"uploads.OSSUploadConfig")}(uploads||(uploads={}));var cdcommon;!function(t){var e;!function(t){var e;!function(t){var e=function(){function t(){}return t.OPEN="open",t.WORK="work",t}();t.EditorTypeConstant=e,__reflect(e.prototype,"cdcommon.editor.constants.EditorTypeConstant")}(e=t.constants||(t.constants={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var views;!function(t){var e=eui.Panel,o=egret.TouchEvent,n=cdcommon.framework.managers.PopUpManager,i=cdcommon.framework.models.IconCommonProvider,r=cdcommon.framework.components.AlertTip,a=cdcommon.framework.utils.DateFormatter,s=function(t){function e(){var e=t.call(this)||this;return e.title="保存成功",e}return __extends(e,t),e.prototype.close=function(){this.clear(),n.removePopUp(this)},e.prototype.init=function(){var t,e=window.location.href.toString();t=-1!=e.lastIndexOf("?")?e.substring(0,e.lastIndexOf("?")+1):e+"?";var o=WorkModelController.getInstance().workModel,n=UserModelController.getInstance().userModel,i=t+ArgumentConstant.WORK_ID+"="+o.workId+"&"+ArgumentConstant.SUPPLIER_ID+"="+n.supplierInfo.spId;this.workUrlInput.text=i},e.prototype.clear=function(){},e.prototype.destroy=function(){this.clear()},e.prototype.createChildren=function(){t.prototype.createChildren.call(this)},e.prototype.partAdded=function(e,n){t.prototype.partAdded.call(this,e,n),n==this.closeButton?this.closeButton.addEventListener(o.TOUCH_TAP,this.onCloseButtonClick,this):n==this.cancelButton?this.cancelButton.addEventListener(o.TOUCH_TAP,this.onCloseButtonClick,this):n==this.copyButton?this.copyButton.addEventListener(o.TOUCH_TAP,this.onCopyUrlButtonClick,this):n==this.saveWorkUrlButton?this.saveWorkUrlButton.addEventListener(o.TOUCH_TAP,this.onSaveWorkUrlButtonClick,this):n==this.addToFavoriteButton&&this.addToFavoriteButton.addEventListener(o.TOUCH_TAP,this.onAddToFavoriteButtonClick,this)},e.prototype.partRemoved=function(e,n){t.prototype.partRemoved.call(this,e,n),n==this.closeButton?this.closeButton.removeEventListener(o.TOUCH_TAP,this.onCloseButtonClick,this):n==this.cancelButton?this.cancelButton.removeEventListener(o.TOUCH_TAP,this.onCloseButtonClick,this):n==this.copyButton?this.copyButton.removeEventListener(o.TOUCH_TAP,this.onCopyUrlButtonClick,this):n==this.saveWorkUrlButton?this.saveWorkUrlButton.removeEventListener(o.TOUCH_TAP,this.onSaveWorkUrlButtonClick,this):n==this.addToFavoriteButton&&this.addToFavoriteButton.removeEventListener(o.TOUCH_TAP,this.onAddToFavoriteButtonClick,this)},e.prototype.onCloseButtonClick=function(t){this.close()},e.prototype.onCopyUrlButtonClick=function(t){try{var e=document.createElement("input");e.value=this.workUrlInput.text,document.body.appendChild(e),e.select(),document.execCommand("Copy"),e.style.display="none",document.body.removeChild(e),r.show("复制成功！已复制到系统剪切板。",700)}catch(o){r.show("复制失败，请直接在输入框中全选复制。")}},e.prototype.onSaveWorkUrlButtonClick=function(t){try{var e="[InternetShortcut]\nurl="+this.workUrlInput.text,o=new a;o.formatString="YYYY-MM-DD JJ:NN:SS";var n=WorkModelController.getInstance().workModel.workName,r="【"+this.getShopName()+"】 作品："+n+"   日期："+o.format(new Date)+".url";this.saveFile(r,e)}catch(s){AlertPic.show(i.Alert_ERROR,"保存链接时异常, Error = "+s.message,"保存链接失败")}},e.prototype.onAddToFavoriteButtonClick=function(t){var e=this.workUrlInput.text,o=new a;o.formatString="YYYY-MM-DD JJ:NN:SS";var n=WorkModelController.getInstance().workModel.workName,i="【"+this.getShopName()+"】 作品："+n+"   日期："+o.format(new Date),s=this.addFavorite(e,i);"ok"!=s&&r.show(s)},e.prototype.addFavorite=function(t,e){var o=navigator.userAgent.toLowerCase();if(o.indexOf("360se")>-1)return"由于360浏览器功能限制，请按 Ctrl+D 手动收藏！";if(o.indexOf("msie 8")>-1)window.external.AddToFavoritesBar(t,e);else if(document.all)try{window.external.addFavorite(t,e)}catch(n){return"您的浏览器不支持,请按 Ctrl+D 手动收藏!"}else{if(!window.sidebar)return"您的浏览器不支持,请按 Ctrl+D 手动收藏!";window.sidebar.addPanel(e,t,"")}return"ok"},e.prototype.getShopName=function(){var t,e=UserModelController.getInstance().userModel.supplierInfo,o=UserModelController.getInstance().userModel.agentInfo;return t=o?o.shop_name:e.spName},e.prototype.saveFile=function(t,e){var o=window.URL||window.webkitURL||window,n=new Blob([e]),i=document.createElementNS("http://www.w3.org/1999/xhtml","a");i.href=o.createObjectURL(n),i.download=t;var r=document.createEvent("MouseEvents");r.initMouseEvent("click",!0,!1,window,0,0,0,0,0,!1,!1,!1,!1,0,null),i.dispatchEvent(r)},e}(e);t.AgentSaveWorkResultPopup=s,__reflect(s.prototype,"views.AgentSaveWorkResultPopup")}(views||(views={}));var views;!function(t){var e=eui.Group,o=eui.Scroller,n=eui.TileLayout,i=eui.UIEvent,r=egret.Event,a=components.PageItemContainer,s=cdcommon.editor.managers.PageModelController,l=cdcommon.framework.hashmap.HashMap,d=t.PageEditorView,c=cdcommon.framework.managers.PopUpManager,h=cdcommon.framework.components.AlertTip,u=utils.MouseScroller,m=cdcommon.editor.managers.ElementModelController,p=cdcommon.framework.models.IconCommonProvider,f=cdcommon.editor.managers.PhotoUsedCountController,g=function(t){function g(){var e=t.call(this)||this;return e._pageModelList=[],e._addPageParamMap=new l,e._displayOnly=!1,e}return __extends(g,t),g.prototype.setDisplayOnly=function(){this._displayOnly=!0},g.prototype.openSelectionMode=function(t){this._selectionModeOpened=t;for(var e,o=this._addPageParamMap.getKeys(),n=0,i=o;n<i.length;n++)e=i[n],e.selectionMode=t},Object.defineProperty(g.prototype,"isSelectAll",{get:function(){return this.getSelectedItems().length==this._pageModelList.length},enumerable:!0,configurable:!0}),g.prototype.batchSetClipForSelection=function(t){var e=this.getSelectedItems();if(0==e.length)return void h.show("请至少选中一张照片进行操作！",1e3);for(var o,n=0,i=e;n<i.length;n++)o=i[n],o.clip=t},g.prototype.batchDeleteForSelection=function(){var t=this.getSelectedItems(),e=this;if(0==t.length)return void h.show("请至少选中一张照片进行操作！",1e3);var o,n=function(o){if(o.detail==AlertPic.YES)for(var n,i=0,r=t;i<r.length;i++)n=r[i],e.removeItem(n.getModel().id,"page");AlertPic.resetLabels()};AlertPic.yesLabel="确定",AlertPic.cancelLabel="取消",o=AlertPic.showConfirm(p.Alert_WARNING,"删除照片后不能恢复，确定要删除该照片?","提示",AlertPic.YES|AlertPic.CANCEL,GlobalCommon.rootContainer,n,this,!0,null,["app.OKButtonSkin","app.CancelButtonSkin"])},g.prototype.getSelectedItems=function(){var t=[];if(!this.openSelectionMode)return t;for(var e,o=this._addPageParamMap.getKeys(),n=0,i=o;n<i.length;n++)e=i[n],e.selected&&t.push(e);return t},g.prototype.selectAllItem=function(){this.selectAllHandler(!0)},g.prototype.unSelectAllItem=function(){this.selectAllHandler(!1)},g.prototype.containsItem=function(t,e){void 0===e&&(e="photo");for(var o,n,i=this._addPageParamMap.getValues(),r=0,a=i;r<a.length;r++){n=a[r];var s="photo"==e?n[1]:n[0];if(s&&s.id==t){o=!0;break}}return o},g.prototype.getItemList=function(){return this._addPageParamMap.getKeys()},g.prototype.getItem=function(t,e){void 0===e&&(e="photo");for(var o,n,i=this._addPageParamMap.getValues(),r=0,a=i;r<a.length;r++){n=a[r];var s="photo"==e?n[1]:n[0];if(s&&s.id==t){o=this._addPageParamMap.getKey(n);break}}return o},g.prototype.addItem=function(t,e){var o;e&&this.containsItem(e.id)?(o=this.getItem(e.id),o.printCount++):(o=new a,o.displayOnly=this._displayOnly,this._pageModelList.push(t),s.getInstance().addModel(t),this._addPageParamMap.put(o,[t,e]),o.once(i.CREATION_COMPLETE,this.onPageItemCreated,this),o.addEventListener(a.EVENT_STAGE_CLICK,this.onPageItemClick,this),o.addEventListener(a.EVENT_PRINT_COUNT_CHANGE,this.onPagePrintCountChange,this),this.dataGroup.addChild(o)),this.dispatchEvent(new r(g.EVENT_ITEM_PRINT_COUNT_CHANGE))},g.prototype.removeItem=function(t,e){void 0===e&&(e="photo");var o=this.getItem(t,e);if(o){var n=o.getModel(),i=n.elementList.getItemAt(0);i&&f.getInstance().removeUsed(i.relatedId),this._addPageParamMap.remove(o),this._pageModelList.splice(this._pageModelList.indexOf(n),1),s.getInstance().removeModel(n.id),m.getInstance().removeModelListByPageId(n.id),o.destroy(),o.removeEventListener(a.EVENT_STAGE_CLICK,this.onPageItemClick,this),o.removeEventListener(a.EVENT_PRINT_COUNT_CHANGE,this.onPagePrintCountChange,this),this.dataGroup.removeChild(o),this.updatePagesNameAndIndex(),console.log("删除页面："+n.id)}this.dispatchEvent(new r(g.EVENT_ITEM_PRINT_COUNT_CHANGE))},g.prototype.init=function(t){},g.prototype.clear=function(){},g.prototype.destroy=function(){this.clear(),this.scroller&&this.mouseScroller.unbind(this.scroller)},g.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.dataGroup=new e;var i=new n;i.horizontalGap=60,i.verticalGap=60,i.paddingLeft=i.paddingTop=i.paddingRight=i.paddingBottom=20,i.columnWidth=200,i.useVirtualLayout=!1,this.dataGroup.layout=i,this.scroller=new o,this.scroller.left=this.scroller.right=this.scroller.top=this.scroller.bottom=0,this.scroller.bounces=!1,this.scroller.viewport=this.dataGroup,this.scroller.addChild(this.dataGroup),this.addChild(this.scroller),this.mouseScroller=u.getInstance(),this.mouseScroller.init(this.stage),this.mouseScroller.bind(this.scroller)},g.prototype.onPageItemCreated=function(t){var e=t.target,o=this._addPageParamMap.getValue(e);e.init(o[0],o[1])},g.prototype.onPageItemClick=function(t){var e=this;if(!this._displayOnly){var o=t.data;if(this._selectionModeOpened){var n=new r(g.EVENT_ITEM_SELECTED_CHANGE);n.data=o,this.dispatchEvent(n)}else this.pageEditorView?(c.addPopUp(this.pageEditorView,GlobalCommon.rootContainer,!1),c.centerPopUp(this.pageEditorView),this.pageEditorView.init(o.getModel(!0),this.getItemList().length,this.onPageEditorCallBack,this)):(this.pageEditorView=new d,this.pageEditorView.left=this.pageEditorView.right=0,this.pageEditorView.top=60,this.pageEditorView.bottom=0,this.pageEditorView.addEventListener(d.EVENT_PREVIOUS_PAGE,this.onEditPageChangeHandler,this),this.pageEditorView.addEventListener(d.EVENT_NEXT_PAGE,this.onEditPageChangeHandler,this),this.pageEditorView.addEventListener(d.EVENT_DELETE_PAGE,this.onEditPageDeleteHandler,this),this.pageEditorView.once(i.CREATION_COMPLETE,function(t){e.pageEditorView.init(o.getModel(!0),e.getItemList().length,e.onPageEditorCallBack,e)},this),c.addPopUp(this.pageEditorView,GlobalCommon.rootContainer,!1),c.centerPopUp(this.pageEditorView))}},g.prototype.onPageEditorCallBack=function(t){var e=this.getItem(t.id,"page");e.init(t)},g.prototype.onPagePrintCountChange=function(t){this.dispatchEvent(new r(g.EVENT_ITEM_PRINT_COUNT_CHANGE))},g.prototype.onEditPageChangeHandler=function(t){var e,o=this.pageEditorView.getModel(),n=this.getItem(o.id,"page"),i=this.dataGroup.getChildIndex(n);if(t.type==d.EVENT_NEXT_PAGE){if(!(i<this.dataGroup.numChildren-1))return void h.show("已经是最后一张了！",1e3);i++}else{if(!(i>0))return void h.show("没有上一张了！",1e3);i--}this.pageEditorView.childStage.updateToRealData(),n.init(o);var r=this.dataGroup.getChildAt(i);e=r.getModel(!0),this.pageEditorView.init(e,this.getItemList().length,this.onPageEditorCallBack,this)},g.prototype.onEditPageDeleteHandler=function(t){var e,o=this.pageEditorView.getModel(),n=this.getItem(o.id,"page"),i=this.dataGroup.getChildIndex(n);if(this.dataGroup.numChildren>1){i<this.dataGroup.numChildren-1?i++:i--;var r=this.dataGroup.getChildAt(i);e=r.getModel(!0),this.pageEditorView.init(e,this.getItemList().length,this.onPageEditorCallBack,this)}this.removeItem(o.id,"page"),this.pageEditorView.updatePageInfo(this.getItemList().length)},g.prototype.selectAllHandler=function(t){for(var e,o=this._addPageParamMap.getKeys(),n=0,i=o;n<i.length;n++)e=i[n],e.selected=t},g.prototype.updatePagesNameAndIndex=function(){for(var t,e,o=0;o<this.dataGroup.numChildren;o++)t=this.dataGroup.getChildAt(o),e=t.getModel(),e.pageName=(o+1).toString(),e.pageIndex=o,console.log("[重新排序]",e.pageName,e.pageIndex);console.log("[~~~~~~~~~~~~~~~~~~~~~~~~]")},g.EVENT_ITEM_SELECTED_CHANGE="itemSelectChange",g.EVENT_ITEM_PRINT_COUNT_CHANGE="itemPrintCountChange",g}(e);t.PageList=g,__reflect(g.prototype,"views.PageList",["cdcommon.framework.interfaces.IComponent","eui.UIComponent","egret.DisplayObject"])}(views||(views={}));var views;!function(t){var e=eui.Panel,o=egret.TouchEvent,n=egret.Event,i=t.UploadPhotoView,r=cdcommon.framework.managers.PopUpManager,a=function(t){function e(){var o=t.call(this)||this;return o.addEventListener(e.EVENT_CHILD_EXPORT,o.onExportPhotosHandler,o),o.addEventListener(e.EVENT_CHILD_CLOSE,o.onClosePanelHandler,o),o.addEventListener(e.EVENT_CHILD_REMOVED,o.onPhotoRemovedHandler,o),o}return __extends(e,t),e.prototype.close=function(){this.clear(),r.removePopUp(this)},e.prototype.init=function(t){this.uploadView&&this.uploadView.init()},e.prototype.clear=function(){this.uploadView&&this.uploadView.clear()},e.prototype.destroy=function(){this.clear()},e.prototype.createChildren=function(){t.prototype.createChildren.call(this);this.uploadView=new i,this.uploadView.percentWidth=this.uploadView.percentHeight=100,this.uploadView.skinName="app.UploadPhotoViewSkin",this.uploadView.name="本地上传",this.viewStack.addChild(this.uploadView),this.viewStack.selectedIndex=0},e.prototype.partAdded=function(e,n){t.prototype.partAdded.call(this,e,n),n==this.tabBar||n==this.closeButton&&this.closeButton.addEventListener(o.TOUCH_TAP,this.onCloseButtonClick,this)},e.prototype.partRemoved=function(e,o){t.prototype.partRemoved.call(this,e,o)},e.prototype.onPhotoRemovedHandler=function(t){var o=new n(e.EVENT_REMOVE);o.data=t.data,this.dispatchEvent(o)},e.prototype.onExportPhotosHandler=function(t){var o=new n(e.EVENT_EXPORT);o.data=t.data,this.dispatchEvent(o)},e.prototype.onClosePanelHandler=function(t){this.close()},e.prototype.onCloseButtonClick=function(t){this.close()},e.EVENT_EXPORT="exportPhotos",e.EVENT_REMOVE="removePhotos",e.EVENT_CHILD_EXPORT="childExport",e.EVENT_CHILD_CLOSE="childClose",e.EVENT_CHILD_REMOVED="childRemoved",e}(e);t.PhotoManagerPanel=a,__reflect(a.prototype,"views.PhotoManagerPanel",["cdcommon.framework.interfaces.IComponent","eui.UIComponent","egret.DisplayObject"])}(views||(views={}));var cdcommon;!function(t){var e;!function(e){var o;!function(e){var o=t.framework.models.UserModel,n=function(){function t(t){this._userModel=new o}return Object.defineProperty(t.prototype,"userModel",{get:function(){return this._userModel},set:function(t){this._userModel=t},enumerable:!0,configurable:!0}),t.getInstance=function(){return this._inst||(this._inst=new t(new i)),this._inst},t}();e.UserModelController=n,__reflect(n.prototype,"cdcommon.framework.managers.UserModelController");var i=function(){function t(){}return t}();__reflect(i.prototype,"SingletonEnforcer")}(o=e.managers||(e.managers={}))}(e=t.framework||(t.framework={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(t){var e;!function(t){var e=egret.Event,o=function(t){function e(e,o,n,i){return t.call(this,e,o,n,i)||this}return __extends(e,t),e.prototype.clone=function(){var t=new e(this.type,this.bubbles,this.cancelable,this.data);return t.result=this.result,t},e.COMPLETE="loadComplete",e.IO_ERROR="loadIOError",e}(e);t.ResourceLoadedEvent=o,__reflect(o.prototype,"cdcommon.framework.events.ResourceLoadedEvent")}(e=t.events||(t.events={}))}(e=t.framework||(t.framework={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(e){var o;!function(e){var o=t.framework.dtos.ResultBaseDTO,n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(o);e.GetPhotoListResultDTO=n,__reflect(n.prototype,"cdcommon.editor.dtos.GetPhotoListResultDTO")}(o=e.dtos||(e.dtos={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(e){var o;!function(e){var o=egret.Tween,n=egret.Ease,i=eui.UIEvent,r=t.framework.events.ScenesEvent,a=function(t){function e(e){var o=t.call(this)||this;return o.popuedScenes=[],o}return __extends(e,t),e.prototype.isPopupedScenen=function(t){return-1!=this.popuedScenes.indexOf(t)},e.prototype.changeScene=function(t,o,n,i){void 0===o&&(o=!1),void 0===n&&(n=!1),void 0===i&&(i=e.EFFECT_FROM_RIGHT);var a=this,s=function(e){a.closePopupScene(!1,!0),a.currentScene&&(o&&a.currentScene.destroy(),a.rootLayer.removeChild(a.currentScene),a.currentScene=null),a.currentScene=t;var e=new r(r.CHANGE_COMPLETE);e.scene=t,a.dispatchEvent(e)};this.once(r.CHANGE_COMPLETE,s,this),this.popupScene(t,n,i)},e.prototype.popupScene=function(t,o,n,a){void 0===o&&(o=!1),void 0===n&&(n=e.EFFECT_FROM_RIGHT);var s=this,l=function(){a&&s.closePopupScene(!1),s.currentPopupScene=t;var e=new r(r.CHANGE_COMPLETE);e.scene=t,s.dispatchEvent(e)};t.visible=!o,t.initialized?(this.isPopupedScenen(t)?(this.rootLayer.setChildIndex(t,this.rootLayer.numChildren-1),this.popuedScenes.splice(this.popuedScenes.indexOf(t),1),this.popuedScenes.push(t)):(this.rootLayer.addChild(t),this.popuedScenes.push(t)),o?s.playSceneEffect(t,n,!1,l):l()):(t.once(i.CREATION_COMPLETE,function(e){t.initialized=!0,o?s.playSceneEffect(t,n,!1,l):l()},this),this.rootLayer.addChild(t),this.popuedScenes.push(t))},e.prototype.closePopupScene=function(t,e){if(void 0===t&&(t=!1),void 0===e&&(e=!1),this.currentPopupScene){var o=this,n=function(){var t=new r(r.CLOSE_COMPLETE);t.scene=o.currentPopupScene,o.dispatchEvent(t),e&&o.currentPopupScene.clear(),o.rootLayer.removeChild(o.currentPopupScene),o.popuedScenes.splice(o.popuedScenes.indexOf(o.currentPopupScene),1),o.popuedScenes.length>0&&(o.currentPopupScene=o.popuedScenes[o.popuedScenes.length-1])};t&&this.previousSceneEffectFrom?this.playSceneEffect(this.currentPopupScene,this.previousSceneEffectFrom,!0,n):n()}},e.prototype.removeUnusedPopupScene=function(t){this.isPopupedScenen(t)&&t!=this.currentPopupScene&&(t.clear(),this.rootLayer.removeChild(t),this.popuedScenes.splice(this.popuedScenes.indexOf(t),1))},e.prototype.playSceneEffect=function(t,i,r,a,s){void 0===r&&(r=!1),void 0===a&&(a=null),void 0===s&&(s=null),this.previousSceneEffectFrom=i;var l=0,d=0,c=0,h=0;switch(i){case e.EFFECT_FROM_TOP:l=c=0,d=r?0:-this.rootLayer.height,h=r?-this.rootLayer.height:0;break;case e.EFFECT_FROM_BOTTOM:l=c=0,d=r?0:this.rootLayer.height,h=r?this.rootLayer.height:0;break;case e.EFFECT_FROM_LEFT:l=r?0:-this.rootLayer.width,c=r?-this.rootLayer.width:0,d=h=0;break;case e.EFFECT_FROM_RIGHT:l=r?0:this.rootLayer.width,c=r?this.rootLayer.width:0,d=h=0}t.x=l,t.y=d,t.visible=!0,o.get(t,{loop:!1}).to({x:c,y:h},e.EFFECT_DURATION,n.sineInOut).call(a,this,s)},e.getInstance=function(){return this._inst||(this._inst=new e(new s)),this._inst},e.EFFECT_FROM_LEFT="left",e.EFFECT_FROM_RIGHT="right",e.EFFECT_FROM_TOP="top",e.EFFECT_FROM_BOTTOM="bottom",e.EFFECT_DURATION=300,e}(egret.EventDispatcher);e.ScenesManager=a,__reflect(a.prototype,"cdcommon.framework.managers.ScenesManager");var s=function(){function t(){}return t}();__reflect(s.prototype,"SingletonEnforcer")}(o=e.managers||(e.managers={}))}(e=t.framework||(t.framework={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(e){var o;!function(e){var o=t.framework.dtos.ParamBaseDTO,n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(o);e.GetPhotoListParamDTO=n,__reflect(n.prototype,"cdcommon.editor.dtos.GetPhotoListParamDTO")}(o=e.dtos||(e.dtos={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(e){var o;!function(e){var o=t.framework.dtos.ResultBaseDTO,n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(o);e.GetMaterialStyleListResultDTO=n,__reflect(n.prototype,"cdcommon.editor.dtos.GetMaterialStyleListResultDTO")}(o=e.dtos||(e.dtos={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(e){var o;!function(e){var o=t.framework.dtos.ParamBaseDTO,n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(o);e.GetMaterialStyleListParamDTO=n,__reflect(n.prototype,"cdcommon.editor.dtos.GetMaterialStyleListParamDTO")}(o=e.dtos||(e.dtos={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;
!function(e){var o;!function(e){var o=t.framework.dtos.ResultBaseDTO,n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(o);e.GetMaterialListResultDTO=n,__reflect(n.prototype,"cdcommon.editor.dtos.GetMaterialListResultDTO")}(o=e.dtos||(e.dtos={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(e){var o;!function(e){var o=t.framework.dtos.ParamBaseDTO,n=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.style_id=-1,e.size_id=-1,e.tid="-1",e}return __extends(e,t),e}(o);e.GetMaterialListParamDTO=n,__reflect(n.prototype,"cdcommon.editor.dtos.GetMaterialListParamDTO")}(o=e.dtos||(e.dtos={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(e){var o;!function(e){var o=t.framework.dtos.ResultBaseDTO,n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(o);e.GetLayoutListResultDTO=n,__reflect(n.prototype,"cdcommon.editor.dtos.GetLayoutListResultDTO")}(o=e.dtos||(e.dtos={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(e){var o;!function(e){var o=t.framework.dtos.ParamBaseDTO,n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(o);e.GetLayoutListParamDTO=n,__reflect(n.prototype,"cdcommon.editor.dtos.GetLayoutListParamDTO")}(o=e.dtos||(e.dtos={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(e){var o;!function(e){var o=egret.URLRequest,n=egret.URLRequestMethod,i=egret.URLVariables,r=t.framework.constants.APIConstant,a=t.framework.managers.APIConfig,s=t.framework.events.InterfaceEvent,l=t.framework.services.InterfaceBase,d=t.framework.utils.APIUtils,c=t.editor.dtos.GetWorkParamDTO,h=t.editor.dtos.GetWorkResultDTO,u=t.framework.managers.ModelDataGenerator,m=t.editor.utils.SizeItemUtil,p=t.editor.models.WPageItem,f=t.editor.models.WorkExtraInfo,g=function(t){function e(e){return t.call(this,e)||this}return __extends(e,t),e.prototype.call=function(e){if(t.prototype.call.call(this,e),e instanceof c){var s=e;this.request=new o(a.getItem(r.GET_WORK).url),this.request.method=n.POST;var l=new i;l.variables={},l.variables.wid=s.wid,this._workId=s.wid,this.request.data=l,this.loader.load(this.request)}},e.prototype.onResultHandler=function(t){try{var o=JSON.parse(this.loader.data),n=d.json2ResultDTO(o,new h);if(n.success){var i=n.results[0];n.thumb_url=i.thumb_url,n.work_name=i.work_name,n.template_id=i.template_id,n.template_name=i.template_name,n.goods_id=i.goods_id,n.product_id=i.product_id,n.theme_id=i.theme_id,n.theme_name=i.theme_name,n.uid=i.uid,n.sp_id=i.sp_id,n.agent_id=i.agent_id,n.uid=i.uid,n.thickness=parseFloat(i.thickness),n.size_item=m.jsonObj2SizeItem(i.size_item),n.inpage_count=parseInt(i.inpage_count),n.status=i.status,n.sub_system=i.sub_system,n.pages=this.getPageList(i.pages),n.work_extra_info=this.getWorkExtraInfo(i.work_extra_info),n.wid=this._workId,0==n.pages.length?this.callback(e.EMPTY_CONTENT,this._workId):this.callback(s.COMPLETE,n)}else"60001"==n.err_code?this.callback(e.NOT_FOUND,this._workId):this.callback(s.FAULT,"获取作品信息发生错误\n(ERROR_CODE="+n.err_code+"MSG="+n.err_msg+")")}catch(r){this.callback(s.FAULT,"解析返回结果出错："+r.message)}},e.prototype.onFaultHandler=function(t){this.callback(s.FAULT,"接口IO错误！")},e.prototype.getPageList=function(t){for(var e=[],o=0,n=t;o<n.length;o++){var i=n[o],r=u.fillModelByObject(i,new p,!1);e.push(r)}return e},e.prototype.getWorkExtraInfo=function(t){var e=u.fillModelByObject(t,new f,!0);return e},e.NOT_FOUND="notFound",e.EMPTY_CONTENT="emptyContent",e}(l);e.GetWorkInterface=g,__reflect(g.prototype,"cdcommon.editor.services.GetWorkInterface")}(o=e.services||(e.services={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(e){var o;!function(e){var o=egret.URLRequest,n=egret.URLRequestMethod,i=t.framework.constants.APIConstant,r=t.framework.managers.APIConfig,a=t.framework.events.InterfaceEvent,s=t.framework.services.InterfaceBase,l=t.framework.utils.APIUtils,d=t.editor.dtos.GetWorkIDResultDTO,c=function(t){function e(e){return t.call(this,e)||this}return __extends(e,t),e.prototype.call=function(e){t.prototype.call.call(this,e),this.request=new o(r.getItem(i.GET_WORK_ID).url),this.request.method=n.POST,this.loader.load(this.request)},e.prototype.onResultHandler=function(t){try{var e=JSON.parse(this.loader.data),o=l.json2ResultDTO(e,new d);if(o.success){var n=o.results[0];o.wid=n.wid,this.callback(a.COMPLETE,o)}else this.callback(a.FAULT,"获取作品ID过程发生错误！\n(ERROR_CODE="+o.err_code+"MSG="+o.err_msg+")")}catch(i){this.callback(a.FAULT,"解析返回结果出错："+i.message)}},e.prototype.onFaultHandler=function(t){this.callback(a.FAULT,"接口IO错误！")},e}(s);e.GetWorkIDInterface=c,__reflect(c.prototype,"cdcommon.editor.services.GetWorkIDInterface")}(o=e.services||(e.services={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(e){var o;!function(e){var o=egret.URLRequest,n=egret.URLRequestMethod,i=egret.URLVariables,r=t.framework.constants.APIConstant,a=t.framework.managers.APIConfig,s=t.framework.events.InterfaceEvent,l=t.framework.services.InterfaceBase,d=t.framework.utils.APIUtils,c=t.editor.dtos.GetSupplierInfoParamDTO,h=t.editor.dtos.GetSupplierInfoResultDTO,u=t.framework.models.SupplierInfo,m=function(t){function e(e){return t.call(this,e)||this}return __extends(e,t),e.prototype.call=function(e){if(t.prototype.call.call(this,e),e instanceof c){var s=e;this.request=new o(a.getItem(r.GET_SUPPLIER_INFO).url),this.request.method=n.POST;var l=new i;l.variables={},l.variables.sp_id=s.sp_id,this.request.data=l,this.loader.load(this.request)}},e.prototype.onResultHandler=function(t){try{var e=JSON.parse(this.loader.data),o=d.json2ResultDTO(e,new h);if(o.success){var n=o.results[0],i=n.info;if(i){var r=new u;r.spId=i.sp_id,r.spName=i.sp_name,r.logoUrl=i.logo_url,r.siteUrl=i.site_url,r.contactName=i.contact_name,r.phoneNum=i.phone_num,r.telNum=i.tel_num,r.qq=i.qq,r.email=i.email,r.styleId=i.style_id,o.info=r}this.callback(s.COMPLETE,o)}else this.callback(s.FAULT,"获取商家信息发生错误！\n(ERROR_CODE="+o.err_code+"MSG="+o.err_msg+")")}catch(a){this.callback(s.FAULT,"解析返回结果出错："+a.message)}},e.prototype.onFaultHandler=function(t){this.callback(s.FAULT,"接口IO错误！")},e}(l);e.GetSupplierInfoInterface=m,__reflect(m.prototype,"cdcommon.editor.services.GetSupplierInfoInterface")}(o=e.services||(e.services={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(e){var o;!function(e){var o=egret.URLRequest,n=egret.URLRequestMethod,i=egret.URLVariables,r=t.framework.constants.APIConstant,a=t.framework.managers.APIConfig,s=t.framework.events.InterfaceEvent,l=t.framework.services.InterfaceBase,d=t.framework.utils.APIUtils,c=t.editor.dtos.GetGoodsParamDTO,h=t.editor.dtos.GetGoodsResultDTO,u=t.editor.models.ProductItem,m=t.editor.models.ProductChildItem,p=t.framework.managers.ModelDataGenerator,f=t.editor.utils.SizeItemUtil,g=function(t){function e(e){return t.call(this,e)||this}return __extends(e,t),e.prototype.call=function(e){if(t.prototype.call.call(this,e),e instanceof c){var s=e;this.request=new o(a.getItem(r.GET_GOODS).url),this.request.method=n.POST;var l=new i;l.variables={},l.variables.goods_id=s.goods_id,l.variables.product_id=s.product_id,this.request.data=l,this.loader.load(this.request)}},e.prototype.onResultHandler=function(t){try{var e=JSON.parse(this.loader.data),o=d.json2ResultDTO(e,new h);if(o.success){var n=o.results[0];o.name=n.name,o.type_id=n.type_id.toString(),n.product_item&&(o.product_item=this.generateProductItem(n.product_item)),n.product_item_list&&(o.product_item_list=this.generateProductItemList(n.product_item_list)),o.size_item=f.jsonObj2SizeItem(n.size_item),o.thumb_url=n.thumb_url,o.max_image_count=parseInt(n.max_image_count),o.page_count=parseInt(n.page_count),o.min_image_count=parseInt(n.min_image_count),o.max_page_count=parseInt(n.max_page_count),o.add_page_span=parseInt(n.add_page_span),o.allow_page_adjustment=parseInt(n.allow_page_adjustment),this.callback(s.COMPLETE,o)}else this.callback(s.FAULT,"获取商品信息过程错误\n(ERROR_CODE="+o.err_code+"MSG="+o.err_msg+")")}catch(i){this.callback(s.FAULT,"解析返回结果出错："+i.message)}},e.prototype.onFaultHandler=function(t){this.callback(s.FAULT,"接口IO错误！")},e.prototype.generateProductItem=function(t){var e=new u;return e.id=t.id,e.name=t.name,e.infos=this.generateProductChildItemList(t.infos),e},e.prototype.generateProductChildItemList=function(t){for(var e=[],o=0,n=t;o<n.length;o++){var i=n[o],r=p.fillModelByObject(i,new m);e.push(r)}return e},e.prototype.generateProductItemList=function(t){for(var e=[],o=0,n=t;o<n.length;o++){var i=n[o],r=this.generateProductItem(i);e.push(r)}return e},e}(l);e.GetGoodsInterface=g,__reflect(g.prototype,"cdcommon.editor.services.GetGoodsInterface")}(o=e.services||(e.services={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(t){var e;!function(t){var e=function(){function t(){}return t.DOING=1,t.SUBMITTED=2,t.AUDITED=3,t}();t.WorksStatusConstant=e,__reflect(e.prototype,"cdcommon.editor.constants.WorksStatusConstant")}(e=t.constants||(t.constants={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(t){var e;!function(t){var e=function(e){function o(){var t=e.call(this)||this;return t._children=[],t._processed=0,t}return __extends(o,e),Object.defineProperty(o.prototype,"children",{get:function(){return this._children},set:function(t){this._children=t},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"size",{get:function(){return this.countChildren(this)},enumerable:!0,configurable:!0}),o.prototype.countChildren=function(t){for(var e=t.children.length,o=0,n=t.children;o<n.length;o++){var i=n[o];i&&(e+=this.countChildren(i))}return e},Object.defineProperty(o.prototype,"processed",{get:function(){return this._processed},enumerable:!0,configurable:!0}),o.prototype.addChild=function(t){null!=t&&this._children.push(t)},o.prototype.removeChild=function(t){if(null!=t){var e=this._children.indexOf(t);e>=0&&this._children.splice(e,1)}},o.prototype.processChild=function(e){if(null==e)throw new Error("Cannot start processing a null task");return e.enabled?(e.addEventListener(t.TaskEvent.TASK_START,this.onChildTaskStart,this),e.addEventListener(t.TaskEvent.TASK_COMPLETE,this.onChildTaskComplete,this),e.addEventListener(t.TaskEvent.TASK_FAULT,this.onChildTaskFault,this),e.addEventListener(t.TaskEvent.TASK_PROGRESS,this.onChildTaskProgress,this),e.addEventListener(t.TaskEvent.CHILD_START,this.dispatchEvent,this),e.addEventListener(t.TaskEvent.CHILD_COMPLETE,this.dispatchEvent,this),e.addEventListener(t.TaskEvent.CHILD_FAULT,this.dispatchEvent,this),e.start(),!0):(this.dispatchNextProgressEvent(),!1)},o.prototype.onChildTaskStart=function(e){this.dispatchEvent(t.TaskEvent.createChildStartEvent(e.task))},o.prototype.onChildTaskComplete=function(e){this.cleanUpChild(e.task),this.dispatchEvent(t.TaskEvent.createChildCompleteEvent(e.task)),this.dispatchNextProgressEvent()},o.prototype.onChildTaskFault=function(e){this.cleanUpChild(e.task),this.dispatchEvent(t.TaskEvent.createChildFaultEvent(e.task,e.message))},o.prototype.dispatchNextProgressEvent=function(){this.dispatchEvent(t.TaskEvent.createProgressEvent(this,++this._processed,this.size))},o.prototype.onChildTaskProgress=function(t){this.dispatchNextProgressEvent()},o.prototype.cleanUpChild=function(e){e.removeEventListener(t.TaskEvent.TASK_START,this.onChildTaskStart,this),e.removeEventListener(t.TaskEvent.TASK_COMPLETE,this.onChildTaskComplete,this),e.removeEventListener(t.TaskEvent.TASK_FAULT,this.onChildTaskFault,this),e.removeEventListener(t.TaskEvent.TASK_PROGRESS,this.onChildTaskProgress,this),e.removeEventListener(t.TaskEvent.CHILD_START,this.dispatchEvent,this),e.removeEventListener(t.TaskEvent.CHILD_COMPLETE,this.dispatchEvent,this),e.removeEventListener(t.TaskEvent.CHILD_FAULT,this.dispatchEvent,this)},o}(t.Task);t.TaskGroup=e,__reflect(e.prototype,"cdcommon.framework.task.TaskGroup",["cdcommon.framework.task.ITaskGroup"])}(e=t.task||(t.task={}))}(e=t.framework||(t.framework={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(t){var e;!function(t){var e=function(){function t(){}return t.getNameByType=function(e){var o;switch(e){case t.PHOTO_BOOK:o=t.PHOTO_BOOK_NAME;break;case t.CALENDAR:o=t.CALENDAR_NAME;break;case t.PRINT:o=t.PRINT_NAME;break;case t.PHONE:o=t.PHONE_NAME;break;case t.CARD:o=t.CARD_NAME;break;case t.FRAME:o=t.FRAME_NAME;break;case t.T_SHIRT:o=t.T_SHIRT_NAME;break;case t.CUP:o=t.CUP_NAME;break;default:o="未知产品类型"}return o},t.PHOTO_BOOK="50",t.CALENDAR="51",t.PRINT="52",t.PHONE="-9",t.CARD="55",t.FRAME="54",t.T_SHIRT="-99",t.CUP="53",t.PHOTO_BOOK_NAME="照片书",t.CALENDAR_NAME="台历",t.PRINT_NAME="冲印",t.PHONE_NAME="手机壳",t.CARD_NAME="海报&名片",t.FRAME_NAME="摆台相框",t.T_SHIRT_NAME="T恤",t.CUP_NAME="杯子",t}();t.GoodsTypeConstant=e,__reflect(e.prototype,"cdcommon.editor.constants.GoodsTypeConstant")}(e=t.constants||(t.constants={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var models;!function(t){var e=cdcommon.editor.constants.EditorTypeConstant,o=cdcommon.editor.constants.EditorModeConstant,n=function(){function t(){this.editorType=e.OPEN,this.editorMode=o.NORMAL}return t}();t.ArgumentModel=n,__reflect(n.prototype,"models.ArgumentModel")}(models||(models={}));var cdcommon;!function(t){var e;!function(e){var o;!function(e){var o=egret.URLRequest,n=egret.URLRequestMethod,i=egret.URLVariables,r=t.framework.constants.APIConstant,a=t.framework.managers.APIConfig,s=t.framework.events.InterfaceEvent,l=t.framework.services.InterfaceBase,d=t.framework.utils.APIUtils,c=t.editor.dtos.GetAgentInfoParamDTO,h=t.editor.dtos.GetAgentInfoResultDTO,u=t.framework.models.AgentInfo,m=function(t){function e(e){return t.call(this,e)||this}return __extends(e,t),e.prototype.call=function(e){if(t.prototype.call.call(this,e),e instanceof c){var s=e;this.request=new o(a.getItem(r.GET_AGENT_INFO).url),this.request.method=n.POST;var l=new i;l.variables={},l.variables.agent_id=s.agent_id,this.request.data=l,this.loader.load(this.request)}},e.prototype.onResultHandler=function(t){try{var e=JSON.parse(this.loader.data),o=d.json2ResultDTO(e,new h);if(o.success){var n=o.results[0],i=n.info;if(i){var r=new u;r.agent_id=i.agent_id,r.group_id=i.group_id,r.true_name=i.true_name,r.shop_name=i.shop_name,r.shop_url=i.shop_url,r.shop_type_id=parseInt(i.shop_type_id),r.mobile=i.mobile,r.qq=i.qq,r.email=i.email,r.status=parseInt(i.status),o.info=r}this.callback(s.COMPLETE,o)}else this.callback(s.FAULT,"获取分销商信息发生错误！\n(ERROR_CODE="+o.err_code+"MSG="+o.err_msg+")")}catch(a){this.callback(s.FAULT,"解析返回结果出错："+a.message)}},e.prototype.onFaultHandler=function(t){this.callback(s.FAULT,"接口IO错误！")},e}(l);e.GetAgentInfoInterface=m,__reflect(m.prototype,"cdcommon.editor.services.GetAgentInfoInterface")}(o=e.services||(e.services={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(e){var o;!function(e){var o=t.framework.dtos.ResultBaseDTO,n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(o);e.GetTemplateThemeListResultDTO=n,__reflect(n.prototype,"cdcommon.editor.dtos.GetTemplateThemeListResultDTO")}(o=e.dtos||(e.dtos={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(e){var o;!function(e){var o=t.framework.dtos.ParamBaseDTO,n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(o);e.GetTemplateThemeListParamDTO=n,__reflect(n.prototype,"cdcommon.editor.dtos.GetTemplateThemeListParamDTO")}(o=e.dtos||(e.dtos={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(t){var e;!function(t){var e=function(){function t(){}return t.WORK_ID="w",t.PRODUCT_ID="p",t.GOODS_ID="g",t.TEMPLATE_ID="t",t.USER_ID="u",t.AGENT_ID="a",t.SUPPLIER_ID="sp",t.PAGE_COUNT="pc",t.ORDER_NO="order_no",t.EDITOR_MODE="m",t}();t.ArgumentConstant=e,__reflect(e.prototype,"cdcommon.editor.constants.ArgumentConstant")}(e=t.constants||(t.constants={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(e){var o;!function(e){var o=t.framework.dtos.ResultBaseDTO,n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(o);e.GetTemplateListResultDTO=n,__reflect(n.prototype,"cdcommon.editor.dtos.GetTemplateListResultDTO")}(o=e.dtos||(e.dtos={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(e){var o;!function(e){var o=t.editor.managers.ElementModelController,n=function(t){function e(){var e=t.call(this)||this;return e.elementModelController=o.getInstance(),e}return __extends(e,t),e.prototype.addElementToStage=function(e,o){void 0===o&&(o=!1),t.prototype.addElementToStage.call(this,e,o),this.elementModelController.addModel(e,e.elementType)},e.prototype.removeElementFromStage=function(e){t.prototype.removeElementFromStage.call(this,e),this.elementModelController.removeModel(e.id,e.elementType)},e.prototype.init=function(e){void 0===e&&(e=null),t.prototype.init.call(this,e)},e.prototype.clear=function(){t.prototype.clear.call(this)},e.prototype.destroy=function(){t.prototype.destroy.call(this)},e.prototype.partAdded=function(e,o){t.prototype.partAdded.call(this,e,o)},e.prototype.partRemoved=function(e,o){t.prototype.partRemoved.call(this,e,o)},e.prototype.getCurrentState=function(){var e=t.prototype.getCurrentState.call(this);return this._displayState&&(e=this._displayState),e},e}(e.StageOverviewBase);e.StageOverview=n,__reflect(n.prototype,"cdcommon.editor.components.StageOverview")}(o=e.components||(e.components={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(e){var o;!function(e){var o=t.framework.dtos.ParamBaseDTO,n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(o);e.GetTemplateListParamDTO=n,__reflect(n.prototype,"cdcommon.editor.dtos.GetTemplateListParamDTO")}(o=e.dtos||(e.dtos={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(t){var e;!function(t){var e=function(){function t(){}return t.copyToClipboard=function(t){var e=document.createElement("input");e.value=t,document.body.appendChild(e),e.select(),document.execCommand("Copy"),e.style.display="none",document.body.removeChild(e)},t}();t.CopyUtils=e,__reflect(e.prototype,"cdcommon.framework.utils.CopyUtils")}(e=t.utils||(t.utils={}))}(e=t.framework||(t.framework={}))}(cdcommon||(cdcommon={}));var views;!function(t){var e=cdcommon.framework.views.SceneBase,o=eui.Button,n=egret.TouchEvent,i=egret.Event,r=eui.UIEvent,a=presentations.PrinterOverviewPM,s=t.PhotoManagerPanel,l=cdcommon.framework.managers.PopUpManager,d=uploads.OSSUploadConfig,c=managers.PhotoUploadManager,h=cdcommon.editor.models.PhotoItem,u=cdcommon.editor.constants.PhotoStatus,m=cdcommon.framework.components.AlertTip,p=t.PageList,f=cdcommon.editor.dtos.SaveWorkDataParamDTO,g=cdcommon.editor.constants.SubSystemConstant,v=cdcommon.editor.managers.PageModelController,_=t.SaveWorksConfirmPopup,y=t.AgentSaveWorkResultPopup,E=cdcommon.editor.events.PhotoItemRenderEvent,C=cdcommon.editor.managers.LeftPhotoItemController,M=cdcommon.framework.utils.BitmapDataUtil,I=cdcommon.editor.managers.PhotoUsedCountController,T=utils.PhotoBrowser,w=function(e){function w(){var t=e.call(this)||this;return t.currPrintCount=0,t.photoUploadManager=c.getInstance(),t.photoUploadManager.addEventListener(c.START,t.onPhotoUploadResult,t),t.photoUploadManager.addEventListener(c.UPDATE,t.onPhotoUploadResult,t),t.photoUploadManager.addEventListener(c.FINISHED,t.onPhotoUploadResult,t),t.addEventListener(E.ADD,t.handlePhotoItemRenderEvents,t),t}return __extends(w,e),Object.defineProperty(w.prototype,"pm",{get:function(){return this._pm||(this._pm=new a),this._pm},enumerable:!0,configurable:!0}),w.prototype.showLoader=function(){this._displayState="loading",this.invalidateState()},w.prototype.hideLoader=function(){this._displayState=null,this.invalidateState()},w.prototype.resetFlags=function(){this._isAddingToCart=!1},w.prototype.updateUploadTip=function(){var t=this.pm.workModel,e=t.goodsInfo;if(this.uploadTipDisplay&&e){var o=void 0;this.currPrintCount=0;for(var n=v.getInstance().getModelList(),i=0,r=n;i<r.length;i++){var a=r[i];this.currPrintCount+=a.printCount}o=e.allowPageAdjustment?[{text:"提示：单次只能上传"},{text:" "+T.ONCE_MAX_UPLOAD_COUNT+" ",style:{bold:!0}},{text:"张照片\n\n"},{text:"当前冲印张数：",style:{bold:!0}},{text:" "+this.currPrintCount+" ",style:{textColor:39168,bold:!0}},{text:"张",style:{bold:!0}}]:[{text:"提示：单次只能上传"},{text:" "+T.ONCE_MAX_UPLOAD_COUNT+" ",style:{bold:!0}},{text:"张照片\n\n"},{text:"当前："},{text:" "+this.currPrintCount+" ",style:{bold:!0}},{text:"张，最小："},{text:" "+T.MIN_UPLOAD_COUNT+" ",style:{textColor:39168}},{text:"张，最大："},{text:" "+T.TOTAL_MAX_UPLOAD_COUNT+" ",style:{textColor:16461386}},{text:"张"}],this.uploadTipDisplay.textFlow=o}},w.prototype.init=function(t){e.prototype.init.call(this,t);var o=t;this.pm.view=this,this.pm.workModel=o,this.getInitializedData()["catch"](function(t){console.log("[ERROR] getInitializedData()",t)}),d.init()},w.prototype.destroy=function(){e.prototype.destroy.call(this),this.removeEventListener(E.ADD,this.handlePhotoItemRenderEvents,this)},w.prototype.getCurrentState=function(){var t=e.prototype.getCurrentState.call(this);return this._displayState&&(t=this._displayState),t},w.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.pageListGroup&&(this.pageList=new p,this.pageList.percentWidth=this.pageList.percentHeight=100,this.pageList.addEventListener(p.EVENT_ITEM_SELECTED_CHANGE,this.onPageItemSelectedChange,this),this.pageList.addEventListener(p.EVENT_ITEM_PRINT_COUNT_CHANGE,this.onPageItemPrintCountChange,this),this.pageListGroup.addChild(this.pageList))},w.prototype.partAdded=function(t,r){e.prototype.partAdded.call(this,t,r),r instanceof o&&mouse.setButtonMode(r,!0),r==this.batchButton?this.batchButton.addEventListener(n.TOUCH_TAP,this.onBatchButtonClick,this):r==this.backButton?this.backButton.addEventListener(n.TOUCH_TAP,this.onBackButtonClick,this):r==this.uploadButton?this.uploadButton.addEventListener(n.TOUCH_TAP,this.onUploadButtonClick,this):r==this.uploadProgressBar?this.uploadProgressBar.labelFunction=function(t,e){return Math.round(t/e*100)+"%"}:r==this.batchCutButton?this.batchCutButton.addEventListener(n.TOUCH_TAP,this.onBatchActionsButtonClick,this):r==this.batchWhiteSpaceButton?this.batchWhiteSpaceButton.addEventListener(n.TOUCH_TAP,this.onBatchActionsButtonClick,this):r==this.batchDeleteButton?this.batchDeleteButton.addEventListener(n.TOUCH_TAP,this.onBatchActionsButtonClick,this):r==this.selectAllCheckBox?this.selectAllCheckBox.addEventListener(i.CHANGE,this.onSelectAllChange,this):r==this.saveButton?this.saveButton.addEventListener(n.TOUCH_TAP,this.onSaveButtonClick,this):r==this.submitButton&&this.submitButton.addEventListener(n.TOUCH_TAP,this.onSubmitButtonClick,this)},w.prototype.partRemoved=function(t,r){e.prototype.partRemoved.call(this,t,r),r instanceof o&&mouse.setButtonMode(r,!1),r==this.batchButton?this.batchButton.removeEventListener(n.TOUCH_TAP,this.onBatchButtonClick,this):r==this.backButton?this.backButton.removeEventListener(n.TOUCH_TAP,this.onBackButtonClick,this):r==this.uploadButton?this.uploadButton.removeEventListener(n.TOUCH_TAP,this.onUploadButtonClick,this):r==this.uploadProgressBar?this.uploadProgressBar.labelFunction=null:r==this.batchCutButton?this.batchCutButton.removeEventListener(n.TOUCH_TAP,this.onBatchActionsButtonClick,this):r==this.batchWhiteSpaceButton?this.batchWhiteSpaceButton.removeEventListener(n.TOUCH_TAP,this.onBatchActionsButtonClick,this):r==this.batchDeleteButton?this.batchDeleteButton.removeEventListener(n.TOUCH_TAP,this.onBatchActionsButtonClick,this):r==this.selectAllCheckBox?this.selectAllCheckBox.removeEventListener(i.CHANGE,this.onSelectAllChange,this):r==this.saveButton?this.saveButton.removeEventListener(n.TOUCH_TAP,this.onSaveButtonClick,this):r==this.submitButton&&this.submitButton.removeEventListener(n.TOUCH_TAP,this.onSubmitButtonClick,this)},w.prototype.getInitializedData=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return EditorCommon.editorType!=EditorTypeConstant.OPEN?[3,4]:[4,this.pm.getGoodsInfoCall()];case 1:return e.sent(),[4,this.pm.getWorksIDCall()];case 2:return e.sent(),[4,this.pm.getTemplateCall()];case 3:return e.sent(),[3,10];case 4:return EditorCommon.editorType!=EditorTypeConstant.WORK?[3,10]:[4,this.pm.getWorkInfoCall()];case 5:return e.sent(),t=this.pm.workModel,t.agentId&&""!=t.agentId?[4,this.pm.getAgentInfoCall()]:[3,7];case 6:e.sent(),e.label=7;case 7:return[4,this.pm.getGoodsInfoCall()];case 8:return e.sent(),[4,this.pm.getTemplateCall()];case 9:e.sent(),e.label=10;case 10:return this.initOverview(),[2]}})})},w.prototype.initOverview=function(){var t=this.pm.workModel;if(this.spInfoDisplay){var e=UserModelController.getInstance().userModel.supplierInfo,o=UserModelController.getInstance().userModel.agentInfo;o?this.spInfoDisplay.text=o.shop_name:this.spInfoDisplay.text=e.spName}if(this.goodsCoverImage&&(this.goodsCoverImage.source=t.goodsInfo.thumbUrl),this.goodsNameDisplay&&(this.goodsNameDisplay.text=t.goodsInfo.name),this.sizeItemDisplay&&(this.sizeItemDisplay.text=t.sizeItem.name),this.worksNameDisplay&&(this.worksNameDisplay.text=t.workName),GlobalCommon.isAgentMode?(this.addToCartButton&&(this.addToCartButton.visible=this.addToCartButton.includeInLayout=!1),this.submitButton&&(this.submitButton.label="提交作品")):this.submitButton&&(this.submitButton.label="立刻购买"),EditorCommon.editorType==EditorTypeConstant.OPEN);else if(EditorCommon.editorType==EditorTypeConstant.WORK){this.createPhotoManagerPanel(!0),this.pm.workModel.status!=WorksStatusConstant.DOING&&this.pageList&&this.pageList.setDisplayOnly(),t.pageList=this.pm.generateWorksPageModelList();for(var n=void 0,i=0,r=t.pageList;i<r.length;i++){n=r[i];var a=n.elementList.getItemAt(0),s=new h;s.id=a.relatedId,C.getInstance().addModel(s),this.pageList.addItem(n,s)}}},w.prototype.onUploadButtonClick=function(t){this.createPhotoManagerPanel(),l.addPopUp(this.photoManagerPanel,GlobalCommon.rootContainer,!0),l.centerPopUp(this.photoManagerPanel)},w.prototype.createPhotoManagerPanel=function(t){void 0===t&&(t=!1);var e=this;this.photoManagerPanel?this.photoManagerPanel.init():(this.photoManagerPanel=new s,this.photoManagerPanel.addEventListener(s.EVENT_EXPORT,this.onPhotoManagerPanelHandler,this),this.photoManagerPanel.addEventListener(s.EVENT_REMOVE,this.onPhotoManagerPanelHandler,this),this.photoManagerPanel.skinName="app.PhotoManagerPanelSkin",this.photoManagerPanel.title="图片管理",this.photoManagerPanel.once(r.CREATION_COMPLETE,function(o){e.photoManagerPanel.init(),t&&e.photoManagerPanel.parent&&e.photoManagerPanel.parent.removeChild(e.photoManagerPanel)},this),this.photoManagerPanel.width=1070,this.photoManagerPanel.height=.75*egret.MainContext.instance.stage.stageHeight),t&&GlobalCommon.rootContainer.addChild(this.photoManagerPanel)},w.prototype.onPhotoUploadResult=function(t){if(t.type==c.START)this.displayUploadingInfo(!0,"",0);else if(t.type==c.UPDATE){var e=t.data;if(e&&(e.status==u.UPLOAD_COMPLETE||e.status==u.UPLOAD_FAULT)){var o=Math.round(this.photoUploadManager.uploadedCount/this.photoUploadManager.totalCount*100),n=this.photoUploadManager.totalCount.toString(),i=this.photoUploadManager.uploadedCount.toString(),r=this.photoUploadManager.errorCount.toString(),a=[{text:"总上传："},{text:""+n,style:{bold:!0}},{text:"张、"},{text:"已传："},{text:""+i,style:{bold:!0,textColor:39168}},{text:"张、"},{text:"失败："},{text:""+r,style:{bold:!0,textColor:16711680}},{text:"张"}];this.displayUploadingInfo(!0,a,o)}}else if(t.type==c.FINISHED)if(this.photoUploadManager.errorCount>0){var s='\n                    <e:Group id="contentGroups" left="0" right="0" top="0" bottom="0">\n                        <e:Rect id="backgroundRect" left="0" right="0" top="0" bottom="0" fillColor="0xFF0000" fillAlpha="0.5" strokeColor="0xCCCCCC" strokeAlpha="1"/>\n\n                        <e:Label id="textComp" verticalCenter="0" horizontalCenter="0" textAlign="center" textColor="0xFFFFFF"\n                                left="30" right="30" top="20" bottom="20" size="14" multiline="true"/>\n                    </e:Group>\n                    ';l.contains(this.photoManagerPanel)?m.show("上传过程存在 "+this.photoUploadManager.errorCount+" 张照片上传失败！请在照片列表中找到失败项尝试重新上传。",300,GlobalCommon.rootContainer,s):m.show("上传过程存在 "+this.photoUploadManager.errorCount+" 张照片上传失败！请打开管理面板尝试重新上传。",300,GlobalCommon.rootContainer,s)}else this.displayUploadingInfo(!1,"",0)},w.prototype.displayUploadingInfo=function(t,e,o){this.uploadingInfoGroup&&this.uploadingInfoGroup.visible!=t&&(this.uploadingInfoGroup.visible=this.uploadingInfoGroup.includeInLayout=t),this.uploadProgressBar&&(this.uploadProgressBar.value=Math.round(o)),this.uploadingInfoDisplay&&(e instanceof Array?this.uploadingInfoDisplay.textFlow=e:this.uploadingInfoDisplay.text=e)},w.prototype.onSaveButtonClick=function(t){var e=this;this.saveButton.touchEnabled=!1,egret.setTimeout(function(){e.saveButton.touchEnabled=!0},this,1e3),this.saveOrSubmitWorks(!1,!0)},w.prototype.onSubmitButtonClick=function(t){this.saveOrSubmitWorks(!0,!0)},w.prototype.saveOrSubmitWorks=function(e,o){return void 0===o&&(o=!0),__awaiter(this,void 0,void 0,function(){var n=this;return __generator(this,function(i){if(c.getInstance().isUploading)return m.show("部分照片仍在上传，请上传完毕后再保存！",1500,this),[2];if(0==this.pageList.getItemList().length)return m.show("请至少添加 1 张冲印照片再"+(e?"提交":"保存")+"！",1e3,this),[2];if(e&&!this.pm.workModel.goodsInfo.allowPageAdjustment){if(T.MIN_UPLOAD_COUNT>0&&this.currPrintCount<T.MIN_UPLOAD_COUNT)return m.show("该商品至少冲印 "+T.MIN_UPLOAD_COUNT+" 张照片，请修改冲印数量或添加更多照片！",1e3,this),[2];if(T.TOTAL_MAX_UPLOAD_COUNT>0&&this.currPrintCount>T.TOTAL_MAX_UPLOAD_COUNT)return m.show("该商品最多冲印 "+T.MIN_UPLOAD_COUNT+" 张照片，请修改冲印数量或删除部分照片！",1e3,this),[2]}return this.showSaveConfirmPopup(e).then(function(){n.pm.saveWorksDataCall(n.createSaveWorkDataParam(e)).then(function(i){if(n.hideLoader(),o)if(e){var a=m.show("提交作品成功，正在跳转完成页面...",1500);a.once("removed",function(e){var o=new t.AgentSubmitWorkResultView;o.left=o.right=0,o.top=60,o.bottom=80,o.once(r.CREATION_COMPLETE,function(t){o.init(n.pm.workModel)},n),l.addPopUp(o,GlobalCommon.rootContainer,!1),l.centerPopUp(o)},n)}else UserModelController.getInstance().userModel.agentInfo?(n.agentSaveWorksResultPopup?n.agentSaveWorksResultPopup.init():(n.agentSaveWorksResultPopup=new y,n.agentSaveWorksResultPopup.once(r.CREATION_COMPLETE,function(t){this.agentSaveWorksResultPopup.init()},n)),l.addPopUp(n.agentSaveWorksResultPopup,GlobalCommon.rootContainer,!0),l.centerPopUp(n.agentSaveWorksResultPopup)):m.show("保存作品成功！",1500),n.updateWorksUrl()})})["catch"](function(t){console.log("reason",t)}),this.showLoader(),[2]})})},w.prototype.showSaveConfirmPopup=function(t){var e=this,o=this;return new Promise(function(n,i){var a=function(t){console.log("showSaveConfirmPopup callback",t),t?n():i("cancel")};o.saveWorksConfirmPopup?o.saveWorksConfirmPopup.init(o.pm.workModel,t,a,e):(o.saveWorksConfirmPopup=new _,o.saveWorksConfirmPopup.visible=!1,o.saveWorksConfirmPopup.once(r.CREATION_COMPLETE,function(e){o.saveWorksConfirmPopup.init(o.pm.workModel,t,a,this)},o)),l.addPopUp(o.saveWorksConfirmPopup,GlobalCommon.rootContainer,!0),l.centerPopUp(o.saveWorksConfirmPopup)})},w.prototype.createSaveWorkDataParam=function(t){var e=this.pm,o=UserModelController.getInstance().userModel,n=new f;
n.wid=e.workModel.workId,n.uid=e.workModel.uid,n.agent_id=o.agentInfo?o.agentInfo.agent_id:"",n.sp_id=o.supplierInfo.spId,n.tsid=e.workModel.templateId,n.pid=e.workModel.productId,n.work_name=e.workModel.workName,n.work_extra_info=e.workModel.workExtraInfo?JSON.stringify(e.workModel.workExtraInfo):"",n.is_submit=t?1:0,o.agentInfo?n.sub_system=g.AGENT:n.sub_system=g.HTML5,n.sys_version=GlobalCommon.versionInfo,n.mask_total_count=0,n.mask_empty_count=0,n.bad_px_count=0,n.is_mobile=1,e.workModel.pageList=this.generateSaveWorksPageList();var i=v.getInstance().createSaveWorkPageItemList(e.workModel.pageList);return n.pages=JSON.stringify(i),n},w.prototype.generateSaveWorksPageList=function(){for(var t,e=[],o=this.pageList.getItemList(),n=-1,i=0,r=o;i<r.length;i++){t=r[i];var a=t.getModel(!0);a.pageIndex=++n,e.push(a);for(var s=t.printCount-1,l=0;s>0;){var d=a.clone();d.pageIndex=++n,d.pageName+="-"+ ++l,e.push(d),s--}}return e},w.prototype.onPhotoManagerPanelHandler=function(t){var e;if(t.type==s.EVENT_EXPORT)for(var o=t.data,n=0,i=o;n<i.length;n++){e=i[n];var r=this.pm.createPageTemplateModel();this.pageList.addItem(r,e)}else t.type==s.EVENT_REMOVE&&(e=t.data,this.pageList.removeItem(e.id));this.updateUploadTip()},w.prototype.onPageItemSelectedChange=function(t){this.selectAllCheckBox&&(this.selectAllCheckBox.selected=this.pageList.isSelectAll)},w.prototype.onPageItemPrintCountChange=function(t){this.updateUploadTip()},w.prototype.onBatchButtonClick=function(t){this.changeState("batching"),this.pageList.openSelectionMode(!0)},w.prototype.onBackButtonClick=function(t){this.changeState(null),this.pageList.openSelectionMode(!1),this.selectAllCheckBox.selected=!1},w.prototype.onSelectAllChange=function(t){this.selectAllCheckBox.selected?this.pageList.selectAllItem():this.pageList.unSelectAllItem()},w.prototype.onBatchActionsButtonClick=function(t){t.target==this.batchCutButton?this.pageList.batchSetClipForSelection(!0):t.target==this.batchWhiteSpaceButton?this.pageList.batchSetClipForSelection(!1):t.target==this.batchDeleteButton&&this.pageList.batchDeleteForSelection()},w.prototype.handlePhotoItemRenderEvents=function(t){C.getInstance();if(t.type==E.ADD){if(!this.photoManagerPanel)return;var e=t.photoItem;this.photoManagerPanel.uploadView.containsItem(e.id)||(!e.thumb_url&&e.source&&(e.thumb_url=M.scaleByMaxEdge(e.source,PhotoTools.SMARLL_SIZE_PX)),this.photoManagerPanel.uploadView.addPhotoItem(e),I.getInstance().addUsed(e.id))}this.updateUploadTip()},w.prototype.changeState=function(t){this._displayState=t,this.invalidateState()},w.prototype.updateWorksUrl=function(){var t=window.location.href,e=t.substring(0,t.lastIndexOf("?")+1),o=WorkModelController.getInstance().workModel,n=UserModelController.getInstance().userModel,i=e+ArgumentConstant.WORK_ID+"="+o.workId+"&"+ArgumentConstant.SUPPLIER_ID+"="+n.supplierInfo.spId;return t!=i&&window.history&&history.pushState&&window.history.pushState(null,null,i),i},w}(e);t.PrinterOverview=w,__reflect(w.prototype,"views.PrinterOverview")}(views||(views={}));var cdcommon;!function(t){var e;!function(t){var e;!function(t){var e=function(){function t(t){this.dataURI=t}return t.prototype.dataURItoBlob=function(){var t=this.getMimeString(),e=this.convertToTypedArray();return new Blob([e],{type:t})},t.prototype.getByteString=function(){var t;return t=this.dataURI.split(",")[0].indexOf("base64")>=0?atob(this.dataURI.split(",")[1]):decodeURI(this.dataURI.split(",")[1])},t.prototype.getMimeString=function(){return this.dataURI.split(",")[0].split(":")[1].split(";")[0]},t.prototype.convertToTypedArray=function(){for(var t=this.getByteString(),e=new Uint8Array(t.length),o=0;o<t.length;o++)e[o]=t.charCodeAt(o);return e},t}();t.ImageDataConverter=e,__reflect(e.prototype,"cdcommon.framework.utils.ImageDataConverter")}(e=t.utils||(t.utils={}))}(e=t.framework||(t.framework={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(t){var e;!function(t){var e=function(e){function o(){return e.call(this)||this}return __extends(o,e),o.prototype.performTask=function(){this.hasNoEnabledChildren?this.complete():this.processChildren()},Object.defineProperty(o.prototype,"hasNoEnabledChildren",{get:function(){for(var t=0,e=this.children;t<e.length;t++){var o=e[t];if(o.enabled)return!1}return!0},enumerable:!0,configurable:!0}),o.prototype.processChildren=function(){for(var t=0,e=this.children;t<e.length;t++){var o=e[t];this.processChild(o)}},o.prototype.onChildTaskComplete=function(o){e.prototype.onChildTaskComplete.call(this,o),this.processed==this.size&&this.currentState!=t.TaskEvent.TASK_FAULT&&this.complete()},o.prototype.onChildTaskFault=function(t){e.prototype.onChildTaskFault.call(this,t),this.fault(t.message)},o}(t.TaskGroup);t.ParallelTask=e,__reflect(e.prototype,"cdcommon.framework.task.ParallelTask")}(e=t.task||(t.task={}))}(e=t.framework||(t.framework={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(t){var e;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e.currentIndex=0,e}return __extends(e,t),e.prototype.performTask=function(){this.startNextTask()},e.prototype.onChildTaskComplete=function(e){t.prototype.onChildTaskComplete.call(this,e),this.startNextTask()},e.prototype.onChildTaskFault=function(e){t.prototype.onChildTaskFault.call(this,e),this.fault(e.message)},e.prototype.startNextTask=function(){if(this.hasMoreTasks){var t=0==this.processChild(this.getNextChild());t&&this.startNextTask()}else this.complete()},Object.defineProperty(e.prototype,"hasMoreTasks",{get:function(){return this.children&&this.currentIndex<this.children.length},enumerable:!0,configurable:!0}),e.prototype.getNextChild=function(){return this.children[this.currentIndex++]},e.prototype.removeChild=function(e){this.currentIndex=this.processed,t.prototype.removeChild.call(this,e)},e}(t.TaskGroup);t.SequenceTask=e,__reflect(e.prototype,"cdcommon.framework.task.SequenceTask")}(e=t.task||(t.task={}))}(e=t.framework||(t.framework={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(e){var o;!function(e){var o=t.framework.models.GlobalCommon,n=function(){function t(){this._fontSize=40;var t=document.getElementById("gameDiv");this.p=document.createElement("p"),t.appendChild(this.p),this.p.style.border="0px",this.p.style.backgroundColor="transparent",this.p.style.position="absolute",this.p.style.fontSize=this.fontSize+"px",this.p.style.display="none",this.p.style.color="#000000",this.p.style.textAlign="center"}return Object.defineProperty(t.prototype,"fontSize",{get:function(){return this._fontSize},set:function(t){this._fontSize=t,this.p.style.fontSize=this._fontSize+"px"},enumerable:!0,configurable:!0}),t.prototype.setValue=function(t){this.p.style.display="inline",this.p.innerHTML=t},t.prototype.setPosition=function(t,e,n,i){var r=document.body.clientWidth/o.rootContainer.stage.stageWidth,a=document.body.clientHeight/o.rootContainer.stage.stageHeight;this.p.style.left=t*r+"px",this.p.style.top=e*a-this.fontSize+"px",this.p.style.width=n*r+"px",this.p.style.height=i*a+"px",this.p.style.display="inline"},t.prototype.show=function(){this.p&&(this.p.style.display="inline")},t.prototype.hide=function(){this.p&&(this.p.style.display="none")},t}();e.HTMLText=n,__reflect(n.prototype,"cdcommon.framework.components.HTMLText")}(o=e.components||(e.components={}))}(e=t.framework||(t.framework={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(e){var o;!function(e){var o=egret.URLRequest,n=egret.URLRequestMethod,i=egret.URLVariables,r=t.framework.constants.APIConstant,a=t.framework.managers.APIConfig,s=t.framework.events.InterfaceEvent,l=t.framework.services.InterfaceBase,d=t.framework.utils.APIUtils,c=t.editor.dtos.GetTemplateListParamDTO,h=t.editor.dtos.GetTemplateListResultDTO,u=t.framework.managers.ModelDataGenerator,m=t.editor.models.TemplateItem,p=function(t){function e(e){return t.call(this,e)||this}return __extends(e,t),e.prototype.call=function(e){if(t.prototype.call.call(this,e),e instanceof c){var s=e;this.request=new o(a.getItem(r.GET_TEMPLATE_LIST).url),this.request.method=n.POST;var l=new i;l.variables={},l.variables.sp_id=UserModelController.getInstance().userModel.supplierInfo.spId,l.variables.size_id=s.size_id,l.variables.theme_id=s.theme_id,l.variables.size=s.size,l.variables.index=s.index-1,l.variables.all_state=s.all_state,console.log("args",l),this.request.data=l,this.loader.load(this.request)}},e.prototype.onResultHandler=function(t){try{var e=JSON.parse(this.loader.data),o=d.json2ResultDTO(e,new h);if(console.log("resultDTO",e),o.success){if(o.results.length>0){var n=o.results[0];o.list=this.getItemList(n.list),o.total_page=n.total_page}this.callback(s.COMPLETE,o)}else this.callback(s.FAULT,"获取模版列表发生错误\n(ERROR_CODE="+o.err_code+"MSG="+o.err_msg+")")}catch(i){this.callback(s.FAULT,"解析返回结果出错："+i.message)}},e.prototype.onFaultHandler=function(t){this.callback(s.FAULT,"接口IO错误！")},e.prototype.getItemList=function(t){for(var e=[],o=0,n=t;o<n.length;o++){var i=n[o],r=u.fillModelByObject(i,new m);e.push(r)}return e},e}(l);e.GetTemplateListInterface=p,__reflect(p.prototype,"cdcommon.editor.services.GetTemplateListInterface")}(o=e.services||(e.services={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(e){var o;!function(e){var o=egret.URLRequest,n=egret.URLRequestMethod,i=egret.URLVariables,r=t.framework.constants.APIConstant,a=t.framework.managers.APIConfig,s=t.framework.events.InterfaceEvent,l=t.framework.services.InterfaceBase,d=t.framework.utils.APIUtils,c=t.editor.dtos.GetTemplateThemeListParamDTO,h=t.editor.dtos.GetTemplateThemeListResultDTO,u=t.editor.models.TemplateThemeItem,m=t.framework.managers.ModelDataGenerator,p=function(t){function e(e){return t.call(this,e)||this}return __extends(e,t),e.prototype.call=function(e){if(t.prototype.call.call(this,e),e instanceof c){var s=e;this.request=new o(a.getItem(r.GET_TEMPLATE_THEME_LIST).url),this.request.method=n.POST;var l=new i;l.variables={},l.variables.sp_id=s.sp_id,l.variables.type_id=s.type_id,this.request.data=l,this.loader.load(this.request)}},e.prototype.onResultHandler=function(t){try{var e=JSON.parse(this.loader.data),o=d.json2ResultDTO(e,new h);if(o.success){if(o.results.length>0){var n=o.results[0];o.list=this.getItemList(n.list)}this.callback(s.COMPLETE,o)}else this.callback(s.FAULT,"获取模版主题列表发生错误\n(ERROR_CODE="+o.err_code+"MSG="+o.err_msg+")")}catch(i){this.callback(s.FAULT,"解析返回结果出错："+i.message)}},e.prototype.onFaultHandler=function(t){this.callback(s.FAULT,"接口IO错误！")},e.prototype.getItemList=function(t){for(var e=[],o=0,n=t;o<n.length;o++){var i=n[o],r=m.fillModelByObject(i,new u);e.push(r)}return e},e}(l);e.GetTemplateThemeListInterface=p,__reflect(p.prototype,"cdcommon.editor.services.GetTemplateThemeListInterface")}(o=e.services||(e.services={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(t){var e;!function(t){var e=function(){function t(){}return t.UNSTARTED="unstarted",t.RUNNING="running",t.COMPLETED="completed",t.FAULT="fault",t}();t.TaskState=e,__reflect(e.prototype,"cdcommon.framework.task.TaskState")}(e=t.task||(t.task={}))}(e=t.framework||(t.framework={}))}(cdcommon||(cdcommon={}));var GetWorkIDInterface=cdcommon.editor.services.GetWorkIDInterface,GetWorkInterface=cdcommon.editor.services.GetWorkInterface,GetAgentInfoInterface=cdcommon.editor.services.GetAgentInfoInterface,GetSupplierInfoInterface=cdcommon.editor.services.GetSupplierInfoInterface,GetGoodsInterface=cdcommon.editor.services.GetGoodsInterface,GetSupplierInfoParamDTO=cdcommon.editor.dtos.GetSupplierInfoParamDTO,GetSupplierInfoResultDTO=cdcommon.editor.dtos.GetSupplierInfoResultDTO,GetGoodsResultDTO=cdcommon.editor.dtos.GetGoodsResultDTO,GetAgentInfoParamDTO=cdcommon.editor.dtos.GetAgentInfoParamDTO,GetAgentInfoResultDTO=cdcommon.editor.dtos.GetAgentInfoResultDTO,GetGoodsParamDTO=cdcommon.editor.dtos.GetGoodsParamDTO,GetWorkParamDTO=cdcommon.editor.dtos.GetWorkParamDTO,GetWorkResultDTO=cdcommon.editor.dtos.GetWorkResultDTO,WorksStatusConstant=cdcommon.editor.constants.WorksStatusConstant,EditorModeConstant=cdcommon.editor.constants.EditorModeConstant,InterfaceEvent=cdcommon.framework.events.InterfaceEvent,ArgumentModel=models.ArgumentModel,ArgumentConstant=cdcommon.editor.constants.ArgumentConstant,UserModel=cdcommon.framework.models.UserModel,UserModelController=cdcommon.framework.managers.UserModelController,ScenesManager=cdcommon.framework.managers.ScenesManager,EditorTypeConstant=cdcommon.editor.constants.EditorTypeConstant,WorkModel=cdcommon.editor.models.WorkModel,WorkModelController=cdcommon.editor.managers.WorkModelController,EditorCommon=cdcommon.editor.models.EditorCommon,GlobalCommon=cdcommon.framework.models.GlobalCommon,AlertPic=cdcommon.framework.components.AlertPic,PhotoTools=cdcommon.editor.utils.PhotoTools,GoodsTypeConstant=cdcommon.editor.constants.GoodsTypeConstant,PrinterOverview=views.PrinterOverview,Main=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.getUrlParam=function(t){var e=new RegExp("(^|&)"+t+"=([^&]*)(&|$)","i"),o=location.search.substr(1).match(e);return null!=o?decodeURI(decodeURIComponent(decodeURI(o[2]))):null},e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.stage.scaleMode=egret.StageScaleMode.NO_SCALE,egret.lifecycle.addLifecycleListener(function(t){}),egret.lifecycle.onPause=function(){},egret.lifecycle.onResume=function(){};var e=new AssetAdapter;egret.registerImplementation("eui.IAssetAdapter",e),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),egret.ImageLoader.crossOrigin="anonymous",this.initApp()["catch"](function(t){console.log(t)}),console.log("当前设备舞台宽度高度："+egret.MainContext.instance.stage.stageWidth+"x"+egret.MainContext.instance.stage.stageHeight)},e.prototype.getArgumentModel=function(){var t=new ArgumentModel;return t.supplierId=this.getUrlParam(ArgumentConstant.SUPPLIER_ID),t.agentId=this.getUrlParam(ArgumentConstant.AGENT_ID),t.workId=this.getUrlParam(ArgumentConstant.WORK_ID),t.goodsId=this.getUrlParam(ArgumentConstant.GOODS_ID),t.productId=this.getUrlParam(ArgumentConstant.PRODUCT_ID),t.templateId=this.getUrlParam(ArgumentConstant.TEMPLATE_ID),t.userId=this.getUrlParam(ArgumentConstant.USER_ID),t.pageCount=isNaN(parseInt(this.getUrlParam(ArgumentConstant.PAGE_COUNT)))?0:parseInt(this.getUrlParam(ArgumentConstant.PAGE_COUNT)),t.orderNo=this.getUrlParam(ArgumentConstant.ORDER_NO),t.editorMode=this.getUrlParam(ArgumentConstant.EDITOR_MODE),t.goodsId&&t.templateId?t.editorType=EditorTypeConstant.OPEN:t.workId&&(t.editorType=EditorTypeConstant.WORK),t},e.prototype.initApp=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return document.title="爱美印记",GlobalCommon.rootContainer=this,ScenesManager.getInstance().rootLayer=this,this.argumentModel=this.getArgumentModel(),this.createLoadingView(),[4,this.loadResource()];case 1:return t.sent(),[4,this.loadEnv()];case 2:return t.sent(),[4,this.getCommonData()];case 3:return t.sent(),this.removeLoadingView(),this.createMainScene(),[2]}})})},e.prototype.createLoadingView=function(){this.loadingView=new LoadingUI,this.loadingView.width=this.stage.stageWidth,this.loadingView.height=this.stage.stageHeight,this.stage.addChild(this.loadingView)},e.prototype.removeLoadingView=function(){this.stage.removeChild(this.loadingView),this.loadingView=null},e.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return e.trys.push([0,6,,7]),[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return e.sent(),[4,this.loadTheme()];case 2:return e.sent(),[4,RES.loadGroup("preload",0,this.loadingView)];case 3:return e.sent(),[4,RES.loadGroup("editor",0,this.loadingView)];case 4:return e.sent(),[4,RES.loadGroup("printer",0,this.loadingView)];case 5:return e.sent(),[3,7];case 6:return t=e.sent(),console.error(t),[3,7];case 7:return[2]}})})},e.prototype.loadTheme=function(){var t=this;return new Promise(function(e,o){var n=new eui.Theme("resource/default.thm.json",t.stage);n.addEventListener(eui.UIEvent.COMPLETE,function(){e()},t)})},e.prototype.loadEnv=function(){var t=this;return new Promise(function(e,o){var n=new EnvironmentConfig;n.once("envReady",function(){e()},t),n.initEnvConfig(GlobalCommon.API_CONFIG_URL)})},e.prototype.getCommonData=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.getSupplierInfo()];case 1:return t.sent(),this.argumentModel.editorType!=EditorTypeConstant.OPEN?[3,5]:this.argumentModel.agentId?[4,this.getAgentInfo()]:[3,3];case 2:t.sent(),t.label=3;case 3:return[4,this.getGoodsInfo()];case 4:return t.sent(),[3,8];case 5:return this.argumentModel.editorType!=EditorTypeConstant.WORK?[3,8]:[4,this.getWorkInfo()];case 6:return t.sent(),[4,this.getGoodsInfo()];case 7:t.sent(),t.label=8;case 8:return[2]}})})},e.prototype.getSupplierInfo=function(){var t=this;return new Promise(function(e,o){var n=function(t){if(t.type==InterfaceEvent.COMPLETE){var n=t.data,i=UserModelController.getInstance().userModel;i.supplierInfo=n.info,e()}else console.log("商家信息获取失败，请尝试刷新页面或重新进入系统。"+t.data),o()},i=new GetSupplierInfoInterface;i.once(InterfaceEvent.COMPLETE,n,t),i.once(InterfaceEvent.FAULT,n,t);var r=new GetSupplierInfoParamDTO;r.sp_id=t.argumentModel.supplierId,i.call(r)})},e.prototype.getAgentInfo=function(){var t=this;return new Promise(function(e,o){var n=function(t){if(t.type==InterfaceEvent.COMPLETE){var n=t.data,i=UserModelController.getInstance().userModel;i.agentInfo=n.info,e()}else console.log("分销商信息失败，请尝试刷新页面或重新进入系统。"+t.data),o()},i=new GetAgentInfoInterface;i.once(InterfaceEvent.COMPLETE,n,t),i.once(InterfaceEvent.FAULT,n,t);var r=new GetAgentInfoParamDTO;r.agent_id=t.argumentModel.agentId,i.call(r)})},e.prototype.getGoodsInfo=function(){var t=this,e=this;return new Promise(function(o,n){var i=function(t){if(t.type==InterfaceEvent.COMPLETE){var i=t.data;i.type_id==GoodsTypeConstant.PHOTO_BOOK?e.argumentModel.editorMode=EditorModeConstant.AUTO_APPLY_LAYOUT:i.type_id==GoodsTypeConstant.PRINT?e.argumentModel.editorMode=EditorModeConstant.PRINTING:e.argumentModel.editorMode=EditorModeConstant.NORMAL,o()}else console.log("分销商信息失败，请尝试刷新页面或重新进入系统。"+t.data),n()},r=new GetGoodsInterface;r.once(InterfaceEvent.COMPLETE,i,t),r.once(InterfaceEvent.FAULT,i,t);var a=new GetGoodsParamDTO;a.goods_id=t.argumentModel.goodsId,a.product_id=t.argumentModel.productId,r.call(a)})},e.prototype.getWorkInfo=function(){var t=this,e=this;return new Promise(function(o,n){var i=function(t){if(t.type==InterfaceEvent.COMPLETE){var i=t.data;i.status==WorksStatusConstant.DOING?e.argumentModel.displayOnly=0:e.argumentModel.displayOnly=1,e.argumentModel.goodsId=i.goods_id,e.argumentModel.productId=i.product_id,o()}else console.log("作品信息获取失败，请尝试刷新页面或重新进入系统。"+t.data),n()},r=new GetWorkInterface;r.once(InterfaceEvent.COMPLETE,i,t),r.once(InterfaceEvent.FAULT,i,t);var a=new GetWorkParamDTO;a.wid=t.argumentModel.workId,r.call(a)})},e.prototype.createMainScene=function(){mouse.enable(this.stage),ScenesManager.getInstance().rootLayer=this;var t=new WorkModel;if(t.workId=this.argumentModel.workId,t.goodsId=this.argumentModel.goodsId,t.productId=this.argumentModel.productId,t.templateId=this.argumentModel.templateId,t.pageCount=this.argumentModel.pageCount,t.uid=this.argumentModel.userId,t.agentId=this.argumentModel.agentId,this.argumentModel.orderNo&&(t.workExtraInfo.order_id=this.argumentModel.orderNo),t.status=this.argumentModel.displayOnly?WorksStatusConstant.SUBMITTED:WorksStatusConstant.DOING,WorkModelController.getInstance().workModel=t,EditorCommon.editorType=this.argumentModel.editorType,this.argumentModel.editorMode&&(EditorCommon.editorMode=this.argumentModel.editorMode),EditorCommon.editorMode==EditorModeConstant.PRINTING){var e=new PrinterOverview;e.percentWidth=e.percentHeight=100,this.argumentModel.displayOnly?e.skinName="app.PrinterOverviewPreviewSkin":e.skinName="app.PrinterOverviewSkin",e.once(eui.UIEvent.CREATION_COMPLETE,function(o){e.init(t)},this),this.addChild(e)}},e}(eui.UILayer);__reflect(Main.prototype,"Main");var DebugPlatform=function(){function t(){}return t.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,{nickName:"username"}]})})},t.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);var cdcommon;!function(t){var e;!function(t){var e;!function(t){var e=function(){function t(){this.indexName="",this.content="",this.relatedModelId=""}return t}();t.EditableTextItem=e,__reflect(e.prototype,"cdcommon.editor.models.EditableTextItem")}(e=t.models||(t.models={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(t){var e;!function(t){var e=function(){function t(){}return t.prototype.addChild=function(t,e){t.addChild(e)},t.prototype.removeChild=function(t,e){t.removeChild(e)},t}();t.ChildManager=e,__reflect(e.prototype,"cdcommon.framework.objecthandles.ChildManager")}(e=t.objecthandles||(t.objecthandles={}))}(e=t.framework||(t.framework={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(t){var e;!function(t){var e=eui.Component,o=function(t){function e(){var e=t.call(this)||this;return e._lineWeight=3,e._thicknessWidth=10,e}return __extends(e,t),Object.defineProperty(e.prototype,"lineWeight",{get:function(){return this._lineWeight},set:function(t){this._lineWeight=t,this.leftLine&&(this.leftLine.width=t),this.rightLine&&(this.rightLine.width=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"thicknessWidth",{get:function(){return this._thicknessWidth},set:function(t){this._thicknessWidth=t,this.spacer&&(this.spacer.width=t)},enumerable:!0,configurable:!0}),e.prototype.partAdded=function(e,o){t.prototype.partAdded.call(this,e,o),o==this.spacer?this.spacer.width=this._thicknessWidth:o==this.leftLine?this.leftLine.width=this._lineWeight:o==this.rightLine&&(this.rightLine.width=this._lineWeight)},e}(e);t.FaceThickness=o,__reflect(o.prototype,"cdcommon.editor.components.FaceThickness")}(e=t.components||(t.components={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(t){var e;!function(t){var e=function(){function t(){}return t}();t.SubmitCheckResultItem=e,__reflect(e.prototype,"cdcommon.editor.models.SubmitCheckResultItem")}(e=t.models||(t.models={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(t){var e;!function(t){var e=egret.Event,o=function(t){function e(o){return t.call(this,e.HANDLE_CLICKED,!1,!1)||this}return __extends(e,t),e.prototype.clone=function(){return new e(this.clickedHandle)},e.HANDLE_CLICKED="handleClicked",e}(e);t.HandleClickedEvent=o,__reflect(o.prototype,"cdcommon.framework.objecthandles.HandleClickedEvent")}(e=t.objecthandles||(t.objecthandles={}))}(e=t.framework||(t.framework={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(t){var e;!function(t){var e=egret.Point,o=function(){function o(){}return o.DEFAULT_DEFINITION=[new t.HandleDescription(t.HandleRoles.RESIZE_UP+t.HandleRoles.RESIZE_LEFT,new e(0,0),new e(0,0)),new t.HandleDescription(t.HandleRoles.RESIZE_UP,new e(50,0),new e(0,0)),new t.HandleDescription(t.HandleRoles.RESIZE_UP+t.HandleRoles.RESIZE_RIGHT,new e(100,0),new e(0,0)),new t.HandleDescription(t.HandleRoles.RESIZE_RIGHT,new e(100,50),new e(0,0)),new t.HandleDescription(t.HandleRoles.RESIZE_DOWN+t.HandleRoles.RESIZE_RIGHT,new e(100,100),new e(0,0)),new t.HandleDescription(t.HandleRoles.RESIZE_DOWN,new e(50,100),new e(0,0)),new t.HandleDescription(t.HandleRoles.RESIZE_DOWN+t.HandleRoles.RESIZE_LEFT,new e(0,100),new e(0,0)),new t.HandleDescription(t.HandleRoles.RESIZE_LEFT,new e(0,50),new e(0,0)),new t.HandleDescription(t.HandleRoles.ROTATE,new e(100,50),new e(20,0))],o.NO_ROTATE_DEFINITION=[new t.HandleDescription(t.HandleRoles.RESIZE_UP+t.HandleRoles.RESIZE_LEFT,new e(0,0),new e(0,0)),new t.HandleDescription(t.HandleRoles.RESIZE_UP,new e(50,0),new e(0,0)),new t.HandleDescription(t.HandleRoles.RESIZE_UP+t.HandleRoles.RESIZE_RIGHT,new e(100,0),new e(0,0)),new t.HandleDescription(t.HandleRoles.RESIZE_RIGHT,new e(100,50),new e(0,0)),new t.HandleDescription(t.HandleRoles.RESIZE_DOWN+t.HandleRoles.RESIZE_RIGHT,new e(100,100),new e(0,0)),new t.HandleDescription(t.HandleRoles.RESIZE_DOWN,new e(50,100),new e(0,0)),new t.HandleDescription(t.HandleRoles.RESIZE_DOWN+t.HandleRoles.RESIZE_LEFT,new e(0,100),new e(0,0)),new t.HandleDescription(t.HandleRoles.RESIZE_LEFT,new e(0,50),new e(0,0))],o.DEFAULT_PLUS_MOVE_DEFINITION=[new t.HandleDescription(t.HandleRoles.MOVE,new e(50,50),new e(0,0)),new t.HandleDescription(t.HandleRoles.RESIZE_UP+t.HandleRoles.RESIZE_LEFT,new e(0,0),new e(0,0)),new t.HandleDescription(t.HandleRoles.RESIZE_UP,new e(50,0),new e(0,0)),new t.HandleDescription(t.HandleRoles.RESIZE_UP+t.HandleRoles.RESIZE_RIGHT,new e(100,0),new e(0,0)),new t.HandleDescription(t.HandleRoles.RESIZE_RIGHT,new e(100,50),new e(0,0)),new t.HandleDescription(t.HandleRoles.RESIZE_DOWN+t.HandleRoles.RESIZE_RIGHT,new e(100,100),new e(0,0)),new t.HandleDescription(t.HandleRoles.RESIZE_DOWN,new e(50,100),new e(0,0)),new t.HandleDescription(t.HandleRoles.RESIZE_DOWN+t.HandleRoles.RESIZE_LEFT,new e(0,100),new e(0,0)),new t.HandleDescription(t.HandleRoles.RESIZE_LEFT,new e(0,50),new e(0,0)),new t.HandleDescription(t.HandleRoles.ROTATE,new e(100,50),new e(20,0))],o}();t.HandleDefinitions=o,__reflect(o.prototype,"cdcommon.framework.objecthandles.HandleDefinitions")}(e=t.objecthandles||(t.objecthandles={}))}(e=t.framework||(t.framework={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(t){var e;!function(t){var e=function(){function t(){this.now=new Date,this.nowDayOfWeek=this.now.getDay(),this.nowDay=this.now.getDate(),this.nowMonth=this.now.getMonth(),this.nowYear=this.now.getFullYear()}return t.prototype.addTiem=function(){this.nowYear+=this.nowYear<2e3?1900:0},t.prototype.formatDate=function(t,e){void 0===e&&(e="-");var o=t.getFullYear(),n=t.getMonth()+1,i=t.getDate();return o+e+n+e+i},t.prototype.getCurrentDate=function(){var t=this.now.getMonth()+1,e=this.now.getDate();10>t&&(t="0"+t),10>e&&(e="0"+e);var o=this.now.getFullYear()+"-"+t+"-"+e;return o},t.prototype.dayOfWeek=function(t){return t.getDay()},t.prototype.getMonthDays=function(t){this.addTiem();var e=new Date(this.nowYear,t,1),o=new Date(this.nowYear,t+1,1),n=(o-e)/864e5;return n},t.prototype.getMonthWeeks=function(t){var e=0,o=this.getMonthDays(t),n=7-this.dayOfWeek(new Date(t.getFullYear(),t.getMonth(),1)),i=(o-n)%7;return e+=Math.floor((o-n)/7)+1,0!=i&&(e+=1),e},t.prototype.getYesterDay=function(t){var e=new Date(t);e.setDate(e.getDate()-1);var o=e.getFullYear()+"-"+(e.getMonth()+1)+"-"+e.getDate();return o},t.prototype.getTomorrow=function(t){var e=new Date(t);e.setDate(e.getDate()+1);var o=e.getMonth()+1,n=e.getDate();10>o&&(o="0"+o),10>n&&(n="0"+n);var i=e.getFullYear()+"-"+o+"-"+n;return i},t.prototype.getQuarterStartMonth=function(){var t=0;return this.nowMonth<3&&(t=0),2<this.nowMonth&&this.nowMonth<6&&(t=3),5<this.nowMonth&&this.nowMonth<9&&(t=6),this.nowMonth>8&&(t=9),t},t.prototype.getSevenDaysDate=function(t){var e=new Date,o=new Date;o.setDate(e.getDate()+t);var n=o.getMonth()+1,i=o.getDate();10>n&&(n="0"+n),10>i&&(i="0"+i);var r=o.getFullYear()+"-"+n+"-"+i;return r},t.prototype.getWeekStartDate=function(){this.addTiem();var t=new Date(this.nowYear,this.nowMonth,this.nowDay-this.nowDayOfWeek);return this.formatDate(t)},t.prototype.getWeekEndDate=function(){this.addTiem();var t=new Date(this.nowYear,this.nowMonth,this.nowDay+(6-this.nowDayOfWeek));return this.formatDate(t)},t.prototype.getLastWeekStartDate=function(){var t=new Date(this.nowYear,this.nowMonth,this.nowDay-this.nowDayOfWeek-7);return this.formatDate(t)},t.prototype.getLastWeekEndDate=function(){var t=new Date(this.nowYear,this.nowMonth,this.nowDay-this.nowDayOfWeek-1);return this.formatDate(t)},t.prototype.getMonthStartDate=function(){this.addTiem();var t=new Date(this.nowYear,this.nowMonth,1);return this.formatDate(t)},t.prototype.getMonthEndDate=function(){this.addTiem();var t=new Date(this.nowYear,this.nowMonth,this.getMonthDays(this.nowMonth));return this.formatDate(t)},t.prototype.getLastMonthStartDate=function(){var t=new Date;t.setDate(1),t.setMonth(t.getMonth()-1);var e=(t.getFullYear(),t.getMonth()),o=new Date(this.nowYear,e,1);return this.formatDate(o)},t.prototype.getLastMonthEndDate=function(){this.addTiem();var t=new Date;t.setDate(1),t.setMonth(t.getMonth()-1);var e=(t.getFullYear(),t.getMonth()),o=new Date(this.nowYear,e,this.getMonthDays(e));return this.formatDate(o)},t.prototype.getQuarterStartDate=function(){this.addTiem();var t=new Date(this.nowYear,this.getQuarterStartMonth(),1);return this.formatDate(t)},t.prototype.getQuarterEndDate=function(){this.addTiem();var t=this.getQuarterStartMonth()+2,e=new Date(this.nowYear,t,this.getMonthDays(t));return this.formatDate(e)},t}();t.DateUtils2=e,__reflect(e.prototype,"cdcommon.framework.utils.DateUtils2")}(e=t.utils||(t.utils={}))}(e=t.framework||(t.framework={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(t){var e;!function(t){var e=function(){function t(){}return t.TEMPLATE="template",t.COMMON="common",t.CUSTOM="custom",t}();t.MaterialGroupConstant=e,__reflect(e.prototype,"cdcommon.editor.constants.MaterialGroupConstant")}(e=t.constants||(t.constants={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(t){var e;!function(t){var e=eui.ItemRenderer,o=function(t){function e(){return t.call(this)||this}return __extends(e,t),e}(e);t.ListItemRendererBase=o,__reflect(o.prototype,"cdcommon.editor.components.ListItemRendererBase")}(e=t.components||(t.components={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(e){var o;!function(e){var o=t.framework.task.Task,n=t.editor.utils.PhotoTools,i=t.framework.utils.ImageDataConverter,r=t.framework.utils.TimeID,a=t.editor.managers.WorkModelController,s=t.framework.oss.OssVar,l=function(t){function e(e){var o=t.call(this)||this;return o.photoItem=null,o.photoItem=e,o}return __extends(e,t),e.prototype.performTask=function(){this.initOSSUploader()},e.prototype.toBlob=function(t,e){return void 0===e&&(e=null),new i(t).dataURItoBlob()},e.prototype.initOSSUploader=function(){var t=this,e=a.getInstance().workModel,o=r.osspath0+r.osspath1()+r.osspath2(e.workId)+t.photoItem.id+"."+t.photoItem.ext.toLocaleLowerCase(),i=function(e){console.log("Plupload version: ",plupload.VERSION),console.log("savePath",o),console.log("BASE64_POLICY",s.BASE64_POLICY),console.log("ACCESS_KEY_ID",s.ACCESS_KEY_ID),console.log("ACCESS_SIGN",s.ACCESS_SIGN),console.log("HOST",s.HOST),console.log("========================================"),t.uploader=e;var n={key:o,policy:s.BASE64_POLICY,OSSAccessKeyId:s.ACCESS_KEY_ID,success_action_status:"200",signature:s.ACCESS_SIGN};e.setOption({url:s.HOST,multipart_params:n}),e.addFile(t.photoItem.fileRef),e.start()},l=function(t,e){for(var o=0,n=e;o<n.length;o++){var i=n[o];console.log("已添加待上传文件：",i.name)}},d=function(t,e){},c=function(t,e){console.log("正在上传：",e.id,e.percent)},h=function(t,e,n){200==n.status?console.log("upload to oss success！回调内容：",n.response,"http://"+s.OSS_BUCKECT_NAME+"."+s.OSS_ENDPOINT+"/"+o):203==n.status?console.log("上传到OSS成功，但是oss访问用户设置的上传回调服务器失败，失败原因是:",n.response):console.log("上传失败，原因是:",n.response)},u=function(t,e){-600==e.code?console.log("选择的文件太大了,可以根据应用情况，在upload.js 设置一下上传的最大大小"):-601==e.code?console.log("选择的文件后缀不对,可以根据应用情况，在upload.js进行设置可允许的上传文件类型"):-602==e.code?console.log("这个文件已经上传过一遍了"):console.log("Error xml:\n:ERROR CODE:",e.code,"\n",e.response)
},m=new plupload.Uploader({runtimes:"html5,html4",browse_button:document.getElementById("uploadImg"),max_retries:1,url:"http://oss.aliyuncs.com",resize:{width:n.BIG_SIZE_PX,height:n.BIG_SIZE_PX,quality:95,preserve_headers:!1},filters:{mime_types:[{title:"Image files",extensions:"jpg,png,bmp"}],max_file_size:"15mb",prevent_duplicates:!0},init:{PostInit:i,FilesAdded:l,BeforeUpload:d,UploadProgress:c,FileUploaded:h,Error:u}});m.init()},e.prototype.overThis=function(t,e){void 0===e&&(e=null),t?this.complete():this.fault(e)},e}(o);e.PhotoUploadToOSSTask=l,__reflect(l.prototype,"cdcommon.editor.tasks.PhotoUploadToOSSTask")}(o=e.tasks||(e.tasks={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(t){var e;!function(t){var e=function(){function t(t,e,o){this.formatPattern(t,e),this.extractToken=o}return t.prototype.formatValue=function(t){for(var e=this.patternInfo[0],o=this.reqFormat.substring(0,e.begin)+this.extractToken(t,e),n=e,i=this.patternInfo.length,r=1;i>r;r++)e=this.patternInfo[r],o+=this.reqFormat.substring(n.end,e.begin)+this.extractToken(t,e),n=e;return n.end>0&&n.end!=this.reqFormat.length&&(o+=this.reqFormat.substring(n.end)),o},t.prototype.formatPattern=function(t,e){var o=0,n=0,i=0,r=e.split(",");this.reqFormat=t,this.patternInfo=[];for(var a=r.length,s=0;a>s;s++)o=this.reqFormat.indexOf(r[s]),o>=0&&o<this.reqFormat.length&&(n=this.reqFormat.lastIndexOf(r[s]),n=n>=0?n+1:o+1,this.patternInfo.splice(i,0,{token:r[s],begin:o,end:n}),i++);this.patternInfo.sort(this.compareValues)},t.prototype.compareValues=function(t,e){return t.begin>e.begin?1:t.begin<e.begin?-1:0},t}();t.StringFormatter=e,__reflect(e.prototype,"cdcommon.framework.utils.StringFormatter")}(e=t.utils||(t.utils={}))}(e=t.framework||(t.framework={}))}(cdcommon||(cdcommon={}));var ThemeAdapter=function(){function t(){}return t.prototype.getTheme=function(t,e,o,n){function i(t){e.call(n,t)}function r(e){e.resItem.url==t&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,r,null),o.call(n))}var a=this;if("undefined"!=typeof generateEUI)egret.callLater(function(){e.call(n,generateEUI)},this);else if("undefined"!=typeof generateEUI2)RES.getResByUrl("resource/gameEui.json",function(t,o){window.JSONParseClass.setData(t),egret.callLater(function(){e.call(n,generateEUI2)},a)},this,RES.ResourceItem.TYPE_JSON);else if("undefined"!=typeof generateJSON)if(t.indexOf(".exml")>-1){var s=t.split("/");s.pop();var l=s.join("/")+"_EUI.json";generateJSON.paths[t]?egret.callLater(function(){e.call(n,generateJSON.paths[t])},this):RES.getResByUrl(l,function(o){window.JSONParseClass.setData(o),egret.callLater(function(){e.call(n,generateJSON.paths[t])},a)},this,RES.ResourceItem.TYPE_JSON)}else egret.callLater(function(){e.call(n,generateJSON)},this);else RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,r,null),RES.getResByUrl(t,i,this,RES.ResourceItem.TYPE_TEXT)},t}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);var cdcommon;!function(cdcommon){var framework;!function(framework){var utils;!function(utils){var UrlUtils=function(){function UrlUtils(){}return UrlUtils.changeURLPar=function(destiny,par,par_value){var pattern=par+"=([^&]*)",replaceText=par+"="+par_value;if(destiny.match(pattern)){var tmp="/\\"+par+"=[^&]*/";return tmp=destiny.replace(eval(tmp),replaceText)}return destiny.match("[?]")?destiny+"&"+replaceText:destiny+"?"+replaceText},UrlUtils}();utils.UrlUtils=UrlUtils,__reflect(UrlUtils.prototype,"cdcommon.framework.utils.UrlUtils")}(utils=framework.utils||(framework.utils={}))}(framework=cdcommon.framework||(cdcommon.framework={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(t){var e;!function(t){var e=function(){function t(t,e){void 0===t&&(t=void 0),void 0===e&&(e=void 0),this._key=void 0,this._value=void 0,this._key=t,this._value=e}return Object.defineProperty(t.prototype,"key",{get:function(){return this._key},set:function(t){this._key=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"value",{get:function(){return this._value},set:function(t){this._value=t},enumerable:!0,configurable:!0}),t}();t.HashMapEntry=e,__reflect(e.prototype,"cdcommon.framework.hashmap.HashMapEntry")}(e=t.hashmap||(t.hashmap={}))}(e=t.framework||(t.framework={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(t){var e;!function(t){var e=function(){function t(){}return t.generateInPageNames=function(t,e){if(!t)return null;var o,n,i=[],r="$",a=1;for(o=0;e>o;o++){n=t;var s=new RegExp(/[0-9]/g);n=n.replace(s,r);for(var l=0;l<n.length;l++){var d=n.charAt(l);if(d==r){var c=n;n=c.substring(0,l)+a.toString()+c.substring(l+1),a++}}i.push(n)}return i},t}();t.PageNameUtil=e,__reflect(e.prototype,"cdcommon.editor.utils.PageNameUtil")}(e=t.utils||(t.utils={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(t){var e;!function(t){var e=egret.EventDispatcher,o=egret.Matrix,n=egret.Point,i=function(e){function i(){var t=e.call(this)||this;return t.currentlySelected=[],t}return __extends(i,e),i.toRadians=function(t){return t*Math.PI/180},i.prototype.addToSelected=function(e){if(-1==this.currentlySelected.indexOf(e)){if(this.currentlySelected.length>0){var o=this.isSelectionLocked();if(e.hasOwnProperty("locked")){if(o&&!e.locked)return;if(!o&&e.locked)return}}this.currentlySelected.push(e);var n=new t.SelectionEvent(t.SelectionEvent.ADDED_TO_SELECTION);n.targets.push(e),this.dispatchEvent(n)}},i.prototype.isSelected=function(t){return-1!=this.currentlySelected.indexOf(t)},i.prototype.setSelected=function(t){this.clearSelection(),this.addToSelected(t)},i.prototype.removeFromSelected=function(e){var o=this.currentlySelected.indexOf(e);if(-1!=o){this.currentlySelected.splice(o,1);var n=new t.SelectionEvent(t.SelectionEvent.REMOVED_FROM_SELECTION);n.targets.push(e),this.dispatchEvent(n)}},i.prototype.clearSelection=function(){var e=new t.SelectionEvent(t.SelectionEvent.SELECTION_CLEARED);e.targets=this.currentlySelected,this.currentlySelected=[],this.dispatchEvent(e)},i.prototype.isSelectionLocked=function(){for(var t,e=0,o=this.currentlySelected;e<o.length;e++)if(t=o[e],t.hasOwnProperty("locked")&&t.locked)return!0;return!1},i.prototype.getGeometry=function(){var e,o;return 0==this.currentlySelected.length?null:1==this.currentlySelected.length?(e=this.currentlySelected[0],o=new t.DragGeometry,e.hasOwnProperty("x")&&(o.x=e.x),e.hasOwnProperty("y")&&(o.y=e.y),e.hasOwnProperty("width")&&(o.width=e.width),e.hasOwnProperty("height")&&(o.height=e.height),e.hasOwnProperty("rotation")&&(o.rotation=e.rotation),e.hasOwnProperty("locked")&&(o.locked=e.locked),o):this.calculateMultiGeometry()},i.prototype.getGeometryForObject=function(e){var o=e,n=new t.DragGeometry;return o.hasOwnProperty("x")&&(n.x=o.x),o.hasOwnProperty("y")&&(n.y=o.y),o.hasOwnProperty("width")&&(n.width=o.width),o.hasOwnProperty("height")&&(n.height=o.height),o.hasOwnProperty("rotation")&&(n.rotation=o.rotation),o.hasOwnProperty("locked")&&(n.locked=o.locked),n},i.prototype.calculateMultiGeometry=function(){for(var e,r,a=Number.POSITIVE_INFINITY,s=Number.POSITIVE_INFINITY,l=Number.NEGATIVE_INFINITY,d=Number.NEGATIVE_INFINITY,c=new o,h=new n,u=(new n,0),m=this.currentlySelected;u<m.length;u++)r=m[u],c.identity(),r.hasOwnProperty("rotation")&&c.rotate(i.toRadians(r.rotation)),c.translate(r.x,r.y),h.x=0,h.y=0,h=c.transformPoint(h.x,h.y),a=Math.min(a,h.x),s=Math.min(s,h.y),l=Math.max(l,h.x),d=Math.max(d,h.y),h.x=0,h.y=r.height,h=c.transformPoint(h.x,h.y),a=Math.min(a,h.x),s=Math.min(s,h.y),l=Math.max(l,h.x),d=Math.max(d,h.y),h.x=r.width,h.y=0,h=c.transformPoint(h.x,h.y),a=Math.min(a,h.x),s=Math.min(s,h.y),l=Math.max(l,h.x),d=Math.max(d,h.y),h.x=r.width,h.y=r.height,h=c.transformPoint(h.x,h.y),a=Math.min(a,h.x),s=Math.min(s,h.y),l=Math.max(l,h.x),d=Math.max(d,h.y);return e=new t.DragGeometry,e.rotation=0,e.x=a,e.y=s,e.width=l-a,e.height=d-s,e.locked=this.isSelectionLocked()?1:0,e},i}(e);t.ObjectHandlesSelectionManager=i,__reflect(i.prototype,"cdcommon.framework.objecthandles.ObjectHandlesSelectionManager")}(e=t.objecthandles||(t.objecthandles={}))}(e=t.framework||(t.framework={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(t){var e;!function(t){var e=function(){function t(){this.name="",this.source=null,this.index=0}return t}();t.PreviewPageItem=e,__reflect(e.prototype,"cdcommon.editor.models.PreviewPageItem")}(e=t.models||(t.models={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var EventDispatcher=egret.EventDispatcher,URLLoader=egret.URLLoader,URLRequest=egret.URLRequest,IOErrorEvent=egret.IOErrorEvent,URLLoaderDataFormat=egret.URLLoaderDataFormat,URLRequestMethod=egret.URLRequestMethod,XML=egret.XML,APIConfigItem=cdcommon.framework.models.APIConfigItem,APIConfig=cdcommon.framework.managers.APIConfig,EnvironmentConfig=function(t){function e(e){var o=t.call(this,e)||this;return o.loader=new URLLoader,o}return __extends(e,t),e.prototype.readEnvConfig=function(t){RES.getResAsync(t,this.onReadConfigComplete,this)},e.prototype.initEnvConfig=function(t){this.loader.addEventListener(egret.Event.COMPLETE,this.onResultHandler,this),this.loader.addEventListener(IOErrorEvent.IO_ERROR,this.onFaultHandler,this),this.loader.dataFormat=URLLoaderDataFormat.TEXT;var e=new URLRequest(t);this.loader.load(e),console.log("env xml : "+t)},e.prototype.onResultHandler=function(t){this.loader.removeEventListener(egret.Event.COMPLETE,this.onResultHandler,this),this.loader.removeEventListener(IOErrorEvent.IO_ERROR,this.onFaultHandler,this),this.initAPIList(XML.parse(this.loader.data)),this.dispatchEvent(new egret.Event("envReady"))},e.prototype.onFaultHandler=function(t){console.log("load env xml IO_ERROR")},e.prototype.onReadConfigComplete=function(t){this.initAPIList(t),this.dispatchEvent(new egret.Event("envReady"))},e.prototype.initAPIList=function(t){for(var e,o=t.children[0],n=o.children.length,i=0;n>i;i++){e=o.children[i];var r=new APIConfigItem;r.kind=e.$kind,r.name=e.$name,r.url=e.children[0].text,APIConfig.addItem(r)}},e}(EventDispatcher);__reflect(EnvironmentConfig.prototype,"EnvironmentConfig");var cdcommon;!function(t){var e;!function(e){var o;!function(e){var o=egret.URLRequest,n=egret.URLRequestMethod,i=t.framework.constants.APIConstant,r=t.framework.managers.APIConfig,a=t.framework.events.InterfaceEvent,s=t.framework.services.InterfaceBase,l=t.framework.utils.APIUtils,d=egret.URLVariables,c=t.editor.dtos.GetMaterialListParamDTO,h=t.editor.dtos.GetMaterialListResultDTO,u=t.framework.managers.ModelDataGenerator,m=t.framework.managers.UserModelController,p=t.editor.factories.ModelFactory,f=function(t){function e(e){return t.call(this,e)||this}return __extends(e,t),e.prototype.call=function(e){if(t.prototype.call.call(this,e),e instanceof c){var a=e;this.param=a,this.request=new o(r.getItem(i.GET_MATERIAL_LIST).url),this.request.method=n.POST;var s=m.getInstance().userModel.supplierInfo.spId,l=new d;l.variables={},l.variables.sp_id=s,l.variables.material_kind=a.material_kind,l.variables.style_id=a.style_id,l.variables.size_id=a.size_id,l.variables.tid=a.tid,l.variables.source=a.source,l.variables.size=a.size,l.variables.index=a.index-1,this.request.data=l,this.loader.load(this.request)}},e.prototype.onResultHandler=function(t){try{var e=JSON.parse(this.loader.data),o=l.json2ResultDTO(e,new h);if(o.success){if(o.results.length>0){var n=o.results[0];o.list=this.getItemList(n.list,this.param.material_kind),o.total_page=n.total_page}this.callback(a.COMPLETE,o)}else this.callback(a.FAULT,"获取素材列表发生错误\n(ERROR_CODE="+o.err_code+"MSG="+o.err_msg+")")}catch(i){this.callback(a.FAULT,"解析返回结果出错："+i.message)}},e.prototype.onFaultHandler=function(t){this.callback(a.FAULT,"接口IO错误！")},e.prototype.getItemList=function(t,e){for(var o=[],n=0,i=t;n<i.length;n++){var r=i[n],a=u.fillModelByObject(r,p.createMaterialModel(this.param.material_kind));o.push(a)}return o},e}(s);e.GetMaterialListInterface=f,__reflect(f.prototype,"cdcommon.editor.services.GetMaterialListInterface")}(o=e.services||(e.services={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(e){var o;!function(e){var o=egret.URLRequest,n=egret.URLRequestMethod,i=t.framework.constants.APIConstant,r=t.framework.managers.APIConfig,a=t.framework.events.InterfaceEvent,s=t.framework.services.InterfaceBase,l=t.framework.utils.APIUtils,d=egret.URLVariables,c=t.editor.dtos.GetMaterialStyleListParamDTO,h=t.editor.dtos.GetMaterialStyleListResultDTO,u=t.editor.models.MaterialStyleItem,m=t.framework.managers.ModelDataGenerator,p=t.framework.managers.UserModelController,f=function(t){function e(e){return t.call(this,e)||this}return __extends(e,t),e.prototype.call=function(e){if(t.prototype.call.call(this,e),e instanceof c){var a=e;this.request=new o(r.getItem(i.GET_MATERIAL_STYLE_LIST).url),this.request.method=n.POST;var s=p.getInstance().userModel.supplierInfo.spId,l=new d;l.variables={},l.variables.sp_id=s,l.variables.material_kind=a.material_kind,l.variables.goods_type=a.goods_type,this.request.data=l,this.loader.load(this.request)}},e.prototype.onResultHandler=function(t){try{var e=JSON.parse(this.loader.data),o=l.json2ResultDTO(e,new h);if(o.success){if(o.results.length>0){var n=o.results[0];o.list=this.getItemList(n.list)}this.callback(a.COMPLETE,o)}else this.callback(a.FAULT,"获取素材分类列表发生错误\n(ERROR_CODE="+o.err_code+"MSG="+o.err_msg+")")}catch(i){this.callback(a.FAULT,"解析返回结果出错："+i.message)}},e.prototype.onFaultHandler=function(t){this.callback(a.FAULT,"接口IO错误！")},e.prototype.getItemList=function(t){for(var e=[],o=0,n=t;o<n.length;o++){var i=n[o],r=m.fillModelByObject(i,new u);e.push(r)}return e},e}(s);e.GetMaterialStyleListInterface=f,__reflect(f.prototype,"cdcommon.editor.services.GetMaterialStyleListInterface")}(o=e.services||(e.services={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(e){var o;!function(e){var o=egret.URLRequest,n=egret.URLRequestMethod,i=t.framework.constants.APIConstant,r=t.framework.managers.APIConfig,a=t.framework.events.InterfaceEvent,s=t.framework.services.InterfaceBase,l=t.framework.utils.APIUtils,d=egret.URLVariables,c=t.editor.dtos.GetPhotoListParamDTO,h=t.editor.dtos.GetPhotoListResultDTO,u=t.editor.models.PhotoVO,m=t.framework.managers.ModelDataGenerator,p=function(t){function e(e){return t.call(this,e)||this}return __extends(e,t),e.prototype.call=function(e){if(t.prototype.call.call(this,e),e instanceof c){var a=e;this.request=new o(r.getItem(i.GET_PHOTO_LIST).url),this.request.method=n.POST;var s=new d;s.variables={},s.variables.wid=a.wid,this.request.data=s,this.loader.load(this.request)}},e.prototype.onResultHandler=function(t){try{var e=JSON.parse(this.loader.data),o=l.json2ResultDTO(e,new h);if(o.success){if(o.results.length>0){var n=o.results[0];o.list=this.getItemList(n.list)}this.callback(a.COMPLETE,o)}else this.callback(a.FAULT,"获取图片列表发生错误\n(ERROR_CODE="+o.err_code+"MSG="+o.err_msg+")")}catch(i){this.callback(a.FAULT,"解析返回结果出错："+i.message)}},e.prototype.onFaultHandler=function(t){this.callback(a.FAULT,"接口IO错误！")},e.prototype.getItemList=function(t){var e=[];for(var o in t){var n=m.fillModelByObject(o,new u);n.add_time*=1e3,e.push(n)}return e},e}(s);e.GetPhotoListInterface=p,__reflect(p.prototype,"cdcommon.editor.services.GetPhotoListInterface")}(o=e.services||(e.services={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(t){var e;!function(t){var e=egret.Event,o=function(t){function e(e,o,n,i){return t.call(this,e,o,n,i)||this}return __extends(e,t),e.prototype.clone=function(){var t=new e(this.type,this.bubbles,this.cancelable,this.data);return t.item=this.item,t},e.ITEM_CLICK="itemClick",e.REMOVE_PAGE="removePage",e.SELECTION_CHANGE="selectionChange",e.PAGE_ADJUSTMENT="pageAdjustment",e.RESET_PAGE="resetPage",e.PAGE_INIT_COMPLETE="pageInitComplete",e.ALL_PAGE_CREATION_COMPLETE="allPageCreationComplete",e.ALL_PAGE_CONTENT_LOAD_COMPLETE="allPageContentLoadComplete",e}(e);t.PageListEvent=o,__reflect(o.prototype,"cdcommon.editor.events.PageListEvent")}(e=t.events||(t.events={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));var uploads;!function(t){var e=function(){function t(){this.region="",this.endpoint="",this.bucketname="",this.accesskeyid="",this.domain=""}return t}();t.OSSBucket=e,__reflect(e.prototype,"uploads.OSSBucket")}(uploads||(uploads={}));var cdcommon;!function(t){var e;!function(e){var o;!function(e){var o=egret.Event,n=egret.EventDispatcher,i=egret.IOErrorEvent,r=t.framework.events.ResourceLoadedEvent,a=t.framework.components.AlertPic,s=t.framework.models.IconCommonProvider,l=egret.URLLoader,d=egret.URLRequest,c=function(t){function e(){var e=t.call(this)||this;return e.curPath="",e.curLoadedIndex=0,e.isMultipleLoading=!1,e.loader||(e.loader=new l),e}return __extends(e,t),e.prototype.loadResource=function(t,e){void 0===e&&(e=null),this.loader.addEventListener(o.COMPLETE,this.loadResourceComplete,this),this.loader.addEventListener(i.IO_ERROR,this.onIOErrorHandler,this),this.loader.load(new d(t)),e&&(this.loader.dataFormat=e),this.curPath=t},e.prototype.loadResources=function(t){this.isMultipleLoading||(this.results?this.results.splice(0):this.results=[],this.isMultipleLoading=!0),this.curPaths!=t&&(this.curPaths=t.concat()),this.loader.addEventListener(o.COMPLETE,this.loadResourcesComplete,this),this.loader.addEventListener(i.IO_ERROR,this.onIOErrorHandler,this),this.loader.load(new d(t[this.curLoadedIndex])),this.curPath=t[this.curLoadedIndex]},e.prototype.loadResourceComplete=function(t){this.loader.removeEventListener(o.COMPLETE,this.loadResourceComplete,this);var e=new r(r.COMPLETE);e.result=t.target.data,this.dispatchEvent(e)},e.prototype.loadResourcesComplete=function(t){if(this.loader.removeEventListener(o.COMPLETE,this.loadResourcesComplete,this),this.results.push(t.target.data),this.curLoadedIndex++,this.curLoadedIndex!=this.curPaths.length)this.loadResources(this.curPaths);else{this.curPaths.splice(0),this.curLoadedIndex=0,this.isMultipleLoading=!1;var e=new r(r.COMPLETE);e.result=this.results,this.dispatchEvent(e)}},e.prototype.onIOErrorHandler=function(t){this.loader.removeEventListener(i.IO_ERROR,this.onIOErrorHandler,this),a.show(s.Alert_ERROR,"无法加载资源: '"+this.curPath,"资源加载失败");var e=new r(r.IO_ERROR);this.dispatchEvent(e)},e}(n);e.ResourceLoadManager=c,__reflect(c.prototype,"cdcommon.framework.managers.ResourceLoadManager")}(o=e.managers||(e.managers={}))}(e=t.framework||(t.framework={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(t){var e;!function(t){var e;!function(t){var e=function(){function t(){}return t.prototype.updateSelected=function(t,e,o){this.updateDecoration(e,o)},t.prototype.updatePosition=function(t,e,o,n){this.updateDecoration(e,n)},t.prototype.cleanup=function(t){t.graphics.clear()},t.prototype.updateDecoration=function(e,o){o.graphics.clear(),o.graphics.lineStyle(t.lineWidth,t.lineColor,t.lineAlpha);for(var n,i=0,r=e;i<r.length;i++)n=r[i],o.graphics.drawRect(n.x,n.y,n.width,n.height)},t.lineWidth=35,t.lineColor=16664606,t.lineAlpha=1,t}();t.OutlineDecorator=e,__reflect(e.prototype,"cdcommon.framework.objecthandles.decorators.OutlineDecorator",["cdcommon.framework.objecthandles.decorators.IDecorator"])}(e=t.decorators||(t.decorators={}))}(e=t.objecthandles||(t.objecthandles={}))}(e=t.framework||(t.framework={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(t){var e;!function(t){var e;!function(t){var e=function(){function t(){}return t.prototype.updateSelected=function(t,e,o){this.drawWeb(t,o)},t.prototype.updatePosition=function(t,e,o,n){this.drawWeb(t,n)},t.prototype.cleanup=function(t){},t.prototype.drawWeb=function(t,e){e.graphics.clear(),e.graphics.lineStyle(5,7829367);for(var o=1;o<t.length;o++)for(var n=o+1;n<t.length;n++)e.graphics.moveTo(t[o].x+t[o].width/2,t[o].y+t[o].height/2),e.graphics.lineTo(t[n].x+t[n].width/2,t[n].y+t[n].height/2)},t}();t.WebDecorator=e,__reflect(e.prototype,"cdcommon.framework.objecthandles.decorators.WebDecorator",["cdcommon.framework.objecthandles.decorators.IDecorator"])}(e=t.decorators||(t.decorators={}))}(e=t.objecthandles||(t.objecthandles={}))}(e=t.framework||(t.framework={}))}(cdcommon||(cdcommon={}));var views;!function(t){var e=egret.TouchEvent,o=cdcommon.framework.managers.PopUpManager,n=cdcommon.framework.components.AlertTip,i=eui.Component,r=cdcommon.framework.utils.CopyUtils,a=function(t){function i(){return t.call(this)||this}return __extends(i,t),i.prototype.close=function(){this.clear(),o.removePopUp(this)},i.prototype.init=function(t){this.worksModel=t},i.prototype.clear=function(){},i.prototype.destroy=function(){this.clear()},i.prototype.createChildren=function(){t.prototype.createChildren.call(this)},i.prototype.partAdded=function(o,n){t.prototype.partAdded.call(this,o,n),n==this.copyWorksNameButton&&this.copyWorksNameButton.addEventListener(e.TOUCH_TAP,this.onCopyWorksNameButtonClick,this)},i.prototype.partRemoved=function(e,o){t.prototype.partRemoved.call(this,e,o)},i.prototype.onCopyWorksNameButtonClick=function(t){try{r.copyToClipboard(this.worksModel.workName),n.show("复制成功！已复制到系统剪切板。",700)}catch(e){n.show("复制失败，请直接在输入框中全选复制。")}},i}(i);t.AgentSubmitWorkResultView=a,__reflect(a.prototype,"views.AgentSubmitWorkResultView")}(views||(views={}));var AssetAdapter=function(){function t(){}return t.prototype.getAsset=function(t,e,o){function n(n){e.call(o,n,t)}if(RES.hasRes(t)){var i=RES.getRes(t);i?n(i):RES.getResAsync(t,n,this)}else RES.getResByUrl(t,n,this,RES.ResourceItem.TYPE_IMAGE)},t}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var TextField=egret.TextField,Shape=egret.Shape,LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.BAR_WIDTH=300,e.BAR_HEIGHT=5,e._barPercent=0,e._percent=0,e.once(egret.Event.ADDED_TO_STAGE,e.createView,e),e.once(egret.Event.REMOVED_FROM_STAGE,e.onRemoved,e),e}return __extends(e,t),e.prototype.onProgress=function(t,e){this._barPercent=t/e*this.BAR_WIDTH,this._percent=Math.round(t/e*100),t/e==1?this.textField.text="资源加载完成...正在初始化":this.textField.text="正在加载资源"+this._percent+"%",this.textField.x=(this.width-this.textField.width)/2,this.textField.y=(this.height-this.textField.height)/2+20,this.changeGraphics()},e.prototype.createView=function(){this.textField=new TextField,this.textField.textColor=15921906,this.textField.size=14,this.addChild(this.textField),this.trackShape=new Shape,this.addChild(this.trackShape),this.progressShape=new Shape,this.addChild(this.progressShape)},e.prototype.onRemoved=function(){},e.prototype.changeGraphics=function(){var t=(this.width-this.BAR_WIDTH)/2,e=(this.height-this.BAR_HEIGHT)/2;this.trackShape.graphics.beginFill(10270139),this.trackShape.graphics.drawRoundRect(t,e,this.BAR_WIDTH,this.BAR_HEIGHT,10,10),this.trackShape.graphics.endFill(),this.progressShape.graphics.beginFill(16461386),this.progressShape.graphics.drawRoundRect(t,e,this._barPercent,this.BAR_HEIGHT,10,10),this.progressShape.graphics.endFill()},e}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var cdcommon;!function(t){var e;!function(t){var e;!function(t){var e=function(){function t(){this.account_id="",this.account_name="",this.group_id="",this.mobile="",this.qq="",this.email="",this.status=0,this.access_token="",this.sp_id="-1",this.identity=""}return t}();t.AccountInfo=e,__reflect(e.prototype,"cdcommon.framework.models.AccountInfo")}(e=t.models||(t.models={}))}(e=t.framework||(t.framework={}))}(cdcommon||(cdcommon={}));var cdcommon;!function(t){var e;!function(e){var o;!function(e){var o=egret.URLRequest,n=egret.URLRequestMethod,i=t.framework.constants.APIConstant,r=t.framework.managers.APIConfig,a=t.framework.events.InterfaceEvent,s=t.framework.services.InterfaceBase,l=t.framework.utils.APIUtils,d=egret.URLVariables,c=t.editor.dtos.GetLayoutListParamDTO,h=t.editor.dtos.GetLayoutListResultDTO,u=t.editor.models.LayoutItem,m=t.framework.managers.ModelDataGenerator,p=t.framework.managers.UserModelController,f=function(t){function e(e){return t.call(this,e)||this}return __extends(e,t),e.prototype.call=function(e){if(t.prototype.call.call(this,e),e instanceof c){var a=e;this.request=new o(r.getItem(i.GET_LAYOUT_LIST).url),this.request.method=n.POST;var s=p.getInstance().userModel.supplierInfo.spId,l=new d;l.variables={},l.variables.sp_id=s,l.variables.size_id=a.size_id,l.variables.kind_id=a.kind_id,l.variables.all_state=a.all_state,l.variables.source=a.source,this.request.data=l,this.loader.load(this.request)}},e.prototype.onResultHandler=function(t){try{var e=JSON.parse(this.loader.data),o=l.json2ResultDTO(e,new h);if(o.success){if(o.results.length>0){var n=o.results[0];o.list=this.getItemList(n.list)}this.callback(a.COMPLETE,o)}else this.callback(a.FAULT,"获取布局列表发生错误\n(ERROR_CODE="+o.err_code+"MSG="+o.err_msg+")")}catch(i){this.callback(a.FAULT,"解析返回结果出错："+i.message)}},e.prototype.onFaultHandler=function(t){this.callback(a.FAULT,"接口IO错误！")},e.prototype.getItemList=function(t){for(var e=[],o=0,n=t;o<n.length;o++){var i=n[o],r=m.fillModelByObject(i,new u);e.push(r)}return e},e}(s);e.GetLayoutListInterface=f,__reflect(f.prototype,"cdcommon.editor.services.GetLayoutListInterface")}(o=e.services||(e.services={}))}(e=t.editor||(t.editor={}))}(cdcommon||(cdcommon={}));